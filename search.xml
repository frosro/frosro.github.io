<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>SpringCloud Alibaba ä¹‹ Sentinel</title>
    <url>/2021/02/08/SpringCloudAlibaba%E4%B9%8BSentinel/</url>
    <content><![CDATA[<p>test</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>Spring Cloud Alibaba</tag>
      </tags>
  </entry>
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹ï¼ˆä¸‰ï¼‰</title>
    <url>/2021/01/09/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    <content><![CDATA[<h3 id="ä¸‰ã€JUC-java-util-concurrent"><a href="#ä¸‰ã€JUC-java-util-concurrent" class="headerlink" title="ä¸‰ã€JUC:java.util.concurrent"></a>ä¸‰ã€JUC:java.util.concurrent</h3><h4 id="3-1-é›†åˆ"><a href="#3-1-é›†åˆ" class="headerlink" title="3.1 é›†åˆ"></a>3.1 é›†åˆ</h4><h5 id="3-1-1-BlockingQueue"><a href="#3-1-1-BlockingQueue" class="headerlink" title="3.1.1 BlockingQueue"></a>3.1.1 BlockingQueue</h5><p><strong>ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿ</strong></p>
<p>é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼šåœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œ è·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»å®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚</p>
<p>é˜»å¡é˜Ÿåˆ—æä¾›äº†å››ç§å¤„ç†æ–¹æ³•:</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•\å¤„ç†æ–¹å¼</th>
<th>æŠ›å‡ºå¼‚å¸¸</th>
<th>è¿”å›ç‰¹æ®Šå€¼</th>
<th>ä¸€ç›´é˜»å¡</th>
<th>è¶…æ—¶é€€å‡º</th>
</tr>
</thead>
<tbody><tr>
<td>æ’å…¥æ–¹æ³•</td>
<td>add(e)</td>
<td>offer(e)</td>
<td>put(e)</td>
<td>offer(e,time,unit)</td>
</tr>
<tr>
<td>ç§»é™¤æ–¹æ³•</td>
<td>remove()</td>
<td>poll()</td>
<td>take()</td>
<td>poll(time,unit)</td>
</tr>
<tr>
<td>æ£€æŸ¥æ–¹æ³•</td>
<td>element()</td>
<td>peek()</td>
<td>ä¸å¯ç”¨</td>
<td>ä¸å¯ç”¨</td>
</tr>
</tbody></table>
<ul>
<li>å¼‚å¸¸ï¼šæ˜¯æŒ‡å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶å€™ï¼Œå†å¾€é˜Ÿåˆ—é‡Œæ’å…¥å…ƒç´ ï¼Œä¼šæŠ›å‡ºIllegalStateException(â€œQueue fullâ€)å¼‚å¸¸ã€‚å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ æ—¶ä¼šæŠ›å‡ºNoSuchElementExceptionå¼‚å¸¸ ã€‚ </li>
<li>è¿”å›ç‰¹æ®Šå€¼ï¼šæ’å…¥æ–¹æ³•ä¼šè¿”å›æ˜¯å¦æˆåŠŸï¼ŒæˆåŠŸåˆ™è¿”å›trueã€‚ç§»é™¤æ–¹æ³•ï¼Œåˆ™æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å‡ºä¸€ä¸ªå…ƒ ç´ ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›null</li>
<li>ä¸€ç›´é˜»å¡ï¼šå½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå¦‚æœç”Ÿäº§è€…çº¿ç¨‹å¾€é˜Ÿåˆ—é‡Œputå…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ï¼Œç›´ åˆ°æ‹¿åˆ°æ•°æ®ï¼Œæˆ–è€…å“åº”ä¸­æ–­é€€å‡ºã€‚å½“é˜Ÿåˆ—ç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹è¯•å›¾ä»é˜Ÿåˆ—é‡Œtakeå…ƒç´ ï¼Œé˜Ÿåˆ—ä¹Ÿä¼šé˜» å¡æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—å¯ç”¨ã€‚ </li>
<li>è¶…æ—¶é€€å‡ºï¼šå½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼Œç”Ÿäº§è€…çº¿ç¨‹å°±ä¼šé€€å‡º</li>
</ul>
<p>é˜»å¡é˜Ÿåˆ—æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">BlockingQueueçš„æ ¸å¿ƒæ–¹æ³•ï¼š</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BlockingQueue</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"> Â  Â <span class="comment">//æ’å…¥å…ƒç´ eåˆ°é˜Ÿåˆ—ä¸­ï¼ŒæˆåŠŸè¿”å›true, å¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœå‘é™å®šäº†å®¹é‡çš„é˜Ÿåˆ—ä¸­æ’å…¥å€¼ï¼Œæ¨ èä½¿ç”¨offer()æ–¹æ³•ã€‚ Â  Â </span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span></span>;</span><br><span class="line"> Â  Â <span class="comment">//æ’å…¥å…ƒç´ eåˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœè®¾ç½®æˆåŠŸè¿”å›true, å¦åˆ™è¿”å›false. eçš„å€¼ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™æŠ›å‡º ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span></span>;</span><br><span class="line"> Â  Â <span class="comment">//æ’å…¥å…ƒç´ eåˆ°é˜Ÿåˆ—ä¸­ï¼Œï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰å¤šä½™çš„ç©ºé—´ï¼Œè¯¥æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å¤šä½™çš„ ç©ºé—´ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line">Â <span class="comment">//åœ¨ç»™å®šçš„æ—¶é—´æ’å…¥å…ƒç´ eåˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœè®¾ç½®æˆåŠŸè¿”å›true, å¦åˆ™è¿”å›false.</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e, <span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"> Â  Â <span class="comment">//æ£€ç´¢å¹¶ä»é˜Ÿåˆ—çš„å¤´éƒ¨åˆ é™¤å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰å€¼ï¼Œçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å€¼ï¼Œå¹¶ä¸”è¯¥ æ–¹æ³•å–å¾—äº†è¯¥å€¼ã€‚</span></span><br><span class="line">    <span class="function">E <span class="title">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"> Â  Â <span class="comment">//åœ¨ç»™å®šçš„æ—¶é—´èŒƒå›´å†…ï¼Œæ£€ç´¢å¹¶ä»é˜Ÿåˆ—çš„å¤´éƒ¨åˆ é™¤å…ƒç´ ï¼Œä»é˜Ÿåˆ—ä¸­è·å–å€¼ï¼Œå¦‚æœæ²¡æœ‰å–åˆ°ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</span></span><br><span class="line">    <span class="function">E <span class="title">poll</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> Â  Â  Â  Â </span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"> Â  Â <span class="comment">//è·å–é˜Ÿåˆ—ä¸­å‰©ä½™çš„ç©ºé—´ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">remainingCapacity</span><span class="params">()</span></span>;</span><br><span class="line"> Â  Â <span class="comment">//ä»é˜Ÿåˆ—ä¸­ç§»é™¤æŒ‡å®šçš„å€¼ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span></span>;</span><br><span class="line"> Â  Â <span class="comment">//åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦åŒ…å«è¯¥å€¼ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span></span>;</span><br><span class="line"> Â  Â <span class="comment">//å°†é˜Ÿåˆ—ä¸­å€¼ï¼Œå…¨éƒ¨ç§»é™¤ï¼Œå¹¶è¿½åŠ åˆ°ç»™å®šçš„é›†åˆä¸­ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">drainTo</span><span class="params">(Collection&lt;? <span class="keyword">super</span> E&gt; c)</span></span>;</span><br><span class="line"> Â  Â <span class="comment">//æŒ‡å®šæœ€å¤šæ•°é‡é™åˆ¶å°†é˜Ÿåˆ—ä¸­å€¼ï¼Œå…¨éƒ¨ç§»é™¤ï¼Œå¹¶è¿½åŠ åˆ°ç»™å®šçš„é›†åˆä¸­ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">drainTo</span><span class="params">(Collection&lt;? <span class="keyword">super</span> E&gt; c, <span class="keyword">int</span> maxElements)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»§æ‰¿å…³ç³»</p>
<ul>
<li><p>å­æ¥å£ï¼š </p>
<p><strong>BlockingDeque</strong></p>
</li>
</ul>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/09/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89/img1.jpg"  alt></p>
<p>â€‹        <strong>TransferQueue</strong></p>
<p>TransferQueueç»§æ‰¿äº†BlockingQueue,å¹¶æ‰©å±•äº†ä¸€äº›æ–°æ–¹æ³•ã€‚ </p>
<p>BlockingQueueæ˜¯æŒ‡è¿™æ ·çš„ä¸€ä¸ªé˜Ÿåˆ—ï¼šå½“ç”Ÿäº§è€…å‘é˜Ÿåˆ—æ·»åŠ å…ƒç´ ä½†é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œç”Ÿäº§è€…ä¼šè¢«é˜»å¡ï¼›å½“æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ç§»é™¤å…ƒç´ ä½†é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…ä¼šè¢«é˜»å¡ã€‚</p>
<p>TransferQueueåˆ™æ›´è¿›ä¸€æ­¥ï¼Œç”Ÿäº§è€…ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æ‰€æ·»åŠ åˆ°é˜Ÿåˆ—çš„å…ƒç´ è¢«æŸä¸€ä¸ªæ¶ˆè´¹è€…æ‰€æ¶ˆè´¹ ï¼ˆä¸ä»…ä»…æ˜¯æ·»åŠ åˆ°é˜Ÿåˆ—é‡Œå°±å®Œäº‹ï¼‰ã€‚æ–°æ·»åŠ çš„transferæ–¹æ³•ç”¨æ¥å®ç°è¿™ç§çº¦æŸã€‚é¡¾åæ€ä¹‰ï¼Œé˜»å¡å°±æ˜¯å‘ç”Ÿåœ¨å…ƒç´ ä»ä¸€ä¸ªçº¿ç¨‹transferåˆ°å¦ä¸€ä¸ªçº¿ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒæœ‰æ•ˆåœ°å®ç°äº†å…ƒç´ åœ¨çº¿ç¨‹ä¹‹é—´çš„ä¼ é€’ï¼ˆä»¥å»ºç«‹Javaå†…å­˜æ¨¡å‹ä¸­çš„happens-beforeå…³ç³»çš„æ–¹å¼ï¼‰ã€‚ TransferQueueè¿˜åŒ…æ‹¬äº†å…¶ä»–çš„ä¸€äº›æ–¹æ³•ï¼šä¸¤ä¸ªtryTransferæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯éé˜»å¡çš„ï¼Œå¦ä¸€ä¸ªå¸¦ æœ‰timeoutå‚æ•°è®¾ç½®è¶…æ—¶æ—¶é—´çš„ã€‚è¿˜æœ‰ä¸¤ä¸ªè¾…åŠ©æ–¹æ³•hasWaitingConsumer()å’ŒgetWaitingConsumerCount()ã€‚ </p>
<ul>
<li><p>å®ç°ç±» </p>
<p>ArrayBlockingQueue </p>
<p>DelayQueue</p>
<p>LinkedBlockingDeque</p>
<p>LinkedBlockingQueue</p>
<p>LinkedTransferQueue </p>
<p>PriorityBlockingQueue </p>
<p>SynchronousQueue</p>
</li>
</ul>
<h5 id="3-1-2-ArrayBlockingQueue"><a href="#3-1-2-ArrayBlockingQueue" class="headerlink" title="3.1.2 ArrayBlockingQueue"></a>3.1.2 ArrayBlockingQueue</h5><p><strong>ArrayBlockingQueue</strong> æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ã€åŸºäºæ•°ç»„ã€æœ‰ç•Œçš„ã€é˜»å¡çš„ã€FIFO é˜Ÿåˆ—ã€‚è¯•å›¾å‘å·²æ»¡é˜Ÿåˆ—ä¸­æ”¾å…¥å…ƒç´ ä¼šå¯¼è‡´æ“ä½œå—é˜»å¡ï¼›è¯•å›¾ä»ç©ºé˜Ÿåˆ—ä¸­æå–å…ƒç´ å°†å¯¼è‡´ç±»ä¼¼é˜»å¡ã€‚<br>æ­¤ç±»åŸºäº java.util.concurrent.locks.ReentrantLock æ¥å®ç°çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥æä¾›äº† ReentrantLock æ‰€èƒ½æ”¯æŒçš„å…¬å¹³æ€§é€‰æ‹©ã€‚</p>
<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayBlockingQueueDemo</span> </span>&#123; Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> Â  Â  Â  Â BlockingQueue&lt;Integer&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;Integer&gt;(<span class="number">3</span>,<span class="keyword">true</span>);</span><br><span class="line">        Producer producer = <span class="keyword">new</span> Producer(blockingQueue);</span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> Consumer(blockingQueue);</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">new</span> Thread(producer).start();</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">new</span> Thread(consumer).start();</span><br><span class="line"> Â   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> Â BlockingQueue&lt;Integer&gt; blockingQueue;</span><br><span class="line">Â 	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> element = <span class="number">0</span>;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(BlockingQueue&lt;Integer&gt; blockingQueue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.blockingQueue = blockingQueue; Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(element &lt; <span class="number">20</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"ç”Ÿäº§å…ƒç´ ï¼š"</span>+element);</span><br><span class="line">                blockingQueue.put(element++);</span><br><span class="line">            &#125; Â  Â  Â   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"ç”Ÿäº§è€…åœ¨ç­‰å¾…ç©ºé—²ç©ºé—´çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; Â  Â  Â  Â </span><br><span class="line">        System.out.println(<span class="string">"ç”Ÿäº§è€…ç»ˆæ­¢äº†ç”Ÿäº§è¿‡ç¨‹ï¼"</span>); Â   </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> Â BlockingQueue&lt;Integer&gt; blockingQueue;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(BlockingQueue&lt;Integer&gt; blockingQueue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.blockingQueue = blockingQueue;</span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"æ¶ˆè´¹å…ƒç´ ï¼š"</span>+blockingQueue.take());</span><br><span class="line">            &#125; Â  Â  Â   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ–°äº§å“çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; Â  Â  Â  Â </span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆè´¹è€…ç»ˆæ­¢äº†æ¶ˆè´¹è¿‡ç¨‹ï¼"</span>); Â   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-3-PriorityBlockingQueue"><a href="#3-1-3-PriorityBlockingQueue" class="headerlink" title="3.1.3 PriorityBlockingQueue"></a>3.1.3 PriorityBlockingQueue</h5><p><strong>PriorityBlockingQueue</strong>æ˜¯å¸¦ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œæ¯æ¬¡å‡ºé˜Ÿéƒ½è¿”å›ä¼˜å…ˆçº§é«˜çš„å…ƒç´ ï¼Œæ˜¯äºŒå‰æ ‘å°å †çš„å®ç°ã€‚</p>
<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.PriorityBlockingQueue;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PriorityBlockingQueueTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">Â 		PriorityBlockingQueue&lt;PriorityElement&gt; queue = <span class="keyword">new</span> PriorityBlockingQueue&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            Random random=<span class="keyword">new</span> Random();</span><br><span class="line">            PriorityElement ele = <span class="keyword">new</span> PriorityElement(random.nextInt(<span class="number">10</span>));</span><br><span class="line">            queue.put(ele);</span><br><span class="line">        &#125; Â  Â  Â  Â </span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">            System.out.println(queue.take());</span><br><span class="line">        &#125; Â   </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorityElement</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">PriorityElement</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> priority;<span class="comment">//å®šä¹‰ä¼˜å…ˆçº§ Â  Â </span></span><br><span class="line">    PriorityElement(<span class="keyword">int</span> priority) &#123;</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–ä¼˜å…ˆçº§ Â  Â  Â  Â </span></span><br><span class="line">        <span class="keyword">this</span>.priority = priority;</span><br><span class="line">    &#125; Â  Â </span><br><span class="line">    <span class="meta">@Override</span> Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(PriorityElement o)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//æŒ‰ç…§ä¼˜å…ˆçº§å¤§å°è¿›è¡Œæ’åº</span></span><br><span class="line">        <span class="keyword">return</span> priority &gt;= o.getPriority() ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">    &#125; Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPriority</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> priority;</span><br><span class="line">    &#125; Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriority</span><span class="params">(<span class="keyword">int</span> priority)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.priority = priority;</span><br><span class="line">    &#125; Â  Â </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"PriorityElement [priority="</span> + priority + <span class="string">"]"</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-4-DelayQueue"><a href="#3-1-4-DelayQueue" class="headerlink" title="3.1.4 DelayQueue"></a>3.1.4 DelayQueue</h5><p><strong>DelayQueue</strong>é˜Ÿåˆ—ä¸­æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸ªè¿‡æœŸæ—¶é—´ï¼Œå¹¶ä¸”é˜Ÿåˆ—æ˜¯ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå½“ä»é˜Ÿåˆ—è·å–å…ƒç´ æ—¶å€™ï¼Œåªæœ‰è¿‡æœŸå…ƒç´ æ‰ä¼šå‡ºé˜Ÿåˆ—ã€‚</p>
<p>ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.DelayQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Delayed;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayQueueTest</span>  </span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Item item1 = <span class="keyword">new</span> Item(<span class="string">"item1"</span>, <span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">        Item item2 = <span class="keyword">new</span> Item(<span class="string">"item2"</span>,<span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">        Item item3 = <span class="keyword">new</span> Item(<span class="string">"item3"</span>,<span class="number">15</span>, TimeUnit.SECONDS);</span><br><span class="line"> Â  Â  Â  Â DelayQueue&lt;Item&gt; queue = <span class="keyword">new</span> DelayQueue&lt;&gt;();</span><br><span class="line">        queue.put(item1);</span><br><span class="line">        queue.put(item2);</span><br><span class="line">        queue.put(item3);</span><br><span class="line">        System.out.println(<span class="string">"begin time:"</span> + LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            Item take = queue.take();</span><br><span class="line">            System.out.format(<span class="string">"name:&#123;%s&#125;, time:&#123;%s&#125;\n"</span>,take.name, LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME));</span><br><span class="line">        &#125; Â   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span> <span class="keyword">implements</span> <span class="title">Delayed</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* è§¦å‘æ—¶é—´*/</span> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> time;</span><br><span class="line">    String name;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">(String name, <span class="keyword">long</span> time, TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.time = System.currentTimeMillis() + (time &gt; <span class="number">0</span>? unit.toMillis(time): <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDelay</span><span class="params">(TimeUnit unit)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> time - System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Delayed o)</span> </span>&#123; Â </span><br><span class="line">        Item item = (Item) o; Â </span><br><span class="line">        <span class="keyword">long</span> diff = <span class="keyword">this</span>.time - item.time; Â </span><br><span class="line">        <span class="keyword">if</span> (diff &lt;= <span class="number">0</span>) &#123; Â  Â </span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>; Â </span><br><span class="line">        &#125;<span class="keyword">else</span> &#123; Â  </span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>; </span><br><span class="line">        &#125; Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; Â </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Item&#123;"</span> + </span><br><span class="line">            <span class="string">"time="</span> + time + Â </span><br><span class="line">            <span class="string">", name='"</span> + name + <span class="string">'\''</span> + Â </span><br><span class="line">            <span class="string">'&#125;'</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-1-5-LinkedBlockingQueue"><a href="#3-1-5-LinkedBlockingQueue" class="headerlink" title="3.1.5 LinkedBlockingQueue"></a>3.1.5 LinkedBlockingQueue</h5><p><strong>LinkedBlockingQueue</strong>æ˜¯ä¸€ä¸ªåŸºäºå•å‘é“¾è¡¨çš„ã€èŒƒå›´ä»»æ„çš„ï¼ˆå…¶å®æ˜¯æœ‰ç•Œçš„ï¼‰ã€FIFO é˜»å¡é˜Ÿåˆ—ã€‚è®¿é—® ä¸ç§»é™¤æ“ä½œæ˜¯åœ¨é˜Ÿå¤´è¿›è¡Œï¼Œæ·»åŠ æ“ä½œæ˜¯åœ¨é˜Ÿå°¾è¿›è¡Œï¼Œå¹¶åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„é”è¿›è¡Œä¿æŠ¤ï¼Œåªæœ‰åœ¨å¯èƒ½æ¶‰åŠå¤š ä¸ªèŠ‚ç‚¹çš„æ“ä½œæ‰åŒæ—¶å¯¹ä¸¤ä¸ªé”è¿›è¡ŒåŠ é”ã€‚</p>
<p>é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€æ˜¯å¦å·²æ»¡ä»ç„¶æ˜¯é€šè¿‡å…ƒç´ æ•°é‡çš„è®¡æ•°å™¨ï¼ˆcountï¼‰è¿›è¡Œåˆ¤æ–­çš„ï¼Œç”±äºå¯ä»¥åŒæ—¶åœ¨é˜Ÿå¤´ã€ é˜Ÿå°¾å¹¶å‘åœ°è¿›è¡Œè®¿é—®ã€æ·»åŠ æ“ä½œï¼Œæ‰€ä»¥è¿™ä¸ªè®¡æ•°å™¨å¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªåŸå­ç±» AtomicInteger ï¼Œè¿™å°±å†³å®šäº†å®ƒçš„å®¹é‡èŒƒå›´æ˜¯ï¼š 1 â€“ Integer.MAX_VALUEã€‚<br>ç”±äºåŒæ—¶ä½¿ç”¨äº†ä¸¤æŠŠé”ï¼Œåœ¨éœ€è¦åŒæ—¶ä½¿ç”¨ä¸¤æŠŠé”æ—¶ï¼ŒåŠ é”é¡ºåºä¸é‡Šæ”¾é¡ºåºæ˜¯éå¸¸é‡è¦çš„ï¼šå¿…é¡»ä»¥å›ºå®šçš„ é¡ºåºè¿›è¡ŒåŠ é”ï¼Œå†ä»¥ä¸åŠ é”é¡ºåºçš„ç›¸åçš„é¡ºåºé‡Šæ”¾é”ã€‚<br>å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹ä¸€å¼€å§‹æ€»æ˜¯æŒ‡å‘ä¸€ä¸ªå“¨å…µçš„ç»“ç‚¹ï¼Œå®ƒä¸æŒæœ‰å®é™…æ•°æ®ï¼Œå½“é˜Ÿåˆ—ä¸­æœ‰æ•°æ®æ—¶ï¼Œå¤´ç»“ç‚¹ä»ç„¶ æŒ‡å‘è¿™ä¸ªå“¨å…µï¼Œå°¾ç»“ç‚¹æŒ‡å‘æœ‰æ•ˆæ•°æ®çš„åä¸€ä¸ªç»“ç‚¹ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œä¸è®¡æ•°å™¨ count ç»“åˆåï¼Œ å¯¹é˜Ÿå¤´ã€é˜Ÿå°¾çš„è®¿é—®å¯ä»¥ç‹¬ç«‹è¿›è¡Œï¼Œè€Œä¸éœ€è¦åˆ¤æ–­å¤´ç»“ç‚¹ä¸å°¾ç»“ç‚¹çš„å…³ç³»ã€‚</p>
<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingDeque;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayBlockingQueueDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> Â  Â  Â  Â BlockingQueue&lt;Integer&gt; blockingQueue = <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;();</span><br><span class="line">        Producer producer = <span class="keyword">new</span> Producer(blockingQueue); Â  </span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> Consumer(blockingQueue); Â </span><br><span class="line">        <span class="keyword">new</span> Thread(producer).start(); Â  Â  Â </span><br><span class="line">        <span class="keyword">new</span> Thread(consumer).start(); Â </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> Â BlockingQueue&lt;Integer&gt; blockingQueue; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> element = <span class="number">0</span>;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(BlockingQueue&lt;Integer&gt; blockingQueue)</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">this</span>.blockingQueue = blockingQueue; Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">try</span> &#123; Â  Â  Â  </span><br><span class="line">            <span class="keyword">while</span>(element &lt; <span class="number">20</span>) &#123; Â  Â  Â  Â  Â </span><br><span class="line">                System.out.println(<span class="string">"ç”Ÿäº§å…ƒç´ ï¼š"</span>+element); Â  Â  Â  Â  Â  Â  Â  Â blockingQueue.put(element++); Â  Â  Â  Â  Â  </span><br><span class="line">            &#125; Â  Â  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123; Â  </span><br><span class="line">            System.out.println(<span class="string">"ç”Ÿäº§è€…åœ¨ç­‰å¾…ç©ºé—²ç©ºé—´çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼"</span>); Â </span><br><span class="line">            e.printStackTrace(); Â </span><br><span class="line">        &#125; Â  Â  Â </span><br><span class="line">        System.out.println(<span class="string">"ç”Ÿäº§è€…ç»ˆæ­¢äº†ç”Ÿäº§è¿‡ç¨‹ï¼"</span>); Â </span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Â BlockingQueue&lt;Integer&gt; blockingQueue;</span><br><span class="line">Â 	<span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(BlockingQueue&lt;Integer&gt; blockingQueue)</span> </span>&#123; Â </span><br><span class="line">        <span class="keyword">this</span>.blockingQueue = blockingQueue; </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">try</span> &#123; Â  Â  Â  </span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>) &#123; Â </span><br><span class="line">                System.out.println(<span class="string">"æ¶ˆè´¹å…ƒç´ ï¼š"</span>+blockingQueue.take()); Â  Â </span><br><span class="line">            &#125; Â  Â  Â  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123; Â  Â  </span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ–°äº§å“çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼"</span>);</span><br><span class="line">            e.printStackTrace(); Â  Â </span><br><span class="line">        &#125; Â  Â  </span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆè´¹è€…ç»ˆæ­¢äº†æ¶ˆè´¹è¿‡ç¨‹ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-6-LinkedBlockingDeque"><a href="#3-1-6-LinkedBlockingDeque" class="headerlink" title="3.1.6 LinkedBlockingDeque"></a>3.1.6 LinkedBlockingDeque</h5><p><strong>LinkedBlockingDeque</strong>æ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚æ‰€è°“åŒå‘é˜Ÿåˆ—æŒ‡çš„ä½ å¯ä»¥ä»é˜Ÿåˆ—çš„ä¸¤ ç«¯æ’å…¥å’Œç§»å‡ºå…ƒç´ ã€‚åŒç«¯é˜Ÿåˆ—å› ä¸ºå¤šäº†ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—çš„å…¥å£ï¼Œåœ¨å¤šçº¿ç¨‹åŒæ—¶å…¥é˜Ÿæ—¶ï¼Œä¹Ÿå°±å‡å°‘äº†ä¸€åŠçš„ ç«äº‰ã€‚ç›¸æ¯”å…¶ä»–çš„é˜»å¡é˜Ÿåˆ—ï¼ŒLinkedBlockingDequeå¤šäº†addFirstï¼ŒaddLastï¼ŒofferFirstï¼Œ offerLastï¼ŒpeekFirstï¼ŒpeekLastç­‰æ–¹æ³•ï¼Œä»¥Firstå•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–ï¼ˆpeekï¼‰æˆ–ç§» é™¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä»¥Lastå•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„åä¸€ä¸ªå…ƒç´ ã€‚ å¦å¤–æ’å…¥æ–¹æ³•addç­‰åŒäºaddLastï¼Œç§»é™¤æ–¹æ³•removeç­‰æ•ˆäºremoveFirstã€‚åœ¨åˆå§‹åŒ– LinkedBlockingDequeæ—¶å¯ä»¥åˆå§‹åŒ–é˜Ÿåˆ—çš„å®¹é‡ï¼Œç”¨æ¥é˜²æ­¢å…¶å†æ‰©å®¹æ—¶è¿‡æ¸¡è†¨èƒ€ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue; <span class="keyword">import</span> java.util.concurrent.LinkedBlockingDeque;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedBlockingQueueDemo</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> Â  Â  Â  Â BlockingQueue&lt;Integer&gt; blockingQueue = <span class="keyword">new</span> LinkedBlockingDeque&lt;Integer&gt;(); Â </span><br><span class="line">        Producer producer = <span class="keyword">new</span> Producer(blockingQueue); Â </span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> Consumer(blockingQueue); Â  Â  </span><br><span class="line">        <span class="keyword">new</span> Thread(producer).start(); Â </span><br><span class="line">        <span class="keyword">new</span> Thread(consumer).start(); Â </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line"> Â  Â <span class="keyword">private</span> Â BlockingQueue&lt;Integer&gt; blockingQueue; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> element = <span class="number">0</span>;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(BlockingQueue&lt;Integer&gt; blockingQueue)</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">this</span>.blockingQueue = blockingQueue; Â </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">try</span> &#123; Â  Â  </span><br><span class="line">            <span class="keyword">while</span>(element &lt; <span class="number">20</span>) &#123; Â  Â </span><br><span class="line">                System.out.println(<span class="string">"ç”Ÿäº§å…ƒç´ ï¼š"</span>+element); Â </span><br><span class="line">                blockingQueue.put(element++); Â  Â  Â  Â </span><br><span class="line">            &#125; Â  Â </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123; Â  Â  Â </span><br><span class="line">            System.out.println(<span class="string">"ç”Ÿäº§è€…åœ¨ç­‰å¾…ç©ºé—²ç©ºé—´çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼"</span>); Â  Â  Â  Â  Â  Â e.printStackTrace(); Â </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    	System.out.println(<span class="string">"ç”Ÿäº§è€…ç»ˆæ­¢äº†ç”Ÿäº§è¿‡ç¨‹ï¼"</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; Â  </span><br><span class="line">    <span class="keyword">private</span> Â BlockingQueue&lt;Integer&gt; blockingQueue; Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(BlockingQueue&lt;Integer&gt; blockingQueue)</span> </span>&#123; Â  Â  </span><br><span class="line">        <span class="keyword">this</span>.blockingQueue = blockingQueue; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â </span><br><span class="line">        <span class="keyword">try</span> &#123; Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>) &#123; Â  Â </span><br><span class="line">                System.out.println(<span class="string">"æ¶ˆè´¹å…ƒç´ ï¼š"</span>+blockingQueue.take()); Â </span><br><span class="line">            &#125; Â  Â  Â </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123; Â  Â  </span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ–°äº§å“çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼"</span>); Â </span><br><span class="line">            e.printStackTrace(); Â  Â  </span><br><span class="line">        &#125; Â  Â  Â  </span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆè´¹è€…ç»ˆæ­¢äº†æ¶ˆè´¹è¿‡ç¨‹ï¼"</span>); Â </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-7-SynchronousQueue"><a href="#3-1-7-SynchronousQueue" class="headerlink" title="3.1.7 SynchronousQueue"></a>3.1.7 SynchronousQueue</h5><p><strong>SynchronousQueue</strong>æ˜¯ä¸€ä¸ªæ²¡æœ‰æ•°æ®ç¼“å†²çš„BlockingQueueï¼Œç”Ÿäº§è€…çº¿ç¨‹å¯¹å…¶çš„æ’å…¥æ“ä½œputå¿…é¡»ç­‰å¾… æ¶ˆè´¹è€…çš„ç§»é™¤æ“ä½œtakeï¼Œåè¿‡æ¥ä¹Ÿä¸€æ ·ã€‚<br>SynchronousQueueå†…éƒ¨å¹¶æ²¡æœ‰æ•°æ®ç¼“å­˜ç©ºé—´ï¼Œä½ ä¸èƒ½è°ƒç”¨peek()æ–¹æ³•æ¥çœ‹é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ•°æ®å…ƒç´ ï¼Œå›  ä¸ºæ•°æ®å…ƒç´ åªæœ‰å½“ä½ è¯•ç€å–èµ°çš„æ—¶å€™æ‰å¯èƒ½å­˜åœ¨ï¼Œä¸å–èµ°è€Œåªæƒ³å·çª¥ä¸€ä¸‹æ˜¯ä¸è¡Œçš„ï¼Œå½“ç„¶éå†è¿™ä¸ªé˜Ÿåˆ— çš„æ“ä½œä¹Ÿæ˜¯ä¸å…è®¸çš„ã€‚<br>æ•°æ®æ˜¯åœ¨é…å¯¹çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹ä¹‹é—´ç›´æ¥ä¼ é€’çš„ï¼Œå¹¶ä¸ä¼šå°†æ•°æ®ç¼“å†²åˆ°é˜Ÿåˆ—ä¸­ã€‚<br>SynchronousQueueæ”¯æŒå…¬å¹³è®¿é—®é˜Ÿåˆ—ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹é‡‡ç”¨éå…¬å¹³ç­–ç•¥ï¼Œå¦‚æœä½¿ç”¨å…¬å¹³ç­–ç•¥ï¼Œç­‰å¾… çš„çº¿ç¨‹é‡‡ç”¨å…ˆè¿›å…ˆå‡ºçš„é¡ºåºè®¿é—®é˜Ÿåˆ—ã€‚<br>SynchronousQueueé€‚åˆä¼ é€’æ€§åœºæ™¯ï¼Œä¸€ä¸ªä½¿ç”¨åœºæ™¯æ˜¯åœ¨çº¿ç¨‹æ± é‡Œã€‚ Executors.newCachedThreadPool()å°±ä½¿ç”¨äº†SynchronousQueueï¼Œè¿™ä¸ªçº¿ç¨‹æ± æ ¹æ®éœ€è¦ï¼ˆæ–°ä»»åŠ¡åˆ° æ¥æ—¶ï¼‰åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œå¦‚æœæœ‰ç©ºé—²çº¿ç¨‹åˆ™ä¼šé‡å¤ä½¿ç”¨ï¼Œçº¿ç¨‹ç©ºé—²äº†60ç§’åä¼šè¢«å›æ”¶ã€‚</p>
<p>ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronousQueueDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> Â  Â  Â  Â BlockingQueue&lt;Integer&gt; blockingQueue = <span class="keyword">new</span> SynchronousQueue&lt;&gt;(); Â  </span><br><span class="line">        Producer producer = <span class="keyword">new</span> Producer(blockingQueue); Â  Â  Â </span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> Consumer(blockingQueue);</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">new</span> Thread(producer).start(); Â  Â  </span><br><span class="line">        <span class="keyword">new</span> Thread(consumer).start();</span><br><span class="line"> Â   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> Â BlockingQueue&lt;Integer&gt; blockingQueue; Â  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> element = <span class="number">0</span>;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(BlockingQueue&lt;Integer&gt; blockingQueue)</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">this</span>.blockingQueue = blockingQueue; Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  </span><br><span class="line">        <span class="keyword">try</span> &#123; Â  Â  Â  </span><br><span class="line">            <span class="keyword">while</span>(element &lt; <span class="number">20</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"ç”Ÿäº§å…ƒç´ ï¼š"</span>+element); Â  </span><br><span class="line">                blockingQueue.put(element++); Â  Â </span><br><span class="line">            &#125; Â  Â  Â  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123; Â  Â  Â </span><br><span class="line">            System.out.println(<span class="string">"ç”Ÿäº§è€…åœ¨ç­‰å¾…ç©ºé—²ç©ºé—´çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼"</span>); Â  Â  Â  </span><br><span class="line">            e.printStackTrace(); Â </span><br><span class="line">        &#125; Â  Â  Â  </span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"ç”Ÿäº§è€…ç»ˆæ­¢äº†ç”Ÿäº§è¿‡ç¨‹ï¼"</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> Â BlockingQueue&lt;Integer&gt; blockingQueue;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(BlockingQueue&lt;Integer&gt; blockingQueue)</span> </span>&#123; Â  Â  </span><br><span class="line">        <span class="keyword">this</span>.blockingQueue = blockingQueue; Â  </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">while</span>(<span class="keyword">true</span>) &#123; Â  Â  Â  Â  Â </span><br><span class="line">                Thread.sleep(<span class="number">1000l</span>); Â  </span><br><span class="line">                System.out.println(<span class="string">"æ¶ˆè´¹å…ƒç´ ï¼š"</span>+blockingQueue.take()); Â  Â  Â </span><br><span class="line">            &#125; Â  Â  Â   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ–°äº§å“çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼"</span>); </span><br><span class="line">            e.printStackTrace(); Â </span><br><span class="line">        &#125; Â  Â  Â  Â </span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆè´¹è€…ç»ˆæ­¢äº†æ¶ˆè´¹è¿‡ç¨‹ï¼"</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-8-LinkedTransferQueue"><a href="#3-1-8-LinkedTransferQueue" class="headerlink" title="3.1.8 LinkedTransferQueue"></a>3.1.8 LinkedTransferQueue</h5><p><strong>LinkedTransferQueue</strong>æ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡TransferQueueé˜Ÿåˆ—ã€‚ç›¸å¯¹äºå…¶ä»–é˜»å¡é˜Ÿåˆ— LinkedTransferQueueå¤šäº†tryTransferå’Œtransferæ–¹æ³•ã€‚<br>transferæ–¹æ³•ã€‚å¦‚æœå½“å‰æœ‰æ¶ˆè´¹è€…æ­£åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼ˆæ¶ˆè´¹è€…ä½¿ç”¨take()æ–¹æ³•æˆ–å¸¦æ—¶é—´é™åˆ¶çš„poll() æ–¹æ³•æ—¶ï¼‰ï¼Œtransferæ–¹æ³•å¯ä»¥æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç«‹åˆ»transferï¼ˆä¼ è¾“ï¼‰ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€… åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œtransferæ–¹æ³•ä¼šå°†å…ƒç´ å­˜æ”¾åœ¨é˜Ÿåˆ—çš„tailèŠ‚ç‚¹ï¼Œå¹¶ç­‰åˆ°è¯¥å…ƒç´ è¢«æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿” å›ã€‚transferæ–¹æ³•çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š<br>ç¬¬ä¸€è¡Œä»£ç æ˜¯è¯•å›¾æŠŠå­˜æ”¾å½“å‰å…ƒç´ çš„sèŠ‚ç‚¹ä½œä¸ºtailèŠ‚ç‚¹ã€‚ç¬¬äºŒè¡Œä»£ç æ˜¯è®©CPUè‡ªæ—‹ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹å…ƒ ç´ ã€‚å› ä¸ºè‡ªæ—‹ä¼šæ¶ˆè€—CPUï¼Œæ‰€ä»¥è‡ªæ—‹ä¸€å®šçš„æ¬¡æ•°åä½¿ç”¨Thread.yield()æ–¹æ³•æ¥æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ ç¨‹ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚<br>tryTransferæ–¹æ³•ã€‚åˆ™æ˜¯ç”¨æ¥è¯•æ¢ä¸‹ç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ æ˜¯å¦èƒ½ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…ç­‰å¾…æ¥ æ”¶å…ƒç´ ï¼Œåˆ™è¿”å›falseã€‚å’Œtransferæ–¹æ³•çš„åŒºåˆ«æ˜¯tryTransferæ–¹æ³•æ— è®ºæ¶ˆè´¹è€…æ˜¯å¦æ¥æ”¶ï¼Œæ–¹æ³•ç«‹å³è¿” å›ã€‚è€Œtransferæ–¹æ³•æ˜¯å¿…é¡»ç­‰åˆ°æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚<br>å¯¹äºå¸¦æœ‰æ—¶é—´é™åˆ¶çš„tryTransfer(E e, long timeout, TimeUnit unit)æ–¹æ³•ï¼Œåˆ™æ˜¯è¯•å›¾æŠŠç”Ÿäº§è€… ä¼ å…¥çš„å…ƒç´ ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥å…ƒç´ åˆ™ç­‰å¾…æŒ‡å®šçš„æ—¶é—´å†è¿”å›ï¼Œå¦‚æœè¶…æ—¶è¿˜æ²¡ æ¶ˆè´¹å…ƒç´ ï¼Œåˆ™è¿”å›falseï¼Œå¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…æ¶ˆè´¹äº†å…ƒç´ ï¼Œåˆ™è¿”å›trueã€‚</p>
<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedTransferQueueTest</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> Â  Â  Â  Â LinkedTransferQueue&lt;Integer&gt; blockingQueue = <span class="keyword">new</span> LinkedTransferQueue&lt;Integer&gt;(); </span><br><span class="line">        Producer producer = <span class="keyword">new</span> Producer(blockingQueue); </span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> Consumer(blockingQueue);</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">new</span> Thread(producer).start(); Â </span><br><span class="line">        <span class="keyword">new</span> Thread(consumer).start(); Â  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> Â LinkedTransferQueue&lt;Integer&gt; linkedTransferQueue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> element = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(LinkedTransferQueue&lt;Integer&gt; linkedTransferQueue)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.linkedTransferQueue = linkedTransferQueue;</span><br><span class="line"> &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">try</span> &#123; Â  Â  Â  </span><br><span class="line">            <span class="keyword">while</span>(element &lt; <span class="number">20</span>) &#123; Â  Â  </span><br><span class="line">                System.out.println(<span class="string">"ç”Ÿäº§å…ƒç´ ï¼š"</span>+element); Â  Â  Â </span><br><span class="line">                linkedTransferQueue.put(element++); Â  Â  </span><br><span class="line">            &#125; Â  Â  Â  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123; Â  Â  Â  </span><br><span class="line">            System.out.println(<span class="string">"ç”Ÿäº§è€…åœ¨ç­‰å¾…ç©ºé—²ç©ºé—´çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼"</span>); Â </span><br><span class="line">            e.printStackTrace(); Â  Â  </span><br><span class="line">        &#125; Â  Â </span><br><span class="line">        System.out.println(<span class="string">"ç”Ÿäº§è€…ç»ˆæ­¢äº†ç”Ÿäº§è¿‡ç¨‹ï¼"</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> Â LinkedTransferQueue&lt;Integer&gt; linkedTransferQueue;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(LinkedTransferQueue&lt;Integer&gt; linkedTransferQueue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.linkedTransferQueue = linkedTransferQueue; Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">while</span>(<span class="keyword">true</span>) &#123; Â  Â  Â </span><br><span class="line">                Thread.sleep(<span class="number">1000l</span>); Â  </span><br><span class="line">                System.out.println(<span class="string">"æ¶ˆè´¹å…ƒç´ ï¼š"</span>+linkedTransferQueue.take()); Â  Â  Â  </span><br><span class="line">            &#125; Â  Â  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123; Â  Â  Â  Â </span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ–°äº§å“çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼"</span>); Â  Â </span><br><span class="line">            e.printStackTrace(); Â  Â  </span><br><span class="line">        &#125; Â  Â  </span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆè´¹è€…ç»ˆæ­¢äº†æ¶ˆè´¹è¿‡ç¨‹ï¼"</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-9-ConcurrentHashMap"><a href="#3-1-9-ConcurrentHashMap" class="headerlink" title="3.1.9 ConcurrentHashMap"></a>3.1.9 ConcurrentHashMap</h5><h6 id="HashMapå®¹é‡"><a href="#HashMapå®¹é‡" class="headerlink" title="HashMapå®¹é‡"></a>HashMapå®¹é‡</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the specified initial </span></span><br><span class="line"><span class="comment">* capacity and load factor. </span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span>  initialCapacity the initial capacity </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span>  loadFactor Â  Â   the load factor </span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative </span></span><br><span class="line"><span class="comment">* Â  Â  Â  Â  or the load factor is nonpositive </span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>) Â  Â  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal initial capacity: "</span> + Â  Â  Â </span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    </span><br><span class="line">Â <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY) </span><br><span class="line">     initialCapacity = MAXIMUM_CAPACITY; Â  </span><br><span class="line">    <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor)) </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal load factor: "</span> + Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadFactor); Â </span><br><span class="line">    <span class="keyword">this</span>.loadFactor = loadFactor; Â </span><br><span class="line">    <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»™å®šçš„é»˜è®¤å®¹é‡ä¸º 16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚Map åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸æ–­çš„å¾€é‡Œé¢å­˜æ”¾æ•°æ®ï¼Œå½“æ•°é‡è¾¾åˆ°äº† 16 * 0.75 = 12 å°±éœ€è¦å°†å½“å‰ 16 çš„å®¹é‡è¿›è¡Œæ‰©å®¹ï¼Œè€Œæ‰©å®¹è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° rehashã€å¤åˆ¶æ•°æ®ç­‰ æ“ä½œï¼Œæ‰€ä»¥éå¸¸æ¶ˆè€—æ€§èƒ½ã€‚<br>å› æ­¤é€šå¸¸å»ºè®®èƒ½æå‰é¢„ä¼° HashMap çš„å¤§å°å¥½ï¼Œå°½é‡çš„å‡å°‘æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚<br>çº¿ç¨‹ä¸å®‰å…¨çš„ HashMap<br>å› ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ HashMap è¿›è¡Œ put æ“ä½œä¼šå¼•èµ·æ­»å¾ªç¯ï¼Œå¯¼è‡´ CPU åˆ©ç”¨ç‡æ¥è¿‘ 100%ï¼Œæ‰€ä»¥ åœ¨å¹¶å‘æƒ…å†µä¸‹ä¸èƒ½ä½¿ç”¨ HashMapï¼Œå¦‚ä»¥ä¸‹ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> HashMap&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;(<span class="number">2</span>);</span><br><span class="line">Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123; Â </span><br><span class="line">    <span class="meta">@Override</span> Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123; Â </span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123; Â  Â  Â </span><br><span class="line">                <span class="meta">@Override</span> Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">                    map.put(UUID.randomUUID().toString(), <span class="string">""</span>); Â  Â  </span><br><span class="line">                &#125; Â  Â  Â  Â  Â </span><br><span class="line">            &#125;, <span class="string">"kaikeba"</span> + i).start(); Â  </span><br><span class="line">        &#125; Â  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">"kaikeba"</span>);</span><br><span class="line">t.start();</span><br><span class="line">t.join();</span><br></pre></td></tr></table></figure>

<h6 id="æ•ˆç‡ä½ä¸‹çš„-HashTable-å®¹å™¨"><a href="#æ•ˆç‡ä½ä¸‹çš„-HashTable-å®¹å™¨" class="headerlink" title="æ•ˆç‡ä½ä¸‹çš„ HashTable å®¹å™¨"></a>æ•ˆç‡ä½ä¸‹çš„ HashTable å®¹å™¨</h6><p>HashTable å®¹å™¨ä½¿ç”¨ syncronizedæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†åœ¨çº¿ç¨‹ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹ HashTable çš„æ•ˆç‡ éå¸¸ä½ä¸‹ã€‚å› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—® HashTable çš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹è®¿é—® HashTable çš„åŒæ­¥æ–¹æ³• æ—¶ï¼Œå¯èƒ½ä¼šè¿›å…¥é˜»å¡æˆ–è½®è¯¢çŠ¶æ€ã€‚å¦‚çº¿ç¨‹ 1 ä½¿ç”¨ put è¿›è¡Œæ·»åŠ å…ƒç´ ï¼Œçº¿ç¨‹ 2 ä¸ä½†ä¸èƒ½ä½¿ç”¨ put æ–¹ æ³•æ·»åŠ å…ƒç´ ï¼Œå¹¶ä¸”ä¹Ÿä¸èƒ½ä½¿ç”¨ get æ–¹æ³•æ¥è·å–å…ƒç´ ï¼Œæ‰€ä»¥ç«äº‰è¶Šæ¿€çƒˆæ•ˆç‡è¶Šä½ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator; </span><br><span class="line"><span class="keyword">import</span> java.util.Map; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrentHashMapTest</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Â 		Map&lt;String, String&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;String, String&gt;(); Â </span><br><span class="line">        map.put(<span class="string">"key1"</span>, <span class="string">"1"</span>); </span><br><span class="line">        map.put(<span class="string">"key2"</span>, <span class="string">"2"</span>); Â </span><br><span class="line">        map.put(<span class="string">"key3"</span>, <span class="string">"3"</span>); Â  Â </span><br><span class="line">        map.put(<span class="string">"key4"</span>, <span class="string">"4"</span>); Â  Â </span><br><span class="line">        Iterator&lt;String&gt; it = map.keySet().iterator();</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">while</span> (it.hasNext()) &#123; Â </span><br><span class="line">            String key = it.next(); Â  Â </span><br><span class="line">            System.out.println(key + <span class="string">","</span>+ map.get(key));</span><br><span class="line"> Â  Â  Â   &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-10-ConcurrentSkipListMap"><a href="#3-1-10-ConcurrentSkipListMap" class="headerlink" title="3.1.10 ConcurrentSkipListMap"></a>3.1.10 ConcurrentSkipListMap</h5><p>JDK1.6æ—¶ï¼Œä¸ºäº†å¯¹é«˜å¹¶å‘ç¯å¢ƒä¸‹çš„æœ‰åºMapæä¾›æ›´å¥½çš„æ”¯æŒï¼ŒJ.U.Cæ–°å¢äº†ä¸€ä¸ª ConcurrentNavigableMapæ¥å£ï¼ŒConcurrentNavigableMapå¾ˆç®€å•ï¼Œå®ƒåŒæ—¶å®ç°äº†NavigableMapå’Œ ConcurrentMapæ¥å£ã€‚<br>ConcurrentNavigableMapæ¥å£æä¾›çš„åŠŸèƒ½ä¹Ÿå’ŒNavigableMapå‡ ä¹å®Œå…¨ä¸€è‡´ï¼Œå¾ˆå¤šæ–¹æ³•ä»…ä»…æ˜¯è¿”å›çš„ ç±»å‹ä¸åŒã€‚<br>NavigableMapæ¥å£ï¼Œè¿›ä¸€æ­¥æ‰©å±•äº†SortedMapçš„åŠŸèƒ½ï¼Œæä¾›äº†æ ¹æ®æŒ‡å®šKeyè¿”å›æ¥è¿‘é¡¹ã€æŒ‰å‡åº/é™ åºè¿”å›æ‰€æœ‰é”®çš„è§†å›¾ç­‰åŠŸèƒ½ã€‚<br>J.U.Cæä¾›äº†åŸºäºConcurrentNavigableMapæ¥å£çš„ä¸€ä¸ªå®ç°â€”â€” ConcurrentSkipListMap ã€‚ ConcurrentSkipListMapå¯ä»¥çœ‹æˆæ˜¯å¹¶å‘ç‰ˆæœ¬çš„TreeMapï¼Œä½†æ˜¯å’ŒTreeMapä¸åŒæ˜¯ï¼Œ ConcurrentSkipListMapå¹¶ä¸æ˜¯åŸºäºçº¢é»‘æ ‘å®ç°çš„ï¼Œå…¶åº•å±‚æ˜¯ä¸€ç§ç±»ä¼¼è·³è¡¨ï¼ˆSkip Listï¼‰çš„ç»“æ„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentNavigableMap; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentSkipListMap;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrentSkipListMapTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; Â  Â  Â  </span><br><span class="line">        ConcurrentSkipListMap&lt;String, Contact&gt; map = <span class="keyword">new</span> ConcurrentSkipListMap&lt;&gt;();</span><br><span class="line">        Thread threads[]=<span class="keyword">new</span> Thread[<span class="number">25</span>]; Â  Â </span><br><span class="line">        <span class="keyword">int</span> counter=<span class="number">0</span>; Â  Â  </span><br><span class="line">        <span class="comment">//åˆ›å»ºå’Œå¯åŠ¨25ä¸ªä»»åŠ¡ï¼Œå¯¹äºæ¯ä¸ªä»»åŠ¡æŒ‡å®šä¸€ä¸ªå¤§å†™å­—æ¯ä½œä¸ºID Â  Â </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> i=<span class="string">'A'</span>; i&lt;<span class="string">'Z'</span>; i++) &#123; Â  </span><br><span class="line">            Task0 task=<span class="keyword">new</span> Task0(map, String.valueOf(i)); Â  Â  </span><br><span class="line">            threads[counter]=<span class="keyword">new</span> Thread(task); Â  Â </span><br><span class="line">            threads[counter].start(); Â  </span><br><span class="line">            counter++; Â  Â  Â </span><br><span class="line">        &#125; Â  Â  Â  Â  Â  Â </span><br><span class="line">        <span class="comment">//ä½¿ç”¨join()æ–¹æ³•ç­‰å¾…çº¿ç¨‹çš„ç»“æŸ Â  Â </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">25</span>; i++) &#123;</span><br><span class="line">Â 			<span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â  Â  </span><br><span class="line">                threads[i].join(); Â  Â  Â  Â  Â </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  Â  Â  Â  Â </span><br><span class="line">                e.printStackTrace(); Â  Â  Â  Â  Â </span><br><span class="line">            &#125; Â  Â  Â  </span><br><span class="line">        &#125; Â  Â  Â  Â  Â </span><br><span class="line">        System.out.printf(<span class="string">"Size of the map: %d\n"</span>,map.size()); Â  </span><br><span class="line">        Map.Entry&lt;String, Contact&gt; element; Â  Â  Â  Â  Â  </span><br><span class="line">        Contact contact; Â  Â  Â </span><br><span class="line">        <span class="comment">// ä½¿ç”¨firstEntry()æ–¹æ³•è·å–mapçš„ç¬¬ä¸€ä¸ªå®ä½“ï¼Œå¹¶è¾“å‡ºã€‚ </span></span><br><span class="line">        element=map.firstEntry(); Â  Â  </span><br><span class="line">        contact=element.getValue(); Â  Â  Â  Â </span><br><span class="line">        System.out.printf(<span class="string">"First Entry: %s: %s\n"</span>,contact. Â </span><br><span class="line">                          getName(),contact.getPhone()); Â  </span><br><span class="line">        <span class="comment">//ä½¿ç”¨lastEntry()æ–¹æ³•è·å–mapçš„æœ€åä¸€ä¸ªå®ä½“ï¼Œå¹¶è¾“å‡ºã€‚ Â  </span></span><br><span class="line">        element=map.lastEntry(); Â  Â  Â  Â  </span><br><span class="line">        contact=element.getValue(); Â  Â  </span><br><span class="line">        System.out.printf(<span class="string">"Last Entry: %s: %s\n"</span>,contact. Â  Â  Â  Â  Â  Â  Â  Â  Â  Â getName(),contact.getPhone()); Â  Â  Â  Â </span><br><span class="line">        <span class="comment">//ä½¿ç”¨subMap()æ–¹æ³•è·å–mapçš„å­mapï¼Œå¹¶è¾“å‡ºã€‚</span></span><br><span class="line">        System.out.printf(<span class="string">"Submap from A1996 to B1002: \n"</span>);</span><br><span class="line">        ConcurrentNavigableMap&lt;String, Contact&gt; submap=map.</span><br><span class="line"> Â  Â  Â  Â  Â  Â subMap(<span class="string">"A1996"</span>, <span class="string">"B1001"</span>);</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">do</span> &#123; Â  Â  </span><br><span class="line">              </span><br><span class="line">            element=submap.pollFirstEntry(); Â </span><br><span class="line">            <span class="keyword">if</span> (element!=<span class="keyword">null</span>) &#123; Â  Â  </span><br><span class="line">                contact=element.getValue(); Â  Â  Â </span><br><span class="line">                System.out.printf(<span class="string">"%s: %s\n"</span>,contact.getName(),contact. Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â getPhone()); Â  Â  Â  Â  Â  Â </span><br><span class="line">            &#125; Â  Â  Â  Â  </span><br><span class="line">        &#125; <span class="keyword">while</span> (element!=<span class="keyword">null</span>); Â  Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â  Â </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span> </span>&#123; Â </span><br><span class="line">    <span class="keyword">private</span> String name; Â </span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Contact</span><span class="params">(String name, String phone)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.name = name; Â  Â  Â </span><br><span class="line">        <span class="keyword">this</span>.phone = phone;</span><br><span class="line"> Â   &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">return</span> name; Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> String <span class="title">getPhone</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">return</span> phone; Â </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task0</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> ConcurrentSkipListMap&lt;String, Contact&gt; map; </span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Task0</span><span class="params">(ConcurrentSkipListMap&lt;String, Contact&gt; map, String id)</span> </span>&#123; Â </span><br><span class="line">        <span class="keyword">this</span>.id = id; Â  </span><br><span class="line">        <span class="keyword">this</span>.map = map;</span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123; Â  </span><br><span class="line">            Contact contact = <span class="keyword">new</span> Contact(id, String.valueOf(i + <span class="number">1000</span>)); Â </span><br><span class="line">            map.put(id + contact.getPhone(), contact); Â  </span><br><span class="line">        &#125; Â  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-11-ConcurrentSkipListSet"><a href="#3-1-11-ConcurrentSkipListSet" class="headerlink" title="3.1.11 ConcurrentSkipListSet"></a>3.1.11 ConcurrentSkipListSet</h5><p><strong>ConcurrentSkipListSet</strong>ï¼Œæ˜¯JDK1.6æ—¶J.U.Cæ–°å¢çš„ä¸€ä¸ªé›†åˆå·¥å…·ç±»ï¼Œå®ƒæ˜¯ä¸€ç§æœ‰åºçš„SETç±»å‹ã€‚<br>ConcurrentSkipListSetå®ç°äº†NavigableSetæ¥å£ï¼ŒConcurrentSkipListMapå®ç°äº†NavigableMap æ¥å£ï¼Œä»¥æä¾›å’Œæ’åºç›¸å…³çš„åŠŸèƒ½ï¼Œç»´æŒå…ƒç´ çš„æœ‰åºæ€§ï¼Œæ‰€ä»¥ConcurrentSkipListSetå°±æ˜¯ä¸€ç§ä¸ºå¹¶å‘ ç¯å¢ƒè®¾è®¡çš„æœ‰åºSETå·¥å…·ç±»ã€‚<br>ConcurrentSkipListSetåº•å±‚å®ç°å¼•ç”¨äº†ConcurrentSkipListMapã€‚<br>æ —å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentSkipListSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrentSkipListSetTest</span> </span>&#123; Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; Â  </span><br><span class="line">        ConcurrentSkipListSet&lt;Contact1&gt; set = <span class="keyword">new</span> ConcurrentSkipListSet&lt;&gt; (); Â  Â  </span><br><span class="line">        Thread threads[]=<span class="keyword">new</span> Thread[<span class="number">25</span>]; Â  Â  </span><br><span class="line">        <span class="keyword">int</span> counter=<span class="number">0</span>; Â  Â  </span><br><span class="line">        <span class="comment">//åˆ›å»ºå’Œå¯åŠ¨25ä¸ªä»»åŠ¡ï¼Œå¯¹äºæ¯ä¸ªä»»åŠ¡æŒ‡å®šä¸€ä¸ªå¤§å†™å­—æ¯ä½œä¸ºID Â  Â  </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> i=<span class="string">'A'</span>; i&lt;<span class="string">'Z'</span>; i++) &#123; Â  Â  Â  </span><br><span class="line">            Task1 task=<span class="keyword">new</span> Task1(set, String.valueOf(i)); Â  </span><br><span class="line">            threads[counter]=<span class="keyword">new</span> Thread(task); Â  Â </span><br><span class="line">            threads[counter].start(); Â  Â  Â  </span><br><span class="line">            counter++; Â  </span><br><span class="line">        &#125; Â  Â  Â  Â </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä½¿ç”¨join()æ–¹æ³•ç­‰å¾…çº¿ç¨‹çš„ç»“æŸ Â  Â </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">25</span>; i++) &#123; Â </span><br><span class="line">            <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                threads[i].join(); Â  Â  Â  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  Â  Â </span><br><span class="line">                e.printStackTrace(); Â  Â  Â  Â  Â  </span><br><span class="line">            &#125;    </span><br><span class="line"> 		&#125; Â  Â  Â  </span><br><span class="line">        System.out.printf(<span class="string">"Size of the set: %d\n"</span>,set.size()); Â </span><br><span class="line">        Contact1 contact; Â  Â  </span><br><span class="line">        <span class="comment">// ä½¿ç”¨firstæ–¹æ³•è·å–setçš„ç¬¬ä¸€ä¸ªå®ä½“ï¼Œå¹¶è¾“å‡ºã€‚ Â </span></span><br><span class="line">        contact=set.first(); Â  Â </span><br><span class="line">        System.out.printf(<span class="string">"First Entry: %s: %s\n"</span>,contact. Â  Â  Â  Â  Â  Â  Â  Â getName(),contact.getPhone()); </span><br><span class="line">        <span class="comment">//ä½¿ç”¨lastæ–¹æ³•è·å–setçš„æœ€åä¸€ä¸ªå®ä½“ï¼Œå¹¶è¾“å‡ºã€‚ Â  Â  Â </span></span><br><span class="line">        contact=set.last(); Â  Â  Â  Â </span><br><span class="line">        System.out.printf(<span class="string">"Last Entry: %s: %s\n"</span>,contact. Â  Â  Â  Â  Â  Â  Â  Â getName(),contact.getPhone());</span><br><span class="line"> Â   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact1</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Contact1</span>&gt; </span>&#123; Â </span><br><span class="line">    <span class="keyword">private</span> String name; Â </span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Contact1</span><span class="params">(String name, String phone)</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">this</span>.name = name; Â  </span><br><span class="line">        <span class="keyword">this</span>.phone = phone;</span><br><span class="line"> Â   &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123; Â  Â  Â  </span><br><span class="line">        <span class="keyword">return</span> name; Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> String <span class="title">getPhone</span><span class="params">()</span> </span>&#123; Â  Â </span><br><span class="line">        <span class="keyword">return</span> phone; </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Contact1 o)</span> </span>&#123; Â  Â  Â </span><br><span class="line">        <span class="keyword">return</span> name.compareTo(o.name); Â   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task1</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> ConcurrentSkipListSet&lt;Contact1&gt; set; Â  Â </span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">Task1</span><span class="params">(ConcurrentSkipListSet&lt;Contact1&gt; set, String id)</span> </span>&#123; Â </span><br><span class="line">        <span class="keyword">this</span>.id = id; Â  Â  </span><br><span class="line">        <span class="keyword">this</span>.set = set; Â  </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123; Â  Â  Â  Â </span><br><span class="line">            Contact1 contact = <span class="keyword">new</span> Contact1(id, String.valueOf(i + <span class="number">100</span>)); Â  Â  Â  Â  Â  Â set.add(contact); Â  Â  Â </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-12-CopyOnWriteArrayList"><a href="#3-1-12-CopyOnWriteArrayList" class="headerlink" title="3.1.12 CopyOnWriteArrayList"></a>3.1.12 CopyOnWriteArrayList</h5><p><strong>Copy-On-Write</strong>ç®€ç§°COWï¼Œæ˜¯ä¸€ç§ç”¨äºç¨‹åºè®¾è®¡ä¸­çš„ä¼˜åŒ–ç­–ç•¥ã€‚</p>
<p>å…¶åŸºæœ¬æ€è·¯æ˜¯ï¼Œä»ä¸€å¼€å§‹å¤§å®¶éƒ½åœ¨å…±äº« åŒä¸€ä¸ªå†…å®¹ï¼Œå½“æŸä¸ªäººæƒ³è¦ä¿®æ”¹è¿™ä¸ªå†…å®¹çš„æ—¶å€™ï¼Œæ‰ä¼šçœŸæ­£æŠŠå†…å®¹Copyå‡ºå»å½¢æˆä¸€ä¸ªæ–°çš„å†…å®¹ç„¶åå†æ”¹ï¼Œè¿™æ˜¯ä¸€ç§å»¶æ—¶æ‡’æƒ°ç­–ç•¥ã€‚ä»JDK1.5å¼€å§‹Javaå¹¶å‘åŒ…é‡Œæä¾›äº†ä¸¤ä¸ªä½¿ç”¨CopyOnWriteæœºåˆ¶å®ç°çš„å¹¶ å‘å®¹å™¨,å®ƒä»¬æ˜¯CopyOnWriteArrayListå’ŒCopyOnWriteArraySetã€‚CopyOnWriteå®¹å™¨éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥åœ¨éå¸¸å¤šçš„å¹¶å‘åœºæ™¯ä¸­ä½¿ç”¨åˆ°ã€‚</p>
<p> <strong>ä»€ä¹ˆæ˜¯CopyOnWriteå®¹å™¨</strong></p>
<p> CopyOnWriteå®¹å™¨å³å†™æ—¶å¤åˆ¶çš„å®¹å™¨ã€‚é€šä¿—çš„ç†è§£æ˜¯å½“æˆ‘ä»¬å¾€ä¸€ä¸ªå®¹å™¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¾€å½“å‰ å®¹å™¨æ·»åŠ ï¼Œè€Œæ˜¯å…ˆå°†å½“å‰å®¹å™¨è¿›è¡ŒCopyï¼Œå¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œç„¶åæ–°çš„å®¹å™¨é‡Œæ·»åŠ å…ƒç´ ï¼Œæ·»åŠ å®Œå…ƒç´  ä¹‹åï¼Œå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°çš„å®¹å™¨ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å¯¹CopyOnWriteå®¹å™¨è¿›è¡Œå¹¶å‘çš„è¯»ï¼Œ è€Œä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºå½“å‰å®¹å™¨ä¸ä¼šæ·»åŠ ä»»ä½•å…ƒç´ ã€‚æ‰€ä»¥CopyOnWriteå®¹å™¨ä¹Ÿæ˜¯ä¸€ç§è¯»å†™åˆ†ç¦»çš„æ€æƒ³ï¼Œè¯» å’Œå†™ä¸åŒçš„å®¹å™¨ã€‚ </p>
<p>CopyOnWriteå®¹å™¨æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œå³å†…å­˜å ç”¨é—®é¢˜å’Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚æ‰€ä»¥åœ¨ å¼€å‘çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸€ä¸‹å†…å­˜å ç”¨é—®é¢˜ã€‚å› ä¸ºCopyOnWriteçš„å†™æ—¶å¤åˆ¶æœºåˆ¶ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼Œå†…å­˜é‡Œä¼šåŒæ—¶é©»æ‰ä¸¤ä¸ª å¯¹è±¡çš„å†…å­˜ï¼Œæ—§çš„å¯¹è±¡å’Œæ–°å†™å…¥çš„å¯¹è±¡ï¼ˆ<code>æ³¨æ„:åœ¨å¤åˆ¶çš„æ—¶å€™åªæ˜¯å¤åˆ¶å®¹å™¨é‡Œçš„å¼•ç”¨ï¼Œåªæ˜¯åœ¨å†™çš„æ—¶å€™ ä¼šåˆ›å»ºæ–°å¯¹è±¡æ·»åŠ åˆ°æ–°å®¹å™¨é‡Œï¼Œè€Œæ—§å®¹å™¨çš„å¯¹è±¡è¿˜åœ¨ä½¿ç”¨ï¼Œæ‰€ä»¥æœ‰ä¸¤ä»½å¯¹è±¡å†…å­˜</code>ï¼‰ã€‚å¦‚æœè¿™äº›å¯¹è±¡å ç”¨ çš„å†…å­˜æ¯”è¾ƒå¤§ï¼Œæ¯”å¦‚è¯´200Må·¦å³ï¼Œé‚£ä¹ˆå†å†™å…¥100Mæ•°æ®è¿›å»ï¼Œå†…å­˜å°±ä¼šå ç”¨300Mï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å¾ˆæœ‰ å¯èƒ½é€ æˆé¢‘ç¹çš„Yong GCå’ŒFull GCã€‚ä¹‹å‰æˆ‘ä»¬ç³»ç»Ÿä¸­ä½¿ç”¨äº†ä¸€ä¸ªæœåŠ¡ç”±äºæ¯æ™šä½¿ç”¨CopyOnWriteæœºåˆ¶ æ›´æ–°å¤§å¯¹è±¡ï¼Œé€ æˆäº†æ¯æ™š15ç§’çš„Full GCï¼Œåº”ç”¨å“åº”æ—¶é—´ä¹Ÿéšä¹‹å˜é•¿ã€‚</p>
<p> é’ˆå¯¹å†…å­˜å ç”¨é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å‹ç¼©å®¹å™¨ä¸­çš„å…ƒç´ çš„æ–¹æ³•æ¥å‡å°‘å¤§å¯¹è±¡çš„å†…å­˜æ¶ˆè€—ï¼Œæ¯”å¦‚ï¼Œå¦‚æœå…ƒç´ å…¨æ˜¯ 10è¿›åˆ¶çš„æ•°å­—ï¼Œå¯ä»¥è€ƒè™‘æŠŠå®ƒå‹ç¼©æˆ36è¿›åˆ¶æˆ–64è¿›åˆ¶ã€‚æˆ–è€…ä¸ä½¿ç”¨CopyOnWriteå®¹å™¨ï¼Œè€Œä½¿ç”¨å…¶ä»–çš„å¹¶å‘å®¹å™¨ï¼Œå¦‚ConcurrentHashMapã€‚ æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚CopyOnWriteå®¹å™¨åªèƒ½ä¿è¯æ•°æ®çš„ç»ˆä¸€è‡´æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„å®æ—¶ä¸€è‡´æ€§ã€‚æ‰€ä»¥å¦‚ æœä½ å¸Œæœ›å†™å…¥çš„çš„æ•°æ®ï¼Œé©¬ä¸Šèƒ½è¯»åˆ°ï¼Œè¯·ä¸è¦ä½¿ç”¨CopyOnWriteå®¹å™¨ã€‚</p>
<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; Â </span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; list;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">ReadThread</span><span class="params">(List&lt;Integer&gt; list)</span> </span>&#123; Â  Â </span><br><span class="line">        <span class="keyword">this</span>.list = list; Â  </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        System.out.print(<span class="string">"size:="</span>+list.size()+<span class="string">",::"</span>); Â </span><br><span class="line">        <span class="keyword">for</span> (Integer ele : list) &#123;</span><br><span class="line">            System.out.print(ele + <span class="string">","</span>); Â  </span><br><span class="line">        &#125; Â  Â  Â  </span><br><span class="line">        System.out.println(); Â </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WriteThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; Â </span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; list;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="title">WriteThread</span><span class="params">(List&lt;Integer&gt; list)</span> </span>&#123; Â  Â </span><br><span class="line">        <span class="keyword">this</span>.list = list; </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â </span><br><span class="line">        <span class="keyword">this</span>.list.add(<span class="number">9</span>); Â  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCopyOnWriteArrayListTest</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123; Â </span><br><span class="line">        <span class="comment">//1ã€åˆå§‹åŒ–CopyOnWriteArrayList Â  </span></span><br><span class="line">        List&lt;Integer&gt; tempList = Arrays.asList(<span class="keyword">new</span> Integer [] &#123;<span class="number">1</span>,<span class="number">2</span>&#125;); </span><br><span class="line">        CopyOnWriteArrayList&lt;Integer&gt; copyList = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt; (tempList);</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â <span class="comment">//2ã€æ¨¡æ‹Ÿå¤šçº¿ç¨‹å¯¹listè¿›è¡Œè¯»å’Œå†™ Â  Â </span></span><br><span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">10</span>); </span><br><span class="line">        executorService.execute(<span class="keyword">new</span> ReadThread(copyList)); Â  Â  </span><br><span class="line">        executorService.execute(<span class="keyword">new</span> WriteThread(copyList)); </span><br><span class="line">        executorService.execute(<span class="keyword">new</span> WriteThread(copyList)); Â </span><br><span class="line">        executorService.execute(<span class="keyword">new</span> WriteThread(copyList)); Â  </span><br><span class="line">        executorService.execute(<span class="keyword">new</span> ReadThread(copyList)); Â  Â </span><br><span class="line">        executorService.execute(<span class="keyword">new</span> WriteThread(copyList)); Â  Â </span><br><span class="line">        executorService.execute(<span class="keyword">new</span> ReadThread(copyList)); Â </span><br><span class="line">        executorService.execute(<span class="keyword">new</span> WriteThread(copyList)); Â </span><br><span class="line">        <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  </span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">5</span>); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  </span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block Â </span></span><br><span class="line">            e.printStackTrace(); Â </span><br><span class="line">        &#125; Â  Â  Â  Â </span><br><span class="line">        System.out.println(<span class="string">"copyList size:"</span>+copyList.size());</span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">new</span> TestCopyOnWriteArrayList().test(); Â  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-13-CopyOnWriteArraySet"><a href="#3-1-13-CopyOnWriteArraySet" class="headerlink" title="3.1.13 CopyOnWriteArraySet"></a>3.1.13 CopyOnWriteArraySet</h5><p>CopyOnWriteArraySetç›¸å¯¹CopyOnWriteArrayListç”¨æ¥å­˜å‚¨ä¸é‡å¤çš„å¯¹è±¡ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è™½ç„¶ç»§æ‰¿äº†AbstractSetç±»ï¼Œä½†CopyOnWriteArraySetä¸HashMap å®Œå…¨ä¸åŒï¼Œå†…éƒ¨æ˜¯ç”¨ CopyOnWriteArrayListå®ç°çš„ï¼Œå®ç°ä¸é‡å¤çš„ç‰¹æ€§ä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨CopyOnWriteArrayListçš„æ–¹æ³•å®ç° çš„ï¼Œæ„Ÿè§‰åŠ çš„æœ‰ç”¨çš„å‡½æ•°å°±æ˜¯eqå‡½æ•°åˆ¤æ–­å¯¹è±¡æ˜¯å¦ç›¸åŒ</p>
<h4 id="3-2-åŸå­æ“ä½œç±»"><a href="#3-2-åŸå­æ“ä½œç±»" class="headerlink" title="3.2 åŸå­æ“ä½œç±»"></a>3.2 åŸå­æ“ä½œç±»</h4><p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­å¾ˆå®¹æ˜“å‡ºç°å¹¶å‘å®‰å…¨çš„é—®é¢˜ï¼Œæœ‰ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­å°±æ˜¯å¤šçº¿ç¨‹æ›´æ–°å˜é‡i=1,æ¯”å¦‚å¤šä¸ªçº¿ç¨‹ æ‰§è¡Œi++æ“ä½œï¼Œå°±æœ‰å¯èƒ½è·å–ä¸åˆ°æ­£ç¡®çš„å€¼ï¼Œè€Œè¿™ä¸ªé—®é¢˜ï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡Synchronizedè¿›è¡Œæ§åˆ¶ æ¥è¾¾åˆ°çº¿ç¨‹å®‰å…¨çš„ç›®çš„ã€‚ä½†æ˜¯ç”±äºsynchronizedæ˜¯é‡‡ç”¨çš„æ˜¯æ‚²è§‚é”ç­–ç•¥ï¼Œå¹¶ä¸æ˜¯ç‰¹åˆ«é«˜æ•ˆçš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚å®é™…ä¸Šï¼Œåœ¨J.U.Cä¸‹çš„atomicåŒ…æä¾›äº†ä¸€ç³»åˆ—çš„æ“ä½œç®€å•ï¼Œæ€§èƒ½é«˜æ•ˆï¼Œå¹¶èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨çš„ç±»å» æ›´æ–°åŸºæœ¬ç±»å‹å˜é‡ï¼Œæ•°ç»„å…ƒç´ ï¼Œå¼•ç”¨ç±»å‹ä»¥åŠæ›´æ–°å¯¹è±¡ä¸­çš„å­—æ®µç±»å‹ã€‚atomicåŒ…ä¸‹çš„è¿™äº›ç±»éƒ½æ˜¯é‡‡ç”¨çš„ æ˜¯ä¹è§‚é”ç­–ç•¥å»åŸå­æ›´æ–°æ•°æ®ï¼Œåœ¨javaä¸­åˆ™æ˜¯ä½¿ç”¨CASæ“ä½œå…·ä½“å®ç°ã€‚</p>
<h5 id="3-2-1-åŸå­åŸºæœ¬æ•°æ®ç±»å‹"><a href="#3-2-1-åŸå­åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="3.2.1 åŸå­åŸºæœ¬æ•°æ®ç±»å‹"></a>3.2.1 åŸå­åŸºæœ¬æ•°æ®ç±»å‹</h5><p>åŸå­æ›´æ–°åŸºæœ¬ç±»å‹<br>atomicåŒ…æé«˜åŸå­æ›´æ–°åŸºæœ¬ç±»å‹çš„å·¥å…·ç±»ï¼Œä¸»è¦æœ‰è¿™äº›ï¼š</p>
<ul>
<li>AtomicBooleanï¼šä»¥åŸå­æ›´æ–°çš„æ–¹å¼æ›´æ–°booleanï¼›</li>
<li>AtomicIntegerï¼šä»¥åŸå­æ›´æ–°çš„æ–¹å¼æ›´æ–°Integer; </li>
<li>AtomicLongï¼šä»¥åŸå­æ›´æ–°çš„æ–¹å¼æ›´æ–°Longï¼›</li>
<li>AtomicIntegerå¸¸ç”¨çš„æ–¹æ³•:</li>
<li>addAndGet(int delta) ï¼šä»¥åŸå­æ–¹å¼å°†è¾“å…¥çš„æ•°å€¼ä¸å®ä¾‹ä¸­åŸæœ¬çš„å€¼ç›¸åŠ ï¼Œå¹¶è¿”å›åçš„ç»“ æœï¼› </li>
<li>incrementAndGet() ï¼šä»¥åŸå­çš„æ–¹å¼å°†å®ä¾‹ä¸­çš„åŸå€¼è¿›è¡ŒåŠ 1æ“ä½œï¼Œå¹¶è¿”å›ç»ˆç›¸åŠ åçš„ç»“æœï¼› </li>
<li>getAndSet(int newValue)ï¼šå°†å®ä¾‹ä¸­çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¹¶è¿”å›æ—§å€¼ï¼› </li>
<li>getAndIncrement()ï¼šä»¥åŸå­çš„æ–¹å¼å°†å®ä¾‹ä¸­çš„åŸå€¼åŠ 1ï¼Œè¿”å›çš„æ˜¯è‡ªå¢å‰çš„æ—§å€¼ï¼›</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndIncrement</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">    <span class="keyword">return</span> unsafe.getAndAddInt(<span class="keyword">this</span>, valueOffset, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ–¹æ³•å®é™…ä¸Šæ˜¯è°ƒç”¨äº†unsafeå®ä¾‹çš„getAndAddIntæ–¹æ³•ï¼Œunsafeå®ä¾‹çš„è·å–æ—¶é€šè¿‡ UnSafeç±»çš„é™æ€æ–¹æ³•getUnsafeè·å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe = Unsafe.getUnsafe();</span><br></pre></td></tr></table></figure>

<p>Unsafeç±»åœ¨sun.miscåŒ…ä¸‹ï¼ŒUnsaferç±»æä¾›äº†ä¸€äº›åº•å±‚æ“ä½œï¼ŒatomicåŒ…ä¸‹çš„åŸå­æ“ä½œç±»çš„ä¹Ÿä¸»è¦æ˜¯é€š è¿‡Unsafeç±»æä¾›çš„compareAndSwapIntï¼ŒcompareAndSwapLongç­‰ä¸€ç³»åˆ—æä¾›CASæ“ä½œçš„æ–¹æ³•æ¥è¿›è¡Œå®ç°ã€‚</p>
<p>atomicIntegerå€ŸåŠ©äº†UnSafeæä¾›çš„CASæ“ä½œèƒ½å¤Ÿä¿è¯æ•°æ®æ›´æ–°çš„æ—¶å€™æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”ç”±äºCASæ˜¯ é‡‡ç”¨ä¹è§‚é”ç­–ç•¥ï¼Œå› æ­¤ï¼Œè¿™ç§æ•°æ®æ›´æ–°çš„æ–¹æ³•ä¹Ÿå…·æœ‰é«˜æ•ˆæ€§ã€‚</p>
<p>AtomicLongçš„å®ç°åŸç†å’ŒAtomicIntegerä¸€è‡´ï¼Œåªä¸è¿‡ä¸€ä¸ªé’ˆå¯¹çš„æ˜¯longå˜é‡ï¼Œä¸€ä¸ªé’ˆå¯¹çš„æ˜¯intå˜ é‡ã€‚è€Œbooleanå˜é‡çš„æ›´æ–°ç±»AtomicBooleanç±»æ˜¯æ€æ ·å®ç°æ›´æ–°çš„å‘¢?æ ¸å¿ƒæ–¹æ³•æ˜¯ compareAndSet tæ–¹ æ³•ï¼Œ</p>
<p>å…¶æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">boolean</span> expect, <span class="keyword">boolean</span> update)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> e = expect ? <span class="number">1</span> : <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">int</span> u = update ? <span class="number">1</span> : <span class="number">0</span>; Â  </span><br><span class="line">    <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="keyword">this</span>, valueOffset, e, u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼ŒcompareAndSetæ–¹æ³•çš„å®é™…ä¸Šä¹Ÿæ˜¯å…ˆè½¬æ¢æˆ0,1çš„æ•´å‹å˜é‡ï¼Œç„¶åæ˜¯é€šè¿‡é’ˆå¯¹intå‹å˜é‡çš„ åŸå­æ›´æ–°æ–¹æ³•compareAndSwapIntæ¥å®ç°çš„ã€‚å¯ä»¥çœ‹å‡ºatomicåŒ…ä¸­åªæä¾›äº†å¯¹boolean,int ,longè¿™ ä¸‰ç§åŸºæœ¬ç±»å‹çš„åŸå­æ›´æ–°çš„æ–¹æ³•ï¼Œå‚è€ƒå¯¹booleanæ›´æ–°çš„æ–¹å¼ï¼ŒåŸå­æ›´æ–°char,double,floatä¹Ÿå¯ä»¥é‡‡ ç”¨ç±»ä¼¼çš„æ€è·¯è¿›è¡Œå®ç°ã€‚<br>ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123; Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; Â  </span><br><span class="line">        AtomicInteger ai = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"> Â  Â  Â  Â List&lt;Thread&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(); Â  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; Â  Â  Â </span><br><span class="line">            Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Accumlator(ai), <span class="string">"thread-"</span> + i); Â  Â  </span><br><span class="line">            list.add(t); Â  Â  Â  </span><br><span class="line">            t.start(); Â  Â </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">for</span> (Thread t : list) &#123; Â  Â </span><br><span class="line">            t.join(); Â  Â  </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â System.out.println(ai.get());</span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Accumlator</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; Â  Â  </span><br><span class="line">        <span class="keyword">private</span> AtomicInteger ai;</span><br><span class="line"> Â  Â  Â  Â Accumlator(AtomicInteger ai) &#123; Â  Â  Â </span><br><span class="line">            <span class="keyword">this</span>.ai = ai; Â  Â </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="meta">@Override</span> Â  Â  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, len = <span class="number">1000</span>; i &lt; len; i++) &#123; Â  </span><br><span class="line">                ai.incrementAndGet(); Â  Â  Â </span><br><span class="line">            &#125; Â  Â  Â </span><br><span class="line">        &#125; Â  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-2-2-åŸå­æ•°ç»„"><a href="#3-2-2-åŸå­æ•°ç»„" class="headerlink" title="3.2.2 åŸå­æ•°ç»„"></a>3.2.2 åŸå­æ•°ç»„</h5><p>atomicåŒ…ä¸‹æä¾›èƒ½åŸå­æ›´æ–°æ•°ç»„ä¸­å…ƒç´ çš„ç±»æœ‰ï¼š</p>
<ul>
<li>AtomicIntegerArrayï¼šåŸå­æ›´æ–°æ•´å‹æ•°ç»„ä¸­çš„å…ƒç´ ï¼›</li>
<li>AtomicLongArrayï¼šåŸå­æ›´æ–°é•¿æ•´å‹æ•°ç»„ä¸­çš„å…ƒç´ ï¼› </li>
<li>AtomicReferenceArrayï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹æ•°ç»„ä¸­çš„å…ƒç´ </li>
</ul>
<p>è¿™å‡ ä¸ªç±»çš„ç”¨æ³•ä¸€è‡´ï¼Œå°±ä»¥AtomicIntegerArrayæ¥æ€»ç»“ä¸‹å¸¸ç”¨çš„æ–¹æ³•ï¼š</p>
<ul>
<li>addAndGet(int i, int delta)ï¼šä»¥åŸå­æ›´æ–°çš„æ–¹å¼å°†æ•°ç»„ä¸­ç´¢å¼•ä¸ºiçš„å…ƒç´ ä¸è¾“å…¥å€¼ç›¸åŠ ï¼›</li>
<li>getAndIncrement(int i)ï¼šä»¥åŸå­æ›´æ–°çš„æ–¹å¼å°†æ•°ç»„ä¸­ç´¢å¼•ä¸ºiçš„å…ƒç´ è‡ªå¢åŠ 1ï¼› </li>
<li>compareAndSet(int i, int expect, int update)ï¼šå°†æ•°ç»„ä¸­ç´¢å¼•ä¸ºiçš„ä½ç½®çš„å…ƒç´ è¿›è¡Œæ›´æ–°</li>
</ul>
<p>å¯ä»¥çœ‹å‡ºï¼ŒAtomicIntegerArrayä¸AtomicIntegerçš„æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡åœ¨AtomicIntegerArray çš„æ–¹æ³•ä¸­ä¼šå¤šä¸€ä¸ªæŒ‡å®šæ•°ç»„ç´¢å¼•ä½iã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicIntegerArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicIntegerArrayTest</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; Â  </span><br><span class="line">        <span class="comment">//åˆ›å»ºç»™å®šé•¿åº¦çš„AtomicIntegerArrayã€‚ Â </span></span><br><span class="line">        AtomicIntegerArray atomicIntegerArray = <span class="keyword">new</span> AtomicIntegerArray(<span class="number">10</span>); Â  </span><br><span class="line">        <span class="comment">//å°†ä½ç½® i çš„å…ƒç´ è®¾ç½®ä¸ºç»™å®šå€¼,é»˜è®¤å€¼ä¸º0 Â  Â  </span></span><br><span class="line">        atomicIntegerArray.set(<span class="number">9</span>,<span class="number">10</span>); Â  </span><br><span class="line">        System.out.println(<span class="string">"Value: "</span> + atomicIntegerArray.get(<span class="number">9</span>) + <span class="string">"é»˜è®¤å€¼ï¼š"</span> + atomicIntegerArray.get(<span class="number">0</span>)); Â  Â  Â </span><br><span class="line">        <span class="comment">//è¿”å›è¯¥æ•°ç»„çš„é•¿åº¦ Â  Â  </span></span><br><span class="line">        System.out.println(<span class="string">"æ•°ç»„é•¿åº¦ï¼š"</span> + atomicIntegerArray.length()); Â </span><br><span class="line">        <span class="comment">//ä»¥åŸå­æ–¹å¼å…ˆå¯¹ç»™å®šä¸‹æ ‡åŠ ä¸Šç‰¹å®šçš„å€¼ï¼Œå†è·å–ç›¸åŠ åçš„å€¼ Â  Â  Â </span></span><br><span class="line">        atomicIntegerArray.set(<span class="number">0</span>,<span class="number">10</span>); Â  Â </span><br><span class="line">        System.out.println(<span class="string">"Value: "</span> + atomicIntegerArray.get(<span class="number">0</span>)); Â </span><br><span class="line">        System.out.println(<span class="string">"Value: "</span> + Â atomicIntegerArray.addAndGet(<span class="number">5</span>,<span class="number">10</span>)); Â </span><br><span class="line">        <span class="comment">//å¦‚æœå½“å‰å€¼ == é¢„æœŸå€¼ï¼Œå°†ä½ç½® i çš„å…ƒç´ è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚ Â  Â </span></span><br><span class="line">        Boolean bool = atomicIntegerArray.compareAndSet(<span class="number">5</span>,<span class="number">10</span>,<span class="number">30</span>); Â  Â </span><br><span class="line">        System.out.println(<span class="string">"ç»“æœå€¼ï¼š "</span> + atomicIntegerArray.get(<span class="number">5</span>) + <span class="string">" Result: "</span> + bool);</span><br><span class="line">        <span class="comment">//ä»¥åŸå­æ–¹å¼å…ˆå°†å½“å‰ä¸‹æ ‡çš„å€¼å‡1ï¼Œå†è·å–å‡1åçš„ç»“æœ Â  Â </span></span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º5çš„å€¼ä¸ºï¼š"</span> + Â atomicIntegerArray.decrementAndGet(<span class="number">5</span>)); </span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º5çš„å€¼ä¸ºï¼š"</span> + atomicIntegerArray.get(<span class="number">5</span>)); Â  Â  </span><br><span class="line">        <span class="comment">//ä»¥åŸå­æ–¹å¼å…ˆè·å–å½“å‰ä¸‹æ ‡çš„å€¼ï¼Œå†å°†å½“å‰ä¸‹æ ‡çš„å€¼åŠ ä¸Šç»™å®šçš„å€¼ Â  Â </span></span><br><span class="line">        Integer result2 = atomicIntegerArray.getAndAdd(<span class="number">5</span>,<span class="number">5</span>); Â  Â </span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º5çš„å€¼ä¸ºï¼š"</span> + result2); Â  </span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º5çš„å€¼ä¸ºï¼š"</span> + atomicIntegerArray.get(<span class="number">5</span>));</span><br><span class="line">        <span class="comment">//ä»¥åŸå­æ–¹å¼å…ˆè·å–å½“å‰ä¸‹æ ‡çš„å€¼ï¼Œå†å¯¹å½“å‰ä¸‹æ ‡çš„å€¼å‡1 Â  </span></span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º1çš„å€¼ä¸ºï¼š"</span> + atomicIntegerArray.getAndDecrement(<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º1çš„å€¼ä¸ºï¼š"</span> + atomicIntegerArray.get(<span class="number">1</span>)); Â  Â </span><br><span class="line">        <span class="comment">// ä»¥åŸå­æ–¹å¼å…ˆè·å–å½“å‰ä¸‹æ ‡çš„å€¼ï¼Œå†å¯¹å½“å‰ä¸‹æ ‡çš„å€¼åŠ 1 Â  </span></span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º2çš„å€¼ä¸ºï¼š"</span> + atomicIntegerArray.getAndIncrement(<span class="number">2</span>));</span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º2çš„å€¼ä¸ºï¼š"</span> + atomicIntegerArray.get(<span class="number">2</span>)); Â  Â  </span><br><span class="line">        <span class="comment">//å°†ä½ç½® i çš„å…ƒç´ ä»¥åŸå­æ–¹å¼è®¾ç½®ä¸ºç»™å®šå€¼ï¼Œå¹¶è¿”å›æ—§å€¼ã€‚</span></span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º3çš„å€¼ä¸ºï¼š"</span> + atomicIntegerArray.getAndSet(<span class="number">3</span>,<span class="number">50</span>)); Â </span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º3çš„å€¼ä¸ºï¼š"</span> + atomicIntegerArray.get(<span class="number">3</span>)); Â </span><br><span class="line">        <span class="comment">//ä»¥åŸå­æ–¹å¼å…ˆå¯¹ä¸‹æ ‡åŠ 1å†è·å–å€¼ Â  Â  </span></span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º4çš„å€¼ä¸ºï¼š"</span> + atomicIntegerArray.incrementAndGet(<span class="number">4</span>)); Â </span><br><span class="line">        System.out.println(<span class="string">"ä¸‹æ ‡ä¸º4çš„å€¼ä¸ºï¼š"</span> + atomicIntegerArray.get(<span class="number">4</span>));</span><br><span class="line"> Â   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶å‘æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicIntegerArray;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicIntegerArrayTest2</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line"> Â  Â <span class="keyword">static</span> AtomicIntegerArray arr = <span class="keyword">new</span> AtomicIntegerArray(<span class="number">10</span>); </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AddThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123; Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span> <span class="params">()</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">10</span>; k++) Â  Â  </span><br><span class="line">                arr.getAndIncrement(k % arr.length()); </span><br><span class="line">        &#125; Â  </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; Â </span><br><span class="line">        Thread[] ts = <span class="keyword">new</span> Thread[<span class="number">10</span>]; Â  Â  Â </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">10</span>; k++) &#123; Â  Â  Â  Â </span><br><span class="line">            ts[k] = <span class="keyword">new</span> Thread(<span class="keyword">new</span> AddThread()); </span><br><span class="line">        &#125; Â  Â  Â </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">10</span>; k++) &#123; Â  Â </span><br><span class="line">            ts[k].start(); Â  Â  Â </span><br><span class="line">        &#125; Â  Â  Â </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">10</span>; k++) &#123; Â  Â  Â  </span><br><span class="line">            ts[k].join(); Â  Â  </span><br><span class="line">        &#125; Â  Â  </span><br><span class="line">        System.out.println(arr); Â </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-2-3-åŸå­å¼•ç”¨ç±»å‹"><a href="#3-2-3-åŸå­å¼•ç”¨ç±»å‹" class="headerlink" title="3.2.3 åŸå­å¼•ç”¨ç±»å‹"></a>3.2.3 åŸå­å¼•ç”¨ç±»å‹</h5><p>å¦‚æœéœ€è¦åŸå­æ›´æ–°å¼•ç”¨ç±»å‹å˜é‡çš„è¯ï¼Œä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œatomicä¹Ÿæä¾›äº†ç›¸å…³çš„ç±»ï¼š</p>
<ul>
<li><p>AtomicReference </p>
</li>
<li><p>AtomicStampedReference </p>
</li>
<li><p>AtomicMarkableReference</p>
</li>
</ul>
<p>AtomicReferenceçš„å¼•å…¥æ˜¯ä¸ºäº†å¯ä»¥ç”¨ä¸€ç§ç±»ä¼¼ä¹è§‚é”çš„æ–¹å¼æ“ä½œå…±äº«èµ„æºï¼Œåœ¨æŸäº›æƒ…æ™¯ä¸‹ä»¥æå‡æ€§èƒ½ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicReferenceTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; Â  Â  Â  </span><br><span class="line">        AtomicReference&lt;Integer&gt; ref = <span class="keyword">new</span> AtomicReference&lt;&gt;(<span class="keyword">new</span> Integer(<span class="number">1000</span>));</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â List&lt;Thread&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(); Â  Â </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123; Â  Â  Â </span><br><span class="line">            Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Task(ref), <span class="string">"Thread-"</span> + i); Â  Â  </span><br><span class="line">            list.add(t); Â  Â  Â  Â </span><br><span class="line">            t.start();</span><br><span class="line">            </span><br><span class="line"> &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">for</span> (Thread t : list) &#123; Â  </span><br><span class="line">            t.join(); Â  Â  </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â System.out.println(ref.get()); Â  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; Â  </span><br><span class="line">    <span class="keyword">private</span> AtomicReference&lt;Integer&gt; ref;</span><br><span class="line"> Â  Â Task(AtomicReference&lt;Integer&gt; ref) &#123; Â </span><br><span class="line">        <span class="keyword">this</span>.ref = ref; </span><br><span class="line">    &#125; Â  Â  </span><br><span class="line">    <span class="meta">@Override</span> Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â </span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123; Â </span><br><span class="line">            <span class="comment">//è‡ªæ—‹æ“ä½œ Â  Â  Â  </span></span><br><span class="line">            Integer oldV = ref.get(); Â  </span><br><span class="line">            <span class="keyword">if</span> (ref.compareAndSet(oldV, oldV + <span class="number">1</span>)) </span><br><span class="line">                <span class="comment">// CASæ“ä½œ  Â  Â  Â  Â  Â  </span></span><br><span class="line">                <span class="keyword">break</span>; Â  Â  Â </span><br><span class="line">        &#125; Â </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ¡ˆä¾‹å¹¶æ²¡æœ‰ä½¿ç”¨é”ï¼Œæ˜¯ä½¿ç”¨è‡ªæ—‹+CASçš„æ— é”æ“ä½œä¿è¯å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨ã€‚<br>CASæ“ä½œå¯èƒ½å­˜åœ¨ABAçš„é—®é¢˜ï¼š å‡å¦‚ä¸€ä¸ªå€¼åŸæ¥æ˜¯Aï¼Œå˜æˆäº†Bï¼Œåˆå˜æˆäº†Aï¼Œé‚£ä¹ˆCASæ£€æŸ¥æ—¶ä¼šå‘ç°å®ƒçš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šå´ å˜åŒ–äº†ã€‚<br>ä¸€èˆ¬æ¥è®²è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œæ¯”å¦‚æ•°å€¼è¿ç®—ï¼Œçº¿ç¨‹å…¶å®æ ¹æœ¬ä¸å…³å¿ƒå˜é‡ä¸­é€”å¦‚ä½•å˜åŒ–ï¼Œåªè¦ç»ˆçš„çŠ¶æ€ å’Œé¢„æœŸå€¼ä¸€æ ·å³å¯ã€‚<br>ä½†æ˜¯ï¼Œæœ‰äº›æ“ä½œä¼šä¾èµ–äºå¯¹è±¡çš„å˜åŒ–è¿‡ç¨‹ï¼Œæ­¤æ—¶çš„è§£å†³æ€è·¯ä¸€èˆ¬å°±æ˜¯ä½¿ç”¨ç‰ˆæœ¬å·ã€‚åœ¨å˜é‡å‰é¢è¿½åŠ ä¸Šç‰ˆ æœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œé‚£ä¹ˆAï¼Bï¼A å°±ä¼šå˜æˆ1A - 2B - 3Aã€‚<br>AtomicStampedReferenceå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„åŠ äº†ç‰ˆæœ¬å·çš„AtomicReferenceã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">     <span class="keyword">final</span> T reference; Â  Â  </span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> stamp; Â  Â </span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="title">Pair</span><span class="params">(T reference, <span class="keyword">int</span> stamp)</span> </span>&#123; Â  </span><br><span class="line">         <span class="keyword">this</span>.reference = reference; Â  </span><br><span class="line">         <span class="keyword">this</span>.stamp = stamp; Â  Â </span><br><span class="line">     &#125; Â  Â  Â </span><br><span class="line">     <span class="keyword">static</span> &lt;T&gt; <span class="function">Pair&lt;T&gt; <span class="title">of</span><span class="params">(T reference, <span class="keyword">int</span> stamp)</span> </span>&#123; Â  Â  </span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> Pair&lt;T&gt;(reference, stamp); Â  Â  </span><br><span class="line">     &#125; Â  </span><br><span class="line"> &#125;</span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">volatile</span> Pair&lt;V&gt; pair;</span><br><span class="line"> Â  Â <span class="comment">/** Â  Â  </span></span><br><span class="line"><span class="comment"> Â  Â  * Creates a new &#123;<span class="doctag">@code</span> AtomicStampedReference&#125; with the given</span></span><br><span class="line"><span class="comment">	 * initial values. Â  Â  </span></span><br><span class="line"><span class="comment">	 * Â  Â  </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> initialRef the initial reference Â  Â  </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> initialStamp the initial stamp Â  Â  </span></span><br><span class="line"><span class="comment">	 */</span> Â  Â </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AtomicStampedReference</span><span class="params">(V initialRef, <span class="keyword">int</span> initialStamp)</span> </span>&#123; Â  </span><br><span class="line">    	pair = Pair.of(initialRef, initialStamp); Â  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§£å†³ABAé—®é¢˜ï¼Œå¼•å…¥äº†AtomicStampedReferenceã€‚</p>
<p>AtomicStampedReferenceå¯ä»¥ç»™å¼•ç”¨åŠ ä¸Šç‰ˆæœ¬å·ï¼Œè¿½è¸ªå¼•ç”¨çš„æ•´ä¸ªå˜åŒ–è¿‡ç¨‹ï¼Œå¦‚ï¼š A -&gt; B -&gt; C -&gt; D - &gt; Aï¼Œé€šè¿‡AtomicStampedReferenceï¼Œå¯ä»¥çŸ¥é“ï¼Œå¼•ç”¨å˜é‡ä¸­é€”è¢«æ›´æ”¹äº†3 æ¬¡ã€‚</p>
<p>ä½†æ˜¯ï¼Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒå¼•ç”¨å˜é‡æ›´æ”¹äº†å‡ æ¬¡ï¼Œåªå…³å¿ƒæ˜¯å¦æ›´æ”¹è¿‡ï¼Œå°±æœ‰äº† AtomicMarkableReferenceï¼š<br>    AtomicMarkableReferenceå’ŒAtomicStampedReferenceçš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ä¸å†ç”¨intæ ‡è¯†å¼•ç”¨ï¼Œè€Œæ˜¯ä½¿ ç”¨booleanå˜é‡â€”â€”è¡¨ç¤ºå¼•ç”¨å˜é‡æ˜¯å¦è¢«æ›´æ”¹è¿‡ã€‚<br>    AtomicMarkableReferenceå¯¹äºé‚£äº›ä¸å…³å¿ƒå¼•ç”¨å˜åŒ–è¿‡ç¨‹ï¼Œåªå…³å¿ƒå¼•ç”¨å˜é‡æ˜¯å¦å˜åŒ–è¿‡çš„åº”ç”¨ä¼šæ›´åŠ å‹å¥½ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicMarkableReference</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">T</span>&gt; </span>&#123; Â  Â </span><br><span class="line">        <span class="keyword">final</span> T reference; Â  Â  </span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> mark; Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Pair</span><span class="params">(T reference, <span class="keyword">boolean</span> mark)</span> </span>&#123; Â  Â  </span><br><span class="line">            <span class="keyword">this</span>.reference = reference; Â  Â </span><br><span class="line">            <span class="keyword">this</span>.mark = mark; Â  Â  Â  </span><br><span class="line">        &#125; Â  Â  Â </span><br><span class="line">        <span class="keyword">static</span> &lt;T&gt; <span class="function">Pair&lt;T&gt; <span class="title">of</span><span class="params">(T reference, <span class="keyword">boolean</span> mark)</span> </span>&#123; Â </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Pair&lt;T&gt;(reference, mark); Â  Â  Â  </span><br><span class="line">        &#125; Â  </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">volatile</span> Pair&lt;V&gt; pair;</span><br><span class="line"> Â  Â <span class="comment">/** Â  Â  </span></span><br><span class="line"><span class="comment"> Â  Â   * Creates a new &#123;<span class="doctag">@code</span> AtomicMarkableReference&#125; with the given Â  </span></span><br><span class="line"><span class="comment">      * initial values. Â  </span></span><br><span class="line"><span class="comment">      * Â  Â </span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> initialRef the initial reference Â  Â  </span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> initialMark the initial mark </span></span><br><span class="line"><span class="comment">      */</span> Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AtomicMarkableReference</span><span class="params">(V initialRef, <span class="keyword">boolean</span> initialMark)</span> </span>&#123; </span><br><span class="line">        pair = Pair.of(initialRef, initialMark);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-2-4-åŸå­æ›´æ–°å­—æ®µç±»å‹"><a href="#3-2-4-åŸå­æ›´æ–°å­—æ®µç±»å‹" class="headerlink" title="3.2.4 åŸå­æ›´æ–°å­—æ®µç±»å‹"></a>3.2.4 åŸå­æ›´æ–°å­—æ®µç±»å‹</h5><p>å¦‚æœéœ€è¦æ›´æ–°å¯¹è±¡çš„æŸä¸ªå­—æ®µï¼Œå¹¶åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒatomicåŒæ ·ä¹Ÿæä¾›äº†ç›¸åº”çš„ åŸå­æ“ä½œç±»ï¼š</p>
<ul>
<li>AtomicIntegeFieldUpdaterï¼šåŸå­æ›´æ–°æ•´å‹å­—æ®µç±»ï¼› </li>
<li>AtomicLongFieldUpdaterï¼šåŸå­æ›´æ–°é•¿æ•´å‹å­—æ®µç±»ï¼›</li>
<li>AtomicReferenceFieldUpdaterï¼š</li>
</ul>
<p>åŸå­æ›´æ–°å¼•ç”¨å­—æ®µç±»å‹ï¼›</p>
<p>è¦æƒ³ä½¿ç”¨åŸå­æ›´æ–°å­—æ®µéœ€è¦ä¸¤æ­¥æ“ä½œï¼š</p>
<ul>
<li>åŸå­æ›´æ–°å­—æ®µç±»éƒ½æ˜¯æŠ½è±¡ç±»ï¼Œåªèƒ½é€šè¿‡é™æ€æ–¹æ³• newUpdater æ¥åˆ›å»ºä¸€ä¸ªæ›´æ–°å™¨ï¼Œå¹¶ä¸”éœ€è¦è®¾ç½®æƒ³ è¦æ›´æ–°çš„ç±»å’Œå±æ€§ï¼› </li>
<li>æ›´æ–°ç±»çš„å±æ€§å¿…é¡»ä½¿ç”¨ public volatile è¿›è¡Œä¿®é¥°ï¼›</li>
<li>å­—æ®µå¿…é¡»æ˜¯volatileç±»å‹çš„ï¼Œåœ¨çº¿ç¨‹ä¹‹é—´å…±äº«å˜é‡æ—¶ä¿è¯ç«‹å³å¯è§ </li>
<li>å­—æ®µçš„æè¿°ç±»å‹ï¼ˆä¿®é¥°ç¬¦public/protected/default/privateï¼‰æ˜¯ä¸è°ƒç”¨è€…ä¸æ“ä½œå¯¹è±¡å­—æ®µçš„ å…³ç³»ä¸€è‡´ã€‚ä¹Ÿå°±æ˜¯è¯´è°ƒç”¨è€…èƒ½å¤Ÿç›´æ¥æ“ä½œå¯¹è±¡å­—æ®µï¼Œé‚£ä¹ˆå°±å¯ä»¥åå°„è¿›è¡ŒåŸå­æ“ä½œã€‚</li>
<li>å¯¹äºçˆ¶ç±»çš„å­—æ®µï¼Œå­ç±»æ˜¯ä¸èƒ½ç›´æ¥æ“ä½œçš„ï¼Œå°½ç®¡å­ç±»å¯ä»¥è®¿é—®çˆ¶ç±»çš„å­—æ®µã€‚</li>
<li>åªèƒ½æ˜¯å®ä¾‹å˜é‡ï¼Œä¸èƒ½æ˜¯ç±»å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½åŠ staticå…³é”®å­—ã€‚ </li>
<li>åªèƒ½æ˜¯å¯ä¿®æ”¹å˜é‡ï¼Œä¸èƒ½ä½¿finalå˜é‡ï¼Œå› ä¸ºfinalçš„è¯­ä¹‰å°±æ˜¯ä¸å¯ä¿®æ”¹ã€‚ </li>
<li>å¯¹äºAtomicIntegerFieldUpdaterå’ŒAtomicLongFieldUpdateråªèƒ½ä¿®æ”¹int/longç±»å‹çš„å­— æ®µï¼Œä¸èƒ½ä¿®æ”¹å…¶åŒ…è£…ç±»å‹ï¼ˆInteger/Longï¼‰ã€‚å¦‚æœè¦ä¿®æ”¹åŒ…è£…ç±»å‹å°±éœ€è¦ä½¿ç”¨ AtomicReferenceFieldUpdaterã€‚</li>
</ul>
<p>è¿™å‡ ä¸ªç±»æä¾›çš„æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œä»¥AtomicIntegerFieldUpdaterä¸ºä¾‹æ¥çœ‹çœ‹å…·ä½“çš„ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicIntegerFieldUpdater;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicIntegerFieldUpdaterTest</span></span>&#123;</span><br><span class="line">    </span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">static</span> AtomicIntegerFieldUpdater&lt;User&gt; a = </span><br><span class="line">        AtomicIntegerFieldUpdater.newUpdater(User.class, "age");</span><br><span class="line">    </span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; Â  Â  </span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">"conan"</span>, <span class="number">10</span>); Â  Â  Â  </span><br><span class="line">        System.out.println(a.getAndIncrement(user)); Â </span><br><span class="line">        System.out.println(a.get(user)); Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123; Â  Â </span><br><span class="line">        <span class="keyword">private</span> String name; Â  Â  Â </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">int</span> age; Â  Â  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123; Â  Â  Â </span><br><span class="line">            <span class="keyword">this</span>.name = name; Â  Â </span><br><span class="line">            <span class="keyword">this</span>.age = age; Â  Â  </span><br><span class="line">        &#125; Â  Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123; Â  Â  </span><br><span class="line">            <span class="keyword">return</span> name; Â  Â  </span><br><span class="line">        &#125; Â  Â  Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">return</span> age; Â  Â  Â   </span><br><span class="line">        &#125; Â </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ç¤ºä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œåˆ›å»º AtomicIntegerFieldUpdater æ˜¯é€šè¿‡å®ƒæä¾›çš„é™æ€æ–¹æ³•è¿›è¡Œåˆ›å»ºï¼Œ getAndAdd æ–¹æ³•ä¼šå°†æŒ‡å®šçš„å­—æ®µåŠ ä¸Šè¾“å…¥çš„å€¼ï¼Œå¹¶ä¸”è¿”å›ç›¸åŠ ä¹‹å‰çš„å€¼ã€‚userå¯¹è±¡ä¸­ageå­—æ®µåŸå€¼ä¸º 1ï¼ŒåŠ 5ä¹‹åï¼Œå¯ä»¥çœ‹å‡ºuserå¯¹è±¡ä¸­çš„ageå­—æ®µçš„å€¼å·²ç»å˜æˆäº†6ã€‚</p>
<h4 id="3-3-é”ï¼šLock"><a href="#3-3-é”ï¼šLock" class="headerlink" title="3.3 é”ï¼šLock"></a>3.3 é”ï¼šLock</h4><p>java.util.concurrent.locks åŒ…ï¼Œè¯¥åŒ…æä¾›äº†ä¸€ç³»åˆ—åŸºç¡€çš„é”å·¥å…·ï¼Œç”¨ä»¥å¯¹synchronizdã€waitã€ notifyç­‰è¿›è¡Œè¡¥å……ã€å¢å¼ºã€‚ juc-locksé”æ¡†æ¶ä¸­ä¸€å…±å°±ä¸‰ä¸ªæ¥å£ï¼šLockã€Conditionã€ReadWriteLockã€‚</p>
<h5 id="3-3-1-ReentrantLock"><a href="#3-3-1-ReentrantLock" class="headerlink" title="3.3.1 ReentrantLock"></a>3.3.1 ReentrantLock</h5><p>ReentrantLockå«åšå¯é‡å…¥é”ï¼ŒæŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥é‡å¤è·å–åŒä¸€æŠŠé”ï¼Œæˆ–è€…è¯´è¯¥é”æ”¯æŒä¸€ä¸ªçº¿ç¨‹å¯¹èµ„æºçš„ é‡å¤åŠ é”ã€‚åŒæ—¶è¯¥é”è¿˜æ”¯æŒè·å–é”çš„å…¬å¹³æ€§å’Œéå…¬å¹³æ€§é€‰æ‹©ï¼Œé”çš„å…¬å¹³æ€§æ˜¯æŒ‡ï¼Œåœ¨ç»å¯¹æ—¶é—´ä¸Šï¼Œå…ˆå¯¹é” è·å–çš„è¯·æ±‚ä¸€å®šå…ˆè¢«æ»¡è¶³ï¼Œä¹Ÿå°±æ˜¯ç­‰å¾…æ—¶é—´é•¿çš„é‚£ä¸ªçº¿ç¨‹ä¼˜å…ˆè·å¾—ï¼Œå¯ä»¥è¯´ï¼Œé”çš„è·å–æ˜¯é¡ºåºçš„ï¼Œå³ ç¬¦åˆFIFOè§„åˆ™ã€‚<br>ReentrantLockä¹Ÿæ˜¯äº’æ–¥é”ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ä¿è¯åŸå­æ€§ã€‚<br>ReentrantLock é‡å…¥é”çš„åŸºæœ¬åŸç†æ˜¯åˆ¤æ–­ä¸Šæ¬¡è·å–é”çš„çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯åˆ™å¯å†æ¬¡è¿›å…¥ä¸´ ç•ŒåŒºï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™é˜»å¡ã€‚<br>ç”±äºReentrantLockæ˜¯åŸºäºAQSå®ç°çš„ï¼Œåº•å±‚é€šè¿‡æ“ä½œåŒæ­¥çŠ¶æ€æ¥è·å–é”.ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹éå…¬å¹³é”çš„å® ç°é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">nonfairTryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123; Â  Â  </span><br><span class="line">    <span class="comment">//è·å–å½“å‰çº¿ç¨‹ Â  Â  Â  Â  </span></span><br><span class="line">    <span class="keyword">final</span> Thread current = Thread.currentThread(); Â  Â  Â  Â </span><br><span class="line">    <span class="comment">//é€šè¿‡AQSè·å–åŒæ­¥çŠ¶æ€ Â  Â  Â  </span></span><br><span class="line">    <span class="keyword">int</span> c = getState(); Â  Â  Â  Â  Â  Â </span><br><span class="line">    <span class="comment">//åŒæ­¥çŠ¶æ€ä¸º0ï¼Œè¯´æ˜ä¸´ç•ŒåŒºå¤„äºæ— é”çŠ¶æ€ï¼Œ Â  Â  Â  Â  Â  Â </span></span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) &#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">        <span class="comment">//ä¿®æ”¹åŒæ­¥çŠ¶æ€ï¼Œå³åŠ é” Â  Â  Â  Â  Â </span></span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, acquires)) &#123; Â  Â  Â  Â </span><br><span class="line">            <span class="comment">//å°†å½“å‰çº¿ç¨‹è®¾ç½®ä¸ºé”çš„owner Â  Â  </span></span><br><span class="line">            setExclusiveOwnerThread(current); Â  Â </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>; Â  Â  Â  Â  Â  Â </span><br><span class="line">        &#125; Â  Â  Â  Â  </span><br><span class="line">    &#125; Â  Â  Â  </span><br><span class="line">    <span class="comment">//å¦‚æœä¸´ç•ŒåŒºå¤„äºé”å®šçŠ¶æ€ï¼Œä¸”ä¸Šæ¬¡è·å–é”çš„çº¿ç¨‹ä¸ºå½“å‰çº¿ç¨‹ Â </span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) &#123; Â  </span><br><span class="line">        <span class="comment">//åˆ™é€’å¢åŒæ­¥çŠ¶æ€ Â  Â  Â  </span></span><br><span class="line">        <span class="keyword">int</span> nextc = c + acquires; Â  Â  </span><br><span class="line">        <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) <span class="comment">// overflow Â  Â  Â </span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum lock count exceeded"</span>); Â  </span><br><span class="line">        setState(nextc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; Â  Â  Â  </span><br><span class="line">    &#125; Â  Â  Â  Â </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>; Â  Â  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸè·å–é”çš„çº¿ç¨‹å†æ¬¡è·å–é”ï¼Œåªæ˜¯å¢åŠ äº†åŒæ­¥çŠ¶æ€å€¼ï¼Œåœ¨é‡Šæ”¾åŒæ­¥è½¬æ€æ—¶ï¼Œç›¸åº”çš„å‡å°‘åŒæ­¥çŠ¶æ€å€¼ï¼Œ å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123; Â  Â  Â  </span><br><span class="line">    <span class="keyword">int</span> c = getState() - releases; Â  </span><br><span class="line">    <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread()) Â  Â  Â  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException(); Â  Â </span><br><span class="line">    <span class="keyword">boolean</span> free = <span class="keyword">false</span>; Â  Â  Â  Â  </span><br><span class="line">    <span class="comment">//åœ¨åŒæ­¥çŠ¶æ€å®Œå…¨é‡Šæ”¾äº†ï¼Œè®¾ç½®true Â  Â </span></span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) &#123; Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">        free = <span class="keyword">true</span>; Â  Â  Â  </span><br><span class="line">        setExclusiveOwnerThread(<span class="keyword">null</span>); Â  Â  </span><br><span class="line">    &#125; Â  Â  Â  Â  Â  </span><br><span class="line">    setState(c); Â  Â </span><br><span class="line">    <span class="keyword">return</span> free; Â  Â </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¬å¹³é”å’Œéå…¬å¹³é”çš„æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList; </span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections; </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReentrantLockTest</span> </span>&#123; Â  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Lock fairLock = <span class="keyword">new</span> ReentrantLockMine(<span class="keyword">true</span>); </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Lock unfairLock = <span class="keyword">new</span> ReentrantLockMine(<span class="keyword">false</span>);</span><br><span class="line">    </span><br><span class="line"> Â  Â <span class="meta">@Test</span> Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unfair</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123; Â  Â </span><br><span class="line">        testLock(<span class="string">"unfair lock"</span>, unfairLock); Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Test</span> Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fair</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123; Â  </span><br><span class="line">        testLock(<span class="string">"fair lock"</span>, fairLock); Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testLock</span><span class="params">(String type, Lock lock)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; Â  </span><br><span class="line">        System.out.println(type); Â  Â </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123; Â  Â  Â </span><br><span class="line">            Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Job(lock))&#123; Â  Â  </span><br><span class="line">                <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; Â  Â  Â  </span><br><span class="line">                    <span class="keyword">return</span> getName();</span><br><span class="line">                &#125; Â  Â  Â  Â  Â </span><br><span class="line">            &#125;; Â  Â  Â  </span><br><span class="line">            thread.setName(<span class="string">""</span> + i); Â  Â </span><br><span class="line">            thread.start(); Â  Â  Â </span><br><span class="line">        &#125; Â  Â  </span><br><span class="line">        Thread.sleep(<span class="number">11000</span>); Â  </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Job</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123; Â  Â </span><br><span class="line">        <span class="keyword">private</span> Lock lock; Â  Â  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Job</span><span class="params">(Lock lock)</span> </span>&#123; Â  Â  Â </span><br><span class="line">            <span class="keyword">this</span>.lock = lock; Â  Â  </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123; Â  Â  Â </span><br><span class="line">                lock.lock(); Â  Â  Â  Â  Â  </span><br><span class="line">                <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>); Â </span><br><span class="line">                    System.out.println(<span class="string">"è·å–é”çš„å½“å‰çº¿ç¨‹["</span> + Thread.currentThread().getName() + <span class="string">"], åŒæ­¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹"</span> + ((ReentrantLockMine)lock).getQueuedThreads() + <span class="string">""</span>); Â  Â  Â </span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  Â </span><br><span class="line">                    e.printStackTrace(); Â  Â  Â  Â </span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                    lock.unlock(); Â  Â  Â  </span><br><span class="line">                &#125; Â  Â  Â  </span><br><span class="line">            &#125; Â  Â  </span><br><span class="line">        &#125; Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReentrantLockMine</span> <span class="keyword">extends</span> <span class="title">ReentrantLock</span> </span>&#123; Â </span><br><span class="line">        <span class="comment">//é‡æ–°å® ç°ReentrantLockç±»æ˜¯ä¸ºäº†é‡å†™getQueuedThreadsæ–¹æ³•ï¼Œä¾¿äºæˆ‘ä»¬è¯•éªŒçš„è§‚å¯Ÿ</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ReentrantLockMine</span><span class="params">(<span class="keyword">boolean</span> fair)</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">super</span>(fair); Â  Â  </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="meta">@Override</span> Â  </span><br><span class="line">        <span class="function"><span class="keyword">protected</span> Collection&lt;Thread&gt; <span class="title">getQueuedThreads</span><span class="params">()</span> </span>&#123; Â </span><br><span class="line">            <span class="comment">//è·å–åŒæ­¥é˜Ÿåˆ—ä¸­çš„ çº¿ç¨‹ Â  Â  Â  Â  Â </span></span><br><span class="line">            List&lt;Thread&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;Thread&gt; (<span class="keyword">super</span>.getQueuedThreads());</span><br><span class="line">            Collections.reverse(arrayList); Â  Â  </span><br><span class="line">            <span class="keyword">return</span> arrayList; Â  Â  </span><br><span class="line">        &#125; Â </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éå…¬å¹³é”çš„è·å–ï¼Œåªè¦è·å–äº†åŒæ­¥çŠ¶æ€å°±å¯ä»¥è·å–é”ï¼Œæœ‰å¯èƒ½å¯¼è‡´é¥¥é¥¿ç°è±¡ï¼Œä½†æ˜¯éå…¬å¹³é”ï¼Œçº¿ç¨‹çš„åˆ‡ æ¢æ¯”è¾ƒå°‘ï¼Œæ›´é«˜æ•ˆã€‚<br>ReentrantLockä¸synchronizedçš„åŒºåˆ«</p>
<ul>
<li><p>é‡å…¥ </p>
<p>synchronizedå¯é‡å…¥ï¼Œå› ä¸ºåŠ é”å’Œè§£é”è‡ªåŠ¨è¿›è¡Œï¼Œä¸å¿…æ‹…å¿ƒåæ˜¯å¦é‡Šæ”¾é”ï¼›ReentrantLockä¹Ÿ å¯é‡å…¥ï¼Œä½†åŠ é”å’Œè§£é”éœ€è¦æ‰‹åŠ¨è¿›è¡Œï¼Œä¸”æ¬¡æ•°éœ€ä¸€æ ·ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è·å¾—é”ã€‚</p>
</li>
<li><p>å®ç°</p>
<p>synchronizedæ˜¯JVMå®ç°çš„ã€è€ŒReentrantLockæ˜¯JDKå®ç°çš„ã€‚è¯´ç™½äº†å°±æ˜¯ï¼Œæ˜¯æ“ä½œç³»ç»Ÿæ¥å®ç°ï¼Œ è¿˜æ˜¯ç”¨æˆ·è‡ªå·±æ•²ä»£ç å®ç°ã€‚ </p>
</li>
<li><p>æ€§èƒ½ </p>
<p>åœ¨ Java çš„ 1.5 ç‰ˆæœ¬ä¸­ï¼Œsynchronized æ€§èƒ½ä¸å¦‚ SDK é‡Œé¢çš„ Lockï¼Œä½† 1.6 ç‰ˆæœ¬ä¹‹åï¼Œ synchronized åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå°†æ€§èƒ½è¿½äº†ä¸Šæ¥ã€‚</p>
</li>
<li><p>åŠŸèƒ½ </p>
<p>ReentrantLocké”çš„ç»†ç²’åº¦å’Œçµæ´»åº¦ï¼Œä¼˜äºsynchronizedã€‚ ReentrantLockä¸åŒç‚¹ä¸€ï¼šå¯åœ¨æ„é€ å‡½æ•°ä¸­æŒ‡å®šæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Œè€Œsynchronizedåªèƒ½æ˜¯éå…¬å¹³é”</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ReentrantLock reentrantLock = <span class="keyword">new</span> ReentrantLock(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>ReentrantLockä¸åŒç‚¹äºŒï¼šå¯ä»¥é¿å…æ­»é”é—®é¢˜ï¼Œå› ä¸ºå®ƒå¯ä»¥éé˜»å¡åœ°è·å–é”ã€‚å¦‚æœå°è¯•è·å– é”å¤±è´¥ï¼Œå¹¶ä¸è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›falseï¼Œè¿™æ—¶å€™çº¿ç¨‹ä¸ç”¨é˜»å¡ç­‰å¾…ï¼Œå¯ä»¥å…ˆå»åšå…¶ä»–äº‹æƒ…ã€‚ æ‰€ä»¥ä¸ä¼šé€ æˆæ­»é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ”¯æŒéé˜»å¡è·å–é”çš„ API </span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>tryLockè¿˜æ”¯æŒè¶…æ—¶ã€‚è°ƒç”¨tryLockæ—¶æ²¡æœ‰è·å–åˆ°é”ï¼Œä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœçº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´ä¹‹å†…è¿˜æ˜¯ æ²¡æœ‰è·å–åˆ°é”ï¼Œä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯throws InterruptedExceptionï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾ æ›¾ç»æŒæœ‰çš„é”ï¼Œè¿™æ ·ä¹Ÿèƒ½ç ´åæ­»é”ä¸å¯æŠ¢å æ¡ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span></span></span><br></pre></td></tr></table></figure>

<p>ReentrantLockä¸åŒç‚¹ä¸‰ï¼šæä¾›èƒ½å¤Ÿä¸­æ–­ç­‰å¾…é”æœºåˆ¶ã€‚</p>
<p>synchronized çš„é—®é¢˜æ˜¯ï¼ŒæŒæœ‰é” A åï¼Œå¦‚æœå°è¯•è·å–é” B å¤±è´¥ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸€æ—¦ å‘ç”Ÿæ­»é”ï¼Œå°±æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å”¤é†’é˜»å¡çš„çº¿ç¨‹ã€‚</p>
<p>ä½†å¦‚æœé˜»å¡çŠ¶æ€çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ç»™é˜»å¡çš„çº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå”¤ é†’å®ƒï¼Œé‚£å®ƒå°±æœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é” Aã€‚ReentrantLockå¯ä»¥ç”¨lockInterruptiblyæ–¹æ³•æ¥å®ç°ã€‚</p>
<p>ReentrantLockä¸åŒç‚¹å››ï¼šå¯ä»¥ç”¨J.U.CåŒ…ä¸­çš„Conditionå®ç°åˆ†ç»„å”¤é†’éœ€è¦ç­‰å¾…çš„çº¿ç¨‹ã€‚è€Œ synchronizedåªèƒ½notifyæˆ–è€…notifyAllã€‚</p>
<h5 id="3-3-2-LockSupport"><a href="#3-3-2-LockSupport" class="headerlink" title="3.3.2 LockSupport"></a>3.3.2 LockSupport</h5><p>LockSupportç±»ï¼Œæ˜¯JUCåŒ…ä¸­çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œå®šä¹‰äº†ä¸€ç»„é™æ€æ–¹æ³•ï¼Œæä¾›åŸºæœ¬çš„çº¿ç¨‹é˜»å¡å’Œå”¤é†’åŠŸ èƒ½ï¼Œæ˜¯æ„å»ºåŒæ­¥ç»„ä»¶çš„åŸºç¡€å·¥å…·ï¼Œç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¡åŸè¯­ã€‚<br>LockSupportç±»çš„æ ¸å¿ƒæ–¹æ³•å…¶å®å°±ä¸¤ä¸ªï¼špark() å’Œ unpark()ï¼Œå…¶ä¸­ park() æ–¹æ³•ç”¨æ¥é˜»å¡çº¿ç¨‹ï¼Œ unpark()æ–¹æ³•ç”¨äºå”¤é†’æŒ‡å®šçº¿ç¨‹ã€‚<br>å’ŒObjectç±»çš„wait() å’Œ signal() æ–¹æ³•æœ‰äº›ç±»ä¼¼ï¼Œä½†æ˜¯LockSupportçš„è¿™ä¸¤ç§æ–¹æ³•ä»è¯­æ„ä¸Šè®²æ¯” Objectç±»çš„æ–¹æ³•æ›´æ¸…æ™°ï¼Œè€Œä¸”å¯ä»¥é’ˆå¯¹æŒ‡å®šçº¿ç¨‹è¿›è¡Œé˜»å¡å’Œå”¤é†’ã€‚<br>LockSupportç±»ä½¿ç”¨äº†ä¸€ç§åä¸ºPermitï¼ˆè®¸å¯ï¼‰çš„æ¦‚å¿µæ¥åšåˆ°é˜»å¡å’Œå”¤é†’çº¿ç¨‹çš„åŠŸèƒ½ï¼Œå¯ä»¥æŠŠè®¸å¯çœ‹ æˆæ˜¯ä¸€ç§ï¼ˆ0ï¼Œ1ï¼‰ä¿¡å·é‡ï¼ˆSemaphoreï¼‰ï¼Œä½†ä¸Semaphoreä¸åŒçš„æ˜¯ï¼Œè®¸å¯çš„é‡åŠ ä¸Šé™1ã€‚<br>åˆå§‹æ—¶ï¼Œpermitä¸º0ï¼Œå½“è°ƒç”¨ unpark() æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹çš„permitåŠ 1ï¼Œå½“è°ƒç”¨ park()æ–¹æ³•æ—¶ï¼Œå¦‚æœ permitä¸º0ï¼Œåˆ™è°ƒç”¨çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p>
<p>å‡è®¾ç°åœ¨éœ€è¦å®ç°ä¸€ç§FIFOç±»å‹çš„ç‹¬å é”ï¼Œå¯ä»¥æŠŠè¿™ç§é”çœ‹æˆæ˜¯ReentrantLockçš„å…¬å¹³é”ç®€å•ç‰ˆæœ¬ï¼Œ ä¸”æ˜¯ä¸å¯é‡å…¥çš„ï¼Œå°±æ˜¯è¯´å½“ä¸€ä¸ªçº¿ç¨‹è·å¾—é”åï¼Œå…¶ä»–ç­‰å¾…çº¿ç¨‹ä»¥FIFOçš„è°ƒåº¦æ–¹å¼ç­‰å¾…è·å–é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Queue; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentLinkedQueue; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicBoolean;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.LockSupport;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">FIFOMutex</span>  </span>&#123; Â </span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> AtomicBoolean locked = <span class="keyword">new</span> AtomicBoolean(<span class="keyword">false</span>); Â </span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> Queue&lt;Thread&gt; waiters = <span class="keyword">new</span> ConcurrentLinkedQueue&lt;&gt;();</span><br><span class="line">     </span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span></span>&#123; Â  Â </span><br><span class="line">        Thread current = Thread.currentThread(); Â  Â  Â  </span><br><span class="line">        waiters.add(current); Â  Â  Â  </span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰çº¿ç¨‹ä¸åœ¨é˜Ÿé¦–ï¼Œæˆ–é”å·²è¢«å ç”¨ï¼Œåˆ™å½“å‰çº¿ç¨‹é˜»å¡ </span></span><br><span class="line">        <span class="comment">// è¿™ä¸ªåˆ¤æ–­çš„å†…åœ¨æ„å›¾ï¼šé”å¿…é¡»ç”±é˜Ÿé¦–å…ƒç´ æ‹¿åˆ° Â  Â </span></span><br><span class="line">        <span class="keyword">while</span> (waiters.peek() != current || !locked.compareAndSet(<span class="keyword">false</span>,<span class="keyword">true</span>))&#123; Â </span><br><span class="line">            LockSupport.park(); Â  Â  Â </span><br><span class="line">        &#125; Â  Â  Â  </span><br><span class="line">        waiters.remove();</span><br><span class="line">        <span class="comment">// åˆ é™¤é˜Ÿé¦–å…ƒç´  Â </span></span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span></span>&#123; </span><br><span class="line">        locked.set(<span class="keyword">false</span>); Â  Â </span><br><span class="line">        LockSupport.unpark(waiters.peek()); Â </span><br><span class="line">    &#125; </span><br><span class="line"> &#125; </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFIFOMutex</span> </span>&#123; Â </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; Â </span><br><span class="line">         FIFOMutex mutex = <span class="keyword">new</span> FIFOMutex(); </span><br><span class="line">         MyThread a1 = <span class="keyword">new</span> MyThread(<span class="string">"a"</span>, mutex); Â  </span><br><span class="line">         MyThread a2 = <span class="keyword">new</span> MyThread(<span class="string">"b"</span>, mutex); Â  </span><br><span class="line">         MyThread a3 = <span class="keyword">new</span> MyThread(<span class="string">"c"</span>, mutex); Â </span><br><span class="line">         a1.start(); Â  Â  </span><br><span class="line">         a2.start(); Â  Â  </span><br><span class="line">         a3.start(); Â  Â  </span><br><span class="line">         a1.join(); Â  Â  Â  Â </span><br><span class="line">         a2.join(); Â </span><br><span class="line">         a3.join(); Â  Â  </span><br><span class="line">         System.out.println(<span class="string">"Finished"</span>); Â </span><br><span class="line">     &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123; Â </span><br><span class="line">    <span class="keyword">private</span> String name; Â </span><br><span class="line">    <span class="keyword">private</span> FIFOMutex mutex; Â  Â </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> count; Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyThread</span><span class="params">(String name, FIFOMutex mutex)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.name = name; Â  </span><br><span class="line">        <span class="keyword">this</span>.mutex = mutex;</span><br><span class="line"> Â   &#125;</span><br><span class="line">    </span><br><span class="line">Â 	<span class="meta">@Override</span> Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123; Â  Â </span><br><span class="line">            mutex.lock(); Â  Â  Â </span><br><span class="line">            count++; Â  Â  Â  Â  </span><br><span class="line">            System.out.println(<span class="string">"thread:"</span>+Thread.currentThread().getName()+<span class="string">" name:"</span> + name + <span class="string">" count:"</span> + count); Â </span><br><span class="line">            mutex.unlock(); Â  </span><br><span class="line">        &#125; Â </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°FIFOMutexç±»çš„å®ç°ä¸­ï¼Œå½“åˆ¤æ–­é”å·²è¢«å ç”¨æ—¶ï¼Œä¼šè°ƒç”¨ LockSupport.park(this) æ–¹æ³•ï¼Œå°†å½“å‰ è°ƒç”¨çº¿ç¨‹é˜»å¡ï¼›å½“ä½¿ç”¨å®Œé”æ—¶ï¼Œä¼šè°ƒç”¨ LockSupport.unpark(waiters.peek()) æ–¹æ³•å°†ç­‰å¾…é˜Ÿåˆ—ä¸­ çš„é˜Ÿé¦–çº¿ç¨‹å”¤é†’ã€‚<br>é€šè¿‡LockSupportçš„è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„é˜»å¡å’Œå”¤é†’çº¿ç¨‹ã€‚</p>
<ul>
<li>park æ–¹æ³•æ˜¯ä¼šå“åº”ä¸­æ–­çš„ï¼Œä½†æ˜¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´å¦‚æœå½“å‰è°ƒç”¨çº¿ç¨‹è¢«ä¸­æ–­ï¼Œåˆ™ä¼šç«‹å³ è¿”å›ä½†ä¸ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼‰ </li>
<li>park çš„é‡è½½æ–¹æ³• park(Object blocker)ï¼Œä¼šä¼ å…¥ä¸€ä¸ªblockerå¯¹è±¡ï¼Œæ‰€è°“Blockerå¯¹è±¡ï¼Œå…¶å® å°±æ˜¯å½“å‰çº¿ç¨‹è°ƒç”¨æ—¶æ‰€åœ¨è°ƒç”¨å¯¹è±¡ï¼ˆå¦‚ä¸Šè¿°ç¤ºä¾‹ä¸­çš„FIFOMutexå¯¹è±¡ï¼‰ã€‚è¯¥å¯¹è±¡ä¸€èˆ¬ä¾›ç›‘è§†ã€è¯Šæ–­ å·¥å…·ç¡®å®šçº¿ç¨‹å—é˜»å¡çš„åŸå› æ—¶ä½¿ç”¨ã€‚</li>
</ul>
<h5 id="3-3-3-Condition"><a href="#3-3-3-Condition" class="headerlink" title="3.3.3 Condition"></a>3.3.3 Condition</h5><p>åœ¨æ²¡æœ‰Lockä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨synchronizedæ¥æ§åˆ¶åŒæ­¥ï¼Œé…åˆObjectçš„wait()ã€wait(long timeout)ã€notify()ã€ä»¥åŠnotifyAll ç­‰æ–¹æ³•å¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æ¨¡å¼ã€‚<br>Conditionæ¥å£ä¹Ÿæä¾›äº†ç±»ä¼¼äºObjectçš„ç›‘å¬å™¨æ–¹æ³•ã€ä¸Lockæ¥å£é…åˆå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æ¨¡å¼ï¼Œä½†æ˜¯ ä¸¤è€…è¿˜æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ï¼Œä¸‹å›¾æ˜¯ä¸¤è€…çš„å¯¹æ¯”ï¼š</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/09/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89/img2.jpg"  alt></p>
<p>Condition å°† Object ç›‘è§†å™¨æ–¹æ³•ï¼ˆwaitã€notify å’Œ notifyAllï¼‰åˆ†è§£æˆæˆªç„¶ä¸åŒçš„å¯¹è±¡ï¼Œä»¥ä¾¿ é€šè¿‡å°†è¿™äº›å¯¹è±¡ä¸ä»»æ„ Lock å®ç°ç»„åˆä½¿ç”¨ï¼Œä¸ºæ¯ä¸ªå¯¹è±¡æä¾›å¤šä¸ªç­‰å¾… setï¼ˆwait-setï¼‰ã€‚å…¶ä¸­ï¼Œ Lock æ›¿ä»£äº† synchronized æ–¹æ³•å’Œè¯­å¥çš„ä½¿ç”¨ï¼ŒCondition æ›¿ä»£äº† Object ç›‘è§†å™¨æ–¹æ³•çš„ä½¿ç”¨ã€‚</p>
<p>æ¡ä»¶ï¼ˆä¹Ÿç§°ä¸ºæ¡ä»¶é˜Ÿåˆ— æˆ–æ¡ä»¶å˜é‡ï¼‰ä¸ºçº¿ç¨‹æä¾›äº†ä¸€ä¸ªå«ä¹‰ï¼Œä»¥ä¾¿åœ¨æŸä¸ªçŠ¶æ€æ¡ä»¶ç°åœ¨å¯èƒ½ä¸º true çš„å¦ä¸€ä¸ªçº¿ç¨‹é€šçŸ¥å®ƒä¹‹å‰ï¼Œä¸€ç›´æŒ‚èµ·è¯¥çº¿ç¨‹ï¼ˆå³è®©å…¶â€œç­‰å¾…â€ï¼‰ã€‚å› ä¸ºè®¿é—®æ­¤å…±äº«çŠ¶æ€ä¿¡æ¯å‘ç”Ÿåœ¨ä¸åŒ çš„çº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥å®ƒå¿…é¡»å—ä¿æŠ¤ï¼Œå› æ­¤è¦å°†æŸç§å½¢å¼çš„é”ä¸è¯¥æ¡ä»¶ç›¸å…³è”ã€‚ç­‰å¾…æä¾›ä¸€ä¸ªæ¡ä»¶çš„ä¸»è¦å±æ€§ æ˜¯ï¼šä»¥åŸå­æ–¹å¼ é‡Šæ”¾ç›¸å…³çš„é”ï¼Œå¹¶æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œå°±åƒ Object.wait åšçš„é‚£æ ·ã€‚</p>
<p>Condition å®ä¾‹å®è´¨ä¸Šè¢«ç»‘å®šåˆ°ä¸€ä¸ªé”ä¸Šã€‚è¦ä¸ºç‰¹å®š Lock å®ä¾‹è·å¾— Condition å®ä¾‹ï¼Œè¯·ä½¿ç”¨å…¶ newCondition() æ–¹æ³•ã€‚<br>æ ¸å¿ƒæ–¹æ³•<br>Conditionæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•æ¥å¯¹é˜»å¡å’Œå”¤é†’çº¿ç¨‹ï¼š</p>
<ul>
<li>await()ï¼šé€ æˆå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·æˆ–è¢«ä¸­æ–­ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚</li>
<li>await(long time, TimeUnit unit) ï¼šé€ æˆå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ã€è¢«ä¸­æ–­æˆ–åˆ°è¾¾æŒ‡å®šç­‰å¾…æ—¶ é—´ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚ </li>
<li>awaitNanos(long nanosTimeout) ï¼šé€ æˆå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ã€è¢«ä¸­æ–­æˆ–åˆ°è¾¾æŒ‡å®šç­‰å¾…æ—¶é—´ ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚è¿”å›å€¼è¡¨ç¤ºå‰©ä½™æ—¶é—´ï¼Œå¦‚æœåœ¨nanosTimesoutä¹‹å‰å”¤é†’ï¼Œé‚£ä¹ˆè¿”å›å€¼ = nanosTimeout - æ¶ˆè€—æ—¶é—´ï¼Œå¦‚æœè¿”å›å€¼ &lt;= 0 ,åˆ™å¯ä»¥è®¤å®šå®ƒå·²ç»è¶…æ—¶äº†ã€‚ </li>
<li>awaitUninterruptibly() ï¼šé€ æˆå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚ã€æ³¨æ„ï¼šè¯¥æ–¹æ³•å¯¹ä¸­æ–­ä¸æ•æ„Ÿã€‘ã€‚ </li>
<li>awaitUntil(Date deadline) ï¼šé€ æˆå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ã€è¢«ä¸­æ–­æˆ–åˆ°è¾¾æŒ‡å®šåæœŸé™ä¹‹å‰ä¸€ ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰åˆ°æŒ‡å®šæ—¶é—´å°±è¢«é€šçŸ¥ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¡¨ç¤ºåˆ°äº†æŒ‡å®šæ—¶é—´ï¼Œè¿”å›è¿” å›falseã€‚</li>
<li>signal() ï¼šå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚è¯¥çº¿ç¨‹ä»ç­‰å¾…æ–¹æ³•è¿”å›å‰å¿…é¡»è·å¾—ä¸Conditionç›¸å…³çš„é”ã€‚</li>
<li>signalAll() ï¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚èƒ½å¤Ÿä»ç­‰å¾…æ–¹æ³•è¿”å›çš„çº¿ç¨‹å¿…é¡»è·å¾—ä¸Conditionç›¸å…³çš„ é”ã€‚</li>
</ul>
<p>Conditionæ˜¯ä¸€ç§å¹¿ä¹‰ä¸Šçš„æ¡ä»¶é˜Ÿåˆ—ã€‚ä»–ä¸ºçº¿ç¨‹æä¾›äº†ä¸€ç§æ›´ä¸ºçµæ´»çš„ç­‰å¾…/é€šçŸ¥æ¨¡å¼ï¼Œçº¿ç¨‹åœ¨è°ƒç”¨ awaitæ–¹æ³•åæ‰§è¡ŒæŒ‚èµ·æ“ä½œï¼Œç›´åˆ°çº¿ç¨‹ç­‰å¾…çš„æŸä¸ªæ¡ä»¶ä¸ºçœŸæ—¶æ‰ä¼šè¢«å”¤é†’ã€‚Conditionå¿…é¡»è¦é…åˆé”ä¸€ èµ·ä½¿ç”¨ï¼Œå› ä¸ºå¯¹å…±äº«çŠ¶æ€å˜é‡çš„è®¿é—®å‘ç”Ÿåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ã€‚ä¸€ä¸ªConditionçš„å®ä¾‹å¿…é¡»ä¸ä¸€ä¸ªLockç»‘ å®šï¼Œå› æ­¤Conditionä¸€èˆ¬éƒ½æ˜¯ä½œä¸ºLockçš„å†…éƒ¨å®ç°ã€‚</p>
<h6 id="æºç æ¢ç´¢"><a href="#æºç æ¢ç´¢" class="headerlink" title="æºç æ¢ç´¢"></a>æºç æ¢ç´¢</h6><p>è·å–ä¸€ä¸ªConditionå¿…é¡»è¦é€šè¿‡Lockçš„newCondition()æ–¹æ³•ã€‚è¯¥æ–¹æ³•å®šä¹‰åœ¨æ¥å£Lockä¸‹ï¼Œè¿”å›çš„ç»“æœ æ˜¯ç»‘å®šåˆ°æ­¤ Lock å®ä¾‹çš„æ–° Condition å®ä¾‹ã€‚<br>Conditionä¸ºä¸€ä¸ªæ¥å£ï¼Œå…¶ä¸‹ä»…æœ‰ä¸€ä¸ªå®ç°ç±»ConditionObjectï¼Œç”±äºConditionçš„æ“ä½œéœ€è¦è·å–ç›¸å…³ çš„é”ï¼Œè€ŒAQSåˆ™æ˜¯åŒæ­¥é”çš„å®ç°åŸºç¡€ï¼Œæ‰€ä»¥ConditionObjectåˆ™å®šä¹‰ä¸ºAQSçš„å†…éƒ¨ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConditionObject</span> <span class="keyword">implements</span> <span class="title">Condition</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="comment">// çœç•¥æ–¹æ³• </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç­‰å¾…é˜Ÿåˆ—</strong><br>æ¯ä¸ªConditionå¯¹è±¡éƒ½åŒ…å«ç€ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—æ˜¯Conditionå¯¹è±¡é€šçŸ¥/ç­‰å¾…åŠŸèƒ½çš„å…³é”®ã€‚<br>åœ¨é˜Ÿåˆ—ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ç€ä¸€ä¸ªçº¿ç¨‹å¼•ç”¨ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯åœ¨è¯¥Conditionå¯¹è±¡ä¸Šç­‰å¾…çš„çº¿ç¨‹ã€‚<br>Conditionçš„å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConditionObject</span> <span class="keyword">implements</span> <span class="title">Condition</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123; Â </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1173984872572414699L</span>; </span><br><span class="line">    <span class="comment">/** First node of condition queue. */</span> Â  Â  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Node firstWaiter; Â  Â  Â  Â  Â  </span><br><span class="line">    <span class="comment">/** Last node of condition queue. */</span> Â  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Node lastWaiter;</span><br><span class="line">    </span><br><span class="line">Â  Â  Â  Â <span class="comment">/** Â  </span></span><br><span class="line"><span class="comment">         * Creates a new &#123;<span class="doctag">@code</span> ConditionObject&#125; instance.</span></span><br><span class="line"><span class="comment">	  */</span> Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConditionObject</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">Â  Â  Â  Â <span class="comment">// Internal methods Â  Â  </span></span><br><span class="line">    	<span class="comment">// çœç•¥æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºConditionæ‹¥æœ‰é¦–èŠ‚ç‚¹ï¼ˆfirstWaiterï¼‰ï¼Œå°¾èŠ‚ç‚¹ï¼ˆlastWaiterï¼‰ã€‚</p>
<p>å½“å‰çº¿ç¨‹è°ƒç”¨await()æ–¹æ³•ï¼Œå°†ä¼šä»¥å½“å‰çº¿ç¨‹æ„é€ æˆä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼Œå¹¶å°†èŠ‚ç‚¹åŠ å…¥åˆ°è¯¥é˜Ÿåˆ—çš„å°¾ éƒ¨ã€‚<br>Nodeé‡Œé¢åŒ…å«äº†å½“å‰çº¿ç¨‹çš„å¼•ç”¨ã€‚Nodeå®šä¹‰ä¸AQSçš„CLHåŒæ­¥é˜Ÿåˆ—çš„èŠ‚ç‚¹ä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªç±»ã€‚</p>
<p>Conditionçš„é˜Ÿåˆ—ç»“æ„æ¯”CLHåŒæ­¥é˜Ÿåˆ—çš„ç»“æ„ç®€å•äº›ï¼Œæ–°å¢è¿‡ç¨‹è¾ƒä¸ºç®€å•åªéœ€è¦å°†åŸå°¾èŠ‚ç‚¹çš„ nextWaiteræŒ‡å‘æ–°å¢èŠ‚ç‚¹ï¼Œç„¶åæ›´æ–°lastWaiterå³å¯ã€‚</p>
<p><strong>ç­‰å¾…</strong><br>è°ƒç”¨Conditionçš„await()æ–¹æ³•ä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒåŒæ—¶ä¼šåŠ å…¥åˆ°Conditionç­‰å¾…é˜Ÿåˆ—å¹¶é‡Šæ”¾ é”ã€‚</p>
<p>å½“ä»await()æ–¹æ³•è¿”å›æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¸€å®šæ˜¯è·å–äº†Conditionç›¸çš„é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123; Â </span><br><span class="line">    <span class="comment">// å½“å‰çº¿ç¨‹ä¸­æ–­ã€ç›´æ¥å¼‚å¸¸ Â  </span></span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted()) Â  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException(); Â  Â  </span><br><span class="line">    <span class="comment">//åŠ å…¥ç­‰å¾…é˜Ÿåˆ— Â  Â  Â  Â  Â  Â </span></span><br><span class="line">    Node node = addConditionWaiter(); Â  Â </span><br><span class="line">    <span class="comment">//é‡Šæ”¾é” Â  Â  Â  Â  Â  </span></span><br><span class="line">    <span class="keyword">int</span> savedState = fullyRelease(node); Â  Â  Â </span><br><span class="line">    <span class="keyword">int</span> interruptMode = <span class="number">0</span>; Â  Â  Â </span><br><span class="line">    <span class="comment">//æ£€æµ‹å½“å‰èŠ‚ç‚¹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸Šã€å¦‚æœä¸åœ¨åˆ™è¯´æ˜è¯¥èŠ‚ç‚¹æ²¡æœ‰èµ„æ ¼ç«äº‰é”ï¼Œç»§ç»­ç­‰ å¾…ã€‚</span></span><br><span class="line">    <span class="keyword">while</span> (!isOnSyncQueue(node)) &#123; Â  Â  Â </span><br><span class="line">        <span class="comment">// æŒ‚èµ·çº¿ç¨‹ Â  Â  Â  Â  Â  </span></span><br><span class="line">        LockSupport.park(<span class="keyword">this</span>); Â  Â  Â  Â  Â  </span><br><span class="line">        <span class="comment">// çº¿ç¨‹é‡Šæ˜¯å¦è¢«ä¸­æ–­ï¼Œä¸­æ–­ç›´æ¥é€€å‡º Â  Â  Â </span></span><br><span class="line">        <span class="keyword">if</span> ((interruptMode = checkInterruptWhileWaiting(node)) != <span class="number">0</span>) Â  Â  Â  </span><br><span class="line">            <span class="keyword">break</span>; Â  Â  Â  Â </span><br><span class="line">    &#125; Â  Â  Â  Â  Â  Â  Â  Â  Â  </span><br><span class="line">    <span class="comment">// è·å–åŒæ­¥çŠ¶æ€ Â  Â </span></span><br><span class="line">    <span class="keyword">if</span> (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) Â  Â </span><br><span class="line">        interruptMode = REINTERRUPT; Â  Â  Â  Â  Â  Â </span><br><span class="line">    <span class="comment">// æ¸…ç†æ¡ä»¶é˜Ÿåˆ— Â  Â  Â  Â  </span></span><br><span class="line">    <span class="keyword">if</span> (node.nextWaiter != <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">// clean up if cancelled Â  Â  Â </span></span><br><span class="line">        unlinkCancelledWaiters();</span><br><span class="line">	<span class="keyword">if</span> (interruptMode != <span class="number">0</span>) Â  Â </span><br><span class="line">    	reportInterruptAfterWait(interruptMode); Â  Â  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ®µä»£ç çš„é€»è¾‘æ˜¯ï¼š é¦–å…ˆå°†å½“å‰çº¿ç¨‹æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹åŒæ—¶åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç„¶åé‡Šæ”¾å½“å‰çº¿ç¨‹æŒæœ‰çš„åŒæ­¥çŠ¶æ€ã€‚<br>ç„¶ååˆ™æ˜¯ä¸æ–­æ£€æµ‹è¯¥èŠ‚ç‚¹ä»£è¡¨çš„çº¿ç¨‹æ˜¯å¦å‡ºç°åœ¨CLHåŒæ­¥é˜Ÿåˆ—ä¸­ï¼ˆæ”¶åˆ°signalä¿¡å·ä¹‹åå°±ä¼šåœ¨AQSé˜Ÿåˆ— ä¸­æ£€æµ‹åˆ°ï¼‰ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¸€ç›´æŒ‚èµ·ï¼Œå¦åˆ™å‚ä¸ç«äº‰åŒæ­¥çŠ¶æ€ã€‚</p>
<p><strong>åŠ å…¥æ¡ä»¶é˜Ÿåˆ—ï¼ˆaddConditionWaiter()ï¼‰æºç å¦‚ä¸‹</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">addConditionWaiter</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ Â  Â  Â  Â  Â </span></span><br><span class="line">    Node t = lastWaiter; Â  Â  Â </span><br><span class="line">    <span class="comment">// If lastWaiter is cancelled, clean out. Â  Â  Â  Â  Â  </span></span><br><span class="line">    <span class="comment">// å¦‚æœè¯¥èŠ‚ç‚¹çš„çŠ¶æ€çš„ä¸æ˜¯CONDITIONï¼Œåˆ™è¯´æ˜è¯¥èŠ‚ç‚¹ä¸åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸Šï¼Œéœ€è¦æ¸…é™¤ Â  Â  Â  </span></span><br><span class="line">    <span class="keyword">if</span> (t != <span class="keyword">null</span> &amp;&amp; t.waitStatus != Node.CONDITION) &#123; Â  Â  Â  </span><br><span class="line">        <span class="comment">// æ¸…é™¤ç­‰å¾…é˜Ÿåˆ—ä¸­çŠ¶æ€ä¸ä¸ºCONDITIONçš„èŠ‚ç‚¹ Â  Â  Â  Â  </span></span><br><span class="line">        unlinkCancelledWaiters(); Â  Â  Â  Â  Â  Â  Â  Â  </span><br><span class="line">        <span class="comment">//æ¸…é™¤åé‡æ–°è·å–å°¾èŠ‚ç‚¹ Â  Â  Â  Â  Â  </span></span><br><span class="line">        t = lastWaiter; Â  Â  Â  </span><br><span class="line">    &#125; Â  Â  Â  Â  Â  Â  Â  Â  </span><br><span class="line">    <span class="comment">// å°†å½“å‰çº¿ç¨‹æ„é€ æˆç­‰å¾…èŠ‚ç‚¹ Â  Â  </span></span><br><span class="line">    Node node = <span class="keyword">new</span> Node(Thread.currentThread(), Node.CONDITION); Â  Â  </span><br><span class="line">    <span class="comment">// å°†nodeèŠ‚ç‚¹æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—çš„å°¾éƒ¨ Â  Â  Â </span></span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">null</span>) Â  Â  Â  Â  Â  </span><br><span class="line">        firstWaiter = node; Â  Â  Â  </span><br><span class="line">    <span class="keyword">else</span> Â  Â  Â  Â  Â  </span><br><span class="line">        t.nextWaiter = node; Â  Â  </span><br><span class="line">    lastWaiter = node; Â  Â  Â </span><br><span class="line">    <span class="keyword">return</span> node; Â  Â  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•ä¸»è¦æ˜¯å°†å½“å‰çº¿ç¨‹åŠ å…¥åˆ°Conditionæ¡ä»¶é˜Ÿåˆ—ä¸­ã€‚å½“ç„¶åœ¨åŠ å…¥åˆ°å°¾èŠ‚ç‚¹ä¹‹å‰ä¼šæ¸…é™¤æ‰€æœ‰çŠ¶æ€ä¸ä¸º Conditionçš„èŠ‚ç‚¹ã€‚<br>fullyRelease(Node node)ï¼Œè´Ÿè´£é‡Šæ”¾è¯¥çº¿ç¨‹æŒæœ‰çš„é”</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">fullyRelease</span><span class="params">(Node node)</span> </span>&#123; Â  Â  </span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>; Â  Â </span><br><span class="line">    <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â  Â  Â  </span><br><span class="line">        <span class="comment">// è·å–èŠ‚ç‚¹æŒæœ‰é”çš„æ•°é‡ Â  Â  Â  </span></span><br><span class="line">        <span class="keyword">int</span> savedState = getState(); Â  Â  Â  Â </span><br><span class="line">        <span class="comment">// é‡Šæ”¾é”ä¹Ÿå°±æ˜¯é‡Šæ”¾å…±äº«çŠ¶æ€ Â  Â  Â  </span></span><br><span class="line">        <span class="keyword">if</span> (release(savedState)) &#123; Â  Â  Â </span><br><span class="line">            failed = <span class="keyword">false</span>; Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">return</span> savedState;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; Â  Â  Â </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException(); </span><br><span class="line">        &#125; Â  Â  Â </span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123; Â </span><br><span class="line">        <span class="keyword">if</span> (failed) Â  Â  Â  </span><br><span class="line">            node.waitStatus = Node.CANCELLED; Â  </span><br><span class="line">    &#125; Â </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>isOnSyncQueue(Node node)ï¼šå¦‚æœä¸€ä¸ªèŠ‚ç‚¹åˆšå¼€å§‹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸Šï¼Œç°åœ¨åœ¨åŒæ­¥é˜Ÿåˆ—ä¸Šè·å–é”åˆ™è¿”å› trueã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isOnSyncQueue</span><span class="params">(Node node)</span> </span>&#123; Â  Â </span><br><span class="line">	<span class="comment">// çŠ¶æ€ä¸ºCONDITION ã€å‰é©±èŠ‚ç‚¹ä¸ºç©ºï¼Œè¿”å›false Â  Â </span></span><br><span class="line">    <span class="keyword">if</span> (node.waitStatus == Node.CONDITION || node.prev == <span class="keyword">null</span>) Â  Â  Â  Â </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>; Â  Â  Â  </span><br><span class="line">    <span class="comment">// å¦‚æœåç»§èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™è¯´æ˜èŠ‚ç‚¹è‚¯å®šåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ Â  Â  Â  </span></span><br><span class="line">    <span class="keyword">if</span> (node.next != <span class="keyword">null</span>) </span><br><span class="line">        <span class="comment">// If has successor, it must be on queue Â  Â  Â  Â  Â  Â </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; Â  Â  </span><br><span class="line">    <span class="comment">/* Â  Â  Â  Â  </span></span><br><span class="line"><span class="comment">    * node.prev can be non-null, but not yet on queue because Â  Â </span></span><br><span class="line"><span class="comment">    * the CAS to place it on queue can fail. So we have to Â  Â  Â  Â  </span></span><br><span class="line"><span class="comment">    * traverse from tail to make sure it actually made it.  It Â  </span></span><br><span class="line"><span class="comment">    * will always be near the tail in calls to this method, and Â  Â </span></span><br><span class="line"><span class="comment">    * unless the CAS failed (which is unlikely), it will be Â  Â  </span></span><br><span class="line"><span class="comment">    * there, so we hardly ever traverse much. Â </span></span><br><span class="line"><span class="comment">    */</span> Â  Â  </span><br><span class="line">    <span class="keyword">return</span> findNodeFromTail(node); Â  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>unlinkCancelledWaiters()ï¼šè´Ÿè´£å°†æ¡ä»¶é˜Ÿåˆ—ä¸­çŠ¶æ€ä¸ä¸ºConditionçš„èŠ‚ç‚¹åˆ é™¤ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unlinkCancelledWaiters</span><span class="params">()</span> </span>&#123; Â  Â  Â  </span><br><span class="line">    <span class="comment">// é¦–èŠ‚ç‚¹ Â  Â  Â  Â  Â  </span></span><br><span class="line">    Node t = firstWaiter; Â  Â  Â </span><br><span class="line">    Node trail = <span class="keyword">null</span>; Â  Â  Â </span><br><span class="line">    <span class="comment">// ä»å¤´å¼€å§‹æ¸…é™¤çŠ¶æ€ä¸ä¸ºCONDITIONçš„èŠ‚ç‚¹ Â  Â  Â  </span></span><br><span class="line">    <span class="keyword">while</span> (t != <span class="keyword">null</span>) &#123; Â  Â  Â  Â  Â </span><br><span class="line">        Node next = t.nextWaiter; Â  Â  Â  Â  Â </span><br><span class="line">        <span class="keyword">if</span> (t.waitStatus != Node.CONDITION) &#123; Â  </span><br><span class="line">            t.nextWaiter = <span class="keyword">null</span>; Â  Â  Â  </span><br><span class="line">            <span class="keyword">if</span> (trail == <span class="keyword">null</span>) Â  Â  Â  Â </span><br><span class="line">                firstWaiter = next; Â </span><br><span class="line">            <span class="keyword">else</span> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                trail.nextWaiter = next; Â  Â  Â </span><br><span class="line">            <span class="keyword">if</span> (next == <span class="keyword">null</span>) Â  Â  Â  </span><br><span class="line">                lastWaiter = trail; Â  Â  Â  Â </span><br><span class="line">        &#125; Â  Â  Â  Â  Â  Â  Â  </span><br><span class="line">        <span class="keyword">else</span> Â  Â  Â  Â  Â  Â  </span><br><span class="line">            trail = t; Â  Â  Â  </span><br><span class="line">        t = next;</span><br><span class="line">	&#125; Â  Â  Â  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é€šçŸ¥</strong></p>
<p>è°ƒç”¨Conditionçš„signal()æ–¹æ³•ï¼Œå°†ä¼šå”¤é†’åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…é•¿æ—¶é—´çš„èŠ‚ç‚¹ï¼ˆæ¡ä»¶é˜Ÿåˆ—é‡Œçš„é¦–èŠ‚ ç‚¹ï¼‰ï¼Œåœ¨å”¤é†’èŠ‚ç‚¹å‰ï¼Œä¼šå°†èŠ‚ç‚¹ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">signal</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="comment">// å¦‚æœåŒæ­¥æ˜¯ä»¥ç‹¬å æ–¹å¼è¿›è¡Œçš„ï¼Œåˆ™è¿”å› trueï¼›å…¶ä»–æƒ…å†µåˆ™è¿”å› false Â </span></span><br><span class="line">    <span class="keyword">if</span> (!isHeldExclusively()) Â  Â  Â  Â  Â  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException(); Â  Â  Â  Â  </span><br><span class="line">    <span class="comment">// å”¤é†’é¦–èŠ‚ç‚¹ Â  Â  Â  Â  </span></span><br><span class="line">    Node first = firstWaiter; Â  Â  Â  Â  Â  Â  </span><br><span class="line">    <span class="keyword">if</span> (first != <span class="keyword">null</span>) Â  Â  Â  Â </span><br><span class="line">        doSignal(first); Â  Â  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•é¦–å…ˆä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»è·å¾—äº†é”ï¼Œè¿™æ˜¯å‰ç½®æ¡ä»¶ã€‚ç„¶åå”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤´èŠ‚ç‚¹ã€‚<br>doSignal(Node first)ï¼šå”¤é†’å¤´èŠ‚ç‚¹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doSignal</span><span class="params">(Node first)</span> </span>&#123; Â  Â  Â  Â  </span><br><span class="line">    <span class="keyword">do</span> &#123; Â  Â  Â  Â  Â  Â  </span><br><span class="line">        <span class="comment">// ä¿®æ”¹å¤´èŠ‚ç‚¹ã€æ–¹ä¾¿ç§»é™¤ Â  Â  Â  Â  Â </span></span><br><span class="line">        <span class="keyword">if</span> ( (firstWaiter = first.nextWaiter) == <span class="keyword">null</span>) Â  Â  Â </span><br><span class="line">            lastWaiter = <span class="keyword">null</span>; Â  Â  Â  Â </span><br><span class="line">        first.nextWaiter = <span class="keyword">null</span>; Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">        <span class="comment">// å°†è¯¥èŠ‚ç‚¹ç§»åˆ°åŒæ­¥é˜Ÿåˆ— Â  Â  Â </span></span><br><span class="line">    &#125; <span class="keyword">while</span> (!transferForSignal(first) &amp;&amp; Â  Â  </span><br><span class="line">             (first = firstWaiter) != <span class="keyword">null</span>); Â  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>doSignal(Node first)ä¸»è¦æ˜¯åšä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>ä¿®æ”¹å¤´èŠ‚ç‚¹ï¼›</li>
<li>è°ƒç”¨transferForSignal(Node first) æ–¹æ³•å°†èŠ‚ç‚¹ç§»åŠ¨åˆ°CLHåŒæ­¥é˜Ÿåˆ—ä¸­ã€‚</li>
</ul>
<p>æ•´ä¸ªé€šçŸ¥çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»è·å–äº†é”ï¼Œå¦‚æœæ²¡æœ‰è·å–åˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºè·å–é”ä¸ºé€šçŸ¥çš„å‰ç½®æ¡ä»¶ã€‚ </li>
<li>å¦‚æœçº¿ç¨‹å·²ç»è·å–äº†é”ï¼Œåˆ™å°†å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹ã€‚ </li>
<li>å”¤é†’é¦–èŠ‚ç‚¹æ˜¯å…ˆå°†æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤´èŠ‚ç‚¹ç§»å‡ºï¼Œç„¶åè°ƒç”¨AQSçš„enq(Node node)æ–¹æ³•å°†å…¶å®‰å…¨åœ°ç§» åˆ°CLHåŒæ­¥é˜Ÿåˆ—ä¸­ ã€‚ </li>
<li>æœ€ååˆ¤æ–­å¦‚æœè¯¥èŠ‚ç‚¹çš„åŒæ­¥çŠ¶æ€æ˜¯å¦ä¸ºCancelï¼Œæˆ–è€…ä¿®æ”¹çŠ¶æ€ä¸ºSignalå¤±è´¥æ—¶ï¼Œåˆ™ç›´æ¥è°ƒç”¨ LockSupportå”¤é†’è¯¥èŠ‚ç‚¹çš„çº¿ç¨‹ã€‚</li>
</ul>
<p>ä¸€ä¸ªçº¿ç¨‹è·å–é”åï¼Œé€šè¿‡è°ƒç”¨Conditionçš„await()æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹å…ˆåŠ å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­ï¼Œç„¶åé‡Š æ”¾é”ï¼Œåé€šè¿‡isOnSyncQueue(Node node)æ–¹æ³•ä¸æ–­è‡ªæ£€çœ‹èŠ‚ç‚¹æ˜¯å¦å·²ç»åœ¨CLHåŒæ­¥é˜Ÿåˆ—äº†ï¼Œå¦‚æœæ˜¯ åˆ™å°è¯•è·å–é”ï¼Œå¦åˆ™ä¸€ç›´æŒ‚èµ·ã€‚<br>å½“çº¿ç¨‹è°ƒç”¨signal()æ–¹æ³•åï¼Œç¨‹åºé¦–å…ˆæ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦è·å–äº†é”ï¼Œç„¶åé€šè¿‡doSignal(Node first)æ–¹æ³•å”¤é†’CLHåŒæ­¥é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹ã€‚è¢«å”¤é†’çš„çº¿ç¨‹ï¼Œå°†ä»await()æ–¹æ³•ä¸­çš„whileå¾ªç¯ä¸­é€€å‡ºæ¥ï¼Œ ç„¶åè°ƒç”¨acquireQueued()æ–¹æ³•ç«äº‰åŒæ­¥çŠ¶æ€ã€‚<br>æ —å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoundedBuffer</span> </span>&#123; Â </span><br><span class="line">    <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock(); </span><br><span class="line">    <span class="keyword">final</span> Condition notFull Â = lock.newCondition();  </span><br><span class="line">    <span class="keyword">final</span> Condition notEmpty = lock.newCondition(); </span><br><span class="line">    </span><br><span class="line"> Â   <span class="keyword">final</span> Object[] items = <span class="keyword">new</span> Object[<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">int</span> putptr, takeptr, count;</span><br><span class="line">    </span><br><span class="line"> Â   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Object x)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; </span><br><span class="line">        </span><br><span class="line">       lock.lock(); Â  Â  </span><br><span class="line">        <span class="keyword">try</span> &#123; Â  Â </span><br><span class="line">           <span class="keyword">while</span> (count == items.length) Â  Â </span><br><span class="line">               notFull.await(); Â  Â </span><br><span class="line">            items[putptr] = x; Â  Â </span><br><span class="line">            <span class="keyword">if</span> (++putptr == items.length) putptr = <span class="number">0</span>; Â  </span><br><span class="line">            ++count; Â  Â </span><br><span class="line">            notEmpty.signal(); </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123; Â  Â  Â </span><br><span class="line">            lock.unlock(); Â  Â </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"> Â  <span class="function"><span class="keyword">public</span> Object <span class="title">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123; </span><br><span class="line">       lock.lock(); Â  Â </span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line"> 			<span class="keyword">while</span> (count == <span class="number">0</span>) Â  </span><br><span class="line">                notEmpty.await(); </span><br><span class="line">           Object x = items[takeptr]; Â  </span><br><span class="line">           <span class="keyword">if</span> (++takeptr == items.length) takeptr = <span class="number">0</span>; </span><br><span class="line">           --count; Â  Â  Â </span><br><span class="line">           notFull.signal(); Â  Â  </span><br><span class="line">           <span class="keyword">return</span> x; Â </span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123; </span><br><span class="line">           lock.unlock(); Â  </span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-4-Synchronizers"><a href="#3-4-Synchronizers" class="headerlink" title="3.4 Synchronizers"></a>3.4 Synchronizers</h4><h5 id="3-4-1-Semaphore"><a href="#3-4-1-Semaphore" class="headerlink" title="3.4.1 Semaphore"></a>3.4.1 Semaphore</h5><p>Semaphoreï¼ˆä¿¡å·é‡ï¼‰æ˜¯ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œé€šè¿‡åè°ƒå„ä¸ªçº¿ç¨‹ï¼Œä¿è¯åˆç†çš„ä½¿ç”¨ å…¬å…±èµ„æºã€‚<br>Semaphoreç»´æŠ¤äº†ä¸€ä¸ªè®¸å¯é›†ï¼Œå…¶å®å°±æ˜¯ä¸€å®šæ•°é‡çš„â€œè®¸å¯è¯â€ã€‚ å½“æœ‰çº¿ç¨‹æƒ³è¦è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œéœ€è¦å…ˆè·å–(acquire)çš„è®¸å¯ï¼›å¦‚æœè®¸å¯ä¸å¤Ÿäº†ï¼Œçº¿ç¨‹éœ€è¦ä¸€ç›´ç­‰å¾…ï¼Œ ç›´åˆ°è®¸å¯å¯ç”¨ã€‚å½“çº¿ç¨‹ä½¿ç”¨å®Œå…±äº«èµ„æºåï¼Œå¯ä»¥å½’è¿˜(release)è®¸å¯ï¼Œä»¥ä¾›å…¶å®ƒéœ€è¦çš„çº¿ç¨‹ä½¿ç”¨ã€‚<br>å’ŒReentrantLockç±»ä¼¼ï¼ŒSemaphoreæ”¯æŒå…¬å¹³/éå…¬å¹³ç­–ç•¥ã€‚<br>æºç :ç•¥ã€‚<br>ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªä¼šå®ç°print queueçš„ç±»åä¸º PrintQueueã€‚ </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintQueue</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="comment">// å£°æ˜ä¸€ä¸ªå¯¹è±¡ä¸ºSemaphoreï¼Œç§°å®ƒä¸ºsemaphoreã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Semaphore semaphore; Â </span><br><span class="line">    <span class="comment">// å®ç°ç±»çš„æ„é€ å‡½æ•°å¹¶åˆå§‹èƒ½ä¿æŠ¤print quereçš„è®¿é—®çš„semaphoreå¯¹è±¡çš„å€¼ã€‚ Â </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PrintQueue</span><span class="params">()</span> </span>&#123; Â </span><br><span class="line">        semaphore = <span class="keyword">new</span> Semaphore(<span class="number">1</span>); Â  </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="comment">//å®ç°Implement the printJob()æ–¹æ³•ï¼Œæ­¤æ–¹æ³•å¯ä»¥æ¨¡æ‹Ÿæ‰“å°æ–‡æ¡£ï¼Œå¹¶æ¥æ”¶documentå¯¹è±¡ ä½œä¸ºå‚æ•°ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printJob</span><span class="params">(Object document)</span> </span>&#123; </span><br><span class="line">        <span class="comment">//åœ¨è¿™æ–¹æ³•å†…ï¼Œé¦–å…ˆï¼Œä½ å¿…é¡»è°ƒç”¨acquire()æ–¹æ³•è·å¾—demaphoreã€‚è¿™ä¸ªæ–¹æ³•ä¼šæŠ›å‡º InterruptedExceptionå¼‚å¸¸ï¼Œä½¿ç”¨å¿…é¡»åŒ…å«å¤„ç†è¿™ä¸ªå¼‚å¸¸çš„ä»£ç ã€‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  </span><br><span class="line">            semaphore.acquire();</span><br><span class="line">             </span><br><span class="line"><span class="comment">//ç„¶åï¼Œå®ç°èƒ½éšæœºç­‰å¾…ä¸€æ®µæ—¶é—´çš„æ¨¡æ‹Ÿæ‰“å°æ–‡æ¡£çš„è¡Œã€‚ Â  </span></span><br><span class="line">             <span class="keyword">long</span> duration = (<span class="keyword">long</span>) (Math.random() * <span class="number">10</span>);</span><br><span class="line">            </span><br><span class="line">Â 			System.out.printf(<span class="string">"%s: PrintQueue: Printing a Job during %d seconds\n"</span>, Thread.currentThread().getName(), duration);</span><br><span class="line"> Â  Â  Â  Â  Â  Â Thread.sleep(duration);</span><br><span class="line"><span class="comment">//æœ€åï¼Œé‡Šæ”¾semaphoreé€šè¿‡è°ƒç”¨semaphoreçš„relaser()æ–¹æ³•ã€‚</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; </span><br><span class="line">            e.printStackTrace(); Â  Â  Â  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123; Â  Â  Â  Â </span><br><span class="line">            semaphore.release(); Â  </span><br><span class="line">        &#125; Â </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªåä¸ºJobçš„ç±»å¹¶ä¸€å®šå®ç°Runnable æ¥å£ã€‚è¿™ä¸ªç±»å®ç°æŠŠæ–‡æ¡£ä¼ é€åˆ°æ‰“å°æœºçš„ä»»åŠ¡ã€‚ </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Job</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; Â  Â </span><br><span class="line">    <span class="comment">//å£°æ˜ä¸€ä¸ªå¯¹è±¡ä¸ºPrintQueueï¼Œåä¸ºprintQueueã€‚ Â  </span></span><br><span class="line">    <span class="keyword">private</span> PrintQueue printQueue; Â </span><br><span class="line">    <span class="comment">//å®ç°ç±»çš„æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–è¿™ä¸ªç±»é‡Œçš„PrintQueueå¯¹è±¡ã€‚ Â  Â </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Job</span><span class="params">(PrintQueue printQueue)</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">this</span>.printQueue = printQueue; Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="comment">//å®ç°æ–¹æ³•run()ã€‚ </span></span><br><span class="line">    <span class="meta">@Override</span> Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;     </span><br><span class="line">        <span class="comment">//é¦–å…ˆï¼Œ æ­¤æ–¹æ³•å†™ä¿¡æ¯åˆ°æ“æ§å°è¡¨æ˜ä»»åŠ¡å·²ç»å¼€å§‹æ‰§è¡Œäº†ã€‚ Â  Â </span></span><br><span class="line">        System.out.printf(<span class="string">"%s: Going to print a job\n"</span>, Thread.currentThread().getName());          </span><br><span class="line">        <span class="comment">// ç„¶åï¼Œè°ƒç”¨PrintQueue å¯¹è±¡çš„printJob()æ–¹æ³•ã€‚ Â  </span></span><br><span class="line">        printQueue.printJob(<span class="keyword">new</span> Object());         </span><br><span class="line">        <span class="comment">//æœ€åï¼Œ æ­¤æ–¹æ³•å†™ä¿¡æ¯åˆ°æ“æ§å°è¡¨æ˜å®ƒå·²ç»ç»“æŸè¿è¡Œäº†ã€‚ </span></span><br><span class="line">        System.out.printf(<span class="string">"%s: The document has been printed\n"</span>, Thread.currentThread().getName());</span><br><span class="line"> Â   &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreTest</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">                <span class="comment">// åˆ›å»ºPrintQueueå¯¹è±¡åä¸ºprintQueueã€‚ Â  Â  Â </span></span><br><span class="line">        PrintQueue printQueue = <span class="keyword">new</span> PrintQueue();      </span><br><span class="line">        <span class="comment">//åˆ›å»º10ä¸ªthreadsã€‚æ¯ä¸ªçº¿ç¨‹ä¼šæ‰§è¡Œä¸€ä¸ªå‘é€æ–‡æ¡£åˆ°print queueçš„Jobå¯¹è±¡ã€‚ Â  </span></span><br><span class="line">        Thread thread[] = <span class="keyword">new</span> Thread[<span class="number">10</span>];</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; Â  Â  </span><br><span class="line">            thread[i] = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Job(printQueue), <span class="string">"Thread"</span> + i); Â  Â </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; Â  </span><br><span class="line">            thread[i].start(); Â  Â </span><br><span class="line">        &#125;</span><br><span class="line"> Â   &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-4-2-CountDownLatch"><a href="#3-4-2-CountDownLatch" class="headerlink" title="3.4.2 CountDownLatch"></a>3.4.2 CountDownLatch</h5><p>åœ¨å¤šçº¿ç¨‹åä½œå®Œæˆä¸šåŠ¡åŠŸèƒ½æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦ç­‰å¾…å…¶ä»–å¤šä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡ä¹‹åï¼Œä¸»çº¿ç¨‹æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œä¸šåŠ¡åŠŸèƒ½ï¼Œåœ¨è¿™ç§çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨Threadç±»çš„joinæ–¹æ³•ï¼Œè®©ä¸»çº¿ç¨‹ç­‰å¾…è¢«joinçš„çº¿ç¨‹æ‰§ è¡Œå®Œä¹‹åï¼Œä¸»çº¿ç¨‹æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å½“ç„¶ï¼Œä½¿ç”¨çº¿ç¨‹é—´æ¶ˆæ¯é€šä¿¡æœºåˆ¶ä¹Ÿå¯ä»¥å®Œæˆã€‚å…¶å®ï¼Œjavaå¹¶å‘å·¥ å…·ç±»ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ç±»ä¼¼â€œå€’è®¡æ—¶â€è¿™æ ·çš„å·¥å…·ç±»ï¼Œå¯ä»¥ååˆ†æ–¹ä¾¿çš„å®Œæˆæ‰€è¯´çš„è¿™ç§ä¸šåŠ¡åœºæ™¯ã€‚<br>CountDownLatchå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆå·¥ä½œã€‚<br>CountDownLatchç›¸å…³æ–¹æ³•ï¼š</p>
<ul>
<li><p>public CountDownLatch(int count) æ„é€ æ–¹æ³•ä¼šä¼ å…¥ä¸€ä¸ªæ•´å‹æ•°Nï¼Œä¹‹åè°ƒç”¨ CountDownLatchçš„ countDown æ–¹æ³•ä¼šå¯¹Nå‡ä¸€ï¼ŒçŸ¥é“Nå‡åˆ°0çš„æ—¶å€™ï¼Œå½“å‰è°ƒç”¨ await æ–¹æ³•çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚</p>
</li>
<li><p>await() throws InterruptedExceptionï¼šè°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹ç­‰åˆ°æ„é€ æ–¹æ³•ä¼ å…¥çš„Nå‡åˆ°0çš„æ—¶å€™ï¼Œæ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›</p>
</li>
<li><p>await(long timeout, TimeUnit unit)ï¼šä¸ä¸Šé¢çš„awaitæ–¹æ³•åŠŸèƒ½ä¸€è‡´ï¼Œåªä¸è¿‡è¿™é‡Œæœ‰äº†æ—¶é—´ é™åˆ¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹ç­‰åˆ°æŒ‡å®šçš„timeoutæ—¶é—´åï¼Œä¸ç®¡Næ˜¯å¦å‡è‡³ä¸º0ï¼Œéƒ½ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›</p>
</li>
<li><p>countDown()ï¼šä½¿CountDownLatchåˆå§‹å€¼Nå‡1ï¼›</p>
</li>
<li><p>long getCount()ï¼šè·å–å½“å‰CountDownLatchç»´æŠ¤çš„å€¼</p>
</li>
</ul>
<p>  æ —å­ï¼šè¿åŠ¨å‘˜è¿›è¡Œè·‘æ­¥æ¯”èµ›æ—¶ï¼Œå‡è®¾æœ‰6ä¸ªè¿åŠ¨å‘˜å‚ä¸æ¯”èµ›ï¼Œè£åˆ¤å‘˜åœ¨ç»ˆç‚¹ä¼šä¸ºè¿™6ä¸ªè¿åŠ¨å‘˜åˆ†åˆ«è®¡æ—¶ï¼Œ å¯ä»¥æƒ³è±¡æ²¡å½“ä¸€ä¸ªè¿åŠ¨å‘˜åˆ°è¾¾ç»ˆç‚¹çš„æ—¶å€™ï¼Œå¯¹äºè£åˆ¤å‘˜æ¥è¯´å°±å°‘äº†ä¸€ä¸ªè®¡æ—¶ä»»åŠ¡ã€‚ç›´åˆ°æ‰€æœ‰è¿åŠ¨å‘˜éƒ½åˆ° è¾¾ç»ˆç‚¹äº†ï¼Œè£åˆ¤å‘˜çš„ä»»åŠ¡ä¹Ÿæ‰å®Œæˆã€‚è¿™6ä¸ªè¿åŠ¨å‘˜å¯ä»¥ç±»æ¯”æˆ6ä¸ªçº¿ç¨‹ï¼Œå½“çº¿ç¨‹è°ƒç”¨ CountDownLatch.countDownæ–¹æ³•æ—¶å°±ä¼šå¯¹è®¡æ•°å™¨çš„å€¼å‡ä¸€ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼ä¸º0çš„æ—¶å€™ï¼Œè£åˆ¤å‘˜ï¼ˆè°ƒ ç”¨awaitæ–¹æ³•çš„çº¿ç¨‹ï¼‰æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchTest</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CountDownLatch startSignal = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//ç”¨æ¥è¡¨ç¤ºè£åˆ¤å‘˜éœ€è¦ç»´æŠ¤çš„æ˜¯6ä¸ªè¿åŠ¨å‘˜ </span></span><br><span class="line">    rivate <span class="keyword">static</span> CountDownLatch endSignal = <span class="keyword">new</span> CountDownLatch(<span class="number">6</span>);</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; </span><br><span class="line">    ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">6</span>); </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123; Â  </span><br><span class="line">        executorService.execute(() -&gt; &#123; Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">" è¿åŠ¨ å‘˜ç­‰å¾…è£åˆ¤å‘˜å“å“¨ï¼ï¼ï¼"</span>); Â  Â  Â  Â  Â </span><br><span class="line">                startSignal.await(); Â  Â  </span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"æ­£åœ¨ å…¨åŠ›å†²åˆº"</span>); </span><br><span class="line">                endSignal.countDown(); Â  Â </span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"  åˆ° è¾¾ç»ˆç‚¹"</span>); </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  Â </span><br><span class="line">                e.printStackTrace(); Â  Â  Â  </span><br><span class="line">            &#125; Â  Â  </span><br><span class="line">        &#125;); </span><br><span class="line">    &#125; Â  Â </span><br><span class="line">    System.out.println(<span class="string">"è£åˆ¤å‘˜å“å“¨å¼€å§‹å•¦ï¼ï¼ï¼"</span>); Â  Â </span><br><span class="line">    startSignal.countDown(); </span><br><span class="line">    endSignal.await(); Â </span><br><span class="line">    System.out.println(<span class="string">"æ‰€æœ‰è¿åŠ¨å‘˜åˆ°è¾¾ç»ˆç‚¹ï¼Œæ¯”èµ›ç»“æŸï¼"</span>);</span><br><span class="line">Â 	executorService.shutdown();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥ç¤ºä¾‹ä»£ç ä¸­è®¾ç½®äº†ä¸¤ä¸ªCountDownLatchï¼Œç¬¬ä¸€ä¸ªendSignalç”¨äºæ§åˆ¶è®©mainçº¿ç¨‹ï¼ˆè£åˆ¤å‘˜ï¼‰å¿…é¡»ç­‰ åˆ°å…¶ä»–çº¿ç¨‹ï¼ˆè¿åŠ¨å‘˜ï¼‰è®©CountDownLatchç»´æŠ¤çš„æ•°å€¼Nå‡åˆ°0ä¸ºæ­¢ï¼Œç›¸å½“äºä¸€ä¸ªå®Œæˆä¿¡å·ï¼›å¦ä¸€ä¸ª startSignalç”¨äºè®©mainçº¿ç¨‹å¯¹å…¶ä»–çº¿ç¨‹è¿›è¡Œâ€œå‘å·æ–½ä»¤â€ï¼Œç›¸å½“äºä¸€ä¸ªå…¥å£æˆ–è€…å¼€å…³ã€‚</p>
<p>startSignalå¼•ç”¨çš„CountDownLatchåˆå§‹å€¼ä¸º1ï¼Œè€Œå…¶ä»–çº¿ç¨‹æ‰§è¡Œçš„runæ–¹æ³•ä¸­éƒ½ä¼šå…ˆé€šè¿‡ startSignal.await()è®©è¿™äº›çº¿ç¨‹éƒ½è¢«é˜»å¡ï¼Œç›´åˆ°mainçº¿ç¨‹é€šè¿‡è°ƒç”¨startSignal.countDown();ï¼Œ å°†å€¼Nå‡1ï¼ŒCountDownLatchç»´æŠ¤çš„æ•°å€¼Nä¸º0åï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½å¾€ä¸‹æ‰§è¡Œï¼Œå¹¶ä¸”ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„run æ–¹æ³•ä¸­éƒ½ä¼šé€šè¿‡endSignal.countDown();å¯¹endSignalç»´æŠ¤çš„æ•°å€¼è¿›è¡Œå‡ä¸€ï¼Œç”±äºå¾€çº¿ç¨‹æ± æäº¤äº†6 ä¸ªä»»åŠ¡ï¼Œä¼šè¢«å‡6æ¬¡ï¼Œæ‰€ä»¥endSignalç»´æŠ¤çš„å€¼ç»ˆä¼šå˜ä¸º0ï¼Œå› æ­¤mainçº¿ç¨‹åœ¨latch.await();é˜»å¡ç»“ æŸï¼Œæ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p>
<p><code>æ³¨æ„ï¼šå½“è°ƒç”¨CountDownLatchçš„countDownæ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹æ˜¯ä¸ä¼šè¢«é˜»å¡ï¼Œä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</code></p>
<h5 id="3-4-3-CyclicBarrier"><a href="#3-4-3-CyclicBarrier" class="headerlink" title="3.4.3 CyclicBarrier"></a>3.4.3 CyclicBarrier</h5><p>CountDownLatchæ˜¯ä¸€ä¸ªå€’æ•°è®¡æ•°å™¨ï¼Œåœ¨è®¡æ•°å™¨ä¸ä¸º0æ—¶ï¼Œæ‰€æœ‰è°ƒç”¨awaitçš„çº¿ç¨‹éƒ½ä¼šç­‰å¾…ï¼Œå½“è®¡æ•°å™¨é™ ä¸º0ï¼Œçº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œï¼Œä¸”è®¡æ•°å™¨ä¸€æ—¦å˜ä¸º0ï¼Œå°±ä¸èƒ½å†é‡ç½®äº†ã€‚</p>
<p>CyclicBarrierå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªæ …æ ï¼Œæ …æ çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå°±æ˜¯é˜»æŒ¡å‰è¡Œã€‚</p>
<p>CyclicBarrieræ˜¯ä¸€ä¸ªå¯ä»¥å¾ªç¯ä½¿ç”¨çš„æ …æ ï¼Œå®ƒåšçš„äº‹æƒ…å°±æ˜¯ï¼šè®©çº¿ç¨‹åˆ°è¾¾æ …æ æ—¶è¢«é˜»å¡(è°ƒç”¨await æ–¹æ³•)ï¼Œç›´åˆ°åˆ°è¾¾æ …æ çš„çº¿ç¨‹æ•°æ»¡è¶³æŒ‡å®šæ•°é‡è¦æ±‚æ—¶ï¼Œæ …æ æ‰ä¼šæ‰“å¼€æ”¾è¡Œï¼Œè¢«æ …æ æ‹¦æˆªçš„çº¿ç¨‹æ‰å¯ä»¥æ‰§è¡Œã€‚</p>
<p>å½“å¤šä¸ªçº¿ç¨‹éƒ½è¾¾åˆ°äº†æŒ‡å®šç‚¹åï¼Œæ‰èƒ½ç»§ç»­å¾€ä¸‹ç»§ç»­æ‰§è¡Œã€‚è¿™å°±æœ‰ç‚¹åƒæŠ¥æ•°çš„æ„Ÿè§‰ï¼Œå‡è®¾6ä¸ªçº¿ç¨‹å°±ç›¸å½“ äº6ä¸ªè¿åŠ¨å‘˜ï¼Œåˆ°èµ›é“èµ·ç‚¹æ—¶ä¼šæŠ¥æ•°è¿›è¡Œç»Ÿè®¡ï¼Œå¦‚æœåˆšå¥½æ˜¯6çš„è¯ï¼Œè¿™ä¸€æ³¢å°±å‡‘é½äº†ï¼Œæ‰èƒ½å¾€ä¸‹æ‰§è¡Œã€‚è¿™ é‡Œçš„6ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è®¡æ•°å™¨çš„åˆå§‹å€¼6ï¼Œæ˜¯é€šè¿‡CyclicBarrierçš„æ„é€ æ–¹æ³•ä¼ å…¥çš„ã€‚</p>
<p>CyclicBarrierçš„ä¸»è¦æ–¹æ³•ï¼š</p>
<ul>
<li><p>await() throws InterruptedException, BrokenBarrierException  ç­‰åˆ°æ‰€æœ‰çš„çº¿ç¨‹éƒ½åˆ° è¾¾æŒ‡å®šçš„ä¸´ç•Œç‚¹ï¼› </p>
</li>
<li><p>await(long timeout, TimeUnit unit) throws InterruptedException, BrokenBarrierException, TimeoutException ä¸ä¸Šé¢çš„awaitæ–¹æ³•åŠŸèƒ½åŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡è¿™ é‡Œæœ‰è¶…æ—¶é™åˆ¶ï¼Œé˜»å¡ç­‰å¾…ç›´è‡³åˆ°è¾¾è¶…æ—¶æ—¶é—´ä¸ºæ­¢ï¼›</p>
</li>
<li><p>int getNumberWaiting()è·å–å½“å‰æœ‰å¤šå°‘ä¸ªçº¿ç¨‹é˜»å¡ç­‰å¾…åœ¨ä¸´ç•Œç‚¹ä¸Šï¼›</p>
</li>
<li><p>boolean isBroken()ç”¨äºæŸ¥è¯¢é˜»å¡ç­‰å¾…çš„çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ </p>
</li>
<li><p>void reset()å°†å±éšœé‡ç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚å¦‚æœå½“å‰æœ‰çº¿ç¨‹æ­£åœ¨ä¸´ç•Œç‚¹ç­‰å¾…çš„è¯ï¼Œå°†æŠ›å‡º BrokenBarrierExceptionã€‚ </p>
</li>
</ul>
<p>  å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCyclicBarrieræä¾›äº†è¿™æ ·çš„æ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CyclicBarrier</span><span class="params">(<span class="keyword">int</span> parties, Runnable barrierAction)</span></span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç”¨æ¥ï¼Œå½“æŒ‡å®šçš„çº¿ç¨‹éƒ½åˆ°è¾¾äº†æŒ‡å®šçš„ä¸´ç•Œç‚¹çš„æ—¶ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œçš„æ“ä½œå¯ä»¥ç”±barrierActionä¼ å…¥å³ å¯ã€‚</p>
<p>æ —å­ï¼š</p>
<p>6ä¸ªè¿åŠ¨å‘˜å‡†å¤‡è·‘æ­¥æ¯”èµ›ï¼Œè¿åŠ¨å‘˜åœ¨èµ›è·‘éœ€è¦åœ¨èµ·ç‚¹åšå¥½å‡†å¤‡ï¼Œå½“è£åˆ¤å‘ç°æ‰€æœ‰è¿åŠ¨å‘˜å‡†å¤‡å®Œæ¯•åï¼Œå°± ä¸¾èµ·å‘ä»¤æªï¼Œæ¯”èµ›å¼€å§‹ã€‚è¿™é‡Œçš„èµ·è·‘çº¿å°±æ˜¯å±éšœï¼Œæ˜¯ä¸´ç•Œç‚¹ï¼Œè€Œè¿™6ä¸ªè¿åŠ¨å‘˜å°±ç±»æ¯”æˆçº¿ç¨‹çš„è¯ï¼Œå°±æ˜¯ è¿™6ä¸ªçº¿ç¨‹éƒ½å¿…é¡»åˆ°è¾¾æŒ‡å®šç‚¹äº†ï¼Œæ„å‘³ç€å‡‘é½äº†ä¸€æ³¢ï¼Œç„¶åæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™æ¯ä¸ªçº¿ç¨‹éƒ½å¾—é˜»å¡ç­‰å¾…ï¼Œç›´è‡³å‡‘é½ä¸€æ³¢å³å¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierTest</span> </span>&#123; Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â <span class="keyword">int</span> N = <span class="number">6</span>; Â </span><br><span class="line">        <span class="comment">// è¿åŠ¨å‘˜æ•° Â  Â </span></span><br><span class="line">        CyclicBarrier cb = <span class="keyword">new</span> CyclicBarrier(N, <span class="keyword">new</span> Runnable() &#123; Â  Â </span><br><span class="line">            <span class="meta">@Override</span> Â  Â  Â  Â  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â </span><br><span class="line">                System.out.println(<span class="string">"æ‰€æœ‰è¿åŠ¨å‘˜å·²å‡†å¤‡å®Œæ¯•ï¼Œå‘ä»¤æªï¼šè·‘ï¼"</span>); Â  Â  Â </span><br><span class="line">            &#125; Â  Â  </span><br><span class="line">        &#125;);</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123; Â  Â  Â  Â </span><br><span class="line">            Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> PrepareWork(cb), <span class="string">"è¿åŠ¨å‘˜["</span> + i + <span class="string">"]"</span>); </span><br><span class="line">            t.start(); Â  Â  Â </span><br><span class="line">        &#125; Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PrepareWork</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">private</span> CyclicBarrier cb;</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â PrepareWork(CyclicBarrier cb) &#123; Â </span><br><span class="line">            <span class="keyword">this</span>.cb = cb; Â  Â  </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="meta">@Override</span> Â  Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            </span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">try</span> &#123; Â  Â  Â  Â </span><br><span class="line">                Thread.sleep(<span class="number">500</span>); Â  Â  </span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">": å‡† å¤‡å®Œæˆ"</span>); Â </span><br><span class="line">                cb.await(); Â  Â  </span><br><span class="line">                <span class="comment">// åœ¨æ …æ ç­‰å¾… Â  Â  </span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  Â  Â  Â  </span><br><span class="line">                e.printStackTrace(); Â  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123; Â  Â  Â </span><br><span class="line">                e.printStackTrace(); Â  Â  Â </span><br><span class="line">            &#125; Â  Â  Â  </span><br><span class="line">        &#125; Â </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œå½“6ä¸ªè¿åŠ¨å‘˜ï¼ˆçº¿ç¨‹ï¼‰éƒ½åˆ°è¾¾äº†æŒ‡å®šçš„ä¸´ç•Œç‚¹ï¼ˆbarrierï¼‰æ—¶å€™ï¼Œæ‰èƒ½ç»§ç»­å¾€ä¸‹ æ‰§è¡Œï¼Œå¦åˆ™ï¼Œåˆ™ä¼šé˜»å¡ç­‰å¾…åœ¨è°ƒç”¨ await() å¤„ã€‚</p>
<h6 id="CyclicBarrierå¯¹å¼‚å¸¸çš„å¤„ç†"><a href="#CyclicBarrierå¯¹å¼‚å¸¸çš„å¤„ç†" class="headerlink" title="CyclicBarrierå¯¹å¼‚å¸¸çš„å¤„ç†"></a>CyclicBarrierå¯¹å¼‚å¸¸çš„å¤„ç†</h6><p><strong>çº¿ç¨‹åœ¨é˜»å¡è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½è¢«ä¸­æ–­ï¼Œé‚£ä¹ˆæ—¢ç„¶CyclicBarrieræ”¾è¡Œçš„æ¡ä»¶æ˜¯ç­‰å¾…çš„çº¿ç¨‹æ•°è¾¾åˆ°æŒ‡å®šæ•°ç›®ï¼Œ ä¸‡ä¸€çº¿ç¨‹è¢«ä¸­æ–­å¯¼è‡´ç»ˆçš„ç­‰å¾…çº¿ç¨‹æ•°è¾¾ä¸åˆ°æ …æ çš„è¦æ±‚æ€ä¹ˆåŠï¼Ÿ</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, BrokenBarrierException </span>&#123; Â  Â </span><br><span class="line">    <span class="comment">//... </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•é™¤äº†æŠ›å‡ºInterruptedExceptionå¼‚å¸¸å¤–ï¼Œè¿˜ä¼šæŠ›å‡º BrokenBarrierException ã€‚<br>BrokenBarrierExceptionè¡¨ç¤ºå½“å‰çš„CyclicBarrierå·²ç»æŸåäº†ï¼Œç­‰ä¸åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æ …æ äº†ï¼Œæ‰€ ä»¥å·²ç»åœ¨ç­‰å¾…çš„çº¿ç¨‹ä¹Ÿæ²¡å¿…è¦å†ç­‰äº†ï¼Œå¯ä»¥æ•£ä¼™äº†ã€‚<br>å‡ºç°ä»¥ä¸‹å‡ ç§æƒ…å†µä¹‹ä¸€æ—¶ï¼Œå½“å‰ç­‰å¾…çº¿ç¨‹ä¼šæŠ›å‡ºBrokenBarrierExceptionå¼‚å¸¸ï¼š</p>
<ul>
<li><p>å…¶å®ƒæŸä¸ªæ­£åœ¨awaitç­‰å¾…çš„çº¿ç¨‹è¢«ä¸­æ–­äº†ï¼›</p>
</li>
<li><p>å…¶å®ƒæŸä¸ªæ­£åœ¨awaitç­‰å¾…çš„çº¿ç¨‹è¶…æ—¶äº†ï¼›</p>
</li>
<li><p>æŸä¸ªçº¿ç¨‹é‡ç½®äº†CyclicBarrierï¼›</p>
<p>å¦å¤–ï¼Œåªè¦æ­£åœ¨Barrierä¸Šç­‰å¾…çš„ä»»ä¸€çº¿ç¨‹æŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆBarrierå°±ä¼šè®¤ä¸ºè‚¯å®šæ˜¯å‡‘ä¸é½æ‰€æœ‰çº¿ç¨‹äº†ï¼Œå°±ä¼šå°†æ …æ ç½®ä¸ºæŸåï¼ˆBrokenï¼‰çŠ¶æ€ï¼Œå¹¶ä¼ æ’­BrokenBarrierExceptionç»™å…¶å®ƒæ‰€æœ‰æ­£åœ¨ç­‰å¾… ï¼ˆawaitï¼‰çš„çº¿ç¨‹ã€‚<br>å¼‚å¸¸æƒ…å†µæ¨¡æ‹Ÿï¼š</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierTest</span> </span>&#123; Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â <span class="keyword">int</span> N = <span class="number">6</span>; Â </span><br><span class="line">        <span class="comment">// è¿åŠ¨å‘˜æ•° Â  </span></span><br><span class="line">        CyclicBarrier cb = <span class="keyword">new</span> CyclicBarrier(N, <span class="keyword">new</span> Runnable() &#123; Â </span><br><span class="line">            <span class="meta">@Override</span> Â  Â  Â  Â </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">                System.out.println(<span class="string">"æ‰€æœ‰è¿åŠ¨å‘˜å·²å‡†å¤‡å®Œæ¯•ï¼Œå‘ä»¤æªï¼šè·‘ï¼"</span>); Â  Â </span><br><span class="line">            &#125; Â  Â  Â  </span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â List&lt;Thread&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(); Â  Â  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123; Â  Â  </span><br><span class="line">            Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> PrepareWork(cb), <span class="string">"è¿åŠ¨å‘˜["</span> + i + <span class="string">"]"</span>); Â </span><br><span class="line">            list.add(t); Â  Â  Â  Â </span><br><span class="line">            t.start(); Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">3</span>) &#123; Â  Â  Â </span><br><span class="line">                t.interrupt(); </span><br><span class="line">                <span class="comment">// è¿åŠ¨å‘˜[3]ç½®ä¸­æ–­æ ‡å¿—ä½ Â  Â  Â </span></span><br><span class="line">            &#125; Â  Â  Â </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â Thread.sleep(<span class="number">2000</span>); Â </span><br><span class="line">        System.out.println(<span class="string">"Barrieræ˜¯å¦æŸåï¼š"</span> + cb.isBroken());</span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PrepareWork</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">private</span> CyclicBarrier cb;</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â PrepareWork(CyclicBarrier cb) &#123; Â </span><br><span class="line">            <span class="keyword">this</span>.cb = cb; Â  Â  </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="meta">@Override</span> Â  Â  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â  Â  </span><br><span class="line">            <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â </span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">": å‡† å¤‡å®Œæˆ"</span>); Â </span><br><span class="line">                cb.await(); Â  Â  Â </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"> Â 				System.out.println(Thread.currentThread().getName() + <span class="string">": è¢« ä¸­æ–­"</span>); </span><br><span class="line">            &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123; Â  Â  Â  Â </span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">": æŠ› å‡ºBrokenBarrierException"</span>); Â  Â  Â  </span><br><span class="line">            &#125; Â  Â </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CountDownLatchä¸CyclicBarrierçš„æ¯”è¾ƒ<br>CountDownLatchä¸CyclicBarrieréƒ½æ˜¯ç”¨äºæ§åˆ¶å¹¶å‘çš„å·¥å…·ç±»ï¼Œéƒ½å¯ä»¥ç†è§£æˆç»´æŠ¤çš„å°±æ˜¯ä¸€ä¸ªè®¡æ•° å™¨ï¼Œä½†æ˜¯è¿™ä¸¤è€…è¿˜æ˜¯å„æœ‰ä¸åŒä¾§é‡ç‚¹çš„ï¼š</p>
<ul>
<li>CountDownLatchä¸€èˆ¬ç”¨äºæŸä¸ªçº¿ç¨‹Aç­‰å¾…è‹¥å¹²ä¸ªå…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œå®ƒæ‰æ‰§è¡Œï¼›è€Œ CyclicBarrierä¸€èˆ¬ç”¨äºä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼Œç„¶åè¿™ä¸€ç»„çº¿ç¨‹å†åŒæ—¶æ‰§è¡Œï¼› CountDownLatchå¼ºè°ƒä¸€ä¸ªçº¿ç¨‹ç­‰å¤šä¸ªçº¿ç¨‹å®ŒæˆæŸä»¶äº‹æƒ…ã€‚CyclicBarrieræ˜¯å¤šä¸ªçº¿ç¨‹äº’ç­‰ï¼Œç­‰å¤§ å®¶éƒ½å®Œæˆï¼Œå†æºæ‰‹å…±è¿›ã€‚ </li>
<li>è°ƒç”¨CountDownLatchçš„countDownæ–¹æ³•åï¼Œå½“å‰çº¿ç¨‹å¹¶ä¸ä¼šé˜»å¡ï¼Œä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›è€Œè°ƒç”¨ CyclicBarrierçš„awaitæ–¹æ³•ï¼Œä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°CyclicBarrieræŒ‡å®šçš„çº¿ç¨‹å…¨éƒ¨éƒ½åˆ°è¾¾äº† æŒ‡å®šç‚¹çš„æ—¶å€™ï¼Œæ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼› </li>
<li>CountDownLatchæ–¹æ³•æ¯”è¾ƒå°‘ï¼Œæ“ä½œæ¯”è¾ƒç®€å•ï¼Œè€ŒCyclicBarrieræä¾›çš„æ–¹æ³•æ›´å¤šï¼Œæ¯”å¦‚èƒ½å¤Ÿé€šè¿‡ getNumberWaiting()ï¼ŒisBroken()è¿™äº›æ–¹æ³•è·å–å½“å‰å¤šä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼Œå¹¶ä¸”CyclicBarrierçš„ æ„é€ æ–¹æ³•å¯ä»¥ä¼ å…¥barrierActionï¼ŒæŒ‡å®šå½“æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æ—¶æ‰§è¡Œçš„ä¸šåŠ¡åŠŸèƒ½ï¼›</li>
<li>CountDownLatchæ˜¯ä¸èƒ½å¤ç”¨çš„ï¼Œè€ŒCyclicLatchæ˜¯å¯ä»¥å¤ç”¨çš„ã€‚</li>
</ul>
<h5 id="3-4-4-Exchanger"><a href="#3-4-4-Exchanger" class="headerlink" title="3.4.4 Exchanger"></a>3.4.4 Exchanger</h5><p>Exchangerå¯ä»¥ç”¨æ¥åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´äº¤æ¢æŒæœ‰çš„å¯¹è±¡ã€‚å½“Exchangeråœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨exchangeæ–¹æ³•ä¹‹ åï¼Œä¼šç­‰å¾…å¦å¤–çš„çº¿ç¨‹è°ƒç”¨åŒæ ·çš„exchangeæ–¹æ³•ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½è°ƒç”¨exchangeæ–¹æ³•ä¹‹åï¼Œä¼ å…¥çš„å‚æ•°å°± ä¼šäº¤æ¢ã€‚<br>ä¸¤ä¸ªä¸»è¦æ–¹æ³•<br>public V exchange(V x) throws InterruptedException<br>å½“è¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šç­‰å¾…ç›´åˆ°å…¶ä»–çš„çº¿ç¨‹è°ƒç”¨åŒæ ·çš„æ–¹æ³•ã€‚å½“å…¶ä»–çš„çº¿ç¨‹è°ƒç”¨ exchangeä¹‹åï¼Œå½“å‰çº¿ç¨‹å°†ä¼šç»§ç»­æ‰§è¡Œã€‚<br>åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰å…¶ä»–çš„çº¿ç¨‹interruptå½“å‰çº¿ç¨‹ï¼Œåˆ™ä¼šæŠ›å‡ºInterruptedExceptionã€‚<br>public V exchange(V x, long timeout, TimeUnit unit) throws InterruptedException, TimeoutException<br>å¤šäº†ä¸€ä¸ªtimeoutæ—¶é—´ã€‚å¦‚æœåœ¨timeoutæ—¶é—´ä¹‹å†…æ²¡æœ‰å…¶ä»–çº¿ç¨‹è°ƒç”¨exchangeæ–¹æ³•ï¼ŒæŠ›å‡º TimeoutExceptionã€‚</p>
<p>æ —å­ï¼š<br>æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªå¸¦äº¤æ¢çš„ç±»ï¼š</p>
<p>ç„¶åå®šä¹‰ä¸¤ä¸ªRunnableï¼Œåœ¨runæ–¹æ³•ä¸­è°ƒç”¨exchangeæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExchangerTest</span> </span>&#123;</span><br><span class="line">    Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; Â </span><br><span class="line">         Exchanger&lt;CustBook&gt; exchanger = <span class="keyword">new</span> Exchanger&lt;&gt;(); Â  Â </span><br><span class="line">         <span class="comment">// Starting two threads Â  Â </span></span><br><span class="line">         <span class="keyword">new</span> Thread(<span class="keyword">new</span> ExchangerOne(exchanger)).start(); Â  Â  </span><br><span class="line">         <span class="keyword">new</span> Thread(<span class="keyword">new</span> ExchangerTwo(exchanger)).start(); Â </span><br><span class="line">     &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustBook</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> String name;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExchangerOne</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"> Â  Â Exchanger&lt;CustBook&gt; ex;</span><br><span class="line">    </span><br><span class="line"> Â  Â ExchangerOne(Exchanger&lt;CustBook&gt; ex)&#123; Â </span><br><span class="line">        <span class="keyword">this</span>.ex=ex; Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        CustBook custBook= <span class="keyword">new</span> CustBook(); Â  Â </span><br><span class="line">        custBook.setName(<span class="string">"book one"</span>);</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">try</span> &#123; Â  Â </span><br><span class="line">            CustBook exhangeCustBook=ex.exchange(custBook); Â </span><br><span class="line">            log.info(exhangeCustBook.getName()); Â  Â  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  Â  Â </span><br><span class="line">            e.printStackTrace(); Â  Â </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExchangerTwo</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    </span><br><span class="line"> Â  Â Exchanger&lt;CustBook&gt; ex;</span><br><span class="line"> Â  Â ExchangerTwo(Exchanger&lt;CustBook&gt; ex)&#123; Â  </span><br><span class="line">        <span class="keyword">this</span>.ex=ex; Â  </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CustBook custBook= <span class="keyword">new</span> CustBook(); Â </span><br><span class="line">        custBook.setName(<span class="string">"book two"</span>);</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â <span class="keyword">try</span> &#123; Â  Â  </span><br><span class="line">            CustBook exhangeCustBook=ex.exchange(custBook); Â </span><br><span class="line">            log.info(exhangeCustBook.getName()); Â  Â  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â </span><br><span class="line">            e.printStackTrace(); Â </span><br><span class="line">        &#125; Â  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-4-5-Phaser"><a href="#3-4-5-Phaser" class="headerlink" title="3.4.5 Phaser"></a>3.4.5 Phaser</h5><p>Phaseræ˜¯ä¸€ä¸ªåŒæ­¥å·¥å…·ç±»ï¼Œé€‚ç”¨äºä¸€äº›éœ€è¦åˆ†é˜¶æ®µçš„ä»»åŠ¡çš„å¤„ç†ã€‚å®ƒçš„åŠŸèƒ½ä¸ CyclicBarrierå’Œ CountDownLatchç±»ä¼¼ï¼Œç±»ä¼¼äºä¸€ä¸ªå¤šé˜¶æ®µçš„æ …æ ï¼Œå¹¶ä¸”åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæˆ‘ä»¬æ¥æ¯”è¾ƒä¸‹è¿™ä¸‰è€…çš„åŠŸèƒ½ï¼š</p>
<table>
<thead>
<tr>
<th><strong>CountDownLatch</strong></th>
<th>å€’æ•°è®¡æ•°å™¨ï¼Œåˆå§‹æ—¶è®¾å®šè®¡æ•°å™¨å€¼ï¼Œçº¿ç¨‹å¯ä»¥åœ¨è®¡æ•°å™¨ä¸Šç­‰å¾…ï¼Œå½“è®¡æ•°å™¨ å€¼å½’0åï¼Œæ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œ</th>
</tr>
</thead>
<tbody><tr>
<td><strong>CyclicBarrier</strong></td>
<td><strong>å¾ªç¯æ …æ ï¼Œåˆå§‹æ—¶è®¾å®šå‚ä¸çº¿ç¨‹æ•°ï¼Œå½“çº¿ç¨‹åˆ°è¾¾æ …æ åï¼Œä¼šç­‰å¾…å…¶å®ƒçº¿ç¨‹çš„åˆ°è¾¾ï¼Œå½“åˆ°è¾¾æ …æ çš„æ€»æ•°æ»¡è¶³æŒ‡å®šæ•°åï¼Œæ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œ</strong></td>
</tr>
<tr>
<td><strong>Phaser</strong></td>
<td><strong>å¤šé˜¶æ®µæ …æ ï¼Œå¯ä»¥åœ¨åˆå§‹æ—¶è®¾å®šå‚ä¸çº¿ç¨‹æ•°ï¼Œä¹Ÿå¯ä»¥ä¸­é€”æ³¨å†Œ/æ³¨é”€å‚ä¸ è€…ï¼Œå½“åˆ°è¾¾çš„å‚ä¸è€…æ•°é‡æ»¡è¶³æ …æ è®¾å®šçš„æ•°é‡åï¼Œä¼šè¿›è¡Œé˜¶æ®µå‡çº§  ï¼ˆadvanceï¼‰</strong></td>
</tr>
</tbody></table>
<p>ç›¸å…³æ¦‚å¿µï¼š</p>
<p><strong>phase(é˜¶æ®µ)</strong></p>
<p>Phaserä¹Ÿæœ‰æ …æ ï¼Œåœ¨Phaserä¸­ï¼Œæ …æ çš„åç§°å«åšphase(é˜¶æ®µ)ï¼Œåœ¨ä»»æ„æ—¶é—´ç‚¹ï¼ŒPhaseråªå¤„äºæŸä¸€ä¸ª phase(é˜¶æ®µ)ï¼Œåˆå§‹é˜¶æ®µä¸º0ï¼Œå¤§è¾¾åˆ°Integerr.MAX_VALUEï¼Œç„¶åå†æ¬¡å½’é›¶ã€‚å½“æ‰€æœ‰partieså‚ä¸è€… éƒ½åˆ°è¾¾åï¼Œphaseå€¼ä¼šé€’å¢ã€‚</p>
<p><strong>parties(å‚ä¸è€…)</strong></p>
<p>Phaseræ—¢å¯ä»¥åœ¨åˆå§‹æ„é€ æ—¶æŒ‡å®šå‚ä¸è€…çš„æ•°é‡ï¼Œä¹Ÿå¯ä»¥ä¸­é€”é€šè¿‡registerã€bulkRegisterã€ arriveAndDeregisterç­‰æ–¹æ³•æ³¨å†Œ/æ³¨é”€å‚ä¸è€…ã€‚</p>
<p><strong>arrive(åˆ°è¾¾) / advance(è¿›é˜¶)</strong></p>
<p>Phaseræ³¨å†Œå®Œpartiesï¼ˆå‚ä¸è€…ï¼‰ä¹‹åï¼Œå‚ä¸è€…çš„åˆå§‹çŠ¶æ€æ˜¯unarrivedçš„ï¼Œå½“å‚ä¸è€…åˆ°è¾¾ ï¼ˆarriveï¼‰å½“å‰é˜¶æ®µï¼ˆphaseï¼‰åï¼ŒçŠ¶æ€å°±ä¼šå˜æˆarrivedã€‚å½“é˜¶æ®µçš„åˆ°è¾¾å‚ä¸è€…æ•°æ»¡è¶³æ¡ä»¶åï¼ˆæ³¨å†Œ çš„æ•°é‡ç­‰äºåˆ°è¾¾çš„æ•°é‡ï¼‰ï¼Œé˜¶æ®µå°±ä¼šå‘ç”Ÿè¿›é˜¶ï¼ˆadvanceï¼‰â€”â€”ä¹Ÿå°±æ˜¯phaseå€¼+1ã€‚</p>
<p><strong>Terminationï¼ˆç»ˆæ­¢ï¼‰</strong></p>
<p>ä»£è¡¨å½“å‰Phaserå¯¹è±¡è¾¾åˆ°ç»ˆæ­¢çŠ¶æ€ã€‚</p>
<p><strong>Tieringï¼ˆåˆ†å±‚ï¼‰</strong></p>
<p>Phaseræ”¯æŒåˆ†å±‚ï¼ˆTieringï¼‰ â€”â€” ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œé€šè¿‡æ„é€ å‡½æ•°å¯ä»¥æŒ‡å®šå½“å‰å¾…æ„é€ çš„Phaserå¯¹è±¡ çš„çˆ¶ç»“ç‚¹ã€‚ä¹‹æ‰€ä»¥å¼•å…¥Tieringï¼Œæ˜¯å› ä¸ºå½“ä¸€ä¸ªPhaseræœ‰å¤§é‡å‚ä¸è€…ï¼ˆpartiesï¼‰çš„æ—¶å€™ï¼Œå†…éƒ¨çš„åŒæ­¥ æ“ä½œä¼šä½¿æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼Œè€Œåˆ†å±‚å¯ä»¥é™ä½ç«äº‰ï¼Œä»è€Œå‡å°å› åŒæ­¥å¯¼è‡´çš„é¢å¤–å¼€é”€ã€‚<br>åœ¨ä¸€ä¸ªåˆ†å±‚Phasersçš„æ ‘ç»“æ„ä¸­ï¼Œæ³¨å†Œå’Œæ’¤é”€å­Phaseræˆ–çˆ¶Phaseræ˜¯è‡ªåŠ¨è¢«ç®¡ç†çš„ã€‚å½“ä¸€ä¸ªPhaserå‚ ä¸è€…ï¼ˆpartiesï¼‰æ•°é‡å˜æˆ0æ—¶ï¼Œå¦‚æœæœ‰è¯¥Phaseræœ‰çˆ¶ç»“ç‚¹ï¼Œå°±ä¼šå°†å®ƒä»çˆ¶ç»“ç‚¹ä¸­æº¢ç§»é™¤ã€‚<br>æ ¸å¿ƒæ–¹æ³•ï¼š</p>
<ul>
<li><p>arriveAndDeregister() è¯¥æ–¹æ³•ç«‹å³è¿”å›ä¸‹ä¸€é˜¶æ®µçš„åºå·ï¼Œå¹¶ä¸”å…¶å®ƒçº¿ç¨‹éœ€è¦ç­‰å¾…çš„ä¸ªæ•°å‡ ä¸€ï¼Œ     å–æ¶ˆè‡ªå·±çš„æ³¨å†Œã€æŠŠå½“å‰çº¿ç¨‹ä»ä¹‹åéœ€è¦ç­‰å¾…çš„æˆå‘˜ä¸­ç§»é™¤ã€‚     å¦‚æœè¯¥Phaseræ˜¯å¦å¤–ä¸€ä¸ªPhaserçš„å­Phaserï¼ˆå±‚æ¬¡åŒ–Phaserï¼‰ï¼Œ     å¹¶ä¸”è¯¥æ“ä½œå¯¼è‡´å½“å‰Phaserçš„æˆå‘˜æ•°ä¸º0ï¼Œåˆ™è¯¥æ“ä½œä¹Ÿä¼šå°†å½“å‰Phaserä»å…¶çˆ¶Phaserä¸­ç§»é™¤ã€‚ </p>
</li>
<li><p>arrive() æŸä¸ªå‚ä¸è€…å®Œæˆä»»åŠ¡åè°ƒç”¨ï¼Œè¯¥æ–¹æ³•ä¸ä½œä»»ä½•ç­‰å¾…ï¼Œç›´æ¥è¿”å›ä¸‹ä¸€é˜¶æ®µçš„åºå·ã€‚</p>
</li>
<li><p>awaitAdvance(int phase) è¯¥æ–¹æ³•ç­‰å¾…æŸä¸€é˜¶æ®µæ‰§è¡Œå®Œæ¯•ã€‚     å¦‚æœå½“å‰é˜¶æ®µä¸ç­‰äºæŒ‡å®šçš„é˜¶æ®µæˆ–è€…è¯¥Phaserå·²ç»è¢«ç»ˆæ­¢ï¼Œåˆ™ç«‹å³è¿”å›ã€‚     è¯¥é˜¶æ®µæ•°ä¸€èˆ¬ç”±arrive()æ–¹æ³•æˆ–è€…arriveAndDeregister()æ–¹æ³•è¿”å›ã€‚ è¿”å›ä¸‹ä¸€é˜¶æ®µçš„åºå·ï¼Œæˆ–è€…è¿”å›å‚æ•°æŒ‡å®šçš„å€¼ï¼ˆå¦‚æœè¯¥å‚æ•°ä¸ºè´Ÿæ•°ï¼‰ï¼Œæˆ–è€…ç›´æ¥è¿”å›å½“å‰é˜¶ æ®µåºå·ï¼ˆå¦‚æœå½“å‰Phaserå·²ç»è¢«ç»ˆæ­¢ï¼‰ã€‚ </p>
</li>
<li><p>awaitAdvanceInterruptibly(int phase) æ•ˆæœä¸awaitAdvance(int phase)ç›¸å½“ï¼Œ å”¯ä¸€çš„ä¸åŒåœ¨äºè‹¥è¯¥çº¿ç¨‹åœ¨è¯¥æ–¹æ³•ç­‰å¾…æ—¶è¢«ä¸­æ–­ï¼Œåˆ™è¯¥æ–¹æ³•æŠ›å‡ºInterruptedExceptionã€‚</p>
</li>
<li><p>awaitAdvanceInterruptibly(int phase, long timeout, TimeUnit unit)   æ•ˆæœä¸awaitAdvanceInterruptibly(int phase)ç›¸å½“ï¼ŒåŒºåˆ«åœ¨äºå¦‚æœè¶…æ—¶åˆ™æŠ›å‡ºTimeoutExceptionã€‚ </p>
</li>
<li><p>bulkRegister(int parties) åŠ¨æ€è°ƒæ•´æ³¨å†Œä»»åŠ¡partiesçš„æ•°é‡ã€‚å¦‚æœå½“å‰phaserå·²ç»è¢«ç»ˆ æ­¢ï¼Œåˆ™è¯¥æ–¹æ³•æ— æ•ˆï¼Œå¹¶è¿”å›è´Ÿæ•°ã€‚     å¦‚æœè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼ŒonAdvanceæ–¹æ³•æ­£åœ¨æ‰§è¡Œï¼Œåˆ™è¯¥æ–¹æ³•ç­‰å¾…å…¶æ‰§è¡Œå®Œæ¯•ã€‚     å¦‚æœè¯¥Phaseræœ‰çˆ¶Phaseråˆ™æŒ‡å®šçš„partyæ•°å¤§äº0ï¼Œä¸”ä¹‹å‰è¯¥Phaserçš„partyæ•°ä¸º0ï¼Œé‚£ä¹ˆè¯¥ Phaserä¼šè¢«æ³¨å†Œåˆ°å…¶çˆ¶Phaserä¸­ã€‚</p>
</li>
<li><p>forceTermination() å¼ºåˆ¶è®©è¯¥Phaserè¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚ å·²ç»æ³¨å†Œçš„partyæ•°ä¸å—å½±å“ã€‚å¦‚æœè¯¥Phaseræœ‰å­Phaserï¼Œåˆ™å…¶æ‰€æœ‰çš„å­Phaserå‡è¿›å…¥ç»ˆæ­¢ çŠ¶æ€ã€‚å¦‚æœè¯¥Phaserå·²ç»å¤„äºç»ˆæ­¢çŠ¶æ€ï¼Œè¯¥æ–¹æ³•è°ƒç”¨ä¸é€ æˆä»»ä½•å½±å“ã€‚ </p>
</li>
</ul>
<p>æ —å­ï¼š3ä¸ªçº¿ç¨‹ï¼Œ4ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¹¶å‘å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> kaikeba.com;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Phaser;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhaserTest</span> </span>&#123; Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; Â  </span><br><span class="line">        <span class="keyword">int</span> parties = <span class="number">3</span>; Â  Â  Â  </span><br><span class="line">        <span class="keyword">int</span> phases = <span class="number">4</span>; Â  Â </span><br><span class="line">        <span class="keyword">final</span> Phaser phaser = <span class="keyword">new</span> Phaser(parties) &#123; Â  Â  Â </span><br><span class="line">            <span class="meta">@Override</span> Â  Â  Â  Â  </span><br><span class="line">            <span class="comment">//æ¯ä¸ªé˜¶æ®µç»“æŸæ—¶ Â  Â  Â </span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onAdvance</span><span class="params">(<span class="keyword">int</span> phase, <span class="keyword">int</span> registeredParties)</span> </span>&#123; Â </span><br><span class="line">                System.out.println(<span class="string">"====== Phase : "</span> + phase + <span class="string">"  end ======"</span>); Â </span><br><span class="line">                <span class="keyword">return</span> registeredParties == <span class="number">0</span>; Â  Â  Â </span><br><span class="line">            &#125; Â  Â  Â </span><br><span class="line">        &#125;; Â  Â </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parties; i++) &#123; Â  </span><br><span class="line">            <span class="keyword">int</span> threadId = i; Â  Â  Â </span><br><span class="line">            Thread thread = <span class="keyword">new</span> Thread(() -&gt; &#123; Â  Â  Â  Â  </span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> phase = <span class="number">0</span>; phase &lt; phases; phase++) &#123; Â  Â </span><br><span class="line">                    <span class="keyword">if</span> (phase == <span class="number">0</span>) &#123; Â  Â  </span><br><span class="line">                        System.out.println(String.format(<span class="string">"ç¬¬ä¸€é˜¶æ®µæ“ä½œ  Thread %s, phase %s"</span>, threadId, phase)); Â  Â  Â  Â  Â  Â  Â  </span><br><span class="line">                    &#125; Â  Â  Â  Â  Â </span><br><span class="line">                    <span class="keyword">if</span> (phase == <span class="number">1</span>) &#123; Â </span><br><span class="line">                        System.out.println(String.format(<span class="string">"ç¬¬äºŒé˜¶æ®µæ“ä½œ  Thread %s, phase %s"</span>, threadId, phase)); Â  Â  Â  Â  Â  Â  </span><br><span class="line">                    &#125; Â  Â  Â  Â  Â  </span><br><span class="line">                    <span class="keyword">if</span> (phase == <span class="number">2</span>) &#123; Â  Â  </span><br><span class="line">                        System.out.println(String.format(<span class="string">"ç¬¬ä¸‰é˜¶æ®µæ“ä½œ  Thread %s, phase %s"</span>, threadId, phase)); Â  Â  Â </span><br><span class="line">                    &#125; Â  Â  Â  Â  Â </span><br><span class="line">                    <span class="keyword">if</span> (phase == <span class="number">3</span>) &#123; Â  Â </span><br><span class="line">                        System.out.println(String.format(<span class="string">"ç¬¬å››é˜¶æ®µæ“ä½œ  Thread %s, phase %s"</span>, threadId, phase));   </span><br><span class="line">					 &#125; Â  Â  Â </span><br><span class="line">                    <span class="comment">/** Â  Â  Â  Â </span></span><br><span class="line"><span class="comment">                      * arriveAndAwaitAdvance() å½“å‰çº¿ç¨‹å½“å‰é˜¶æ®µæ‰§è¡Œå®Œæ¯•ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹å®Œæˆå½“å‰ é˜¶æ®µã€‚ Â  Â  Â  Â  </span></span><br><span class="line"><span class="comment">                      * å¦‚æœå½“å‰çº¿ç¨‹æ˜¯è¯¥é˜¶æ®µæœ€åä¸€ä¸ªæœªåˆ°è¾¾çš„ï¼Œåˆ™è¯¥æ–¹æ³•ç›´æ¥è¿”å›ä¸‹ä¸€ä¸ªé˜¶æ®µçš„åºå·ï¼ˆé˜¶æ®µ åºå·ä»0å¼€å§‹ï¼‰ï¼Œ Â  Â  Â  Â  </span></span><br><span class="line"><span class="comment">                      * åŒæ—¶å…¶å®ƒçº¿ç¨‹çš„è¯¥æ–¹æ³•ä¹Ÿè¿”å›ä¸‹ä¸€ä¸ªé˜¶æ®µçš„åºå·ã€‚ Â </span></span><br><span class="line"><span class="comment">                      **/</span> Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                    <span class="keyword">int</span> nextPhaser = phaser.arriveAndAwaitAdvance();</span><br><span class="line">                    </span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â   &#125; Â  Â  Â  Â </span><br><span class="line">            &#125;); Â  Â  Â </span><br><span class="line">            thread.start(); Â </span><br><span class="line">        &#125; Â  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-5-Executors"><a href="#3-5-Executors" class="headerlink" title="3.5 Executors"></a>3.5 Executors</h4><h5 id="3-5-1-Executoræ¡†æ¶"><a href="#3-5-1-Executoræ¡†æ¶" class="headerlink" title="3.5.1 Executoræ¡†æ¶"></a>3.5.1 Executoræ¡†æ¶</h5><p>Executoræ¡†æ¶åŒ…æ‹¬3å¤§éƒ¨åˆ†ï¼š</p>
<ul>
<li>ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯å·¥ä½œå•å…ƒï¼ŒåŒ…æ‹¬è¢«æ‰§è¡Œä»»åŠ¡éœ€è¦å®ç°çš„æ¥å£ï¼šRunnableæ¥å£æˆ–è€…Callableæ¥å£ï¼›</li>
<li>ä»»åŠ¡çš„æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯æŠŠä»»åŠ¡åˆ†æ´¾ç»™å¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œæœºåˆ¶ï¼ŒåŒ…æ‹¬Executoræ¥å£åŠç»§æ‰¿è‡ªExecutoræ¥ å£çš„ExecutorServiceæ¥å£ã€‚</li>
<li>å¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚åŒ…æ‹¬Futureæ¥å£åŠå®ç°äº†Futureæ¥å£çš„FutureTaskç±»ã€‚</li>
</ul>
<p>Executoræ¡†æ¶çš„æˆå‘˜åŠå…¶å…³ç³»å¯ä»¥ç”¨ä¸€ä¸‹çš„å…³ç³»å›¾è¡¨ç¤ºï¼š</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/09/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89/img3.jpg"  alt></p>
<p>Executoræ¡†æ¶çš„ä½¿ç”¨ç¤ºæ„å›¾ï¼š</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/09/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89/img4.jpg"  alt></p>
<p>ä½¿ç”¨æ­¥éª¤ï¼š</p>
<ul>
<li>åˆ›å»ºRunnableå¹¶é‡å†™runï¼ˆï¼‰æ–¹æ³•æˆ–è€…Callableå¯¹è±¡å¹¶é‡å†™callï¼ˆï¼‰æ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªä»»åŠ¡å¯¹è±¡</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">callableImp</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span> &gt;</span>&#123; Â  Â  </span><br><span class="line">    <span class="meta">@Override</span> Â  Â  Â  Â  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> </span>&#123; Â  Â  </span><br><span class="line">        <span class="keyword">try</span>&#123; Â  Â  Â  Â  Â  Â  </span><br><span class="line">            String a = <span class="string">"return String"</span>; Â  Â  Â  </span><br><span class="line">            <span class="keyword">return</span> a; Â  Â  Â  Â  </span><br><span class="line">        &#125; Â  Â  Â  Â  Â  Â  </span><br><span class="line">        <span class="keyword">catch</span>(Exception e)&#123; Â  Â  Â </span><br><span class="line">            e.printStackTrace(); Â  Â  Â  </span><br><span class="line">            <span class="keyword">return</span> <span class="string">"exception"</span>; Â  Â  </span><br><span class="line">        &#125; Â  Â  Â  </span><br><span class="line">    &#125; Â  Â  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ›å»ºExecutorServiceæ¥å£çš„å®ç°ç±»ThreadPoolExecutorç±»æˆ–è€… ScheduledThreadPoolExecutorç±»çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶execute()æ–¹æ³•æˆ–è€…submit()æ–¹æ³•ï¼Œæ äº¤ä»»åŠ¡å¯¹è±¡æ‰§è¡Œã€‚</li>
<li>ä¸»çº¿ç¨‹è°ƒç”¨Futureå¯¹è±¡çš„get()æ–¹æ³•è·å–è¿”å›å€¼ï¼Œæˆ–è€…è°ƒç”¨Futureå¯¹è±¡çš„cancel()æ–¹æ³•å–æ¶ˆå½“å‰ çº¿ç¨‹çš„æ‰§è¡Œã€‚</li>
</ul>
<p>Executoræ¡†æ¶æˆå‘˜ï¼šThreadPoolExecutorå®ç°ç±»ã€ScheduledThreadPoolExecutorå®ç°ç±»ã€Future æ¥å£ã€Runnableå’ŒCallableæ¥å£ã€Executorså·¥å‚ç±»<br>Executor:æ‰§è¡Œå™¨æ¥å£ï¼Œä¹Ÿæ˜¯é¡¶å±‚çš„æŠ½è±¡æ ¸å¿ƒæ¥å£ï¼Œ åˆ†ç¦»äº†ä»»åŠ¡å’Œä»»åŠ¡çš„æ‰§è¡Œã€‚ExecutorService åœ¨Executorçš„åŸºç¡€ä¸Šæä¾›äº†æ‰§è¡Œå™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä»»åŠ¡å¼‚æ­¥æ‰§è¡Œç­‰åŠŸèƒ½ã€‚<br>Executorsï¼šç”Ÿäº§å…·ä½“çš„æ‰§è¡Œå™¨çš„é™æ€å·¥å‚ã€‚<br>ThreadPoolExecutor:çº¿ç¨‹æ± Executorï¼Œä¹Ÿæ˜¯å¸¸ç”¨çš„Executorï¼Œé€šå¸¸ä½¿ç”¨Executorsæ¥åˆ›å»ºï¼Œå¯ä»¥ åˆ›å»ºä¸‰ç§ç±»å‹çš„ThreadPoolExecutorï¼šSingleThreadPoolExecutorï¼ŒFixedThreadPoolå’Œ CachedThreadPoolï¼Œä»¥çº¿ç¨‹æ± çš„æ–¹å¼ç®¡ç†çº¿ç¨‹ã€‚<br>ScheduledThreadPoolExecutorï¼šåœ¨ThreadPoolExecutoråŸºç¡€ä¸Šï¼Œå¢åŠ äº†å¯¹å‘¨æœŸä»»åŠ¡è°ƒåº¦çš„æ”¯æŒã€‚</p>
<p>Runnableå’ŒCallableæ¥å£ï¼šRunnableå’ŒCallableæ¥å£çš„å®ç°ç±»ï¼Œå¯ä»¥è¢«ThreadPoolExecutorå’Œ ScheduledThreadPoolExecutoræ‰§è¡Œï¼ŒåŒºåˆ«æ˜¯ï¼Œäº²ç€æ²¡æœ‰è¿”å›ç»“æœï¼Œå€™ç€å¯ä»¥è¿”å›ç»“æœã€‚</p>
<h5 id="3-5-2-ThreadPoolExecutor"><a href="#3-5-2-ThreadPoolExecutor" class="headerlink" title="3.5.2 ThreadPoolExecutor"></a>3.5.2 ThreadPoolExecutor</h5><p>ThreadPoolExecutorä¸€å…±æä¾›äº†4ç§æ„é€ å™¨ï¼Œä½†å…¶å®ƒä¸‰ç§å†…éƒ¨å…¶å®éƒ½è°ƒç”¨äº†ä¸‹é¢çš„æ„é€ å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">  * ä½¿ç”¨ç»™å®šçš„å‚æ•°åˆ›å»ºThreadPoolExecutor. </span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> corePoolSize Â   æ ¸å¿ƒçº¿ç¨‹æ± ä¸­çš„æœ€å¤§çº¿ç¨‹æ•° </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> maximumPoolSize æ€»çº¿ç¨‹æ± ä¸­çš„æœ€å¤§çº¿ç¨‹æ•° </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> keepAliveTime Â  ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> unit Â  Â  Â  Â  Â   keepAliveTimeçš„å•ä½ </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> workQueue Â  Â  Â  ä»»åŠ¡é˜Ÿåˆ—, ä¿å­˜å·²ç»æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„çº¿ç¨‹ </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> threadFactory Â  çº¿ç¨‹åˆ›å»ºå·¥å‚ </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> handler Â  Â  Â  Â  æ‹’ç»ç­–ç•¥ (å½“ä»»åŠ¡å¤ªå¤šå¯¼è‡´å·¥ä½œé˜Ÿåˆ—æ»¡æ—¶çš„å¤„ç†ç­–ç•¥) </span></span><br><span class="line"><span class="comment">  */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize, Â  Â  Â  </span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime, Â  Â  Â  </span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit, Â  Â  Â  Â  Â  Â  Â  Â  </span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue, Â  Â  </span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory, Â  </span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123; Â  Â </span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> || Â  Â  Â  Â </span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> || Â  Â </span><br><span class="line">        maximumPoolSize &lt; corePoolSize || Â  </span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>) Â  Â  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(); Â  Â </span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>) Â  Â  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(); Â  </span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize; Â  Â  </span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize; Â  Â  </span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue; Â  Â  </span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime); Â </span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory; Â  </span><br><span class="line">    <span class="keyword">this</span>.handler = handler; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çº¿ç¨‹æ± çŠ¶æ€å®šä¹‰ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/* Â  Â </span></span><br><span class="line"><span class="comment">  * RUNNING -&gt; SHUTDOWN Â  </span></span><br><span class="line"><span class="comment">  * Â   On invocation of shutdown(), perhaps implicitly in finalize() Â </span></span><br><span class="line"><span class="comment">  * (RUNNING or SHUTDOWN) -&gt; STOP Â  Â  </span></span><br><span class="line"><span class="comment">  * Â   On invocation of shutdownNow() Â  Â </span></span><br><span class="line"><span class="comment">  * SHUTDOWN -&gt; TIDYING Â  Â </span></span><br><span class="line"><span class="comment">  * Â   When both queue and pool are empty Â  </span></span><br><span class="line"><span class="comment">  * STOP -&gt; TIDYING Â  </span></span><br><span class="line"><span class="comment">  * Â   When pool is empty Â  Â  </span></span><br><span class="line"><span class="comment">  * TIDYING -&gt; TERMINATED Â  Â </span></span><br><span class="line"><span class="comment">  * Â   When the terminated() hook method has completed Â </span></span><br><span class="line"><span class="comment">  * */</span> Â  </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RUNNING Â  Â = -<span class="number">1</span> &lt;&lt; COUNT_BITS; Â  </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHUTDOWN Â  = Â <span class="number">0</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP Â  Â  Â  = Â <span class="number">1</span> &lt;&lt; COUNT_BITS; Â </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TIDYING Â  Â = Â <span class="number">2</span> &lt;&lt; COUNT_BITS; Â </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TERMINATED = Â <span class="number">3</span> &lt;&lt; COUNT_BITS;</span><br></pre></td></tr></table></figure>

<p>ThreadPoolExecutorä¸€å…±å®šä¹‰äº†5ç§çº¿ç¨‹æ± çŠ¶æ€ï¼š</p>
<ul>
<li>RUNNING : æ¥å—æ–°ä»»åŠ¡, ä¸”å¤„ç†å·²ç»è¿›å…¥é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡ </li>
<li>SHUTDOWN : ä¸æ¥å—æ–°ä»»åŠ¡, ä½†å¤„ç†å·²ç»è¿›å…¥é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡ </li>
<li>STOP : ä¸æ¥å—æ–°ä»»åŠ¡, ä¸”ä¸å¤„ç†å·²ç»è¿›å…¥é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡, åŒæ—¶ä¸­æ–­æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ </li>
<li>TIDYING : æ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»ˆæ­¢, å·¥ä½œçº¿ç¨‹æ•°ä¸º0, çº¿ç¨‹è½¬åŒ–ä¸ºTIDYINGçŠ¶æ€å¹¶å‡†å¤‡è°ƒç”¨ </li>
<li>terminatedæ–¹æ³• TERMINATED : terminatedæ–¹æ³•å·²ç»æ‰§è¡Œå®Œæˆ</li>
</ul>
<p>å„ä¸ªçŠ¶æ€ä¹‹é—´çš„æµè½¬å›¾ï¼š </p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/09/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89/img5.jpg"  alt></p>
<p>æ‰§è¡Œexecute</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123; Â </span><br><span class="line">    <span class="keyword">if</span> (command == <span class="keyword">null</span>) Â </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(); Â   Â  Â </span><br><span class="line">    <span class="keyword">int</span> c = ctl.get(); Â  Â </span><br><span class="line">    <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123; Â  Â  Â </span><br><span class="line">        <span class="comment">// CASE1: å·¥ä½œçº¿ç¨‹æ•° &lt; æ ¸å¿ƒ çº¿ç¨‹æ± ä¸Šé™ Â  </span></span><br><span class="line">        <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>)) Â  Â  </span><br><span class="line">            <span class="comment">// æ·»åŠ å·¥ä½œçº¿ç¨‹å¹¶æ‰§è¡Œ Â  Â  Â  </span></span><br><span class="line">            <span class="keyword">return</span>; Â  Â  </span><br><span class="line">        c = ctl.get(); </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> Â  Â <span class="comment">// æ‰§è¡Œåˆ°æ­¤å¤„, è¯´æ˜å·¥ä½œçº¿ç¨‹åˆ›å»ºå¤±è´¥ æˆ– å·¥ä½œçº¿ç¨‹æ•°â‰¥æ ¸å¿ƒçº¿ç¨‹æ± ä¸Šé™ Â </span></span><br><span class="line">    <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; Â  </span><br><span class="line">        <span class="comment">// CASE2: æ’å…¥ä»»åŠ¡è‡³ é˜Ÿåˆ—</span></span><br><span class="line"> Â  Â  Â  Â <span class="comment">// å†æ¬¡æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€ Â  Â </span></span><br><span class="line">        <span class="keyword">int</span> recheck = ctl.get(); Â  Â </span><br><span class="line">        <span class="keyword">if</span> (!isRunning(recheck) &amp;&amp; remove(command)) Â  Â  </span><br><span class="line">            reject(command); Â  Â  </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>) Â  Â  Â </span><br><span class="line">            addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>)) Â  Â  </span><br><span class="line">        <span class="comment">// CASE3: æ’å…¥é˜Ÿåˆ—å¤±è´¥, åˆ¤æ–­ å·¥ä½œçº¿ç¨‹æ•° &lt; æ€»çº¿ç¨‹æ± ä¸Šé™ Â  Â </span></span><br><span class="line">        reject(command); Â  </span><br><span class="line">    	<span class="comment">// æ‰§è¡Œæ‹’ç»ç­–ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°executeçš„æ‰§è¡Œæµç¨‹å¯ä»¥ç”¨ä¸‹å›¾æè¿°ï¼š</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/09/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89/img6.jpg"  alt></p>
<p>executeçš„æ•´ä¸ªæ‰§è¡Œæµç¨‹å…³é”®æ˜¯ä¸‹é¢ä¸¤ç‚¹ï¼š</p>
<ul>
<li>å¦‚æœå·¥ä½œçº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ± ä¸Šé™ï¼ˆCorePoolSizeï¼‰ï¼Œåˆ™ç›´æ¥æ–°å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹å¹¶æ‰§è¡Œä»»åŠ¡ï¼›</li>
<li>å¦‚æœå·¥ä½œçº¿ç¨‹æ•°å¤§äºç­‰äºCorePoolSizeï¼Œåˆ™å°è¯•å°†ä»»åŠ¡åŠ å…¥åˆ°é˜Ÿåˆ—ç­‰å¾…ä»¥åæ‰§è¡Œã€‚å¦‚æœåŠ å…¥é˜Ÿåˆ— å¤±è´¥äº†ï¼ˆæ¯”å¦‚é˜Ÿåˆ—å·²æ»¡çš„æƒ…å†µï¼‰ï¼Œåˆ™åœ¨æ€»çº¿ç¨‹æ± æœªæ»¡çš„æƒ…å†µä¸‹ï¼ˆ CorePoolSize â‰¤ å·¥ä½œçº¿ç¨‹æ•° ï¼œ maximumPoolSize ï¼‰æ–°å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ç«‹å³æ‰§è¡Œä»»åŠ¡ï¼Œå¦åˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</li>
</ul>
<p>é€šè¿‡Executoræ¡†æ¶çš„å·¥å…·ç±»Executorsï¼Œå¯ä»¥åˆ›å»ºä¸‰ç§ç±»å‹çš„ThreadPoolExecutorï¼š<br>FixedThreadPoolï¼šå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123; Â </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads, Â </span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS, Â  Â </span><br><span class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()); Â </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>newFixedThreadPool</strong>åˆ›å»ºä¸€ä¸ªå›ºå®šé•¿åº¦çš„çº¿ç¨‹æ± ï¼Œæ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œ ç›´åˆ°è¾¾åˆ°çº¿ç¨‹æ± çš„å¤§æ•°é‡é™åˆ¶ã€‚</p>
<ul>
<li>å®šé•¿ï¼Œå¯ä»¥æ§åˆ¶çº¿ç¨‹å¤§å¹¶å‘æ•°ï¼Œ corePoolSize å’Œ maximumPoolSize çš„æ•°å€¼éƒ½æ˜¯ nThreadsã€‚</li>
<li>è¶…å‡ºçº¿ç¨‹æ•°çš„ä»»åŠ¡ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚ </li>
<li>å·¥ä½œé˜Ÿåˆ—ä¸ºLinkedBlockingQueue</li>
</ul>
<p>åˆ›å»ºæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ExecutorService fixedThreadPool = Executors.newFixedThreadPool(<span class="keyword">int</span> nThreads);</span><br></pre></td></tr></table></figure>

<p>SingleThreadExecutor:ä½¿ç”¨å•ä¸ªçº¿ç¨‹çš„Executor</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">(ThreadFactory threadFactory)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService Â  Â  Â </span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>, Â </span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS, Â  Â </span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(), Â </span><br><span class="line">                                threadFactory)); Â </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>newSingleThreadExecutor</strong>ï¼Œåªåˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œè‹¥è¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹å¼‚å¸¸æ•…éšœäº†ï¼Œä¼šæ–°å»º å¦ä¸€ä¸ªçº¿ç¨‹æ¥æ›¿ä»£ï¼ŒnewSingleThreadExecutorå¯ä»¥ä¿è¯ä»»åŠ¡ä¾ç…§åœ¨å·¥ä½œé˜Ÿåˆ—çš„æ’é˜Ÿé¡ºåºæ¥ä¸²è¡Œæ‰§ è¡Œã€‚</p>
<ul>
<li>æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼›</li>
<li>æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§å·¥ä½œé˜Ÿåˆ—çš„æ’é˜Ÿé¡ºåºæ‰§è¡Œï¼Œå…ˆè¿›å…ˆå‡ºçš„é¡ºåº</li>
<li>å·¥ä½œé˜Ÿåˆ—LinkedBlockingQueue</li>
</ul>
<p>åˆ›å»ºæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ExecutorService singleThreadPool = Executors.newSingleThreadPool();</span><br></pre></td></tr></table></figure>

<p>CachedThreadPool:ä¼šæ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">(ThreadFactory threadFactory)</span> </span>&#123; Â  Â </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE, Â  Â </span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS, Â  Â </span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;(), Â  Â  </span><br><span class="line">                                  threadFactory); Â </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>newCachedThreadPool</strong>å°†åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ•°è¶…è¿‡å¤„ç†ä»»åŠ¡æ—¶ï¼Œå›æ”¶ç©ºé—²çº¿ ç¨‹ï¼›å½“éœ€æ±‚å¢åŠ æ—¶ï¼Œå¯ä»¥æ·»åŠ æ–°çº¿ç¨‹å»å¤„ç†ä»»åŠ¡ã€‚<br>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>çº¿ç¨‹æ•°æ— é™åˆ¶ï¼ŒcorePoolSizeæ•°å€¼ä¸º0ï¼Œ maximumPoolSize çš„æ•°å€¼éƒ½æ˜¯ä¸º Integer.MAX_VALUEã€‚</li>
<li>è‹¥çº¿ç¨‹æœªå›æ”¶ï¼Œä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä¼šå¤ç”¨ç©ºé—²çº¿ç¨‹ï¼›</li>
<li>è‹¥æ— ç©ºé—²çº¿ç¨‹ï¼Œåˆ™æ–°å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚ å› ä¸ºå¤ç”¨æ€§ï¼Œä¸€å®šç¨‹åºå‡å°‘é¢‘ç¹åˆ›å»º/é”€æ¯çº¿ç¨‹ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ã€‚</li>
<li>å·¥ä½œé˜Ÿåˆ—é€‰ç”¨SynchronousQueueã€‚</li>
</ul>
<p>åˆ›å»ºæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ExecutorService cachedThreadPool = Executors.newCachedThreadPool();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolExecutorTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, IOException </span>&#123; </span><br><span class="line">        <span class="keyword">int</span> corePoolSize = <span class="number">2</span>; Â  Â  </span><br><span class="line">        <span class="keyword">int</span> maximumPoolSize = <span class="number">4</span>; Â  </span><br><span class="line">        <span class="keyword">long</span> keepAliveTime = <span class="number">10</span>; Â  Â </span><br><span class="line">        TimeUnit unit = TimeUnit.SECONDS; Â  Â  Â  </span><br><span class="line">        BlockingQueue&lt;Runnable&gt; workQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">2</span>); Â  Â  Â </span><br><span class="line">        RejectedExecutionHandler handler = <span class="keyword">new</span> RejectedExecutionPolicy(); Â  </span><br><span class="line">        ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(corePoolSize,</span><br><span class="line">                                                             maximumPoolSize, </span><br><span class="line">                                                             keepAliveTime, unit, Â  </span><br><span class="line">                                                             workQueue, handler); </span><br><span class="line">        executor.prestartAllCoreThreads();</span><br><span class="line">        <span class="comment">// é¢„å¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹</span></span><br><span class="line"> Â  Â  Â  Â <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123; Â  Â </span><br><span class="line">            ThreadTask task = <span class="keyword">new</span> ThreadTask(String.valueOf(i)); Â  Â  </span><br><span class="line">            executor.execute(task); Â  Â  </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â System.in.read(); </span><br><span class="line">        <span class="comment">//é˜»å¡ä¸»çº¿ç¨‹ </span></span><br><span class="line">    &#125; Â  Â </span><br><span class="line"> Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RejectedExecutionPolicy</span> <span class="keyword">implements</span> <span class="title">RejectedExecutionHandler</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123; Â  Â  </span><br><span class="line">            doLog(r, e); Â  Â </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doLog</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123; Â  Â  </span><br><span class="line">            System.err.println( r.toString() + <span class="string">" rejected"</span>); Â  </span><br><span class="line">        &#125; Â  </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; Â  Â  </span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"> Â  Â  Â  Â <span class="function"><span class="keyword">public</span> <span class="title">ThreadTask</span><span class="params">(String name)</span> </span>&#123; Â  Â </span><br><span class="line">            <span class="keyword">this</span>.name = name; Â  Â  </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="meta">@Override</span> Â  Â  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â  </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">Â System.out.println(<span class="keyword">this</span>.toString() + <span class="string">" is running!"</span>); Â  </span><br><span class="line">                Thread.sleep(<span class="number">3000</span>); Â  Â  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  Â  Â  Â </span><br><span class="line">                e.printStackTrace(); Â  Â  Â </span><br><span class="line">            &#125; Â  Â  Â </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123; Â  Â </span><br><span class="line">            <span class="keyword">return</span> name; Â  Â </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="meta">@Override</span> Â  Â  Â  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; Â  Â  Â  </span><br><span class="line">            <span class="keyword">return</span> <span class="string">"ThreadTask [name="</span> + name + <span class="string">"]"</span>; Â  Â  Â </span><br><span class="line">        &#125; Â  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-5-3-ScheduledExecutorService"><a href="#3-5-3-ScheduledExecutorService" class="headerlink" title="3.5.3 ScheduledExecutorService"></a>3.5.3 ScheduledExecutorService</h5><p><strong>æ„é€ çº¿ç¨‹æ± </strong><br>Executorsä½¿ç”¨ newScheduledThreadPool å·¥å‚æ–¹æ³•åˆ›å»ºScheduledThreadPoolExecutorï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(<span class="keyword">int</span> corePoolSize, ThreadFactory threadFactory)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize, threadFactory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ScheduledThreadPoolExecutorçš„æ„é€ å™¨ï¼Œå†…éƒ¨å…¶å®éƒ½æ˜¯è°ƒç”¨äº†çˆ¶ç±»ThreadPoolExecutorçš„æ„é€  å™¨ï¼Œè¿™é‡Œæ¯”è¾ƒç‰¹åˆ«çš„æ˜¯ä»»åŠ¡é˜Ÿåˆ—çš„é€‰æ‹©â€”â€”DelayedWorkQueueã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScheduledThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123; Â  </span><br><span class="line">    <span class="keyword">super</span>(corePoolSize, Integer.MAX_VALUE, <span class="number">0</span>, NANOSECONDS, <span class="keyword">new</span> DelayedWorkQueue());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScheduledThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize, ThreadFactory threadFactory)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">super</span>(corePoolSize, Integer.MAX_VALUE, <span class="number">0</span>, NANOSECONDS, <span class="keyword">new</span> DelayedWorkQueue(), threadFactory);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScheduledThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize, RejectedExecutionHandler handler)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">super</span>(corePoolSize, Integer.MAX_VALUE, <span class="number">0</span>, NANOSECONDS, <span class="keyword">new</span> DelayedWorkQueue(), </span><br><span class="line">          handler); </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScheduledThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize, ThreadFactory threadFactory, </span></span></span><br><span class="line"><span class="function"><span class="params">                                   RejectedExecutionHandler handler)</span></span>&#123;</span><br><span class="line">Â 	<span class="keyword">super</span>(corePoolSize, Integer.MAX_VALUE, <span class="number">0</span>, NANOSECONDS, <span class="keyword">new</span> DelayedWorkQueue(), threadFactory, handler); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>çº¿ç¨‹æ± çš„è°ƒåº¦</strong><br>è¯¥çº¿ç¨‹æ± çš„æ ¸å¿ƒè°ƒåº¦æ–¹æ³•ï¼Œæ˜¯scheduleã€scheduleAtFixedRateã€scheduleWithFixedDelayï¼Œé€šè¿‡ scheduleæ–¹æ³•æ¥çœ‹ä¸‹æ•´ä¸ªè°ƒåº¦æµç¨‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ScheduledFuture&lt;?&gt; schedule(Runnable command, <span class="keyword">long</span> delay, TimeUnit unit) &#123; Â  </span><br><span class="line">    <span class="keyword">if</span> (command == <span class="keyword">null</span> || unit == <span class="keyword">null</span>) Â  Â  Â </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(); Â  </span><br><span class="line">    RunnableScheduledFuture&lt;?&gt; t = decorateTask(command, <span class="keyword">new</span> ScheduledFutureTask&lt;Void&gt;(command, <span class="keyword">null</span>, Â                                                                                       triggerTime(delay, unit))); Â </span><br><span class="line">    delayedExecute(t); Â  </span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°çš„decorateTaskæ–¹æ³•æŠŠRunnableä»»åŠ¡åŒ…è£…æˆScheduledFutureTaskï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ è¦†å†™è¯¥æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;V&gt; <span class="function">RunnableScheduledFuture&lt;V&gt; <span class="title">decorateTask</span><span class="params">(Runnable runnable, RunnableScheduledFuture&lt;V&gt; task)</span> </span>&#123; Â  </span><br><span class="line">    <span class="keyword">return</span> task;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ScheduledFutureTaskæ˜¯RunnableScheduledFutureæ¥å£çš„å®ç°ç±»ï¼Œä»»åŠ¡é€šè¿‡periodå­—æ®µæ¥è¡¨ç¤ºä»»åŠ¡ ç±»å‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledFutureTask</span>&lt;<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">FutureTask</span>&lt;<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">RunnableScheduledFuture</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"> </span><br><span class="line"> Â  <span class="comment">//ä»»åŠ¡åºå·, è‡ªå¢å”¯ä¸€ </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> sequenceNumber;</span><br><span class="line"> </span><br><span class="line"> Â  Â <span class="comment">// é¦–æ¬¡æ‰§è¡Œçš„æ—¶é—´ç‚¹ Â  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> time;</span><br><span class="line"> Â  Â <span class="comment">// 0: éå‘¨æœŸä»»åŠ¡; &gt;0: fixed-rateä»»åŠ¡;&lt;0: fixed-delayä»»åŠ¡ Â </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> period;</span><br><span class="line"> </span><br><span class="line"> Â  Â <span class="comment">//åœ¨å †ä¸­çš„ç´¢å¼• Â  Â </span></span><br><span class="line">    <span class="keyword">int</span> heapIndex;</span><br><span class="line"> </span><br><span class="line"> Â  Â ScheduledFutureTask(Runnable r, V result, <span class="keyword">long</span> ns) &#123; Â  </span><br><span class="line">        <span class="keyword">super</span>(r, result); Â  Â  Â  </span><br><span class="line">        <span class="keyword">this</span>.time = ns; Â  Â  </span><br><span class="line">        <span class="keyword">this</span>.period = <span class="number">0</span>; Â  Â  Â  </span><br><span class="line">        <span class="keyword">this</span>.sequenceNumber = sequencer.getAndIncrement(); </span><br><span class="line">    &#125; Â  Â  Â  </span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ScheduledThreadPoolExecutorä¸­çš„ä»»åŠ¡é˜Ÿåˆ—â€”â€”DelayedWorkQueueï¼Œä¿å­˜çš„å…ƒç´ å°±æ˜¯ ScheduledFutureTaskã€‚DelayedWorkQueueæ˜¯ä¸€ç§å †ç»“æ„ï¼Œtimeå°çš„ä»»åŠ¡ä¼šæ’åœ¨å †é¡¶ï¼ˆè¡¨ç¤ºæ—© è¿‡æœŸï¼‰ï¼Œæ¯æ¬¡å‡ºé˜Ÿéƒ½æ˜¯å–å †é¡¶å…ƒç´ ï¼Œè¿™æ ·å¿«åˆ°æœŸçš„ä»»åŠ¡å°±ä¼šè¢«å…ˆæ‰§è¡Œã€‚å¦‚æœä¸¤ä¸ª ScheduledFutureTaskçš„timeç›¸åŒï¼Œå°±æ¯”è¾ƒå®ƒä»¬çš„åºå·â€”â€”sequenceNumberï¼Œåºå·å°çš„ä»£è¡¨å…ˆè¢«æ äº¤ï¼Œæ‰€ä»¥å°±ä¼šå…ˆæ‰§è¡Œã€‚</p>
<p>scheduleçš„æ ¸å¿ƒæ˜¯å…¶ä¸­çš„delayedExecuteæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">delayedExecute</span><span class="params">(RunnableScheduledFuture&lt;?&gt; task)</span> </span>&#123; Â </span><br><span class="line">    <span class="keyword">if</span> (isShutdown()) Â </span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ± å·²å…³é—­ Â  Â  Â  Â </span></span><br><span class="line">        reject(task); Â  </span><br><span class="line">    <span class="comment">// ä»»åŠ¡æ‹’ç»ç­–ç•¥ </span></span><br><span class="line">    <span class="keyword">else</span> &#123; Â  Â  </span><br><span class="line">        <span class="keyword">super</span>.getQueue().add(task); Â </span><br><span class="line">        <span class="comment">// å°†ä»»åŠ¡å…¥é˜Ÿ</span></span><br><span class="line"> Â  Â  Â  Â <span class="comment">// å¦‚æœçº¿ç¨‹æ± å·²å…³é—­ä¸”è¯¥ä»»åŠ¡æ˜¯éå‘¨æœŸä»»åŠ¡, åˆ™å°†å…¶ä»é˜Ÿåˆ—ç§»é™¤ Â  Â  </span></span><br><span class="line">        <span class="keyword">if</span> (isShutdown() &amp;&amp; !canRunInCurrentRunState(task.isPeriodic()) &amp;&amp; remove(task)) Â  Â  Â  Â  Â  Â task.cancel(<span class="keyword">false</span>); </span><br><span class="line">        <span class="comment">// å–æ¶ˆä»»åŠ¡ Â  Â </span></span><br><span class="line">        <span class="keyword">else</span> Â  Â  Â  </span><br><span class="line">            ensurePrestart(); Â </span><br><span class="line">        <span class="comment">// æ·»åŠ ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ Â </span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤„ç†è¿‡ç¨‹ï¼š</p>
<ul>
<li>ä»»åŠ¡è¢«æäº¤åˆ°çº¿ç¨‹æ± åï¼Œä¼šåˆ¤æ–­çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯RUNNINGçŠ¶æ€ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼›</li>
<li>ç„¶åï¼Œå°†ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç”±äºDelayedWorkQueueæ˜¯æ— ç•Œé˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¸€å®šä¼šaddæˆåŠŸï¼›</li>
<li>ç„¶åï¼Œä¼šåˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼ŒåŠ å…¥åˆ°æ ¸å¿ƒçº¿ç¨‹æ± æˆ–è€…éæ ¸å¿ƒçº¿ç¨‹æ± ï¼›</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ensurePrestart</span><span class="params">()</span> </span>&#123; Â  </span><br><span class="line">    <span class="keyword">int</span> wc = workerCountOf(ctl.get()); Â </span><br><span class="line">    <span class="keyword">if</span> (wc &lt; corePoolSize)</span><br><span class="line">        <span class="comment">//å¦‚æœæ ¸å¿ƒçº¿ç¨‹æ± æœªæ»¡ï¼Œåˆ™æ–°å»ºçš„å·¥ä½œçº¿ç¨‹ä¼šè¢«æ”¾åˆ°æ ¸å¿ƒçº¿ç¨‹ æ± ä¸­ã€‚ Â  </span></span><br><span class="line">        addWorker(<span class="keyword">null</span>, <span class="keyword">true</span>); Â </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (wc == <span class="number">0</span>) Â </span><br><span class="line">        <span class="comment">//å½“é€šè¿‡setCorePoolSizeæ–¹æ³•è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ± å¤§å°ä¸º0æ—¶ï¼Œè¿™ é‡Œå¿…é¡»è¦ä¿è¯ä»»åŠ¡èƒ½å¤Ÿè¢«æ‰§è¡Œï¼Œä¼šåˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ”¾åˆ°éæ ¸å¿ƒçº¿ç¨‹æ± ä¸­ã€‚ Â   </span></span><br><span class="line">        addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>); </span><br><span class="line">    <span class="comment">//å¦‚æœæ ¸å¿ƒçº¿ç¨‹æ± å·²ç»æ»¡äº†,ä¸ä¼šå†å»åˆ›å»ºå·¥ä½œçº¿ç¨‹,ç›´æ¥è¿”å›ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æœ€åï¼Œçº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ä¼šå»ä»»åŠ¡é˜Ÿåˆ—è·å–ä»»åŠ¡å¹¶æ‰§è¡Œï¼Œå½“ä»»åŠ¡è¢«æ‰§è¡Œå®Œæˆåï¼Œå¦‚æœè¯¥ä»»åŠ¡æ˜¯å‘¨ æœŸä»»åŠ¡ï¼Œåˆ™ä¼šé‡ç½®timeå­—æ®µï¼Œå¹¶é‡æ–°æ’å…¥é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…ä¸‹æ¬¡æ‰§è¡Œã€‚ </p>
</li>
<li><p>ä»é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„æ–¹æ³•ï¼š</p>
<p>â€‹         å¯¹äºæ ¸å¿ƒçº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æ¥è¯´ï¼Œå¦‚æœæ²¡æœ‰è¶…æ—¶è®¾ç½®ï¼ˆ allowCoreThreadTimeOut == false ï¼‰ï¼Œåˆ™ä¼šä½¿ç”¨é˜»å¡æ–¹æ³•takeè·å–ä»»åŠ¡ï¼ˆå› ä¸ºæ²¡æœ‰è¶…æ—¶é™åˆ¶ï¼Œæ‰€ä»¥ä¼šä¸€ç›´ç­‰å¾…ç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰ ä»»åŠ¡ï¼‰ï¼›å¦‚æœè®¾ç½®äº†è¶…æ—¶ï¼Œåˆ™ä¼šä½¿ç”¨pollæ–¹æ³•ï¼ˆæ–¹æ³•å…¥å‚éœ€è¦è¶…æ—¶æ—¶é—´ï¼‰ï¼Œè¶…æ—¶è¿˜æ²¡æ‹¿åˆ°ä»»åŠ¡çš„ è¯ï¼Œè¯¥å·¥ä½œçº¿ç¨‹å°±ä¼šè¢«å›æ”¶ã€‚</p>
<p> å¯¹äºéå·¥ä½œçº¿ç¨‹æ¥è¯´ï¼Œéƒ½æ˜¯è°ƒç”¨pollè·å–é˜Ÿåˆ—å…ƒç´ ï¼Œè¶…æ—¶å–ä¸åˆ°ä»»åŠ¡å°±ä¼šè¢«å›æ”¶ã€‚</p>
</li>
</ul>
<p>æ —å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledThreadPoolExecutorTest</span> </span>&#123; Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123; Â  </span><br><span class="line">        ScheduledThreadPoolExecutorTest.scheduleWithFixedDelay(); Â  Â  Â </span><br><span class="line">        ScheduledThreadPoolExecutorTest.scheduleAtFixedRate(); Â </span><br><span class="line">        ScheduledThreadPoolExecutorTest.scheduleCaller(); Â  Â  Â  </span><br><span class="line">        ScheduledThreadPoolExecutorTest.scheduleRunable();</span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="comment">// ä»»åŠ¡ä»¥å›ºå®šæ—¶é—´é—´éš”æ‰§è¡Œï¼Œå»¶è¿Ÿ5såå¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œä»»åŠ¡æ‰§è¡Œå®Œæ¯•åé—´éš”5så†æ¬¡æ‰§è¡Œï¼Œä¾æ¬¡å¾€ å¤ Â </span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scheduleWithFixedDelay</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123; Â  Â  Â </span><br><span class="line">        ScheduledExecutorService executorService = <span class="keyword">new</span> ScheduledThreadPoolExecutor(<span class="number">10</span>);</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â ScheduledFuture&lt;?&gt; result = executorService.scheduleWithFixedDelay(<span class="keyword">new</span> Runnable() &#123; Â  Â  Â  Â  Â </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                </span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â System.out.println(System.currentTimeMillis());</span><br><span class="line">                </span><br><span class="line"> Â  Â  Â  Â  Â   &#125; Â  Â  </span><br><span class="line">        &#125;, <span class="number">5000</span>, <span class="number">5000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line"> Â  Â  Â  Â <span class="comment">// ç”±äºæ˜¯å®šæ—¶ä»»åŠ¡ï¼Œä¸€ç›´ä¸ä¼šè¿”å› Â  </span></span><br><span class="line">        result.get(); Â  Â  </span><br><span class="line">        System.out.println(<span class="string">"over"</span>);</span><br><span class="line"> Â   &#125; Â  </span><br><span class="line">    <span class="comment">// ç›¸å¯¹å¼€å§‹åŠ å…¥ä»»åŠ¡çš„æ—¶é—´ç‚¹å›ºå®šé¢‘ç‡æ‰§è¡Œï¼šä»åŠ å…¥ä»»åŠ¡å¼€å§‹ç®—2såå¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œ2+5så¼€å§‹ æ‰§è¡Œï¼Œ2+2*5sæ‰§è¡Œï¼Œ2+n*5så¼€å§‹æ‰§è¡Œï¼› Â  Â </span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯å¦‚æœæ‰§è¡Œä»»åŠ¡æ—¶é—´å¤§äº5s,åˆ™ä¸ä¼šå¹¶å‘æ‰§è¡Œï¼Œåç»­ä»»åŠ¡å°†ä¼šå»¶è¿Ÿã€‚</span></span><br><span class="line">    </span><br><span class="line"> Â  Â <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scheduleAtFixedRate</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123; </span><br><span class="line">        ScheduledExecutorService executorService = <span class="keyword">new</span> ScheduledThreadPoolExecutor(<span class="number">10</span>);</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â ScheduledFuture&lt;?&gt; result = executorService.scheduleAtFixedRate(<span class="keyword">new</span> Runnable() &#123; </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                </span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â System.out.println(System.currentTimeMillis());</span><br><span class="line">                </span><br><span class="line"> Â  Â  Â  Â  Â   &#125; Â  Â </span><br><span class="line">        &#125;, <span class="number">2000</span>, <span class="number">5000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">        </span><br><span class="line"> Â  Â  Â  Â <span class="comment">// ç”±äºæ˜¯å®šæ—¶ä»»åŠ¡ï¼Œä¸€ç›´ä¸ä¼šè¿”å› </span></span><br><span class="line">        result.get(); Â  </span><br><span class="line">        System.out.println(<span class="string">"over"</span>); Â </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="comment">// å»¶è¿Ÿ2såå¼€å§‹æ‰§è¡Œï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼Œæ²¡æœ‰è¿”å›å€¼</span></span><br><span class="line">Â <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scheduleRunable</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123; Â  Â  Â  Â ScheduledExecutorService executorService = <span class="keyword">new</span> ScheduledThreadPoolExecutor(<span class="number">10</span>);</span><br><span class="line"> Â  Â  Â  Â ScheduledFuture&lt;?&gt; result = executorService.schedule(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="meta">@Override</span> Â  Â  Â  Â  Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â  Â  Â  Â  Â System.out.println(<span class="string">"gh"</span>); Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Thread.sleep(<span class="number">3000</span>); Â  Â  Â  Â  Â  Â  Â   &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="comment">// TODO Auto-generated catch block Â  Â  Â  Â  Â  Â  Â  Â  Â  Â e.printStackTrace(); Â  Â  Â  Â  Â  Â  Â   &#125;</span></span><br><span class="line"> Â  Â  Â  Â  Â   &#125; Â  Â  Â   &#125;, <span class="number">2000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line"> Â  Â  Â  Â System.out.println(result.get());</span><br><span class="line"> Â   &#125;</span><br><span class="line"> Â  Â <span class="comment">// å»¶è¿Ÿ2såå¼€å§‹æ‰§è¡Œï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼Œæœ‰è¿”å›å€¼ Â  </span></span><br><span class="line"> <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scheduleCaller</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123; Â </span><br><span class="line">     ScheduledExecutorService executorService = <span class="keyword">new</span> ScheduledThreadPoolExecutor(<span class="number">10</span>);</span><br><span class="line">     </span><br><span class="line"> Â  Â  Â  Â ScheduledFuture&lt;String&gt; result = executorService.schedule(<span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="meta">@Override</span> </span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                </span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â </span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>); Â  Â  Â  Â </span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  Â </span><br><span class="line">                    <span class="comment">// TODO Auto-generated catch block Â  Â </span></span><br><span class="line">                    e.printStackTrace(); Â  Â  Â </span><br><span class="line">                &#125;</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">return</span> <span class="string">"gh"</span>; Â  </span><br><span class="line">            &#125;</span><br><span class="line"> Â  Â  Â   &#125;, <span class="number">2000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">     </span><br><span class="line"> Â  Â  Â  Â <span class="comment">// é˜»å¡ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæˆ Â  Â </span></span><br><span class="line">     </span><br><span class="line">     	System.out.print(result.get());</span><br><span class="line">     </span><br><span class="line"> Â   &#125; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹ï¼ˆäºŒï¼‰</title>
    <url>/2021/01/08/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<h2 id="äºŒã€å¹¶å‘ç¼–ç¨‹åŸºç¡€"><a href="#äºŒã€å¹¶å‘ç¼–ç¨‹åŸºç¡€" class="headerlink" title="äºŒã€å¹¶å‘ç¼–ç¨‹åŸºç¡€"></a>äºŒã€å¹¶å‘ç¼–ç¨‹åŸºç¡€</h2><h4 id="2-1-ä¸´ç•Œèµ„æº"><a href="#2-1-ä¸´ç•Œèµ„æº" class="headerlink" title="2.1 ä¸´ç•Œèµ„æº"></a>2.1 ä¸´ç•Œèµ„æº</h4><p>ä¸´ç•Œèµ„æºæ˜¯ä¸€æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨çš„å…±äº«èµ„æºã€‚å„è¿›ç¨‹é‡‡å–äº’æ–¥çš„æ–¹å¼ï¼Œå®ç°å…±äº«çš„èµ„æºç§°ä½œä¸´ç•Œèµ„ æºã€‚å±äºä¸´ç•Œèµ„æºçš„ç¡¬ä»¶æœ‰ï¼Œæ‰“å°æœºï¼Œç£å¸¦æœºç­‰ï¼›è½¯ä»¶æœ‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå˜é‡ï¼Œæ•°ç»„ï¼Œç¼“å†²åŒºç­‰ã€‚è¯¸è¿›ç¨‹é—´ é‡‡å–äº’æ–¥æ–¹å¼ï¼Œå®ç°å¯¹è¿™ç§èµ„æºçš„å…±äº«ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line"> Â  Â  <span class="keyword">protected</span> <span class="keyword">long</span> count = <span class="number">0</span>;</span><br><span class="line"> Â  Â  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">long</span> value)</span></span>&#123; Â  Â  Â  Â  </span><br><span class="line">         <span class="keyword">this</span>.count = <span class="keyword">this</span>.count + value; Â  Â </span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-çº¿ç¨‹å®‰å…¨"><a href="#2-2-çº¿ç¨‹å®‰å…¨" class="headerlink" title="2.2 çº¿ç¨‹å®‰å…¨"></a>2.2 çº¿ç¨‹å®‰å…¨</h4><h5 id="2-2-1-åŸºæœ¬æ¦‚å¿µ"><a href="#2-2-1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="2.2.1 åŸºæœ¬æ¦‚å¿µ"></a>2.2.1 åŸºæœ¬æ¦‚å¿µ</h5><h6 id="ç«æ€æ¡ä»¶ï¼š"><a href="#ç«æ€æ¡ä»¶ï¼š" class="headerlink" title="ç«æ€æ¡ä»¶ï¼š"></a>ç«æ€æ¡ä»¶ï¼š</h6><p>å½“ä¸¤ä¸ªçº¿ç¨‹ç«äº‰åŒä¸€èµ„æºæ—¶ï¼Œå¦‚æœå¯¹èµ„æºçš„è®¿é—®é¡ºåºæ•æ„Ÿï¼Œå°±ç§°å­˜åœ¨ç«æ€æ¡ä»¶ã€‚<br>å¯¼è‡´ç«æ€æ¡ä»¶å‘ç”Ÿçš„ä»£ç åŒºç§°ä½œä¸´ç•ŒåŒºã€‚<br>åœ¨ä¸´ç•ŒåŒºä¸­ä½¿ç”¨é€‚å½“çš„åŒæ­¥å°±å¯ä»¥é¿å…ç«æ€æ¡ä»¶ï¼Œå¦‚ä½¿ç”¨synchronizedæˆ–è€…åŠ é”æœºåˆ¶ã€‚</p>
<h6 id="çº¿ç¨‹å®‰å…¨ï¼š"><a href="#çº¿ç¨‹å®‰å…¨ï¼š" class="headerlink" title="çº¿ç¨‹å®‰å…¨ï¼š"></a>çº¿ç¨‹å®‰å…¨ï¼š</h6><p>å…è®¸è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„ä»£ç ç§°ä½œçº¿ç¨‹å®‰å…¨çš„ä»£ç ã€‚çº¿ç¨‹å®‰å…¨çš„ä»£ç ä¸åŒ…å«ç«æ€æ¡ä»¶ã€‚</p>
<h5 id="2-2-2-å¯¹è±¡çš„å®‰å…¨"><a href="#2-2-2-å¯¹è±¡çš„å®‰å…¨" class="headerlink" title="2.2.2 å¯¹è±¡çš„å®‰å…¨"></a>2.2.2 å¯¹è±¡çš„å®‰å…¨</h5><h6 id="å±€éƒ¨åŸºæœ¬ç±»å‹å˜é‡"><a href="#å±€éƒ¨åŸºæœ¬ç±»å‹å˜é‡" class="headerlink" title="å±€éƒ¨åŸºæœ¬ç±»å‹å˜é‡"></a>å±€éƒ¨åŸºæœ¬ç±»å‹å˜é‡</h6><p>å±€éƒ¨å˜é‡å­˜å‚¨åœ¨çº¿ç¨‹è‡ªå·±çš„æ ˆä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå±€éƒ¨å˜é‡æ°¸è¿œä¹Ÿä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹å…±äº«ã€‚æ‰€ä»¥ï¼ŒåŸºç¡€ç±»å‹çš„å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯åŸºç¡€ç±»å‹çš„å±€éƒ¨å˜é‡çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[]args)</span></span>&#123; Â  Â  Â  Â </span><br><span class="line">        MyThread share = <span class="keyword">new</span> MyThread(); Â  Â  Â  Â </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">50</span>;i++)&#123; Â  Â  Â  Â  Â  </span><br><span class="line">            <span class="keyword">new</span> Thread(share,<span class="string">"çº¿ç¨‹"</span>+i).start(); Â  Â  Â   </span><br><span class="line">        &#125; Â   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">        <span class="keyword">int</span> a =<span class="number">0</span>; Â  Â  Â  Â </span><br><span class="line">        ++a;       		</span><br><span class="line">      System.out.println(Thread.currentThread().getName()+<span class="string">":"</span>+a); </span><br><span class="line">    &#125; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>æ— è®ºå¤šå°‘ä¸ªçº¿ç¨‹å¯¹run()æ–¹æ³•ä¸­çš„åŸºæœ¬ç±»å‹aæ‰§è¡Œ++aæ“ä½œï¼Œåªæ˜¯æ›´æ–°å½“å‰çº¿ç¨‹æ ˆçš„å€¼ï¼Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸å…±äº«æ•°æ®ï¼›</p>
<h6 id="å±€éƒ¨çš„å¯¹è±¡å¼•ç”¨"><a href="#å±€éƒ¨çš„å¯¹è±¡å¼•ç”¨" class="headerlink" title="å±€éƒ¨çš„å¯¹è±¡å¼•ç”¨"></a>å±€éƒ¨çš„å¯¹è±¡å¼•ç”¨</h6><p>å¯¹è±¡çš„å±€éƒ¨å¼•ç”¨å’ŒåŸºç¡€ç±»å‹çš„å±€éƒ¨å˜é‡ä¸å¤ªä¸€æ ·ï¼Œå°½ç®¡å¼•ç”¨æœ¬èº«æ²¡æœ‰è¢«å…±äº«ï¼Œä½†å¼•ç”¨æ‰€æŒ‡çš„å¯¹è±¡å¹¶æ²¡æœ‰ å­˜å‚¨åœ¨çº¿ç¨‹çš„æ ˆå†…ã€‚æ‰€æœ‰çš„å¯¹è±¡éƒ½å­˜åœ¨å…±äº«å †ä¸­ã€‚ å¦‚æœåœ¨æŸä¸ªæ–¹æ³•ä¸­åˆ›å»ºçš„å¯¹è±¡ä¸ä¼šé€ƒé€¸å‡ºï¼ˆå³è¯¥å¯¹è±¡ä¸ä¼šè¢«å…¶å®ƒæ–¹æ³•è·å¾—ï¼Œä¹Ÿä¸ä¼šè¢«éå±€éƒ¨å˜é‡å¼•ç”¨ åˆ°ï¼‰è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å®é™…ä¸Šï¼Œå“ªæ€•å°†è¿™ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ ç»™å…¶å®ƒæ–¹æ³•ï¼Œåªè¦åˆ«çš„çº¿ç¨‹è·å–ä¸åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œé‚£å®ƒä»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span></span>&#123; Â </span><br><span class="line">    LocalObject localObject = <span class="keyword">new</span> LocalObject();</span><br><span class="line">    localObject.callMethod();</span><br><span class="line">    method2(localObject); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">(LocalObject localObject)</span></span>&#123;</span><br><span class="line">    localObject.setValue(<span class="string">"value"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="å¯¹è±¡æˆå‘˜-æˆå‘˜å˜é‡"><a href="#å¯¹è±¡æˆå‘˜-æˆå‘˜å˜é‡" class="headerlink" title="å¯¹è±¡æˆå‘˜(æˆå‘˜å˜é‡)"></a>å¯¹è±¡æˆå‘˜(æˆå‘˜å˜é‡)</h6><p>å¯¹è±¡æˆå‘˜å­˜å‚¨åœ¨å †ä¸Šã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°åŒä¸€ä¸ªå¯¹è±¡çš„åŒä¸€ä¸ªæˆå‘˜ï¼Œé‚£è¿™ä¸ªä»£ç å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[]args)</span></span>&#123;</span><br><span class="line">        NotThreadSafe sharedInstance = <span class="keyword">new</span> NotThreadSafe();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable(sharedInstance)).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable(sharedInstance)).start();</span><br><span class="line">        </span><br><span class="line"> Â   &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">     NotThreadSafe instance = <span class="keyword">null</span>;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="title">MyRunnable</span><span class="params">(NotThreadSafe instance)</span></span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.instance = instance; Â   </span><br><span class="line">     &#125;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.instance.add(<span class="string">" "</span>+Thread.currentThread().getName());</span><br><span class="line">         System.out.println(<span class="keyword">this</span>.instance.builder.toString());</span><br><span class="line">     &#125; </span><br><span class="line"> &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotThreadSafe</span></span>&#123;</span><br><span class="line">     StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String text)</span></span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.builder.append(text); Â   </span><br><span class="line">    &#125; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨åŒä¸€ä¸ªNotThreadSafeå®ä¾‹ä¸Šçš„add()æ–¹æ³•ï¼Œå°±ä¼šæœ‰ç«æ€æ¡ä»¶é—®é¢˜ã€‚</p>
<h5 id="2-2-3-ä¸å¯å˜æ€§"><a href="#2-2-3-ä¸å¯å˜æ€§" class="headerlink" title="2.2.3 ä¸å¯å˜æ€§"></a>2.2.3 ä¸å¯å˜æ€§</h5><p>é€šè¿‡åˆ›å»ºä¸å¯å˜çš„å…±äº«å¯¹è±¡æ¥ä¿è¯å¯¹è±¡åœ¨çº¿ç¨‹é—´å…±äº«æ—¶ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä»è€Œå®ç°çº¿ç¨‹å®‰å…¨ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImmutableValue</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImmutableValue</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;    </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ImmutableValueç±»çš„æˆå‘˜å˜é‡ value æ˜¯é€šè¿‡æ„é€ å‡½æ•°èµ‹å€¼çš„ï¼Œå¹¶ä¸”åœ¨ç±»ä¸­æ²¡æœ‰setæ–¹æ³•ã€‚è¿™æ„å‘³ç€ä¸€æ—¦ImmutableValueå®ä¾‹è¢«åˆ›å»ºï¼Œvalue å˜é‡å°±ä¸èƒ½å†è¢«ä¿®æ”¹ï¼Œè¿™å°±æ˜¯ä¸å¯å˜æ€§ã€‚ä½†ä½ å¯ä»¥é€šè¿‡ getValue()æ–¹æ³•è¯»å–è¿™ä¸ªå˜é‡çš„å€¼ã€‚</p>
<h4 id="2-3-Javaå†…å­˜æ¨¡å‹"><a href="#2-3-Javaå†…å­˜æ¨¡å‹" class="headerlink" title="2.3 Javaå†…å­˜æ¨¡å‹"></a>2.3 Javaå†…å­˜æ¨¡å‹</h4><p><strong>Javaå†…å­˜æ¨¡å‹</strong>å³<strong>Java Memory Model</strong>ï¼Œç®€ç§°<strong>JMM</strong>ã€‚JMMå®šä¹‰äº†Java è™šæ‹Ÿæœº(JVM)åœ¨è®¡ç®—æœºå†…å­˜(RAM)ä¸­çš„å·¥ä½œæ–¹å¼ã€‚JVMæ˜¯æ•´ä¸ªè®¡ç®—æœºè™šæ‹Ÿæ¨¡å‹ï¼Œæ‰€ä»¥JMMæ˜¯éš¶å±äºJVMçš„ã€‚</p>
<h6 id="çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡"><a href="#çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡" class="headerlink" title="çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡"></a>çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡</h6><p>çº¿ç¨‹çš„é€šä¿¡æ˜¯æŒ‡çº¿ç¨‹ä¹‹é—´ä»¥ä½•ç§æœºåˆ¶æ¥äº¤æ¢ä¿¡æ¯ã€‚åœ¨å‘½ä»¤å¼ç¼–ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶æœ‰ä¸¤ç§å…±äº«å†… å­˜å’Œæ¶ˆæ¯ä¼ é€’ã€‚<br>åœ¨å…±äº«å†…å­˜çš„å¹¶å‘æ¨¡å‹é‡Œï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«ç¨‹åºçš„å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´é€šè¿‡å†™-è¯»å†…å­˜ä¸­çš„å…¬å…±çŠ¶æ€æ¥éš å¼è¿›è¡Œé€šä¿¡ï¼Œå…¸å‹çš„å…±äº«å†…å­˜é€šä¿¡æ–¹å¼å°±æ˜¯é€šè¿‡å…±äº«å¯¹è±¡è¿›è¡Œé€šä¿¡ã€‚<br>åœ¨æ¶ˆæ¯ä¼ é€’çš„å¹¶å‘æ¨¡å‹é‡Œï¼Œçº¿ç¨‹ä¹‹é—´æ²¡æœ‰å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´å¿…é¡»é€šè¿‡æ˜ç¡®çš„å‘é€æ¶ˆæ¯æ¥æ˜¾å¼è¿›è¡Œé€š ä¿¡ï¼Œåœ¨javaä¸­å…¸å‹çš„æ¶ˆæ¯ä¼ é€’æ–¹å¼å°±æ˜¯wait()å’Œnotify()ã€‚</p>
<h6 id="çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥"><a href="#çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥" class="headerlink" title="çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥"></a>çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥</h6><p>åŒæ­¥æ˜¯æŒ‡ç¨‹åºç”¨äºæ§åˆ¶ä¸åŒçº¿ç¨‹ä¹‹é—´æ“ä½œå‘ç”Ÿç›¸å¯¹é¡ºåºçš„æœºåˆ¶ã€‚<br>åœ¨å…±äº«å†…å­˜å¹¶å‘æ¨¡å‹é‡Œï¼ŒåŒæ­¥æ˜¯æ˜¾å¼è¿›è¡Œçš„ã€‚ç¨‹åºå‘˜å¿…é¡»æ˜¾å¼æŒ‡å®šæŸä¸ªæ–¹æ³•æˆ–æŸæ®µä»£ç éœ€è¦åœ¨çº¿ç¨‹ä¹‹é—´ äº’æ–¥æ‰§è¡Œã€‚<br>åœ¨æ¶ˆæ¯ä¼ é€’çš„å¹¶å‘æ¨¡å‹é‡Œï¼Œç”±äºæ¶ˆæ¯çš„å‘é€å¿…é¡»åœ¨æ¶ˆæ¯çš„æ¥æ”¶ä¹‹å‰ï¼Œå› æ­¤åŒæ­¥æ˜¯éšå¼è¿›è¡Œçš„ã€‚</p>
<h6 id="Javaçš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹"><a href="#Javaçš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹" class="headerlink" title="Javaçš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹"></a>Javaçš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹</h6><p>Javaçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ€»æ˜¯éšå¼è¿›è¡Œï¼Œæ•´ä¸ªé€šä¿¡è¿‡ç¨‹å¯¹ç¨‹åºå‘˜å®Œå…¨é€æ˜ã€‚å¦‚æœç¼–å†™å¤šçº¿ç¨‹ç¨‹åºçš„Javaç¨‹åºå‘˜ä¸ç†è§£éšå¼è¿›è¡Œçš„çº¿ç¨‹ä¹‹é—´é€šä¿¡çš„å·¥ä½œæœºåˆ¶ï¼Œå¾ˆå¯èƒ½ä¼šé‡åˆ°å„ç§å¥‡æ€ªçš„å†…å­˜å¯è§æ€§é—®é¢˜ã€‚</p>
<h6 id="Javaå†…å­˜æ¨¡å‹ç»“æ„"><a href="#Javaå†…å­˜æ¨¡å‹ç»“æ„" class="headerlink" title="Javaå†…å­˜æ¨¡å‹ç»“æ„"></a>Javaå†…å­˜æ¨¡å‹ç»“æ„</h6><p>Javaå†…å­˜æ¨¡å‹(ç®€ç§°JMM)ï¼ŒJMMå†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚ä»æŠ½è±¡çš„è§’åº¦ æ¥çœ‹ï¼ŒJMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼šçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆmain memoryï¼‰ ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼ˆlocal memoryï¼‰ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯»/å†™å…±äº«å˜é‡ çš„å‰¯æœ¬ã€‚æœ¬åœ°å†…å­˜æ˜¯JMMçš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚å®ƒæ¶µç›–äº†ç¼“å­˜ï¼Œå†™ç¼“å†²åŒºï¼Œå¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/08/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89/img1.png"  alt></p>
<p>ä»ä¸Šå›¾æ¥çœ‹ï¼Œçº¿ç¨‹Aä¸çº¿ç¨‹Bä¹‹é—´å¦‚è¦é€šä¿¡çš„è¯ï¼Œå¿…é¡»è¦ç»å†ä¸‹é¢2ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œçº¿ç¨‹AæŠŠæœ¬åœ°å†…å­˜Aä¸­æ›´æ–°è¿‡çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­å»ã€‚ </li>
<li>ç„¶åï¼Œçº¿ç¨‹Båˆ°ä¸»å†…å­˜ä¸­å»è¯»å–çº¿ç¨‹Aä¹‹å‰å·²æ›´æ–°è¿‡çš„å…±äº«å˜é‡ã€‚</li>
</ol>
<h4 id="2-4-CASä¹è§‚é”"><a href="#2-4-CASä¹è§‚é”" class="headerlink" title="2.4 CASä¹è§‚é”"></a>2.4 CASä¹è§‚é”</h4><p><strong>ä¹è§‚é”</strong>ï¼šä¸åŠ é”ï¼Œå‡è®¾æ²¡æœ‰å†²çªå»å®ŒæˆæŸé¡¹æ“ä½œï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚å…¶å®ç°æ–¹å¼æœ‰ä¸€ç§æ¯”è¾ƒå…¸å‹çš„å°±æ˜¯Compare and Swap( CAS )ã€‚<br>CASæœºåˆ¶å½“ä¸­ä½¿ç”¨äº†3ä¸ªåŸºæœ¬æ“ä½œæ•°ï¼šå†…å­˜åœ°å€Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚<br>æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œåªæœ‰å½“å˜é‡çš„é¢„æœŸå€¼Aå’Œå†…å­˜åœ°å€Vå½“ä¸­çš„å®é™…å€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šå°†å†…å­˜åœ°å€Vå¯¹åº” çš„å€¼ä¿®æ”¹ä¸ºBã€‚<br>ä»æ€æƒ³ä¸Šæ¥è¯´ï¼ŒSynchronizedå±äºæ‚²è§‚é”ï¼Œæ‚²è§‚åœ°è®¤ä¸ºç¨‹åºä¸­çš„å¹¶å‘æƒ…å†µä¸¥é‡ï¼Œæ‰€ä»¥ä¸¥é˜²æ­»å®ˆã€‚CASå± äºä¹è§‚é”ï¼Œä¹è§‚åœ°è®¤ä¸ºç¨‹åºä¸­çš„å¹¶å‘æƒ…å†µä¸é‚£ä¹ˆä¸¥é‡ï¼Œæ‰€ä»¥è®©çº¿ç¨‹ä¸æ–­å»å°è¯•æ›´æ–°ã€‚</p>
<p><strong>CASçš„ç¼ºç‚¹ï¼š</strong></p>
<ol>
<li>CPUå¼€é”€è¾ƒå¤§åœ¨å¹¶å‘é‡æ¯”è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè®¸å¤šçº¿ç¨‹åå¤å°è¯•æ›´æ–°æŸä¸€ä¸ªå˜é‡ï¼Œå´åˆä¸€ç›´æ›´æ–°ä¸æˆåŠŸï¼Œå¾ªç¯å¾€å¤ï¼Œä¼šç»™CPUå¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚</li>
<li>ä¸èƒ½ä¿è¯ä»£ç å—çš„åŸå­æ€§ CASæœºåˆ¶æ‰€ä¿è¯çš„åªæ˜¯ä¸€ä¸ªå˜é‡çš„åŸå­æ€§æ“ä½œï¼Œè€Œä¸èƒ½ä¿è¯æ•´ä¸ªä»£ç å—çš„åŸå­æ€§ã€‚æ¯”å¦‚éœ€è¦ä¿è¯3ä¸ªå˜é‡ å…±åŒè¿›è¡ŒåŸå­æ€§çš„æ›´æ–°ï¼Œå°±ä¸å¾—ä¸ä½¿ç”¨Synchronizedäº†ã€‚</li>
</ol>
<h4 id="2-5-Synchronizedå—"><a href="#2-5-Synchronizedå—" class="headerlink" title="2.5 Synchronizedå—"></a>2.5 Synchronizedå—</h4><p>Javaä¸­çš„åŒæ­¥å—ç”¨synchronizedæ ‡è®°ã€‚åŒæ­¥å—åœ¨Javaä¸­æ˜¯åŒæ­¥åœ¨æŸä¸ªå¯¹è±¡ä¸Šã€‚æ‰€æœ‰åŒæ­¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Š çš„åŒæ­¥å—åœ¨åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è¿›å…¥å¹¶æ‰§è¡Œæ“ä½œã€‚æ‰€æœ‰å…¶ä»–ç­‰å¾…è¿›å…¥è¯¥åŒæ­¥å—çš„çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°æ‰§ è¡Œè¯¥åŒæ­¥å—ä¸­çš„çº¿ç¨‹é€€å‡ºã€‚</p>
<h5 id="æœ‰å››ç§ä¸åŒçš„åŒæ­¥å—ï¼š"><a href="#æœ‰å››ç§ä¸åŒçš„åŒæ­¥å—ï¼š" class="headerlink" title="æœ‰å››ç§ä¸åŒçš„åŒæ­¥å—ï¼š"></a>æœ‰å››ç§ä¸åŒçš„åŒæ­¥å—ï¼š</h5><ul>
<li><p>å®ä¾‹æ–¹æ³• </p>
</li>
<li><p>é™æ€æ–¹æ³• </p>
</li>
<li><p>å®ä¾‹æ–¹æ³•ä¸­çš„åŒæ­¥å— </p>
</li>
<li><p>é™æ€æ–¹æ³•ä¸­çš„åŒæ­¥å—</p>
<p>ä¸Šè¿°åŒæ­¥å—éƒ½åŒæ­¥åœ¨ä¸åŒå¯¹è±¡ä¸Šã€‚å®é™…éœ€è¦é‚£ç§åŒæ­¥å—è§†å…·ä½“æƒ…å†µè€Œå®šã€‚</p>
</li>
</ul>
<blockquote>
<h6 id="å®ä¾‹æ–¹æ³•åŒæ­¥"><a href="#å®ä¾‹æ–¹æ³•åŒæ­¥" class="headerlink" title="å®ä¾‹æ–¹æ³•åŒæ­¥"></a>å®ä¾‹æ–¹æ³•åŒæ­¥</h6></blockquote>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŒæ­¥çš„å®ä¾‹æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.count += value; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åœ¨æ–¹æ³•å£°æ˜ä¸­åŒæ­¥ï¼ˆsynchronized ï¼‰å…³é”®å­—ã€‚<br>Javaå®ä¾‹æ–¹æ³•åŒæ­¥æ˜¯åŒæ­¥åœ¨æ‹¥æœ‰è¯¥æ–¹æ³•çš„å¯¹è±¡ä¸Šã€‚è¿™æ ·ï¼Œæ¯ä¸ªå®ä¾‹å…¶æ–¹æ³•åŒæ­¥éƒ½åŒæ­¥åœ¨ä¸åŒçš„å¯¹è±¡ä¸Šï¼Œ å³è¯¥æ–¹æ³•æ‰€å±çš„å®ä¾‹ã€‚åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿåœ¨å®ä¾‹æ–¹æ³•åŒæ­¥å—ä¸­è¿è¡Œã€‚å¦‚æœæœ‰å¤šä¸ªå®ä¾‹å­˜åœ¨ï¼Œé‚£ä¹ˆä¸€ä¸ªçº¿ ç¨‹ä¸€æ¬¡å¯ä»¥åœ¨ä¸€ä¸ªå®ä¾‹åŒæ­¥å—ä¸­æ‰§è¡Œæ“ä½œã€‚</p>
<blockquote>
<h6 id="é™æ€æ–¹æ³•åŒæ­¥"><a href="#é™æ€æ–¹æ³•åŒæ­¥" class="headerlink" title="é™æ€æ–¹æ³•åŒæ­¥"></a>é™æ€æ–¹æ³•åŒæ­¥</h6></blockquote>
<p>é™æ€æ–¹æ³•åŒæ­¥å’Œå®ä¾‹æ–¹æ³•åŒæ­¥æ–¹æ³•ä¸€æ ·ï¼Œä¹Ÿä½¿ç”¨synchronized å…³é”®å­—ã€‚Javaé™æ€æ–¹æ³•åŒæ­¥å¦‚ä¸‹ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123; </span><br><span class="line">    count += value; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œè¿™é‡Œsynchronized å…³é”®å­—å‘Šè¯‰Javaè¿™ä¸ªæ–¹æ³•æ˜¯åŒæ­¥çš„ã€‚<br>é™æ€æ–¹æ³•çš„åŒæ­¥æ˜¯æŒ‡åŒæ­¥åœ¨è¯¥æ–¹æ³•æ‰€åœ¨çš„ç±»å¯¹è±¡ä¸Šã€‚å› ä¸ºåœ¨Javaè™šæ‹Ÿæœºä¸­ä¸€ä¸ªç±»åªèƒ½å¯¹åº”ä¸€ä¸ªç±»å¯¹è±¡ï¼Œ æ‰€ä»¥åŒæ—¶åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒä¸€ä¸ªç±»ä¸­çš„é™æ€åŒæ­¥æ–¹æ³•ã€‚<br>å¯¹äºä¸åŒç±»ä¸­çš„é™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œæ¯ä¸ªç±»ä¸­çš„é™æ€åŒæ­¥æ–¹æ³•è€Œæ— éœ€ç­‰å¾…ã€‚ä¸ç®¡ç±»ä¸­çš„é‚£ ä¸ªé™æ€åŒæ­¥æ–¹æ³•è¢«è°ƒç”¨ï¼Œä¸€ä¸ªç±»åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚</p>
<blockquote>
<h6 id="å®ä¾‹æ–¹æ³•ä¸­çš„åŒæ­¥å—"><a href="#å®ä¾‹æ–¹æ³•ä¸­çš„åŒæ­¥å—" class="headerlink" title="å®ä¾‹æ–¹æ³•ä¸­çš„åŒæ­¥å—"></a>å®ä¾‹æ–¹æ³•ä¸­çš„åŒæ­¥å—</h6></blockquote>
<p>æœ‰æ—¶ä½ ä¸éœ€è¦åŒæ­¥æ•´ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯åŒæ­¥æ–¹æ³•ä¸­çš„ä¸€éƒ¨åˆ†ã€‚Javaå¯ä»¥å¯¹æ–¹æ³•çš„ä¸€éƒ¨åˆ†è¿›è¡ŒåŒæ­¥ã€‚<br>åœ¨éåŒæ­¥çš„Javaæ–¹æ³•ä¸­çš„åŒæ­¥å—çš„ä¾‹å­å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>.count += value; Â   </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ä½¿ç”¨JavaåŒæ­¥å—æ„é€ å™¨æ¥æ ‡è®°ä¸€å—ä»£ç æ˜¯åŒæ­¥çš„ã€‚è¯¥ä»£ç åœ¨æ‰§è¡Œæ—¶å’ŒåŒæ­¥æ–¹æ³•ä¸€æ ·ã€‚<br>æ³¨æ„JavaåŒæ­¥å—æ„é€ å™¨ç”¨æ‹¬å·å°†å¯¹è±¡æ‹¬èµ·æ¥ã€‚åœ¨ä¸Šä¾‹ä¸­ï¼Œä½¿ç”¨äº†â€œthisâ€ï¼Œå³ä¸ºè°ƒç”¨addæ–¹æ³•çš„å®ä¾‹æœ¬ èº«ã€‚åœ¨åŒæ­¥æ„é€ å™¨ä¸­ç”¨æ‹¬å·æ‹¬èµ·æ¥çš„å¯¹è±¡å«åšç›‘è§†å™¨å¯¹è±¡ã€‚ä¸Šè¿°ä»£ç ä½¿ç”¨ç›‘è§†å™¨å¯¹è±¡åŒæ­¥ï¼ŒåŒæ­¥å®ä¾‹æ–¹æ³•ä½¿ç”¨è°ƒç”¨æ–¹æ³•æœ¬èº«çš„å®ä¾‹ä½œä¸ºç›‘è§†å™¨å¯¹è±¡ã€‚<br>ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿåœ¨åŒæ­¥äºåŒä¸€ä¸ªç›‘è§†å™¨å¯¹è±¡çš„Javaæ–¹æ³•å†…æ‰§è¡Œã€‚<br>ä¸‹é¢ä¸¤ä¸ªä¾‹å­éƒ½åŒæ­¥ä»–ä»¬æ‰€è°ƒç”¨çš„å®ä¾‹å¯¹è±¡ä¸Šï¼Œå› æ­¤ä»–ä»¬åœ¨åŒæ­¥çš„æ‰§è¡Œæ•ˆæœä¸Šæ˜¯ç­‰æ•ˆçš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">log1</span><span class="params">(String msg1, String msg2)</span></span>&#123;</span><br><span class="line">       log.writeln(msg1); Â  Â  Â  </span><br><span class="line">       log.writeln(msg2); Â   </span><br><span class="line">   &#125;</span><br><span class="line">Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log2</span><span class="params">(String msg1, String msg2)</span></span>&#123; Â  Â  Â  </span><br><span class="line">       <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123; Â  Â  Â  Â  Â </span><br><span class="line">           log.writeln(msg1); Â  Â  Â  Â  Â </span><br><span class="line">           log.writeln(msg2); Â  Â  Â  </span><br><span class="line">       &#125; Â   </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šä¾‹ä¸­ï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿåœ¨ä¸¤ä¸ªåŒæ­¥å—ä¸­ä»»æ„ä¸€ä¸ªæ–¹æ³•å†…æ‰§è¡Œã€‚<br>å¦‚æœç¬¬äºŒä¸ªåŒæ­¥å—ä¸æ˜¯åŒæ­¥åœ¨thiså®ä¾‹å¯¹è±¡ä¸Šï¼Œé‚£ä¹ˆä¸¤ä¸ªæ–¹æ³•å¯ä»¥è¢«çº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚</p>
<blockquote>
<h6 id="é™æ€æ–¹æ³•ä¸­çš„åŒæ­¥å—"><a href="#é™æ€æ–¹æ³•ä¸­çš„åŒæ­¥å—" class="headerlink" title="é™æ€æ–¹æ³•ä¸­çš„åŒæ­¥å—"></a>é™æ€æ–¹æ³•ä¸­çš„åŒæ­¥å—</h6></blockquote>
<p>å’Œä¸Šé¢ç±»ä¼¼ï¼Œä¸‹é¢æ˜¯ä¸¤ä¸ªé™æ€æ–¹æ³•åŒæ­¥çš„ä¾‹å­ã€‚è¿™äº›æ–¹æ³•åŒæ­¥åœ¨è¯¥æ–¹æ³•æ‰€å±çš„ç±»å¯¹è±¡ä¸Šã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123; Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">log1</span><span class="params">(String msg1, String msg2)</span></span>&#123;</span><br><span class="line">        log.writeln(msg1); Â  Â  Â  </span><br><span class="line">        log.writeln(msg2); Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">log2</span><span class="params">(String msg1, String msg2)</span></span>&#123; Â  Â  Â  </span><br><span class="line">        <span class="keyword">synchronized</span>(MyClass<span class="class">.<span class="keyword">class</span>)</span>&#123; Â  Â  Â  Â  Â </span><br><span class="line">            log.writeln(msg1); Â  Â  Â  Â  Â </span><br><span class="line">            log.writeln(msg2); Â  Â  Â  </span><br><span class="line">        &#125; Â   </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ä¸ªæ–¹æ³•ä¸å…è®¸åŒæ—¶è¢«çº¿ç¨‹è®¿é—®ã€‚<br>å¦‚æœç¬¬äºŒä¸ªåŒæ­¥å—ä¸æ˜¯åŒæ­¥åœ¨MyClass.classè¿™ä¸ªå¯¹è±¡ä¸Šã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥åŒæ—¶è¢«çº¿ç¨‹è®¿é—®ã€‚</p>
<h5 id="Synchronizedé”çš„å­˜å‚¨"><a href="#Synchronizedé”çš„å­˜å‚¨" class="headerlink" title="Synchronizedé”çš„å­˜å‚¨"></a>Synchronizedé”çš„å­˜å‚¨</h5><p>synchronizedç”¨çš„é”å­˜å‚¨åœ¨Javaå¯¹è±¡å¤´ï¼Œå¦‚æœå¯¹è±¡æ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™è™šæ‹Ÿæœºç”¨3ä¸ªå­—å®½å­˜å‚¨å¯¹è±¡å¤´ï¼Œå¦‚æœ å¯¹è±¡æ˜¯éæ•°ç»„ç±»å‹ï¼Œåˆ™ç”¨2å­—å®½å­˜å‚¨å¯¹è±¡å¤´ï¼Œ32ä½è™šæ‹Ÿæœºï¼Œ1å­—å®½ç­‰äº4å­—èŠ‚ï¼Œå³32ä½.</p>
<h6 id="Javaå¯¹è±¡å¤´çš„é•¿åº¦"><a href="#Javaå¯¹è±¡å¤´çš„é•¿åº¦" class="headerlink" title="Javaå¯¹è±¡å¤´çš„é•¿åº¦"></a>Javaå¯¹è±¡å¤´çš„é•¿åº¦</h6><p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/08/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89/img2.jpg"  alt></p>
<h6 id="Mark-Wordçš„å­˜å‚¨ç»“æ„"><a href="#Mark-Wordçš„å­˜å‚¨ç»“æ„" class="headerlink" title="Mark Wordçš„å­˜å‚¨ç»“æ„"></a>Mark Wordçš„å­˜å‚¨ç»“æ„</h6><p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/08/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89/img3.jpg"  alt></p>
<h6 id="Mark-Wordå¯èƒ½çš„å­˜å‚¨ç»“æœï¼š"><a href="#Mark-Wordå¯èƒ½çš„å­˜å‚¨ç»“æœï¼š" class="headerlink" title="Mark Wordå¯èƒ½çš„å­˜å‚¨ç»“æœï¼š"></a>Mark Wordå¯èƒ½çš„å­˜å‚¨ç»“æœï¼š</h6><p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/08/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89/img4.jpg"  alt></p>
<h5 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h5><p>åå‘é”çš„è·å–æµç¨‹ï¼š<br> ï¼ˆ1ï¼‰æŸ¥çœ‹Mark Wordä¸­åå‘é”çš„æ ‡è¯†ä»¥åŠé”æ ‡å¿—ä½ï¼Œè‹¥æ˜¯å¦åå‘é”ä¸º1ä¸”é”æ ‡å¿—ä½ä¸º01ï¼Œåˆ™è¯¥é”ä¸ºå¯åå‘çŠ¶æ€ã€‚<br> ï¼ˆ2ï¼‰è‹¥ä¸ºå¯åå‘çŠ¶æ€ï¼Œåˆ™æµ‹è¯•Mark Wordä¸­çš„çº¿ç¨‹IDæ˜¯å¦ä¸å½“å‰çº¿ç¨‹ç›¸åŒï¼Œè‹¥ç›¸åŒï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”ï¼Œå¦‚æœä¸åŒï¼Œåˆ™è¿›å…¥ï¼ˆ3ï¼‰<br> ï¼ˆ3ï¼‰æµ‹è¯•Mark Wordçš„åå‘é”çš„æ ‡è¯†æ˜¯å¦è®¾ç½®ä¸º1ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨CASæ“ä½œç«äº‰é”ï¼Œå¦‚ä½•è®¾ç½® äº†ï¼Œåˆ™å°è¯•ä½¿ç”¨CASå°è¯•å°†Mark Wordä¸­çº¿ç¨‹IDè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹IDï¼Œå¦‚æœå°è¯•å¤±è´¥ï¼Œåˆ™æ‰§è¡Œï¼ˆ4ï¼‰<br> ï¼ˆ4ï¼‰å½“å‰çº¿ç¨‹é€šè¿‡CASç«äº‰é”å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œè¯´æ˜æœ‰ç«äº‰ã€‚å½“åˆ°è¾¾å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œæ²¡æœ‰ æ­£åœ¨æ‰§è¡Œçš„ä»£ç ï¼‰æ—¶ä¹‹å‰è·å¾—åå‘é”çš„çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œåå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œç„¶åè¢«é˜»å¡åœ¨å®‰å…¨ç‚¹çš„çº¿ ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡ŒåŒæ­¥ä»£ç ã€‚</p>
<h5 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h5><p>è½»é‡çº§é”ä¸æ˜¯ç”¨æ¥æ›¿ä»£ä¼ ç»Ÿçš„é‡é‡çº§é”çš„ï¼Œè€Œæ˜¯åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨è½»é‡çº§é”èƒ½å¤Ÿå‡å°‘æ€§ èƒ½æ¶ˆè€—ï¼Œä½†æ˜¯å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ç«äº‰é”æ—¶ï¼Œè½»é‡çº§é”ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚<br>è½»é‡çº§é”çš„åŠ é”è¿‡ç¨‹ï¼š<br>ï¼ˆ1ï¼‰å½“çº¿ç¨‹æ‰§è¡Œä»£ç è¿›å…¥åŒæ­¥å—æ—¶ï¼Œè‹¥Mark Wordä¸ºæ— é”çŠ¶æ€ï¼Œè™šæ‹Ÿæœºå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ ä¸ªåä¸ºLock Recordçš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨å½“å‰å¯¹è±¡çš„Mark Wordçš„æ‹·è´ï¼Œå®˜æ–¹ç§°ä¹‹ä¸ºâ€œDispalced Mark Wordâ€ï¼Œæ­¤æ—¶çŠ¶æ€å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/08/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89/img5.jpg"  alt></p>
<p>ï¼ˆ2ï¼‰å¤åˆ¶å¯¹è±¡å¤´ä¸­çš„Mark Wordåˆ°é”è®°å½•ä¸­ã€‚<br>ï¼ˆ3ï¼‰å¤åˆ¶æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ç”¨CASæ“ä½œå°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæ‰§è¡ŒLock  Recordçš„æŒ‡é’ˆï¼Œå¹¶å°† Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™æ‰§è¡Œ4ï¼Œå¦åˆ™æ‰§è¡Œ5ã€‚ï¼›<br>ï¼ˆ4ï¼‰å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™è¿™ä¸ªçº¿ç¨‹æ‹¥æœ‰äº†è¿™ä¸ªé”ï¼Œå¹¶å°†é”æ ‡å¿—è®¾ä¸º00ï¼Œè¡¨ç¤ºå¤„äºè½»é‡çº§é”çŠ¶æ€ï¼Œæ­¤æ—¶çŠ¶æ€å›¾ï¼š</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/08/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89/img6.jpg"  alt></p>
<p>ï¼ˆ5ï¼‰å¦‚æœæ›´æ–°å¤±è´¥ï¼Œåˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿é€šè¿‡è‡ªæ—‹æ¥è·å–é”ã€‚è½»é‡çº§é”å°±ä¼šè†¨èƒ€ä¸º é‡é‡çº§é”ï¼ŒMark Wordä¸­å­˜å‚¨é‡é‡çº§é”ï¼ˆäº’æ–¥é”ï¼‰çš„æŒ‡é’ˆï¼Œåé¢ç­‰å¾…é”çš„çº¿ç¨‹ä¹Ÿè¦è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p>
<h5 id="é‡é‡çº§é”"><a href="#é‡é‡çº§é”" class="headerlink" title="é‡é‡çº§é”"></a>é‡é‡çº§é”</h5><p>å³å½“æœ‰å…¶ä»–çº¿ç¨‹å ç”¨é”æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p>
<h4 id="2-6-å…³é”®å­—Volatile"><a href="#2-6-å…³é”®å­—Volatile" class="headerlink" title="2.6 å…³é”®å­—Volatile"></a>2.6 å…³é”®å­—Volatile</h4><p>Volatileæ˜¯è½»é‡çº§çš„synchronized,åœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ä¿è¯å…±äº«å˜é‡çš„å¯è§æ€§ã€‚å®ƒä¸ä¼šå¼•èµ·çº¿ ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œè°ƒåº¦ï¼Œæ­£ç¡®çš„ä½¿ç”¨Volatile,æ¯”synchronizedçš„ä½¿ç”¨å’Œæ‰§è¡Œæˆæœ¬æ›´ä½ã€‚</p>
<h5 id="å¯è§æ€§ï¼š"><a href="#å¯è§æ€§ï¼š" class="headerlink" title="å¯è§æ€§ï¼š"></a>å¯è§æ€§ï¼š</h5><p>å¯è§æ€§ï¼Œæ˜¯æŒ‡çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹çš„çŠ¶æ€å¯¹å¦ä¸€ä¸ªçº¿ç¨‹æ˜¯å¯è§çš„ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ä¸€ ä¸ªå…±äº«å˜é‡æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹é©¬ä¸Šå°±èƒ½çœ‹åˆ°ã€‚æ¯”å¦‚ï¼šç”¨volatileä¿®é¥°çš„å˜é‡ï¼Œå°±ä¼šå…·æœ‰å¯è§æ€§ã€‚</p>
<p>volatileä¿®é¥°çš„å˜é‡ä¸å…è®¸çº¿ç¨‹å†…éƒ¨ç¼“å­˜å’Œé‡æ’åºï¼Œå³ç›´æ¥ä¿®æ”¹å†…å­˜ã€‚æ‰€ä»¥å¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ã€‚ä½† æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œvolatileåªèƒ½è®©è¢«ä»–ä¿®é¥°å†…å®¹å…·æœ‰å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯å®ƒå…·æœ‰åŸå­æ€§ã€‚æ¯” å¦‚ volatile int a = 0ï¼›ä¹‹åæœ‰ä¸€ä¸ªæ“ä½œ a++ï¼›è¿™ä¸ªå˜é‡aå…·æœ‰å¯è§æ€§ï¼Œä½†æ˜¯a++ ä¾ç„¶æ˜¯ä¸€ä¸ªéåŸ å­æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ“ä½œåŒæ ·å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚<br>ã€€ã€€åœ¨ Java ä¸­ volatileã€synchronized å’Œ final å®ç°å¯è§æ€§ã€‚</p>
<h5 id="åŸå­æ€§ï¼š"><a href="#åŸå­æ€§ï¼š" class="headerlink" title="åŸå­æ€§ï¼š"></a>åŸå­æ€§ï¼š</h5><p>ã€€ã€€å­æ˜¯ä¸–ç•Œä¸Šçš„å°å•ä½ï¼Œå…·æœ‰ä¸å¯åˆ†å‰²æ€§ã€‚æ¯”å¦‚ a=0ï¼›ï¼ˆaélongå’Œdoubleç±»å‹ï¼‰ è¿™ä¸ªæ“ä½œæ˜¯ä¸ å¯åˆ†å‰²çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´è¿™ä¸ªæ“ä½œæ—¶åŸå­æ“ä½œã€‚å†æ¯”å¦‚ï¼ša++ï¼› è¿™ä¸ªæ“ä½œå®é™…æ˜¯a = a + 1ï¼›æ˜¯å¯åˆ†å‰² çš„ï¼Œæ‰€ä»¥ä»–ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚éåŸå­æ“ä½œéƒ½ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œéœ€è¦æˆ‘ä»¬ä½¿ç”¨åŒæ­¥æŠ€æœ¯ ï¼ˆsychronizedï¼‰æ¥è®©å®ƒå˜æˆä¸€ä¸ªåŸå­æ“ä½œã€‚ä¸€ä¸ªæ“ä½œæ˜¯åŸå­æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°å®ƒå…·æœ‰åŸå­æ€§ã€‚javaçš„ concurrentåŒ…ä¸‹æä¾›äº†ä¸€äº›åŸå­ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é˜…è¯»APIæ¥äº†è§£è¿™äº›åŸå­ç±»çš„ç”¨æ³•ã€‚æ¯”å¦‚ï¼š AtomicIntegerã€AtomicLongã€AtomicReferenceç­‰ã€‚<br>ã€€ã€€åœ¨ Java ä¸­ synchronized å’Œåœ¨ lockã€unlock ä¸­æ“ä½œä¿è¯åŸå­æ€§ã€‚</p>
<h5 id="æœ‰åºæ€§ï¼š"><a href="#æœ‰åºæ€§ï¼š" class="headerlink" title="æœ‰åºæ€§ï¼š"></a>æœ‰åºæ€§ï¼š</h5><p>ã€€ã€€Java è¯­è¨€æä¾›äº† volatile å’Œ synchronized ä¸¤ä¸ªå…³é”®å­—æ¥ä¿è¯çº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ï¼Œ volatile æ˜¯å› ä¸ºå…¶æœ¬èº«åŒ…å«â€œç¦æ­¢æŒ‡ä»¤é‡æ’åºâ€çš„è¯­ä¹‰ï¼Œsynchronized æ˜¯ç”±â€œä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶ åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œ lock æ“ä½œâ€è¿™æ¡è§„åˆ™è·å¾—çš„ï¼Œæ­¤è§„åˆ™å†³å®šäº†æŒæœ‰åŒä¸€ä¸ªå¯¹è±¡é”çš„ä¸¤ä¸ªåŒæ­¥ å—åªèƒ½ä¸²è¡Œæ‰§è¡Œã€‚<br>ã€€Javaè¯­è¨€æä¾›äº†ä¸€ç§ç¨å¼±çš„åŒæ­¥æœºåˆ¶ï¼Œå³volatileå˜é‡ï¼Œç”¨æ¥ç¡®ä¿å°†å˜é‡çš„æ›´æ–°æ“ä½œé€šçŸ¥åˆ°å…¶ä»–çº¿ ç¨‹ã€‚å½“æŠŠå˜é‡å£°æ˜ä¸ºvolatileç±»å‹åï¼Œç¼–è¯‘å™¨ä¸è¿è¡Œæ—¶éƒ½ä¼šæ³¨æ„åˆ°è¿™ä¸ªå˜é‡æ˜¯å…±äº«çš„ï¼Œå› æ­¤ä¸ä¼šå°†è¯¥ å˜é‡ä¸Šçš„æ“ä½œä¸å…¶ä»–å†…å­˜æ“ä½œä¸€èµ·é‡æ’åºã€‚volatileå˜é‡ä¸ä¼šè¢«ç¼“å­˜åœ¨å¯„å­˜å™¨æˆ–è€…å¯¹å…¶ä»–å¤„ç†å™¨ä¸å¯ è§çš„åœ°æ–¹ï¼Œå› æ­¤åœ¨è¯»å–volatileç±»å‹çš„å˜é‡æ—¶æ€»ä¼šè¿”å›æ–°å†™å…¥çš„å€¼ã€‚<br>ã€€ã€€åœ¨è®¿é—®volatileå˜é‡æ—¶ä¸ä¼šæ‰§è¡ŒåŠ é”æ“ä½œï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šä½¿æ‰§è¡Œçº¿ç¨‹é˜»å¡ï¼Œå› æ­¤volatileå˜é‡æ˜¯ ä¸€ç§æ¯”sychronizedå…³é”®å­—æ›´è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚<br>å½“ä¸€ä¸ªå˜é‡å®šä¹‰ä¸º volatile ä¹‹åï¼Œå°†å…·å¤‡ä¸¤ç§ç‰¹æ€§ï¼š<br>ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çš„çº¿ç¨‹çš„å¯è§æ€§ï¼Œè¿™é‡Œçš„â€œå¯è§æ€§â€ï¼Œå¦‚æœ¬æ–‡å¼€å¤´æ‰€è¿°ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ª å˜é‡çš„å€¼ï¼Œvolatile ä¿è¯äº†æ–°å€¼èƒ½ç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œä»¥åŠæ¯æ¬¡ä½¿ç”¨å‰ç«‹å³ä»ä¸»å†…å­˜åˆ·æ–°ã€‚ä½†æ™® é€šå˜é‡åšä¸åˆ°è¿™ç‚¹ï¼Œæ™®é€šå˜é‡çš„å€¼åœ¨çº¿ç¨‹é—´ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚ ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚æœ‰volatileä¿®é¥°çš„å˜é‡ï¼Œèµ‹å€¼åå¤šæ‰§è¡Œäº†ä¸€ä¸ªâ€œload addl $0x0, (%esp)â€æ“ä½œï¼Œè¿™ä¸ªæ“ä½œç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœï¼ˆæŒ‡ä»¤é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å± éšœä¹‹å‰çš„ä½ç½®ï¼‰ï¼Œåªæœ‰ä¸€ä¸ªCPUè®¿é—®å†…å­˜æ—¶ï¼Œå¹¶ä¸éœ€è¦å†…å­˜å±éšœï¼›ï¼ˆä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’åºï¼šæ˜¯æŒ‡CPU é‡‡ç”¨äº†å…è®¸å°†å¤šæ¡æŒ‡ä»¤ä¸æŒ‰ç¨‹åºè§„å®šçš„é¡ºåºåˆ†å¼€å‘é€ç»™å„ç›¸åº”ç”µè·¯å•å…ƒå¤„ç†ã€‚</p>
<h4 id="2-7-æœ¬åœ°çº¿ç¨‹"><a href="#2-7-æœ¬åœ°çº¿ç¨‹" class="headerlink" title="2.7 æœ¬åœ°çº¿ç¨‹"></a>2.7 æœ¬åœ°çº¿ç¨‹</h4><p>Javaä¸­çš„ThreadLocalç±»å…è®¸æˆ‘ä»¬åˆ›å»ºåªèƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹è¯»å†™çš„å˜é‡ã€‚å› æ­¤ï¼Œå¦‚æœä¸€æ®µä»£ç å«æœ‰ä¸€ä¸ª ThreadLocalå˜é‡çš„å¼•ç”¨ï¼Œå³ä½¿ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¿™æ®µä»£ç ï¼Œå®ƒä»¬ä¹Ÿæ— æ³•è®¿é—®åˆ°å¯¹æ–¹çš„ThreadLocalå˜ é‡ã€‚<br>å¦‚ä½•åˆ›å»ºThreadLocalå˜é‡<br>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªThreadLocalå˜é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> ThreadLocal myThreadLocal = <span class="keyword">new</span> ThreadLocal();</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡è¿™æ®µä»£ç å®ä¾‹åŒ–äº†ä¸€ä¸ªThreadLocalå¯¹è±¡ã€‚æˆ‘ä»¬åªéœ€è¦å®ä¾‹åŒ–å¯¹è±¡ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¹Ÿä¸éœ€è¦çŸ¥é“å®ƒæ˜¯è¢«å“ªä¸ªçº¿ç¨‹å®ä¾‹åŒ–ã€‚è™½ç„¶æ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®åˆ°è¿™ä¸ªThreadLocalå®ä¾‹ï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹å´ åªèƒ½è®¿é—®åˆ°è‡ªå·±é€šè¿‡è°ƒç”¨ThreadLocalçš„set()æ–¹æ³•è®¾ç½®çš„å€¼ã€‚å³ä½¿æ˜¯ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹åœ¨åŒä¸€ä¸ª ThreadLocalå¯¹è±¡ä¸Šè®¾ç½®äº†ä¸åŒçš„å€¼ï¼Œä»–ä»¬ä»ç„¶æ— æ³•è®¿é—®åˆ°å¯¹æ–¹çš„å€¼ã€‚<br>å¦‚ä½•è®¿é—®ThreadLocalå˜é‡<br>ä¸€æ—¦åˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è®¾ç½®æŸä¸ªéœ€è¦ä¿å­˜çš„å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">myThreadLocal.set(<span class="string">"A thread local valueâ€);</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡ä¸‹é¢æ–¹æ³•è¯»å–ä¿å­˜åœ¨ThreadLocalå˜é‡ä¸­çš„å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String threadLocalValue = (String) myThreadLocal.get();</span><br></pre></td></tr></table></figure>

<p>ThreadLocalä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalExample</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">private</span> ThreadLocal threadLocal = <span class="keyword">new</span> ThreadLocal();</span><br><span class="line"> Â  Â  Â  Â <span class="meta">@Override</span> Â  Â  Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            threadLocal.set((<span class="keyword">int</span>) (Math.random() * <span class="number">100</span>D)); Â  Â  Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">                Thread.sleep(<span class="number">2000</span>); Â  Â  Â  Â  Â   </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                </span><br><span class="line"> Â  Â  Â  Â  Â   &#125; Â  Â  Â  Â  Â  Â </span><br><span class="line">            System.out.println(threadLocal.get()); Â  Â  Â   </span><br><span class="line">        &#125; Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; Â  Â  Â  Â  </span><br><span class="line">        MyRunnable sharedRunnableInstance = <span class="keyword">new</span> MyRunnable();</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(sharedRunnableInstance);</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(sharedRunnableInstance);</span><br><span class="line">        thread1.start(); Â  Â  Â  Â  </span><br><span class="line">        thread2.start(); Â   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­åˆ›å»ºäº†ä¸€ä¸ªMyRunnableå®ä¾‹ï¼Œå¹¶å°†è¯¥å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸¤ä¸ªçº¿ç¨‹ã€‚ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰§è¡Œ run()æ–¹æ³•ï¼Œå¹¶ä¸”éƒ½åœ¨ThreadLocalå®ä¾‹ä¸Šä¿å­˜äº†ä¸åŒçš„å€¼ã€‚å¦‚æœå®ƒä»¬è®¿é—®çš„ä¸æ˜¯ThreadLocalå¯¹è±¡å¹¶ ä¸”è°ƒç”¨çš„set()æ–¹æ³•è¢«åŒæ­¥äº†ï¼Œåˆ™ç¬¬äºŒä¸ªçº¿ç¨‹ä¼šè¦†ç›–æ‰ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¾ç½®çš„å€¼ã€‚ä½†æ˜¯ï¼Œç”±äºå®ƒä»¬è®¿é—®çš„æ˜¯ ä¸€ä¸ªThreadLocalå¯¹è±¡ï¼Œå› æ­¤è¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½æ— æ³•çœ‹åˆ°å¯¹æ–¹ä¿å­˜çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬å­˜å–çš„æ˜¯ä¸¤ä¸ªä¸åŒ çš„å€¼ã€‚<br>å…³äºInheritableThreadLocal<br>InheritableThreadLocalç±»æ˜¯ThreadLocalç±»çš„å­ç±»ã€‚ThreadLocalä¸­æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰å®ƒè‡ªå·±çš„å€¼ï¼Œä¸ ThreadLocalä¸åŒçš„æ˜¯ï¼ŒInheritableThreadLocalå…è®¸ä¸€ä¸ªçº¿ç¨‹ä»¥åŠè¯¥çº¿ç¨‹åˆ›å»ºçš„æ‰€æœ‰å­çº¿ç¨‹éƒ½å¯ä»¥ è®¿é—®å®ƒä¿å­˜çš„å€¼ã€‚</p>
<h4 id="2-8ã€å¤šçº¿ç¨‹é—®é¢˜"><a href="#2-8ã€å¤šçº¿ç¨‹é—®é¢˜" class="headerlink" title="2.8ã€å¤šçº¿ç¨‹é—®é¢˜"></a>2.8ã€å¤šçº¿ç¨‹é—®é¢˜</h4><h5 id="2-8-1-æ­»é”"><a href="#2-8-1-æ­»é”" class="headerlink" title="2.8.1 æ­»é”"></a>2.8.1 æ­»é”</h5><h6 id="æ­»é”çš„äº§ç”Ÿ"><a href="#æ­»é”çš„äº§ç”Ÿ" class="headerlink" title="æ­»é”çš„äº§ç”Ÿ"></a>æ­»é”çš„äº§ç”Ÿ</h6><p>æ­»é”æ˜¯ä¸¤ä¸ªæˆ–æ›´å¤šçº¿ç¨‹é˜»å¡ç€ç­‰å¾…å…¶å®ƒå¤„äºæ­»é”çŠ¶æ€çš„çº¿ç¨‹æ‰€æŒæœ‰çš„é”ã€‚æ­»é”é€šå¸¸å‘ç”Ÿåœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶ ä½†ä»¥ä¸åŒçš„é¡ºåºè¯·æ±‚åŒä¸€ç»„é”çš„æ—¶å€™ã€‚<br>ä¾‹å¦‚ï¼Œå¦‚æœçº¿ç¨‹1é”ä½äº†Aï¼Œç„¶åå°è¯•å¯¹Bè¿›è¡ŒåŠ é”ï¼ŒåŒæ—¶çº¿ç¨‹2å·²ç»é”ä½äº†Bï¼Œæ¥ç€å°è¯•å¯¹Aè¿›è¡ŒåŠ é”ï¼Œè¿™ æ—¶æ­»é”å°±å‘ç”Ÿäº†ã€‚çº¿ç¨‹1æ°¸è¿œå¾—ä¸åˆ°Bï¼Œçº¿ç¨‹2ä¹Ÿæ°¸è¿œå¾—ä¸åˆ°Aï¼Œå¹¶ä¸”å®ƒä»¬æ°¸è¿œä¹Ÿä¸ä¼šçŸ¥é“å‘ç”Ÿäº†è¿™æ ·çš„äº‹ æƒ…ã€‚ä¸ºäº†å¾—åˆ°å½¼æ­¤çš„å¯¹è±¡ï¼ˆAå’ŒBï¼‰ï¼Œå®ƒä»¬å°†æ°¸è¿œé˜»å¡ä¸‹å»ã€‚è¿™ç§æƒ…å†µå°±æ˜¯ä¸€ä¸ªæ­»é”ã€‚</p>
<h6 id="æ›´å¤æ‚çš„æ­»é”"><a href="#æ›´å¤æ‚çš„æ­»é”" class="headerlink" title="æ›´å¤æ‚çš„æ­»é”"></a>æ›´å¤æ‚çš„æ­»é”</h6><p>æ­»é”å¯èƒ½ä¸æ­¢åŒ…å«2ä¸ªçº¿ç¨‹ï¼Œè¿™è®©æ£€æµ‹æ­»é”å˜å¾—æ›´åŠ å›°éš¾ã€‚</p>
<p>çº¿ç¨‹1ç­‰å¾…çº¿ç¨‹2ï¼Œçº¿ç¨‹2ç­‰å¾…çº¿ç¨‹3ï¼Œçº¿ç¨‹3ç­‰å¾…çº¿ç¨‹4ï¼Œçº¿ç¨‹4ç­‰å¾…çº¿ç¨‹1ã€‚</p>
<h6 id="æ•°æ®åº“çš„æ­»é”"><a href="#æ•°æ®åº“çš„æ­»é”" class="headerlink" title="æ•°æ®åº“çš„æ­»é”"></a>æ•°æ®åº“çš„æ­»é”</h6><p>æ›´åŠ å¤æ‚çš„æ­»é”åœºæ™¯å‘ç”Ÿåœ¨æ•°æ®åº“äº‹åŠ¡ä¸­ã€‚ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å¯èƒ½ç”±å¤šæ¡SQLæ›´æ–°è¯·æ±‚ç»„æˆã€‚å½“åœ¨ä¸€ä¸ªäº‹ åŠ¡ä¸­æ›´æ–°ä¸€æ¡è®°å½•ï¼Œè¿™æ¡è®°å½•å°±ä¼šè¢«é”ä½é¿å…å…¶ä»–äº‹åŠ¡çš„æ›´æ–°è¯·æ±‚ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªäº‹åŠ¡ç»“æŸã€‚åŒä¸€ä¸ªäº‹åŠ¡ ä¸­æ¯ä¸€ä¸ªæ›´æ–°è¯·æ±‚éƒ½å¯èƒ½ä¼šé”ä½ä¸€äº›è®°å½•ã€‚<br>å½“å¤šä¸ªäº‹åŠ¡åŒæ—¶éœ€è¦å¯¹ä¸€äº›ç›¸åŒçš„è®°å½•åšæ›´æ–°æ“ä½œæ—¶ï¼Œå°±å¾ˆæœ‰å¯èƒ½å‘ç”Ÿæ­»é”ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Transaction 1, request 1, locks record 1 for <span class="keyword">update</span> </span><br><span class="line"><span class="keyword">Transaction</span> <span class="number">2</span>, request <span class="number">1</span>, locks <span class="built_in">record</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span></span><br><span class="line"><span class="keyword">Transaction</span> <span class="number">1</span>, request <span class="number">2</span>, tries <span class="keyword">to</span> <span class="keyword">lock</span> <span class="built_in">record</span> <span class="number">2</span> <span class="keyword">for</span> update. </span><br><span class="line"><span class="keyword">Transaction</span> <span class="number">2</span>, request <span class="number">2</span>, tries <span class="keyword">to</span> <span class="keyword">lock</span> <span class="built_in">record</span> <span class="number">1</span> <span class="keyword">for</span> update.</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºé”å‘ç”Ÿåœ¨ä¸åŒçš„è¯·æ±‚ä¸­ï¼Œå¹¶ä¸”å¯¹äºä¸€ä¸ªäº‹åŠ¡æ¥è¯´ä¸å¯èƒ½æå‰çŸ¥é“æ‰€æœ‰å®ƒéœ€è¦çš„é”ï¼Œå› æ­¤å¾ˆéš¾æ£€æµ‹å’Œé¿å…æ•°æ®åº“äº‹åŠ¡ä¸­çš„æ­»é”ã€‚</p>
<h6 id="æ­»é”çš„é¿å…"><a href="#æ­»é”çš„é¿å…" class="headerlink" title="æ­»é”çš„é¿å…"></a>æ­»é”çš„é¿å…</h6><p><strong>åŠ é”é¡ºåº</strong><br>å½“å¤šä¸ªçº¿ç¨‹éœ€è¦ç›¸åŒçš„ä¸€äº›é”ï¼Œä½†æ˜¯æŒ‰ç…§ä¸åŒçš„é¡ºåºåŠ é”ï¼Œæ­»é”å°±å¾ˆå®¹æ˜“å‘ç”Ÿã€‚<br>å¦‚æœèƒ½ç¡®ä¿æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯æŒ‰ç…§ç›¸åŒçš„é¡ºåºè·å¾—é”ï¼Œé‚£ä¹ˆæ­»é”å°±ä¸ä¼šå‘ç”Ÿã€‚çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Thread 1: Â lock A  Â lock B</span><br><span class="line">Thread 2: Â  wait for A Â  lock C (when A locked)</span><br><span class="line">Thread 3: Â  wait for A Â  wait for B Â  wait for C</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€ä¸ªçº¿ç¨‹ï¼ˆæ¯”å¦‚çº¿ç¨‹3ï¼‰éœ€è¦ä¸€äº›é”ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»æŒ‰ç…§ç¡®å®šçš„é¡ºåºè·å–é”ã€‚å®ƒåªæœ‰è·å¾—äº†ä»é¡ºåºä¸Š æ’åœ¨å‰é¢çš„é”ä¹‹åï¼Œæ‰èƒ½è·å–åé¢çš„é”ã€‚<br>ä¾‹å¦‚ï¼Œçº¿ç¨‹2å’Œçº¿ç¨‹3åªæœ‰åœ¨è·å–äº†é”Aä¹‹åæ‰èƒ½å°è¯•è·å–é”C(è¯‘è€…æ³¨ï¼šè·å–é”Aæ˜¯è·å–é”Cçš„å¿…è¦æ¡ä»¶)ã€‚å› ä¸ºçº¿ç¨‹1å·²ç»æ‹¥æœ‰äº†é”Aï¼Œæ‰€ä»¥çº¿ç¨‹2å’Œ3éœ€è¦ä¸€ç›´ç­‰åˆ°é”Aè¢«é‡Šæ”¾ã€‚ç„¶ååœ¨å®ƒä»¬å°è¯•å¯¹Bæˆ–CåŠ é”ä¹‹å‰ï¼Œå¿…é¡»æˆåŠŸåœ°å¯¹AåŠ äº†é”ã€‚<br>æŒ‰ç…§é¡ºåºåŠ é”æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ­»é”é¢„é˜²æœºåˆ¶ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼éœ€è¦ä½ äº‹å…ˆçŸ¥é“æ‰€æœ‰å¯èƒ½ä¼šç”¨åˆ°çš„é”(è¯‘è€… æ³¨ï¼šå¹¶å¯¹è¿™äº›é”åšé€‚å½“çš„æ’åº)ï¼Œä½†æ€»æœ‰äº›æ—¶å€™æ˜¯æ— æ³•é¢„çŸ¥çš„ã€‚</p>
<p><strong>åŠ é”æ—¶é™</strong></p>
<p>å¦å¤–ä¸€ä¸ªå¯ä»¥é¿å…æ­»é”çš„æ–¹æ³•æ˜¯åœ¨å°è¯•è·å–é”çš„æ—¶å€™åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€åœ¨å°è¯•è·å–é”çš„è¿‡ ç¨‹ä¸­è‹¥è¶…è¿‡äº†è¿™ä¸ªæ—¶é™è¯¥çº¿ç¨‹åˆ™æ”¾å¼ƒå¯¹è¯¥é”è¯·æ±‚ã€‚è‹¥ä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰åœ¨ç»™å®šçš„æ—¶é™å†…æˆåŠŸè·å¾—æ‰€æœ‰éœ€è¦çš„ é”ï¼Œåˆ™ä¼šè¿›è¡Œå›é€€å¹¶é‡Šæ”¾æ‰€æœ‰å·²ç»è·å¾—çš„é”ï¼Œç„¶åç­‰å¾…ä¸€æ®µéšæœºçš„æ—¶é—´å†é‡è¯•ã€‚è¿™æ®µéšæœºçš„ç­‰å¾…æ—¶é—´è®© å…¶å®ƒçº¿ç¨‹æœ‰æœºä¼šå°è¯•è·å–ç›¸åŒçš„è¿™äº›é”ï¼Œå¹¶ä¸”è®©è¯¥åº”ç”¨åœ¨æ²¡æœ‰è·å¾—é”çš„æ—¶å€™å¯ä»¥ç»§ç»­è¿è¡Œ(è¯‘è€…æ³¨ï¼šåŠ  é”è¶…æ—¶åå¯ä»¥å…ˆç»§ç»­è¿è¡Œå¹²ç‚¹å…¶å®ƒäº‹æƒ…ï¼Œå†å›å¤´æ¥é‡å¤ä¹‹å‰åŠ é”çš„é€»è¾‘)ã€‚<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå±•ç¤ºäº†ä¸¤ä¸ªçº¿ç¨‹ä»¥ä¸åŒçš„é¡ºåºå°è¯•è·å–ç›¸åŒçš„ä¸¤ä¸ªé”ï¼Œåœ¨å‘ç”Ÿè¶…æ—¶åå›é€€å¹¶é‡è¯•çš„åœºæ™¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Thread 1 locks A </span><br><span class="line">Thread 2 locks B</span><br><span class="line">Thread 1 attempts to lock B but is blocked</span><br><span class="line">Thread 2 attempts to lock A but is blocked</span><br><span class="line">Thread 1&#39;s lock attempt on B times out </span><br><span class="line">Thread 1 backs up and releases A as well </span><br><span class="line">Thread 1 waits randomly (e.g. 257 millis) before retrying.</span><br><span class="line">Thread 2&#39;s lock attempt on A times out</span><br><span class="line">Thread 2 backs up and releases B as well </span><br><span class="line">Thread 2 waits randomly (e.g. 43 millis) before retrying.</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œçº¿ç¨‹2æ¯”çº¿ç¨‹1æ—©200æ¯«ç§’è¿›è¡Œé‡è¯•åŠ é”ï¼Œå› æ­¤å®ƒå¯ä»¥å…ˆæˆåŠŸåœ°è·å–åˆ°ä¸¤ä¸ªé”ã€‚è¿™æ—¶ï¼Œ çº¿ç¨‹1å°è¯•è·å–é”Aå¹¶ä¸”å¤„äºç­‰å¾…çŠ¶æ€ã€‚å½“çº¿ç¨‹2ç»“æŸæ—¶ï¼Œçº¿ç¨‹1ä¹Ÿå¯ä»¥é¡ºåˆ©çš„è·å¾—è¿™ä¸¤ä¸ªé”ï¼ˆé™¤éçº¿ç¨‹2 æˆ–è€…å…¶å®ƒçº¿ç¨‹åœ¨çº¿ç¨‹1æˆåŠŸè·å¾—ä¸¤ä¸ªé”ä¹‹å‰åˆè·å¾—å…¶ä¸­çš„ä¸€äº›é”ï¼‰ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå­˜åœ¨é”çš„è¶…æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½è®¤ä¸ºè¿™ç§åœºæ™¯å°±ä¸€å®šæ˜¯å‡ºç°äº†æ­»é”ã€‚ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºè·å¾—äº†é”çš„çº¿ç¨‹ï¼ˆå¯¼è‡´å…¶å®ƒçº¿ç¨‹è¶…æ—¶ï¼‰éœ€è¦å¾ˆé•¿çš„æ—¶é—´å»å®Œæˆå®ƒçš„ä»»åŠ¡ã€‚</p>
<p>æ­¤å¤–ï¼Œå¦‚æœæœ‰éå¸¸å¤šçš„çº¿ç¨‹åŒä¸€æ—¶é—´å»ç«äº‰åŒä¸€æ‰¹èµ„æºï¼Œå°±ç®—æœ‰è¶…æ—¶å’Œå›é€€æœºåˆ¶ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šå¯¼è‡´è¿™äº› çº¿ç¨‹é‡å¤åœ°å°è¯•ä½†å´å§‹ç»ˆå¾—ä¸åˆ°é”ã€‚å¦‚æœåªæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”é‡è¯•çš„è¶…æ—¶æ—¶é—´è®¾å®šä¸º0åˆ°500æ¯«ç§’ä¹‹é—´ï¼Œ è¿™ç§ç°è±¡å¯èƒ½ä¸ä¼šå‘ç”Ÿï¼Œä½†æ˜¯å¦‚æœæ˜¯10ä¸ªæˆ–20ä¸ªçº¿ç¨‹æƒ…å†µå°±ä¸åŒäº†ã€‚å› ä¸ºè¿™äº›çº¿ç¨‹ç­‰å¾…ç›¸ç­‰çš„é‡è¯•æ—¶é—´ çš„æ¦‚ç‡å°±é«˜çš„å¤šï¼ˆæˆ–è€…éå¸¸æ¥è¿‘ä»¥è‡³äºä¼šå‡ºç°é—®é¢˜ï¼‰ã€‚</p>
<p><code>**è¿™ç§æœºåˆ¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨Javaä¸­ä¸èƒ½å¯¹synchronizedåŒæ­¥å—è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é”ï¼Œæˆ–ä½¿ç”¨Java5ä¸­java.util.concurrentåŒ…ä¸‹çš„å·¥å…·ã€‚**</code></p>
<p><strong>æ­»é”æ£€æµ‹</strong></p>
<p>æ­»é”æ£€æµ‹æ˜¯ä¸€ä¸ªæ›´å¥½çš„æ­»é”é¢„é˜²æœºåˆ¶ï¼Œå®ƒä¸»è¦æ˜¯é’ˆå¯¹é‚£äº›ä¸å¯èƒ½å®ç°æŒ‰åºåŠ é”å¹¶ä¸”é”è¶…æ—¶ä¹Ÿä¸å¯è¡Œçš„åœºæ™¯ã€‚<br>æ¯å½“ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†é”ï¼Œä¼šåœ¨çº¿ç¨‹å’Œé”ç›¸å…³çš„æ•°æ®ç»“æ„ä¸­ï¼ˆmapã€graphç­‰ç­‰ï¼‰å°†å…¶è®°ä¸‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ æ¯å½“æœ‰çº¿ç¨‹è¯·æ±‚é”ï¼Œä¹Ÿéœ€è¦è®°å½•åœ¨è¿™ä¸ªæ•°æ®ç»“æ„ä¸­ã€‚<br>å½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚é”å¤±è´¥æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹å¯ä»¥éå†é”çš„å…³ç³»å›¾çœ‹çœ‹æ˜¯å¦æœ‰æ­»é”å‘ç”Ÿã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹Aè¯·æ±‚é”7ï¼Œ ä½†æ˜¯é”7è¿™ä¸ªæ—¶å€™è¢«çº¿ç¨‹BæŒæœ‰ï¼Œè¿™æ—¶çº¿ç¨‹Aå°±å¯ä»¥æ£€æŸ¥ä¸€ä¸‹çº¿ç¨‹Bæ˜¯å¦å·²ç»è¯·æ±‚äº†çº¿ç¨‹Aå½“å‰æ‰€æŒæœ‰çš„é”ã€‚å¦‚æœçº¿ç¨‹Bç¡®å®æœ‰è¿™æ ·çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå°±æ˜¯å‘ç”Ÿäº†æ­»é”ï¼ˆçº¿ç¨‹Aæ‹¥æœ‰é”1ï¼Œè¯·æ±‚é”7ï¼›çº¿ç¨‹Bæ‹¥æœ‰é”7ï¼Œè¯· æ±‚é”1ï¼‰ã€‚<br>å½“ç„¶ï¼Œæ­»é”ä¸€èˆ¬è¦æ¯”ä¸¤ä¸ªçº¿ç¨‹äº’ç›¸æŒæœ‰å¯¹æ–¹çš„é”è¿™ç§æƒ…å†µè¦å¤æ‚çš„å¤šã€‚çº¿ç¨‹Aç­‰å¾…çº¿ç¨‹Bï¼Œçº¿ç¨‹Bç­‰å¾…çº¿ ç¨‹Cï¼Œçº¿ç¨‹Cç­‰å¾…çº¿ç¨‹Dï¼Œçº¿ç¨‹Dåˆåœ¨ç­‰å¾…çº¿ç¨‹Aã€‚çº¿ç¨‹Aä¸ºäº†æ£€æµ‹æ­»é”ï¼Œå®ƒéœ€è¦é€’è¿›åœ°æ£€æµ‹æ‰€æœ‰è¢«Bè¯·æ±‚çš„é”ã€‚ä»çº¿ç¨‹Bæ‰€è¯·æ±‚çš„é”å¼€å§‹ï¼Œçº¿ç¨‹Aæ‰¾åˆ°äº†çº¿ç¨‹Cï¼Œç„¶ååˆæ‰¾åˆ°äº†çº¿ç¨‹Dï¼Œå‘ç°çº¿ç¨‹Dè¯·æ±‚çš„é”è¢«çº¿ç¨‹Aè‡ª å·±æŒæœ‰ç€ã€‚è¿™æ˜¯å®ƒå°±çŸ¥é“å‘ç”Ÿäº†æ­»é”ã€‚</p>
<p><strong><em>é‚£ä¹ˆå½“æ£€æµ‹å‡ºæ­»é”æ—¶ï¼Œè¿™äº›çº¿ç¨‹è¯¥åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</em></strong></p>
<p>ä¸€ä¸ªå¯è¡Œçš„åšæ³•æ˜¯é‡Šæ”¾æ‰€æœ‰é”ï¼Œå›é€€ï¼Œå¹¶ä¸”ç­‰å¾…ä¸€æ®µéšæœºçš„æ—¶é—´åé‡è¯•ã€‚è¿™ä¸ªå’Œç®€å•çš„åŠ é”è¶…æ—¶ç±»ä¼¼ï¼Œ ä¸ä¸€æ ·çš„æ˜¯åªæœ‰æ­»é”å·²ç»å‘ç”Ÿäº†æ‰å›é€€ï¼Œè€Œä¸ä¼šæ˜¯å› ä¸ºåŠ é”çš„è¯·æ±‚è¶…æ—¶äº†ã€‚è™½ç„¶æœ‰å›é€€å’Œç­‰å¾…ï¼Œä½†æ˜¯å¦‚æœæœ‰å¤§é‡çš„çº¿ç¨‹ç«äº‰åŒä¸€æ‰¹é”ï¼Œå®ƒä»¬è¿˜æ˜¯ä¼šé‡å¤åœ°æ­»é”ï¼ˆç¼–è€…æ³¨ï¼šåŸå› åŒè¶…æ—¶ç±»ä¼¼ï¼Œä¸èƒ½ä»æ ¹æœ¬ä¸Šå‡è½»ç«äº‰ï¼‰ã€‚<br>ä¸€ä¸ªæ›´å¥½çš„æ–¹æ¡ˆæ˜¯ç»™è¿™äº›çº¿ç¨‹è®¾ç½®ä¼˜å…ˆçº§ï¼Œè®©ä¸€ä¸ªï¼ˆæˆ–å‡ ä¸ªï¼‰çº¿ç¨‹å›é€€ï¼Œå‰©ä¸‹çš„çº¿ç¨‹å°±åƒæ²¡å‘ç”Ÿæ­»é”ä¸€ æ ·ç»§ç»­ä¿æŒç€å®ƒä»¬éœ€è¦çš„é”ã€‚å¦‚æœèµ‹äºˆè¿™äº›çº¿ç¨‹çš„ä¼˜å…ˆçº§æ˜¯å›ºå®šä¸å˜çš„ï¼ŒåŒä¸€æ‰¹çº¿ç¨‹æ€»æ˜¯ä¼šæ‹¥æœ‰æ›´é«˜çš„ ä¼˜å…ˆçº§ã€‚ä¸ºé¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨æ­»é”å‘ç”Ÿçš„æ—¶å€™è®¾ç½®éšæœºçš„ä¼˜å…ˆçº§ã€‚</p>
<h5 id="2-8-2-é¥¥é¥¿å’Œå…¬å¹³"><a href="#2-8-2-é¥¥é¥¿å’Œå…¬å¹³" class="headerlink" title="2.8.2 é¥¥é¥¿å’Œå…¬å¹³"></a>2.8.2 é¥¥é¥¿å’Œå…¬å¹³</h5><p><strong><em>å¦‚æœä¸€ä¸ªçº¿ç¨‹å› ä¸ºCPUæ—¶é—´å…¨éƒ¨è¢«å…¶ä»–çº¿ç¨‹æŠ¢èµ°è€Œå¾—ä¸åˆ°CPUè¿è¡Œæ—¶é—´ï¼Œè¿™ç§çŠ¶æ€è¢«ç§°ä¹‹ä¸ºâ€œé¥¥é¥¿â€ã€‚</em></strong>è€Œè¯¥çº¿ç¨‹è¢«â€œé¥¥é¥¿è‡´æ­»â€æ­£æ˜¯å› ä¸ºå®ƒå¾—ä¸åˆ°CPUè¿è¡Œæ—¶é—´çš„æœºä¼šã€‚<strong>è§£å†³é¥¥é¥¿çš„æ–¹æ¡ˆè¢«ç§°ä¹‹ä¸ºâ€œå…¬å¹³æ€§â€ â€“ å³æ‰€æœ‰çº¿ç¨‹å‡èƒ½å…¬å¹³åœ°è·å¾—è¿è¡Œæœºä¼šã€‚</strong></p>
<h6 id="Javaä¸­å¯¼è‡´é¥¥é¥¿çš„åŸå› "><a href="#Javaä¸­å¯¼è‡´é¥¥é¥¿çš„åŸå› " class="headerlink" title="Javaä¸­å¯¼è‡´é¥¥é¥¿çš„åŸå› "></a>Javaä¸­å¯¼è‡´é¥¥é¥¿çš„åŸå› </h6><p>åœ¨Javaä¸­ï¼Œä¸‹é¢ä¸‰ä¸ªå¸¸è§çš„åŸå› ä¼šå¯¼è‡´çº¿ç¨‹é¥¥é¥¿ï¼š</p>
<ul>
<li><p>é«˜ä¼˜å…ˆçº§çº¿ç¨‹åå™¬æ‰€æœ‰çš„ä½ä¼˜å…ˆçº§çº¿ç¨‹çš„CPUæ—¶é—´ </p>
<p>ä½ èƒ½ä¸ºæ¯ä¸ªçº¿ç¨‹è®¾ç½®ç‹¬è‡ªçš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šé«˜çš„çº¿ç¨‹è·å¾—çš„CPUæ—¶é—´è¶Šå¤šï¼Œçº¿ç¨‹ä¼˜å…ˆçº§å€¼è®¾ç½®åœ¨1åˆ°10ä¹‹é—´ï¼Œè€Œè¿™äº›ä¼˜å…ˆçº§å€¼æ‰€è¡¨ç¤ºè¡Œä¸ºçš„å‡†ç¡®è§£é‡Šåˆ™ä¾èµ–äºä½ çš„åº”ç”¨è¿è¡Œå¹³å°ã€‚å¯¹å¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œä½ å¥½æ˜¯ä¸è¦æ”¹å˜å…¶ä¼˜å…ˆçº§å€¼ã€‚ </p>
</li>
<li><p>çº¿ç¨‹è¢«æ°¸ä¹…å µå¡åœ¨ä¸€ä¸ªç­‰å¾…è¿›å…¥åŒæ­¥å—çš„çŠ¶æ€ </p>
<p>Javaçš„åŒæ­¥ä»£ç åŒºä¹Ÿæ˜¯ä¸€ä¸ªå¯¼è‡´é¥¥é¥¿çš„å› ç´ ã€‚Javaçš„åŒæ­¥ä»£ç åŒºå¯¹å“ªä¸ªçº¿ç¨‹å…è®¸è¿›å…¥çš„æ¬¡åºæ²¡æœ‰ä»»ä½•ä¿éšœã€‚è¿™å°±æ„å‘³ç€ç†è®ºä¸Šå­˜åœ¨ä¸€ä¸ªè¯•å›¾è¿›å…¥è¯¥åŒæ­¥åŒºçš„çº¿ç¨‹å¤„äºè¢«æ°¸ä¹…å µå¡çš„é£é™©ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹æ€»æ˜¯èƒ½æŒç»­åœ°å…ˆäºå®ƒè·å¾—è®¿é—®ï¼Œè¿™å³æ˜¯â€œé¥¥é¥¿â€é—®é¢˜ï¼Œè€Œä¸€ä¸ªçº¿ç¨‹è¢«â€œé¥¥é¥¿è‡´æ­»â€æ­£æ˜¯å› ä¸ºå®ƒå¾—ä¸åˆ°CPUè¿è¡Œæ—¶é—´çš„æœºä¼šã€‚</p>
</li>
<li><p>çº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªæœ¬èº«(åœ¨å…¶ä¸Šè°ƒç”¨wait())ä¹Ÿå¤„äºæ°¸ä¹…ç­‰å¾…å®Œæˆçš„å¯¹è±¡ </p>
<p>å¦‚æœå¤šä¸ªçº¿ç¨‹å¤„åœ¨wait()æ–¹æ³•æ‰§è¡Œä¸Šï¼Œè€Œå¯¹å…¶è°ƒç”¨notify()ä¸ä¼šä¿è¯å“ªä¸€ä¸ªçº¿ç¨‹ä¼šè·å¾—å”¤é†’ï¼Œä»»ä½•çº¿ç¨‹éƒ½æœ‰å¯èƒ½å¤„äºç»§ç»­ç­‰å¾…çš„çŠ¶æ€ã€‚å› æ­¤å­˜åœ¨è¿™æ ·ä¸€ä¸ªé£é™©ï¼šä¸€ä¸ªç­‰å¾…çº¿ç¨‹ä»æ¥å¾—ä¸åˆ°å”¤é†’ï¼Œå› ä¸ºå…¶ä»–ç­‰å¾…çº¿ç¨‹æ€»æ˜¯èƒ½è¢«è·å¾—å”¤é†’ã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹ï¼ˆä¸€ï¼‰</title>
    <url>/2021/01/07/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<h2 id="ä¸€ã€å¹¶å‘ç¼–ç¨‹å…¥é—¨"><a href="#ä¸€ã€å¹¶å‘ç¼–ç¨‹å…¥é—¨" class="headerlink" title="ä¸€ã€å¹¶å‘ç¼–ç¨‹å…¥é—¨"></a>ä¸€ã€å¹¶å‘ç¼–ç¨‹å…¥é—¨</h2><h3 id="1-1-çº¿ç¨‹"><a href="#1-1-çº¿ç¨‹" class="headerlink" title="1.1 çº¿ç¨‹"></a>1.1 çº¿ç¨‹</h3><h4 id="1-1-1è¿›ç¨‹å’Œçº¿ç¨‹è¿›ç¨‹"><a href="#1-1-1è¿›ç¨‹å’Œçº¿ç¨‹è¿›ç¨‹" class="headerlink" title="1.1.1è¿›ç¨‹å’Œçº¿ç¨‹è¿›ç¨‹"></a>1.1.1è¿›ç¨‹å’Œçº¿ç¨‹è¿›ç¨‹</h4><p><strong>è¿›ç¨‹</strong>ï¼š</p>
<p>è¿›ç¨‹æŒ‡æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œè¿›ç¨‹æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ã€ç§æœ‰çš„åŸºæœ¬è¿è¡Œèµ„æºé›†åˆã€‚é€šå¸¸ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰</p>
<p>è‡ªå·±çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>è¿›ç¨‹å¾€å¾€è¢«çœ‹ä½œæ˜¯ç¨‹åºæˆ–åº”ç”¨çš„ä»£åè¯ï¼Œç„¶è€Œï¼Œç”¨æˆ·çœ‹åˆ°çš„ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºå®é™…ä¸Šå¯èƒ½æ˜¯ä¸€ç»„ç›¸äº’ åä½œçš„è¿›ç¨‹é›†åˆã€‚</p>
<p>ä¸ºäº†ä¾¿äºè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ï¼Œå¦‚pipes å’Œsocketsã€‚IPCä¸ä»…æ”¯æŒåŒä¸€ç³»ç»Ÿä¸Šçš„é€šä¿¡ï¼Œä¹Ÿæ”¯æŒä¸åŒçš„ç³»ç»Ÿã€‚IPCé€šä¿¡æ–¹å¼åŒ…æ‹¬ç®¡é“ï¼ˆåŒ…æ‹¬æ— åç®¡é“å’Œå‘½åç®¡é“ï¼‰ã€ æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡ã€å…±äº«å­˜å‚¨ã€Socketã€Streamsç­‰æ–¹å¼ï¼Œå…¶ä¸­  Socketå’ŒStreamsæ”¯æŒä¸åŒä¸»æœºä¸Šçš„ä¸¤ä¸ªè¿›ç¨‹IPCã€‚</p>
<p><strong>çº¿ç¨‹</strong>ï¼š</p>
<p>çº¿ç¨‹æœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§çš„è¿›ç¨‹ã€‚è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æä¾›äº†ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œä½†åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¯”åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹éœ€è¦çš„èµ„æºè¦å°‘ã€‚</p>
<p>çº¿ç¨‹æ˜¯åœ¨è¿›ç¨‹ä¸­å­˜åœ¨çš„ â€” æ¯ä¸ªè¿›ç¨‹æœ€å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚çº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºï¼ŒåŒ…æ‹¬å†…å­˜å’Œæ‰“å¼€çš„æ–‡ä»¶ã€‚è¿™æ ·æé«˜äº†æ•ˆç‡ï¼Œä½†æ½œåœ¨çš„é—®é¢˜å°±æ˜¯çº¿ç¨‹é—´çš„é€šä¿¡ã€‚</p>
<p>å¤šçº¿ç¨‹çš„æ‰§è¡Œæ˜¯Javaå¹³å°çš„ä¸€ä¸ªåŸºæœ¬ç‰¹å¾ã€‚æ¯ä¸ªåº”ç”¨éƒ½è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ â€“ æˆ–å‡ ä¸ªï¼Œå¦‚æœç®—ä¸Šâ€œç³»</p>
<p>ç»Ÿâ€çº¿ç¨‹çš„è¯ï¼Œæ¯”å¦‚å†…å­˜ç®¡ç†å’Œä¿¡å·å¤„ç†ç­‰ã€‚ä½†æ˜¯ä»ç¨‹åºå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œå¯åŠ¨çš„åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå«ä¸»çº¿ ç¨‹ã€‚</p>
<p>ç®€è€Œè¨€ä¹‹ï¼šä¸€ä¸ªç¨‹åºè¿è¡Œåè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ã€‚</p>
<h4 id="1-1-2-çº¿ç¨‹å®è·µ"><a href="#1-1-2-çº¿ç¨‹å®è·µ" class="headerlink" title="1.1.2 çº¿ç¨‹å®è·µ"></a>1.1.2 çº¿ç¨‹å®è·µ</h4><h5 id="1-1-2-1-çº¿ç¨‹çš„åˆ›å»º"><a href="#1-1-2-1-çº¿ç¨‹çš„åˆ›å»º" class="headerlink" title="1.1.2.1 çº¿ç¨‹çš„åˆ›å»º"></a>1.1.2.1 çº¿ç¨‹çš„åˆ›å»º</h5><p>ä¸¤ç§æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">        System.out.println(<span class="string">"Hello from a thread!"</span>); Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123; Â  Â  Â   </span><br><span class="line">        (<span class="keyword">new</span> HelloThread()).start(); Â   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">        System.out.println(<span class="string">"Hello from a thread!"</span>); Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123; Â  Â  Â   </span><br><span class="line">        (<span class="keyword">new</span> Thread(<span class="keyword">new</span> HelloRunnable())).start(); Â   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-2-çº¿ç¨‹å¯åŠ¨å’Œåœæ­¢"><a href="#1-1-2-2-çº¿ç¨‹å¯åŠ¨å’Œåœæ­¢" class="headerlink" title="1.1.2.2 çº¿ç¨‹å¯åŠ¨å’Œåœæ­¢"></a>1.1.2.2 çº¿ç¨‹å¯åŠ¨å’Œåœæ­¢</h5><p><strong>å¯åŠ¨çº¿ç¨‹</strong>ï¼šè°ƒç”¨startæ–¹æ³•</p>
<p><strong>åœæ­¢çº¿ç¨‹</strong>ï¼šçº¿ç¨‹è‡ªå¸¦çš„stopæ–¹æ³•ï¼Œä¸€æ–¹é¢å·²ç»è¿‡æ—¶ï¼Œå¦ä¸€æ–¹é¢ï¼Œä¸ä¼šå¯¹åœæ­¢çš„çº¿ç¨‹åšçŠ¶æ€ä¿å­˜ï¼Œä½¿å¾—çº¿ç¨‹ä¸­æ¶‰åŠçš„ å¯¹è±¡å¤„äºæœªçŸ¥çŠ¶æ€ï¼Œå¦‚æœè¿™äº›çŠ¶æ€ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¼šä½¿ç”¨ï¼Œå°†ä¼šä½¿å¾—å…¶ä»–çº¿ç¨‹å‡ºç°æ— æ³•é¢„æ–™çš„å¼‚å¸¸ï¼Œæ‰€   ä»¥ï¼Œåœæ­¢ç¨‹åºçš„åŠŸèƒ½ï¼Œéœ€è¦è‡ªå·±å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123; Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        StopThread thread = <span class="keyword">new</span> StopThread();</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line">        thread.stop();</span><br><span class="line">        <span class="keyword">while</span> (thread.isAlive()) &#123;&#125; Â  Â  Â  Â </span><br><span class="line">        thread.print(); Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StopThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">private</span> <span class="keyword">int</span> x = <span class="number">0</span>; </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> y = <span class="number">0</span>;</span><br><span class="line"> Â  Â  Â  Â <span class="meta">@Override</span> Â  Â  Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                ++x; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                    Thread.sleep(<span class="number">3000L</span>); Â  Â  Â  Â  Â  Â  Â   </span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace(); Â  Â  Â  Â  Â  Â  Â   </span><br><span class="line">                &#125;</span><br><span class="line">                ++y; Â  Â  Â  Â  Â   </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"x="</span> + x + <span class="string">" y="</span> + y);</span><br><span class="line">        &#125; Â   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œrunæ–¹æ³•é‡Œæ˜¯ä¸€ä¸ªåŒæ­¥çš„åŸå­æ“ä½œï¼Œxå’Œyå¿…é¡»è¦å…±åŒå¢åŠ ï¼Œç„¶è€Œè¿™é‡Œå¦‚æœè°ƒç”¨ thread.stop()æ–¹æ³•å¼ºåˆ¶ä¸­æ–­çº¿ç¨‹ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">x=<span class="number">1</span> y=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰å¼‚å¸¸ï¼Œä¹Ÿç ´åäº†æˆ‘ä»¬çš„é¢„æœŸã€‚å¦‚æœè¿™ç§é—®é¢˜å‡ºç°åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œä¼šå¼•å‘éš¾ä»¥é¢„æœŸçš„å¼‚å¸¸ã€‚å› æ­¤è¿™ ç§ä¸å®‰å…¨çš„æ–¹å¼å¾ˆæ—©å°±è¢«åºŸå¼ƒäº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">boolean</span> doStop = <span class="keyword">false</span>;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doStop = <span class="keyword">true</span>; Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">keepRunning</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.doStop == <span class="keyword">false</span>; Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="meta">@Override</span> Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">        <span class="keyword">while</span>(keepRunning()) &#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            <span class="comment">// keep doing what this thread should do. </span></span><br><span class="line">            System.out.println(<span class="string">"Running"</span>);</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                Thread.sleep(<span class="number">3L</span> * <span class="number">1000L</span>); Â  Â  Â  Â  Â   </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace(); Â  Â  Â  Â  Â   </span><br><span class="line">            &#125;</span><br><span class="line"> Â  Â  Â   &#125; Â   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnableMain</span> </span>&#123;</span><br><span class="line"> Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">        MyRunnable myRunnable = <span class="keyword">new</span> MyRunnable();</span><br><span class="line"> Â  Â  Â  Â Thread thread = <span class="keyword">new</span> Thread(myRunnable);</span><br><span class="line"> Â  Â  Â  Â thread.start();</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            Thread.sleep(<span class="number">10L</span> * <span class="number">1000L</span>); Â  Â  Â   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            e.printStackTrace(); Â  Â  Â   </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â myRunnable.doStop(); Â  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-3-çº¿ç¨‹æš‚åœå’Œä¸­æ–­"><a href="#1-1-2-3-çº¿ç¨‹æš‚åœå’Œä¸­æ–­" class="headerlink" title="1.1.2.3 çº¿ç¨‹æš‚åœå’Œä¸­æ–­"></a>1.1.2.3 çº¿ç¨‹æš‚åœå’Œä¸­æ–­</h5><p><strong>æš‚åœ</strong>ï¼š<br>Javaä¸­çº¿ç¨‹çš„æš‚åœæ˜¯è°ƒç”¨ java.lang.Thread ç±»çš„ sleep æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šä½¿å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æš‚åœ æŒ‡å®šçš„ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœçº¿ç¨‹æŒæœ‰é”ï¼Œ sleep æ–¹æ³•ç»“æŸå‰å¹¶ä¸ä¼šé‡Šæ”¾è¯¥é”ã€‚<br><strong>ä¸­æ–­</strong>ï¼š<br>java.lang.Threadç±»æœ‰ä¸€ä¸ª interrupt æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç›´æ¥å¯¹çº¿ç¨‹è°ƒç”¨ã€‚å½“è¢«interruptçš„çº¿ç¨‹æ­£åœ¨ sleepæˆ–waitæ—¶ï¼Œä¼šæŠ›å‡º InterruptedException å¼‚å¸¸ã€‚ äº‹å®ä¸Šï¼Œ interrupt æ–¹æ³•åªæ˜¯æ”¹å˜ç›®æ ‡çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼ˆinterrupt statusï¼‰ï¼Œè€Œé‚£äº›ä¼šæŠ›å‡º InterruptedException å¼‚å¸¸çš„æ–¹æ³•ï¼Œå¦‚waitã€sleepã€joinç­‰ï¼Œéƒ½æ˜¯åœ¨æ–¹æ³•å†…éƒ¨ä¸æ–­åœ°æ£€æŸ¥ä¸­æ–­çŠ¶ æ€çš„å€¼ã€‚</p>
<ul>
<li><strong>interruptæ–¹æ³•</strong><br>Threadå®ä¾‹æ–¹æ³•ï¼šå¿…é¡»ç”±å…¶å®ƒçº¿ç¨‹è·å–è¢«è°ƒç”¨çº¿ç¨‹çš„å®ä¾‹åï¼Œè¿›è¡Œè°ƒç”¨ã€‚å®é™…ä¸Šï¼Œåªæ˜¯æ”¹å˜äº†è¢«è°ƒç”¨çº¿ ç¨‹çš„å†…éƒ¨ä¸­æ–­çŠ¶æ€ï¼›</li>
<li><strong>Thread.interruptedæ–¹æ³•</strong><br>Threadç±»æ–¹æ³•ï¼šå¿…é¡»åœ¨å½“å‰æ‰§è¡Œçº¿ç¨‹å†…è°ƒç”¨ï¼Œè¯¥æ–¹æ³•è¿”å›å½“å‰çº¿ç¨‹çš„å†…éƒ¨ä¸­æ–­çŠ¶æ€ï¼Œç„¶åæ¸…é™¤ä¸­æ–­çŠ¶æ€ ï¼ˆç½®ä¸ºfalseï¼‰ ï¼›</li>
<li><strong>isInterruptedæ–¹æ³•</strong><br>Threadå®ä¾‹æ–¹æ³•ï¼šç”¨æ¥æ£€æŸ¥æŒ‡å®šçº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚å½“çº¿ç¨‹ä¸ºä¸­æ–­çŠ¶æ€æ—¶ï¼Œä¼šè¿”å›trueï¼›å¦åˆ™è¿”å› falseã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123; Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        StopThread thread = <span class="keyword">new</span> StopThread(); Â  Â  Â  Â </span><br><span class="line">        thread.start(); Â  Â  Â  Â </span><br><span class="line">        Thread.sleep(<span class="number">1000L</span>); Â  Â  Â  Â </span><br><span class="line">        thread.interrupt(); Â  Â  Â  Â </span><br><span class="line">        <span class="keyword">while</span> (thread.isAlive()) &#123; &#125; Â  Â  Â  Â </span><br><span class="line">        thread.print(); Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StopThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">private</span> <span class="keyword">int</span> x = <span class="number">0</span>; </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> y = <span class="number">0</span>;</span><br><span class="line"> Â  Â  Â  Â <span class="meta">@Override</span> Â  Â  Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                ++x; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                    Thread.sleep(<span class="number">3000L</span>); Â  Â  Â  Â  Â  Â  Â   </span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace(); Â  Â  Â  Â  Â  Â  Â   </span><br><span class="line">                &#125; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                ++y; Â  Â  Â  Â  Â  </span><br><span class="line">            &#125; Â  Â  Â   </span><br><span class="line">        &#125;</span><br><span class="line"> Â  Â  Â  Â <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Â            System.out.println(<span class="string">"x="</span> + x + <span class="string">" y="</span> + y); Â  Â  Â   </span><br><span class="line">        &#125; Â   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">x=<span class="number">1</span> y=<span class="number">1</span> </span><br><span class="line">    java.lang.InterruptedException: sleep interrupted Â  Â </span><br><span class="line">        at java.lang.Thread.sleep(Native Method) Â  Â </span><br><span class="line">        at ThreadTest$StopThread.run(ThreadTest.java:<span class="number">28</span>)</span><br></pre></td></tr></table></figure>

<p>x=1,y=1 è¿™ä¸ªç»“æœæ˜¯ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼ŒåŒæ—¶è¿˜æŠ›å‡ºäº†ä¸ªå¼‚å¸¸ã€‚</p>
<p>åº•å±‚æºç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// æ ¸å¿ƒ interrupt æ–¹æ³• Â  </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">interrupt</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> != Thread.currentThread()) <span class="comment">// éæœ¬çº¿ç¨‹ï¼Œéœ€è¦æ£€æŸ¥æƒé™</span></span><br><span class="line">        checkAccess();</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">synchronized</span> (blockerLock) &#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            Interruptible b = blocker; Â  Â  Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">if</span> (b != <span class="keyword">null</span>) &#123; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                interrupt0(); Â  Â  Â  Â  Â  <span class="comment">// ä»…ä»…è®¾ç½®interruptæ ‡å¿—ä½</span></span><br><span class="line">                b.interrupt(<span class="keyword">this</span>); Â  Â <span class="comment">// è°ƒç”¨å¦‚ I/O æ“ä½œå®šä¹‰çš„ä¸­æ–­æ–¹æ³•</span></span><br><span class="line">                <span class="keyword">return</span>; Â  Â  Â  Â  Â   </span><br><span class="line">            &#125; Â  Â  Â   </span><br><span class="line">        &#125; Â  Â  Â  Â </span><br><span class="line">    interrupt0(); Â   </span><br><span class="line">&#125; Â  Â </span><br><span class="line"><span class="comment">// é™æ€æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ç‚¹å‘ï¼Œè°ƒç”¨è¯¥æ–¹æ³•è°ƒç”¨åä¼šæ¸…é™¤ä¸­æ–­çŠ¶æ€ã€‚ Â  Â </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">interrupted</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">    <span class="keyword">return</span> currentThread().isInterrupted(<span class="keyword">true</span>); Â   </span><br><span class="line">&#125; Â  Â </span><br><span class="line"><span class="comment">// è¿™ä¸ªæ–¹æ³•ä¸ä¼šæ¸…é™¤ä¸­æ–­çŠ¶æ€ Â  Â </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isInterrupted</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">    <span class="keyword">return</span> isInterrupted(<span class="keyword">false</span>); Â   </span><br><span class="line">&#125; Â  </span><br><span class="line"><span class="comment">// ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•ä¼šè°ƒç”¨è¿™ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå‚æ•°ä»£è¡¨æ˜¯å¦æ¸…é™¤ä¸­æ–­çŠ¶æ€ Â  </span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isInterrupted</span><span class="params">(<span class="keyword">boolean</span> ClearInterrupted)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>interrupt() ï¼š</strong></p>
<ul>
<li><p>interrupt ä¸­æ–­æ“ä½œæ—¶ï¼Œéè‡ªèº«æ‰“æ–­éœ€è¦å…ˆæ£€æµ‹æ˜¯å¦æœ‰ä¸­æ–­æƒé™ï¼Œè¿™ç”±jvmçš„å®‰å…¨æœºåˆ¶é…ç½®ï¼› </p>
</li>
<li><p>å¦‚æœçº¿ç¨‹å¤„äºsleep, wait, join ç­‰çŠ¶æ€ï¼Œé‚£ä¹ˆçº¿ç¨‹å°†ç«‹å³é€€å‡ºè¢«é˜»å¡çŠ¶æ€ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ª InterruptedExceptionå¼‚å¸¸ï¼› </p>
</li>
<li><p>å¦‚æœçº¿ç¨‹å¤„äºI/Oé˜»å¡çŠ¶æ€ï¼Œå°†ä¼šæŠ›å‡ºClosedByInterruptExceptionï¼ˆIOExceptionçš„å­ç±»ï¼‰å¼‚å¸¸ï¼› </p>
</li>
<li><p>å¦‚æœçº¿ç¨‹åœ¨Selectorä¸Šè¢«é˜»å¡ï¼Œselectæ–¹æ³•å°†ç«‹å³è¿”å›ï¼›</p>
</li>
<li><p>å¦‚æœéä»¥ä¸Šæƒ…å†µï¼Œå°†ç›´æ¥æ ‡è®° interrupt çŠ¶æ€ï¼›</p>
</li>
</ul>
<p>  æ³¨æ„ï¼šinterrupt æ“ä½œä¸ä¼šæ‰“æ–­æ‰€æœ‰é˜»å¡ï¼Œåªæœ‰ä¸Šè¿°é˜»å¡æƒ…å†µæ‰åœ¨jvmçš„æ‰“æ–­èŒƒå›´å†…ï¼Œå¦‚å¤„äºé”é˜»å¡çš„ çº¿ç¨‹ï¼Œä¸ä¼šå— interrupt ä¸­æ–­ï¼›<br>  é˜»å¡æƒ…å†µä¸‹ä¸­æ–­ï¼ŒæŠ›å‡ºå¼‚å¸¸åçº¿ç¨‹æ¢å¤éä¸­æ–­çŠ¶æ€ï¼Œå³ interrupted = false</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; Â  Â  Â  Â </span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Task(<span class="string">"mytask"</span>)); Â  Â  Â  Â </span><br><span class="line">        t.start(); Â  Â  Â  Â </span><br><span class="line">        t.interrupt(); Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123; Â  Â  Â  Â </span><br><span class="line">        String name; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(String name)</span> </span>&#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">this</span>.name = name; Â  Â  Â   </span><br><span class="line">        &#125; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">        <span class="meta">@Override</span> Â  Â  Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">try</span> &#123; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">                Thread.sleep(<span class="number">1000</span>); Â  Â  Â  Â  Â   </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">"thread has been interrupt!"</span>);</span><br><span class="line">            &#125; Â  Â  Â  Â  Â  Â </span><br><span class="line">            System.out.println(<span class="string">"isInterrupted: "</span> + </span><br><span class="line">                               Thread.currentThread().isInterrupted()); Â  Â  Â  Â  Â  Â </span><br><span class="line">            System.out.println(<span class="string">"task "</span> + name + <span class="string">" is over"</span>); Â  Â  Â   </span><br><span class="line">        &#125; Â   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">thread has been interrupt! </span><br><span class="line">isInterrupted: <span class="keyword">false</span> </span><br><span class="line">task <span class="number">1</span> is over</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨Thread.interrupted() æ–¹æ³•åçº¿ç¨‹æ¢å¤éä¸­æ–­çŠ¶æ€</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123; Â  Â  Â  Â </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; Â  Â  Â  Â </span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Task(<span class="string">"mytask"</span>)); Â  Â  Â  Â </span><br><span class="line">        t.start(); Â  Â  Â  Â </span><br><span class="line">        t.interrupt(); Â   </span><br><span class="line">    &#125;</span><br><span class="line"> Â  Â <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123; Â  Â  Â  Â </span><br><span class="line">        String name; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(String name)</span> </span>&#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            <span class="keyword">this</span>.name = name; Â  Â  Â   </span><br><span class="line">        &#125; Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">        <span class="meta">@Override</span> Â  Â  Â  Â </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; Â  Â  Â  Â  Â  Â </span><br><span class="line">            System.out.println(<span class="string">"first :"</span> + Thread.interrupted());</span><br><span class="line">            System.out.println(<span class="string">"second:"</span> + Thread.interrupted());</span><br><span class="line">			System.out.println(<span class="string">"task "</span> + name + <span class="string">" is over"</span>); Â  Â  Â   </span><br><span class="line">        &#125; Â   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">first :<span class="keyword">true</span> </span><br><span class="line">second:<span class="keyword">false</span> </span><br><span class="line">task <span class="number">1</span> is o</span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-4-çº¿ç¨‹çš„çŠ¶æ€"><a href="#1-1-2-4-çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="1.1.2.4 çº¿ç¨‹çš„çŠ¶æ€"></a>1.1.2.4 çº¿ç¨‹çš„çŠ¶æ€</h5><p>Javaçº¿ç¨‹å¯èƒ½çš„çŠ¶æ€ï¼š</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/07/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89/img1.jpg"  alt></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2021/01/07/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89/img2.jpg"  alt></p>
<h3 id="1-2-å¤šçº¿ç¨‹"><a href="#1-2-å¤šçº¿ç¨‹" class="headerlink" title="1.2 å¤šçº¿ç¨‹"></a>1.2 å¤šçº¿ç¨‹</h3><p>çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œè´Ÿè´£å½“å‰è¿›ç¨‹ä¸­ç¨‹åºçš„æ‰§è¡Œï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­æ˜¯å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹çš„ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºå¤šçº¿ç¨‹ç¨‹åºã€‚</p>
<h4 id="1-2-1-å¹¶å‘å’Œå¹¶è¡Œ"><a href="#1-2-1-å¹¶å‘å’Œå¹¶è¡Œ" class="headerlink" title="1.2.1 å¹¶å‘å’Œå¹¶è¡Œ"></a>1.2.1 å¹¶å‘å’Œå¹¶è¡Œ</h4><ul>
<li>å¹¶è¡Œæ˜¯æŒ‡ä¸¤ä¸ªæˆ–è€…å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿï¼›è€Œå¹¶å‘æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´é—´éš”å‘ç”Ÿã€‚</li>
<li>å¹¶è¡Œæ˜¯åœ¨ä¸åŒå®ä½“ä¸Šçš„å¤šä¸ªäº‹ä»¶ï¼Œå¹¶å‘æ˜¯åœ¨åŒä¸€å®ä½“ä¸Šçš„å¤šä¸ªäº‹ä»¶ã€‚ </li>
<li>åœ¨ä¸€å°å¤„ç†å™¨ä¸Šâ€œåŒæ—¶â€å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œåœ¨å¤šå°å¤„ç†å™¨ä¸ŠåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚å¦‚hadoopåˆ†å¸ƒå¼é›†ç¾¤</li>
</ul>
<h4 id="1-2-2-å¤šçº¿ç¨‹å¥½å¤„"><a href="#1-2-2-å¤šçº¿ç¨‹å¥½å¤„" class="headerlink" title="1.2.2 å¤šçº¿ç¨‹å¥½å¤„"></a>1.2.2 å¤šçº¿ç¨‹å¥½å¤„</h4><p>æé«˜cpuçš„åˆ©ç”¨ç‡</p>
<p><strong>å•çº¿ç¨‹ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5 seconds reading file A  </span><br><span class="line">2 seconds processing file A  </span><br><span class="line">5 seconds reading file B  </span><br><span class="line">2 seconds processing file B </span><br><span class="line">---------------------- </span><br><span class="line">14 seconds total</span><br></pre></td></tr></table></figure>

<p><strong>å¤šçº¿ç¨‹ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5 seconds reading file A  </span><br><span class="line">5 seconds reading file B + </span><br><span class="line">2 seconds processing file A  </span><br><span class="line">2 seconds processing file B </span><br><span class="line">---------------------- </span><br><span class="line">12 seconds total</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç­‰å¾…ç£ç›˜IOï¼Œç½‘ç»œIOæˆ–è€…ç­‰å¾…ç”¨æˆ·è¾“å…¥æ—¶ï¼ŒCPUå¯ä»¥åŒæ—¶å»å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚</p>
<p><strong>æ›´é«˜æ•ˆçš„å“åº”</strong></p>
<p>å¤šçº¿ç¨‹æŠ€æœ¯ä½¿ç¨‹åºçš„å“åº”é€Ÿåº¦æ›´å¿« ,å› ä¸ºç”¨æˆ·ç•Œé¢å¯ä»¥åœ¨è¿›è¡Œå…¶å®ƒå·¥ä½œçš„åŒæ—¶ä¸€ç›´å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œä¸ä¼š é€ æˆæ— æ³•å“åº”çš„ç°è±¡ã€‚</p>
<p><strong>å…¬å¹³ä½¿ç”¨CPUèµ„æº</strong></p>
<p>å½“å‰æ²¡æœ‰è¿›è¡Œå¤„ç†çš„ä»»åŠ¡ï¼Œå¯ä»¥å°†å¤„ç†å™¨æ—¶é—´è®©ç»™å…¶å®ƒä»»åŠ¡;å ç”¨å¤§é‡å¤„ç†æ—¶é—´çš„ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å®šæœŸå°† å¤„ç†å™¨æ—¶é—´è®©ç»™å…¶å®ƒä»»åŠ¡;é€šè¿‡å¯¹CPUæ—¶é—´çš„åˆ’åˆ†ï¼Œä½¿å¾—CPUæ—¶é—´ç‰‡å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œé¿å…éœ€è¦ é•¿æ—¶é—´å¤„ç†çš„çº¿ç¨‹ç‹¬å CPUï¼Œå¯¼è‡´å…¶å®ƒçº¿ç¨‹é•¿æ—¶é—´ç­‰å¾…ã€‚</p>
<h5 id="1-2-3-å¤šçº¿ç¨‹çš„ä»£ä»·"><a href="#1-2-3-å¤šçº¿ç¨‹çš„ä»£ä»·" class="headerlink" title="1.2.3 å¤šçº¿ç¨‹çš„ä»£ä»·"></a>1.2.3 å¤šçº¿ç¨‹çš„ä»£ä»·</h5><p>*<em>æ›´å¤æ‚çš„è®¾è®¡ *</em></p>
<p>å…±äº«æ•°æ®çš„è¯»å–ï¼Œæ•°æ®çš„å®‰å…¨æ€§ï¼Œçº¿ç¨‹ä¹‹é—´çš„äº¤äº’ï¼Œçº¿ç¨‹çš„åŒæ­¥ç­‰ï¼›</p>
<p><strong>ä¸Šä¸‹æ–‡ç¯å¢ƒåˆ‡æ¢</strong></p>
<p>çº¿ç¨‹åˆ‡æ¢ï¼Œcpuéœ€è¦ä¿å­˜æœ¬åœ°æ•°æ®ã€ç¨‹åºæŒ‡é’ˆç­‰å†…å®¹ï¼›</p>
<p><strong>æ›´å¤šçš„èµ„æºæ¶ˆè€—</strong></p>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦å†…å­˜ç»´æŠ¤è‡ªå·±çš„æœ¬åœ°æ ˆä¿¡æ¯ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿéœ€è¦èµ„æºå¯¹çº¿ç¨‹è¿›è¡Œç®¡ç†ç»´æŠ¤ï¼›</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Dubbo ç›¸å…³çŸ¥è¯†åŠä½¿ç”¨(ä¸€)</title>
    <url>/2020/12/27/Dubbo%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E5%8F%8A%E4%BD%BF%E7%94%A8%E4%B8%80/</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Dubboå®˜ç½‘åœ°å€ï¼šhttp:&#x2F;&#x2F;dubbo.apache.org</span><br><span class="line">å®˜ç½‘æœ‰è¯¦ç»†çš„æ–‡æ¡£å¯ä¾›å­¦ä¹ ï¼Œå¹¶ä¸”æœ‰ä¸­æ–‡çš„ã€‚</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">èŠ‚ç‚¹</th>
<th>è§’è‰²è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Provider</td>
<td>æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹</td>
</tr>
<tr>
<td align="center">Consumer</td>
<td>è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹</td>
</tr>
<tr>
<td align="center">Registry</td>
<td>æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ</td>
</tr>
<tr>
<td align="center">Monitor</td>
<td>ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ</td>
</tr>
<tr>
<td align="center">Container</td>
<td>æœåŠ¡è¿è¡Œå®¹å™¨</td>
</tr>
</tbody></table>
<p>ç®€å•çš„æè¿°ä¸€ä¸‹è°ƒç”¨å…³ç³»ï¼š</p>
<ol>
<li>æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚ </li>
<li>æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚ </li>
<li>æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚ </li>
<li>æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•° æ®ç»™æ¶ˆè´¹è€…ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨ å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚</li>
</ol>
<hr>
<h3 id="Dubboå¿«é€Ÿå¼€å‘"><a href="#Dubboå¿«é€Ÿå¼€å‘" class="headerlink" title="Dubboå¿«é€Ÿå¼€å‘"></a>Dubboå¿«é€Ÿå¼€å‘</h3><h5 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡:"></a>ç¯å¢ƒå‡†å¤‡:</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create database dubbo;</span><br><span class="line">CREATE TABLE &#96;t_user&#96; (  </span><br><span class="line">    &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">    &#96;name&#96; varchar(20) DEFAULT NULL,</span><br><span class="line">    &#96;age&#96; int(11) DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;3 DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>

<h5 id="åˆ›å»ºçˆ¶å·¥ç¨‹ï¼š"><a href="#åˆ›å»ºçˆ¶å·¥ç¨‹ï¼š" class="headerlink" title="åˆ›å»ºçˆ¶å·¥ç¨‹ï¼š"></a>åˆ›å»ºçˆ¶å·¥ç¨‹ï¼š</h5><p>â€‹    çˆ¶å·¥ç¨‹ï¼Œä¸å®ç°ä»»ä½•ä»£ç ï¼Œä¸»è¦æ˜¯æ·»åŠ å·¥ç¨‹éœ€è¦çš„åº“çš„ä¾èµ–ç®¡ç†ï¼ˆDependencyManagementï¼‰ï¼Œ ä¾èµ–ç®¡ç†å°±æ˜¯è§£å†³é¡¹ç›®ä¸­å¤šä¸ªæ¨¡å—é—´å…¬å…±ä¾èµ–çš„ç‰ˆæœ¬å·ã€scopeçš„æ§åˆ¶èŒƒå›´ã€‚æœ¬é¡¹ç›®éœ€è¦ä½¿ç”¨spring-webmvcï¼Œä½¿ç”¨dubboï¼ˆåŠ¡å¿…2.6.2ä»¥ä¸Šç‰ˆæœ¬ï¼‰ã€zookeeperåŠå…¶å®¢æˆ·ç«¯ï¼ˆcurator-frameworkï¼‰ä¾èµ–åº“ã€‚</p>
<p>â€‹    ä¿®æ”¹pom.xmlæ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.frosro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>dubbo_common<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>dubbo_interface<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>dubbo_provider<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>dubbo_consumer<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql-connector-java.version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">mysql-connector-java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.20<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis-spring.version</span>&gt;</span>2.0.1<span class="tag">&lt;/<span class="name">mybatis-spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">zookeeper.version</span>&gt;</span>3.4.7<span class="tag">&lt;/<span class="name">zookeeper.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">curator.version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">curator.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-api.version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">servlet-api.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jackson.version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">jackson.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ç®¡ç†jaråŒ…, åœ¨å½“å‰å·¥ç¨‹ä¸­ä¸è¿›è¡ŒjaråŒ…åŠ è½½, åªæ˜¯ç®¡ç†ç‰ˆæœ¬--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--ä¸æ•°æ®åº“ç›¸å…³çš„jar--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector-java.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--ä¸Mybatisç›¸å…³çš„--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--Springç›¸å…³çš„jar--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--dubbo,ZooKeeperç›¸å…³çš„jar--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;zookeeper.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;curator.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;curator.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;dubbo.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--servletç›¸å…³çš„jar--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;servlet-api.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--è§£æjsonç›¸å…³çš„jar--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="åˆ›å»ºå…¬å…±å­æ¨¡å—ï¼š"><a href="#åˆ›å»ºå…¬å…±å­æ¨¡å—ï¼š" class="headerlink" title="åˆ›å»ºå…¬å…±å­æ¨¡å—ï¼š"></a>åˆ›å»ºå…¬å…±å­æ¨¡å—ï¼š</h5><p>â€‹        ä¸é€‰æ‹©å·¥ç¨‹æ¨¡æ¿ï¼Œåœ¨çˆ¶å·¥ç¨‹å†…éƒ¨åˆ›å»ºå­æ¨¡å—ï¼Œå‘½åä¸º dubbo_common ã€‚ä¸»è¦æ”¾å…¬å…±ç±»çš„å®šä¹‰ï¼Œå®ƒæ˜¯æ¥å£å­æ¨¡å—çš„ä¾èµ–æ¨¡å—ã€‚</p>
<h6 id="pom-xmlå†…å®¹ï¼š"><a href="#pom-xmlå†…å®¹ï¼š" class="headerlink" title="pom.xmlå†…å®¹ï¼š"></a>pom.xmlå†…å®¹ï¼š</h6><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.frosro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="åœ¨javaæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºåŒ…ï¼šcom-frosro-pojoï¼Œå¹¶æ·»åŠ Userç±»ï¼š"><a href="#åœ¨javaæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºåŒ…ï¼šcom-frosro-pojoï¼Œå¹¶æ·»åŠ Userç±»ï¼š" class="headerlink" title="åœ¨javaæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºåŒ…ï¼šcom.frosro.pojoï¼Œå¹¶æ·»åŠ Userç±»ï¼š"></a>åœ¨javaæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºåŒ…ï¼šcom.frosro.pojoï¼Œå¹¶æ·»åŠ Userç±»ï¼š</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.frosro.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> sy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 15:59</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;<span class="comment">//å¿…é¡»å®ç°Serializableæ¥å£ï¼Œåºåˆ—åŒ–ã€‚ä¸ºäº†ç½‘ç»œä¼ è¾“ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(String age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="åˆ›å»ºæ¥å£å­æ¨¡å—ï¼š"><a href="#åˆ›å»ºæ¥å£å­æ¨¡å—ï¼š" class="headerlink" title="åˆ›å»ºæ¥å£å­æ¨¡å—ï¼š"></a>åˆ›å»ºæ¥å£å­æ¨¡å—ï¼š</h5><pre><code>æ­¤æ¨¡å—ï¼Œä¸»è¦æ˜¯æ”¾ä¸šåŠ¡æ¥å£çš„å®šä¹‰ï¼Œå®ƒæ˜¯æœåŠ¡æ¶ˆè´¹è€…æ¨¡å—å’ŒæœåŠ¡æä¾›è€…æ¨¡å—çš„å…¬å…±ä¾èµ–æ¨¡å—ã€‚å‘½åä¸º:dubbo_interfaceï¼ŒåŒæ ·ä¹Ÿæ˜¯åœ¨çˆ¶å·¥ç¨‹å†…éƒ¨åˆ›å»ºã€‚ </code></pre><h6 id="pom-xmlæ–‡ä»¶ï¼š"><a href="#pom-xmlæ–‡ä»¶ï¼š" class="headerlink" title="pom.xmlæ–‡ä»¶ï¼š"></a>pom.xmlæ–‡ä»¶ï¼š</h6><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.frosro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.frosro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨javaæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºcom.frosro.serviceåŒ…ï¼Œå¹¶åˆ›å»ºæ¥å£ç±»ï¼šUserService</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.frosro.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.frosro.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> sy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 16:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æœåŠ¡æä¾›è€…æ¨¡å—ï¼š"><a href="#æœåŠ¡æä¾›è€…æ¨¡å—ï¼š" class="headerlink" title="æœåŠ¡æä¾›è€…æ¨¡å—ï¼š"></a>æœåŠ¡æä¾›è€…æ¨¡å—ï¼š</h5><p>æ­¤æ¨¡å—æ˜¯æœåŠ¡æä¾›è€…æ¨¡å—ï¼Œéœ€è¦åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼ŒæŠŠæœåŠ¡æ³¨å†Œåˆ°zookeeper,æ•…éœ€è¦å¼•å…¥springwebmvc,zookeeperåŠå®¢æˆ·ç«¯ä¾èµ–ã€‚ </p>
<p>ä½¿ç”¨webappæ¨¡æ¿å·¥ç¨‹åˆ›å»ºå­æ¨¡å—<strong>dubbo_provider</strong></p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2020/12/27/Dubbo%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E5%8F%8A%E4%BD%BF%E7%94%A8%E4%B8%80/1609161306(1).png"  alt="1"></p>
<h6 id="åœ¨pom-xmlä¸­æ·»åŠ å¿…è¦ä¾èµ–ï¼š"><a href="#åœ¨pom-xmlä¸­æ·»åŠ å¿…è¦ä¾èµ–ï¼š" class="headerlink" title="åœ¨pom.xmlä¸­æ·»åŠ å¿…è¦ä¾èµ–ï¼š"></a>åœ¨pom.xmlä¸­æ·»åŠ å¿…è¦ä¾èµ–ï¼š</h6><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.frosro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_provider<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.frosro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            è¿™é‡Œå¯¼å…¥çš„dubbo_interfaceä¸­åŒ…å«äº†dubbo_commonæ‰€ä»¥ä¸å†å¯¼å…¥--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>dubbo_provider<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>8888<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h6 id="åˆå§‹åŒ–javaèµ„æºç›®å½•"><a href="#åˆå§‹åŒ–javaèµ„æºç›®å½•" class="headerlink" title="åˆå§‹åŒ–javaèµ„æºç›®å½•"></a>åˆå§‹åŒ–javaèµ„æºç›®å½•</h6><h6 id="åœ¨javaæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºcom-frosro-daoåŒ…å¹¶åˆ›å»ºæ¥å£ç±»UserDaoï¼š"><a href="#åœ¨javaæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºcom-frosro-daoåŒ…å¹¶åˆ›å»ºæ¥å£ç±»UserDaoï¼š" class="headerlink" title="åœ¨javaæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºcom.frosro.daoåŒ…å¹¶åˆ›å»ºæ¥å£ç±»UserDaoï¼š"></a>åœ¨javaæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºcom.frosro.daoåŒ…å¹¶åˆ›å»ºæ¥å£ç±»UserDaoï¼š</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.frosro.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.frosro.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> sy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 16:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="ç„¶ååœ¨resourcesèµ„æºç›®å½•ä¸‹åŒæ ·åˆ›å»ºcom-frosro-daoåŒ…å¹¶å¢åŠ UserDao-xmlæ–‡ä»¶"><a href="#ç„¶ååœ¨resourcesèµ„æºç›®å½•ä¸‹åŒæ ·åˆ›å»ºcom-frosro-daoåŒ…å¹¶å¢åŠ UserDao-xmlæ–‡ä»¶" class="headerlink" title="ç„¶ååœ¨resourcesèµ„æºç›®å½•ä¸‹åŒæ ·åˆ›å»ºcom.frosro.daoåŒ…å¹¶å¢åŠ UserDao.xmlæ–‡ä»¶"></a>ç„¶ååœ¨resourcesèµ„æºç›®å½•ä¸‹åŒæ ·åˆ›å»ºcom.frosro.daoåŒ…å¹¶å¢åŠ UserDao.xmlæ–‡ä»¶</h6><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.frosro.dao.UserDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">resultType</span>=<span class="string">"com.frosro.pojo.User"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">        select * from t_user where id=#&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="è¿™é‡Œè¦æ·»åŠ UserServiceçš„å…·ä½“å®ç°ï¼Œåœ¨com-frosro-serviceä¸‹æ·»åŠ UserServiceImplå®ç°ç±»ï¼š"><a href="#è¿™é‡Œè¦æ·»åŠ UserServiceçš„å…·ä½“å®ç°ï¼Œåœ¨com-frosro-serviceä¸‹æ·»åŠ UserServiceImplå®ç°ç±»ï¼š" class="headerlink" title="è¿™é‡Œè¦æ·»åŠ UserServiceçš„å…·ä½“å®ç°ï¼Œåœ¨com.frosro.serviceä¸‹æ·»åŠ UserServiceImplå®ç°ç±»ï¼š"></a>è¿™é‡Œè¦æ·»åŠ UserServiceçš„å…·ä½“å®ç°ï¼Œåœ¨com.frosro.serviceä¸‹æ·»åŠ UserServiceImplå®ç°ç±»ï¼š</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.frosro.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.frosro.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.frosro.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> sy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 16:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//@Service è¿™æ˜¯springmvcçš„æ³¨è§£</span></span><br><span class="line">    <span class="meta">@Service</span><span class="comment">// æ¢æˆdubboçš„serviceæ³¨è§£ï¼Œç›¸åº”xmlé…ç½®ä¸­æ¢æˆåŒ…æ‰«æ</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºå…¶ä»–çš„ä¸€äº›é…ç½®æ–‡ä»¶ï¼š"><a href="#åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºå…¶ä»–çš„ä¸€äº›é…ç½®æ–‡ä»¶ï¼š" class="headerlink" title="åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºå…¶ä»–çš„ä¸€äº›é…ç½®æ–‡ä»¶ï¼š"></a>åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºå…¶ä»–çš„ä¸€äº›é…ç½®æ–‡ä»¶ï¼š</h6><p>dubboçš„é…ç½®æ–‡ä»¶ï¼šspring-dubbo.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://dubbo.apache.org/schema/dubbo</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://dubbo.apache.org/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    ç»™æä¾›è€…èµ·ä¸ªåå­—--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubbo_provider"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    Â &lt;dubbo:registry address="zookeeper://39.106.92.113:2181"/&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    zkçš„åœ°å€ï¼Œè¿™é‡Œè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªzké›†ç¾¤ï¼Œå¦‚æœæ˜¯å•æœºè¯ï¼Œå¯ä»¥å†™æˆä¸Šé¢é‚£æ ·--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">"zookeeper"</span> <span class="attr">address</span>=<span class="string">"192.168.234.130:2181,192.168.234.131:2181,192.168.234.132:2181"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!--    æš´éœ²æœåŠ¡çš„åœ°å€    --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;dubbo:service interface="com.frosro.service.UserService" ref="userServiceImpl"/&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    dubboçš„serviceæ³¨è§£çš„åŒ…æ‰«æï¼Œä¸ä¸Šé¢ä½œç”¨ä¸€æ · --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">"com.frosro.service"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h6 id="springçš„é…ç½®æ–‡ä»¶spring-xml"><a href="#springçš„é…ç½®æ–‡ä»¶spring-xml" class="headerlink" title="springçš„é…ç½®æ–‡ä»¶spring.xml"></a>springçš„é…ç½®æ–‡ä»¶spring.xml</h6><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--åŠ è½½å±æ€§æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®æ•°æ®æº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"druidDataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClassName&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®SQLSessionFactory--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"druidDataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®Mapperæ–‡ä»¶æ‰«æ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"scannerConfigurer"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionFactory"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.frosro.dao"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®äº‹åŠ¡ç®¡ç†å™¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"druidDataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--äº‹åŠ¡æ³¨è§£é©±åŠ¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--è‡ªåŠ¨æ‰«åŒ…--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.frosro.service"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>log4jçš„é…ç½®æ–‡ä»¶ log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">### direct log messages to stdout ###</span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.Target</span>=<span class="string">System.err</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">debug, stdout</span></span><br></pre></td></tr></table></figure>



<p>æ•°æ®åº“è¿æ¥çš„ jdbc.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">jdbc.driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/dubbo</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>



<p>åœ¨webapp/WEB-INFä¸‹çš„web.xmlå†…:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">web-app</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="æä¾›è€…çš„æ•´ä½“æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š"><a href="#æä¾›è€…çš„æ•´ä½“æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š" class="headerlink" title="æä¾›è€…çš„æ•´ä½“æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š"></a>æä¾›è€…çš„æ•´ä½“æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</h6><p><img src="/img/loading.gif" class="lazyload" data-src="/2020/12/27/Dubbo%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E5%8F%8A%E4%BD%BF%E7%94%A8%E4%B8%80/1609163369(1).png"  alt="2"></p>
<h5 id="ä¸‹é¢åˆ›å»ºæ¶ˆè´¹è€…æ¨¡å—dubbo-consumerï¼š"><a href="#ä¸‹é¢åˆ›å»ºæ¶ˆè´¹è€…æ¨¡å—dubbo-consumerï¼š" class="headerlink" title="ä¸‹é¢åˆ›å»ºæ¶ˆè´¹è€…æ¨¡å—dubbo-consumerï¼š"></a>ä¸‹é¢åˆ›å»ºæ¶ˆè´¹è€…æ¨¡å—dubbo-consumerï¼š</h5><p>åŒæ ·ä½¿ç”¨webappçš„å·¥ç¨‹æ¨¡æ¿è¿›è¡Œåˆ›å»º</p>
<h6 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h6><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.frosro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_consumer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.frosro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>dubbo_consumer<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9999<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨javaç›®å½•ä¸‹åˆ›å»ºcom.frosro.controlleråŒ…ï¼Œå¹¶ä¸”åˆ›å»ºUserControllerç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.frosro.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.frosro.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.frosro.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> sy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 16:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Autowired</span></span><br><span class="line">    <span class="meta">@Reference</span> <span class="comment">//è¿™æ˜¯dubboçš„@Referenceæ ‡ç­¾,ä»£æ›¿@Autowired å¹¶ä¸” å»æ‰äº†xml ä¸­çš„ dubbo:reference é…ç½®</span></span><br><span class="line">   <span class="keyword">public</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/findById"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="åœ¨resourcesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºï¼š"><a href="#åœ¨resourcesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºï¼š" class="headerlink" title="åœ¨resourcesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºï¼š"></a>åœ¨resourcesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºï¼š</h6><p>spring-dubbo.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://dubbo.apache.org/schema/dubbo</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://dubbo.apache.org/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubbo_consumer"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">"zookeeper"</span> <span class="attr">address</span>=<span class="string">"192.168.234.130:2181,192.168.234.131:2181,192.168.234.132:2181"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    &lt;dubbo:reference interface="com.frosro.service.UserService" id="userService"/&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    å¼€å¯controlleråŒ…å†…çš„æ³¨è§£æ‰«æ,å°†ä¸Šé¢ dubbo:reference æ”¹ä¸ºæ³¨è§£å½¢å¼  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">"com.frosro.controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:annotation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spring.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--è‡ªåŠ¨æ‰«åŒ…--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.frosro.controller"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ³¨è§£é©±åŠ¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="webappä¸‹çš„web-xmlæ–‡ä»¶ï¼š"><a href="#webappä¸‹çš„web-xmlæ–‡ä»¶ï¼š" class="headerlink" title="webappä¸‹çš„web.xmlæ–‡ä»¶ï¼š"></a>webappä¸‹çš„web.xmlæ–‡ä»¶ï¼š</h6><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">web-app</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h5 id="ä¸‹é¢å¯åŠ¨è™šæ‹Ÿæœº"><a href="#ä¸‹é¢å¯åŠ¨è™šæ‹Ÿæœº" class="headerlink" title="ä¸‹é¢å¯åŠ¨è™šæ‹Ÿæœº"></a>ä¸‹é¢å¯åŠ¨è™šæ‹Ÿæœº</h5><h6 id="æˆ‘é€šè¿‡MobaXtermè¿›è¡Œè¿æ¥ï¼Œå¼€å¯å†…éƒ¨å®‰è£…çš„zké›†ç¾¤ã€‚"><a href="#æˆ‘é€šè¿‡MobaXtermè¿›è¡Œè¿æ¥ï¼Œå¼€å¯å†…éƒ¨å®‰è£…çš„zké›†ç¾¤ã€‚" class="headerlink" title="æˆ‘é€šè¿‡MobaXtermè¿›è¡Œè¿æ¥ï¼Œå¼€å¯å†…éƒ¨å®‰è£…çš„zké›†ç¾¤ã€‚"></a>æˆ‘é€šè¿‡MobaXtermè¿›è¡Œè¿æ¥ï¼Œå¼€å¯å†…éƒ¨å®‰è£…çš„zké›†ç¾¤ã€‚</h6><p><img src="/img/loading.gif" class="lazyload" data-src="/2020/12/27/Dubbo%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E5%8F%8A%E4%BD%BF%E7%94%A8%E4%B8%80/1609164240(1).png"  alt="3"></p>
<h6 id="å¼€å¯åè¿›å»zkçš„å®¢æˆ·ç«¯"><a href="#å¼€å¯åè¿›å»zkçš„å®¢æˆ·ç«¯" class="headerlink" title="å¼€å¯åè¿›å»zkçš„å®¢æˆ·ç«¯"></a>å¼€å¯åè¿›å»zkçš„å®¢æˆ·ç«¯</h6><p><img src="/img/loading.gif" class="lazyload" data-src="/2020/12/27/Dubbo%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E5%8F%8A%E4%BD%BF%E7%94%A8%E4%B8%80/1609164557(1).png"  alt="4"></p>
<h6 id="è¿™ä¸ªæ—¶å€™æ¶ˆè´¹è€…å’Œæä¾›è€…å†…éƒ¨éƒ½æ˜¯ç©ºçš„ï¼Œåˆ†åˆ«å¯åŠ¨æä¾›è€…å’Œæ¶ˆè´¹è€…çš„tomcatæ’ä»¶ï¼›"><a href="#è¿™ä¸ªæ—¶å€™æ¶ˆè´¹è€…å’Œæä¾›è€…å†…éƒ¨éƒ½æ˜¯ç©ºçš„ï¼Œåˆ†åˆ«å¯åŠ¨æä¾›è€…å’Œæ¶ˆè´¹è€…çš„tomcatæ’ä»¶ï¼›" class="headerlink" title="è¿™ä¸ªæ—¶å€™æ¶ˆè´¹è€…å’Œæä¾›è€…å†…éƒ¨éƒ½æ˜¯ç©ºçš„ï¼Œåˆ†åˆ«å¯åŠ¨æä¾›è€…å’Œæ¶ˆè´¹è€…çš„tomcatæ’ä»¶ï¼›"></a>è¿™ä¸ªæ—¶å€™æ¶ˆè´¹è€…å’Œæä¾›è€…å†…éƒ¨éƒ½æ˜¯ç©ºçš„ï¼Œåˆ†åˆ«å¯åŠ¨æä¾›è€…å’Œæ¶ˆè´¹è€…çš„tomcatæ’ä»¶ï¼›</h6><p><img src="/img/loading.gif" class="lazyload" data-src="/2020/12/27/Dubbo%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E5%8F%8A%E4%BD%BF%E7%94%A8%E4%B8%80/1609164667(1).png"  alt="5"></p>
<p>ç°åœ¨å¯ä»¥çœ‹åˆ°zkä¸Šdubboé‡Œæœ‰å€¼äº†</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2020/12/27/Dubbo%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E5%8F%8A%E4%BD%BF%E7%94%A8%E4%B8%80/1609164804(1).png"  alt="6"></p>
<h6 id="æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨http-localhost-9999-user-findById-do-id-1è®¿é—®æ¶ˆè´¹è€…ï¼Œå¯ä»¥è·å–æ•°æ®åº“å†…çš„å€¼"><a href="#æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨http-localhost-9999-user-findById-do-id-1è®¿é—®æ¶ˆè´¹è€…ï¼Œå¯ä»¥è·å–æ•°æ®åº“å†…çš„å€¼" class="headerlink" title="æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨http://localhost:9999/user/findById.do?id=1è®¿é—®æ¶ˆè´¹è€…ï¼Œå¯ä»¥è·å–æ•°æ®åº“å†…çš„å€¼"></a>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨<a href="http://localhost:9999/user/findById.do?id=1è®¿é—®æ¶ˆè´¹è€…ï¼Œå¯ä»¥è·å–æ•°æ®åº“å†…çš„å€¼" target="_blank" rel="noopener">http://localhost:9999/user/findById.do?id=1è®¿é—®æ¶ˆè´¹è€…ï¼Œå¯ä»¥è·å–æ•°æ®åº“å†…çš„å€¼</a></h6><p><img src="/img/loading.gif" class="lazyload" data-src="/2020/12/27/Dubbo%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E5%8F%8A%E4%BD%BF%E7%94%A8%E4%B8%80/1609164929(1).png"  alt="7"></p>
]]></content>
      <categories>
        <category>ğŸ‚æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
        <tag>RPC</tag>
        <tag>æ¡†æ¶</tag>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title>é‡å¯</title>
    <url>/2020/12/23/%E9%87%8D%E5%90%AF/</url>
    <content><![CDATA[<hr>
<p>â€‹        å¿«åˆ°2021å¹´äº†ï¼Œä»ä¹æœˆä»½å¼€å§‹åˆ°ç°åœ¨ï¼Œå¤§æ¦‚å››ä¸ªæœˆçš„æ—¶é—´äº†ï¼Œæˆ‘é€æ¸é€‚åº”äº†æ–°çš„ç¯å¢ƒå’Œå·¥ä½œï¼Œè™½ç„¶è¿˜æœ‰å¾ˆå¤šæ¬ ç¼ºï¼Œä¸ç®¡æ˜¯åœ¨ä¸šåŠ¡ä¸Šè¿˜æ˜¯æŠ€æœ¯ä¸Šã€‚ä½†è¿™æ˜¯ä¸€ä¸ªä¸é”™çš„å¼€å§‹ã€‚</p>
<p>â€‹        æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šå°†ç©ºé—²çš„æ—¶é—´å…¨éƒ¨æŠ•å…¥åˆ°å­¦ä¹ ä¸­ï¼Œäº‰å–æ¥å¹´èƒ½æœ‰æ›´å¤§çš„è¿›æ­¥ã€‚å¹¶ä¸”ä¼šé€æ­¥æ¢å¤å­¦ä¹ ç¬”è®°çš„è®°å½•ï¼Œè®°å½•ä¸‹é‚£äº›å·¥ä½œæˆ–è€…å­¦ä¹ ä¸Šçš„éš¾ç‚¹ã€‚</p>
<p>â€‹        <del>~</del>ï¼go    </p>
]]></content>
      <categories>
        <category>ğŸŸå°å°è®°</category>
      </categories>
      <tags>
        <tag>å†ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>è½¬æˆ˜æˆéƒ½</title>
    <url>/2020/08/26/%E8%BD%AC%E6%88%98%E6%88%90%E9%83%BD/</url>
    <content><![CDATA[<p>2020å¹´8æœˆ24æ—¥   æ˜ŸæœŸä¸€   æ™´</p>
<p>æˆ‘è¿›å…¥äº†æ–°çš„å·¥ä½œç¯å¢ƒï¼Œæ˜¯ä¸­è½¯çš„å¤–åŒ…å¹³å®‰çº¿ï¼Œä¸å¯å¦è®¤ï¼Œè¿™å¯èƒ½ä¸æ˜¯ä¸€ä»½å¥½å·¥ä½œï¼Œä½†å·¥èµ„æˆ‘è¿˜æ˜¯è§‰å¾—è¾ƒä¸ºå¯è§‚ï¼Œæ¯å¤©ä¹Ÿä¸éœ€è¦åŠ ç­ï¼Œä¸€åˆ‡éƒ½æ˜¯ä¸ºäº†ç”Ÿæ´»ã€‚</p>
<p>é¡¹ç›®ç”¨çš„æ˜¯æˆ‘ä¸ç†Ÿæ‚‰çš„æŠ€æœ¯ï¼Œ</p>
<p>æ•°æ®åº“æ˜¯Orcalï¼Œæˆ‘è§‰å¾—æˆ‘å¯ä»¥å¥½å¥½å­¦ä¸€ä¸‹ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸–ç•Œä¸Šé¡¶çº§çš„æ•°æ®åº“ã€‚</p>
<p>æœåŠ¡å™¨ä¸å†æ˜¯Tomcatï¼Œè€Œæ˜¯WebLogicï¼Œä¹Ÿæœ‰å¿…è¦å¥½å¥½äº†è§£ä¸€ä¸‹çœ‹ã€‚</p>
<p>è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä¸œè¥¿ï¼›</p>
<p>è¿™ä¸ªäººäº‹ç®¡ç†ç³»ç»Ÿç›®å‰åˆ†ä¸ºè€ç‰ˆæœ¬å’Œæ–°ç‰ˆæœ¬ï¼Œè¿˜æœ‰ä¸€ä¸ªç§»åŠ¨ç«¯ã€‚</p>
<p>ç›®å‰æˆ‘åªçœ‹åˆ°äº†è€ç‰ˆæœ¬çš„ä»£ç ï¼Œå¸Œæœ›å¯ä»¥ä»ä¸­å­¦åˆ°ä¸å°‘æœ‰ç”¨çš„çŸ¥è¯†ã€‚</p>
]]></content>
      <categories>
        <category>ğŸŸå°å°è®°</category>
      </categories>
      <tags>
        <tag>å†ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Java synchronizedåŸç†æ€»ç»“</title>
    <url>/2020/07/26/Java-synchronized%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>æˆ‘è§‰å¾—å¹¶ä¸ä¼šæ¯”ä»–å†™å¾—å¥½ï¼š</p>
<p><a href="https://zhuanlan.zhihu.com/p/29866981" target="_blank" rel="noopener">ç‚¹å‡»æ­¤å¤„</a></p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>synchronized</tag>
        <tag>é”</tag>
        <tag>åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>java JVM çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java-JVM-%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-è¯´ä¸€ä¸‹-JVM-çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼ŸåŠå…¶ä½œç”¨ï¼Ÿ"><a href="#1-è¯´ä¸€ä¸‹-JVM-çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼ŸåŠå…¶ä½œç”¨ï¼Ÿ" class="headerlink" title="1. è¯´ä¸€ä¸‹ JVM çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼ŸåŠå…¶ä½œç”¨ï¼Ÿ"></a><strong>1.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>JVM</strong> <strong>çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼ŸåŠå…¶ä½œç”¨ï¼Ÿ</strong></h4><p>Â·    ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰</p>
<p>Â·    è¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime Data Areaï¼‰</p>
<p>Â·    æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰</p>
<p>Â·    æœ¬åœ°åº“æ¥å£ï¼ˆNative Interfaceï¼‰</p>
<p>ç»„ä»¶çš„ä½œç”¨ï¼š é¦–å…ˆé€šè¿‡ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ä¼šæŠŠ Java ä»£ç è½¬æ¢æˆå­—èŠ‚ç ï¼Œè¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime Data Areaï¼‰å†æŠŠå­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œå­—èŠ‚ç æ–‡ä»¶åªæ˜¯ JVM çš„ä¸€å¥—æŒ‡ä»¤é›†è§„èŒƒï¼Œå¹¶ä¸èƒ½ç›´æ¥äº¤ç»™åº•å±‚æ“ä½œç³»ç»Ÿå»æ‰§è¡Œï¼Œå› æ­¤éœ€è¦ç‰¹å®šçš„å‘½ä»¤è§£æå™¨æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰ï¼Œå°†å­—èŠ‚ç ç¿»è¯‘æˆåº•å±‚ç³»ç»ŸæŒ‡ä»¤ï¼Œå†äº¤ç”± CPU å»æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨å…¶ä»–è¯­è¨€çš„æœ¬åœ°åº“æ¥å£ï¼ˆNative Interfaceï¼‰æ¥å®ç°æ•´ä¸ªç¨‹åºçš„åŠŸèƒ½ã€‚</p>
<h4 id="2-è¯´ä¸€ä¸‹-JVM-è¿è¡Œæ—¶æ•°æ®åŒºï¼Ÿ"><a href="#2-è¯´ä¸€ä¸‹-JVM-è¿è¡Œæ—¶æ•°æ®åŒºï¼Ÿ" class="headerlink" title="2. è¯´ä¸€ä¸‹ JVM è¿è¡Œæ—¶æ•°æ®åŒºï¼Ÿ"></a><strong>2.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>JVM</strong> <strong>è¿è¡Œæ—¶æ•°æ®åŒºï¼Ÿ</strong></h4><p>ä¸åŒè™šæ‹Ÿæœºçš„è¿è¡Œæ—¶æ•°æ®åŒºå¯èƒ½ç•¥å¾®æœ‰æ‰€ä¸åŒï¼Œä½†éƒ½ä¼šéµä» Java è™šæ‹Ÿæœºè§„èŒƒï¼Œ Java è™šæ‹Ÿæœºè§„èŒƒè§„å®šçš„åŒºåŸŸåˆ†ä¸ºä»¥ä¸‹ 5 ä¸ªéƒ¨åˆ†ï¼š</p>
<p>Â·   ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼šå½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œå­—èŠ‚ç è§£æå™¨çš„å·¥ä½œæ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼ï¼Œæ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½ï¼Œéƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆï¼›</p>
<p>Â·   Java è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰ï¼šç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼›</p>
<p>Â·   æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ï¼šä¸è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è™šæ‹Ÿæœºæ ˆæ˜¯æœåŠ¡ Java æ–¹æ³•çš„ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºè°ƒç”¨ Native æ–¹æ³•æœåŠ¡çš„ï¼›</p>
<p>Â·   Java å †ï¼ˆJava Heapï¼‰ï¼šJava è™šæ‹Ÿæœºä¸­å†…å­˜æœ€å¤§çš„ä¸€å—ï¼Œæ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ï¼›</p>
<p>Â·   æ–¹æ³•åŒºï¼ˆMethed Areaï¼‰ï¼šç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</p>
<h4 id="3-è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ"><a href="#3-è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3. è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ"></a><strong>3.</strong> <strong>è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    åŠŸèƒ½æ–¹é¢ï¼šå †æ˜¯ç”¨æ¥å­˜æ”¾å¯¹è±¡çš„ï¼Œæ ˆæ˜¯ç”¨æ¥æ‰§è¡Œç¨‹åºçš„ã€‚</p>
<p>Â·    å…±äº«æ€§ï¼šå †æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p>
<p>Â·    ç©ºé—´å¤§å°ï¼šå †å¤§å°è¿œè¿œå¤§äºæ ˆã€‚</p>
<h4 id="4-é˜Ÿåˆ—å’Œæ ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#4-é˜Ÿåˆ—å’Œæ ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="4. é˜Ÿåˆ—å’Œæ ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>4.</strong> <strong>é˜Ÿåˆ—å’Œæ ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>é˜Ÿåˆ—å’Œæ ˆéƒ½æ˜¯è¢«ç”¨æ¥é¢„å­˜å‚¨æ•°æ®çš„ã€‚</p>
<p>é˜Ÿåˆ—å…è®¸å…ˆè¿›å…ˆå‡ºæ£€ç´¢å…ƒç´ ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–çš„æƒ…å†µï¼ŒDeque æ¥å£å…è®¸ä»ä¸¤ç«¯æ£€ç´¢å…ƒç´ ã€‚</p>
<p>æ ˆå’Œé˜Ÿåˆ—å¾ˆç›¸ä¼¼ï¼Œä½†å®ƒè¿è¡Œå¯¹å…ƒç´ è¿›è¡Œåè¿›å…ˆå‡ºè¿›è¡Œæ£€ç´¢ã€‚</p>
<h4 id="5-ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ"><a href="#5-ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ" class="headerlink" title="5. ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ"></a><strong>5.</strong> <strong>ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</strong></h4><p>åœ¨ä»‹ç»åŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰å…ˆè¯´ä¸‹ç±»åŠ è½½å™¨ã€‚å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®ç«‹åœ¨ JVM ä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚ç±»åŠ è½½å™¨å°±æ˜¯æ ¹æ®æŒ‡å®šå…¨é™å®šåç§°å°† class æ–‡ä»¶åŠ è½½åˆ° JVM å†…å­˜ï¼Œç„¶åå†è½¬åŒ–ä¸º class å¯¹è±¡ã€‚</p>
<p>ç±»åŠ è½½å™¨åˆ†ç±»ï¼š</p>
<p>Â·    å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥åŠ è½½Java_HOME/lib/ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢« -Xbootclasspath å‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­å¹¶ä¸”è¢«è™šæ‹Ÿæœºè¯†åˆ«çš„ç±»åº“ï¼›</p>
<p>Â·    å…¶ä»–ç±»åŠ è½½å™¨ï¼š</p>
<p>Â·    æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼šè´Ÿè´£åŠ è½½<java_home>\lib\extç›®å½•æˆ–Java. ext. dirsç³»ç»Ÿå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ï¼›</java_home></p>
<p>Â·    åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ã€‚è´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆclasspathï¼‰ä¸Šçš„æŒ‡å®šç±»åº“ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ã€‚ä¸€èˆ¬æƒ…å†µï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰è‡ªå®šä¹‰ç±»åŠ è½½å™¨é»˜è®¤å°±æ˜¯ç”¨è¿™ä¸ªåŠ è½½å™¨ã€‚</p>
<p>åŒäº²å§”æ´¾æ¨¡å‹ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€å±‚çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œè¿™æ ·æ‰€æœ‰çš„åŠ è½½è¯·æ±‚éƒ½ä¼šè¢«ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•å»åŠ è½½ç±»ã€‚</p>
<h4 id="6-è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ"><a href="#6-è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ" class="headerlink" title="6. è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ"></a><strong>6.</strong> <strong>è¯´ä¸€ä¸‹ç±»è£…è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ</strong></h4><p>ç±»è£…è½½åˆ†ä¸ºä»¥ä¸‹ 5 ä¸ªæ­¥éª¤ï¼š</p>
<p>Â·    åŠ è½½ï¼šæ ¹æ®æŸ¥æ‰¾è·¯å¾„æ‰¾åˆ°ç›¸åº”çš„ class æ–‡ä»¶ç„¶åå¯¼å…¥ï¼›</p>
<p>Â·    æ£€æŸ¥ï¼šæ£€æŸ¥åŠ è½½çš„ class æ–‡ä»¶çš„æ­£ç¡®æ€§ï¼›</p>
<p>Â·    å‡†å¤‡ï¼šç»™ç±»ä¸­çš„é™æ€å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼›</p>
<p>Â·    è§£æï¼šè™šæ‹Ÿæœºå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢æˆç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ç¬¦å·å¼•ç”¨å°±ç†è§£ä¸ºä¸€ä¸ªæ ‡ç¤ºï¼Œè€Œåœ¨ç›´æ¥å¼•ç”¨ç›´æ¥æŒ‡å‘å†…å­˜ä¸­çš„åœ°å€ï¼›</p>
<p>Â·    åˆå§‹åŒ–ï¼šå¯¹é™æ€å˜é‡å’Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</p>
<h4 id="7-æ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ï¼Ÿ"><a href="#7-æ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ï¼Ÿ" class="headerlink" title="7. æ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ï¼Ÿ"></a><strong>7.</strong> <strong>æ€ä¹ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ï¼Ÿ</strong></h4><p>ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•æ¥åˆ¤æ–­ï¼š</p>
<p>Â·    å¼•ç”¨è®¡æ•°å™¨ï¼šä¸ºæ¯ä¸ªå¯¹è±¡åˆ›å»ºä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œæœ‰å¯¹è±¡å¼•ç”¨æ—¶è®¡æ•°å™¨ +1ï¼Œå¼•ç”¨è¢«é‡Šæ”¾æ—¶è®¡æ•° -1ï¼Œå½“è®¡æ•°å™¨ä¸º 0 æ—¶å°±å¯ä»¥è¢«å›æ”¶ã€‚å®ƒæœ‰ä¸€ä¸ªç¼ºç‚¹ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼›</p>
<p>Â·    å¯è¾¾æ€§åˆ†æï¼šä» GC Roots å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ã€‚å½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯å¯ä»¥è¢«å›æ”¶çš„ã€‚</p>
<h4 id="8-Java-ä¸­éƒ½æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ"><a href="#8-Java-ä¸­éƒ½æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ" class="headerlink" title="8. Java ä¸­éƒ½æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ"></a><strong>8. Java</strong> <strong>ä¸­éƒ½æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ</strong></h4><p>Â·    å¼ºå¼•ç”¨ï¼šå‘ç”Ÿ gc çš„æ—¶å€™ä¸ä¼šè¢«å›æ”¶ã€‚</p>
<p>Â·    è½¯å¼•ç”¨ï¼šæœ‰ç”¨ä½†ä¸æ˜¯å¿…é¡»çš„å¯¹è±¡ï¼Œåœ¨å‘ç”Ÿå†…å­˜æº¢å‡ºä¹‹å‰ä¼šè¢«å›æ”¶ã€‚</p>
<p>Â·    å¼±å¼•ç”¨ï¼šæœ‰ç”¨ä½†ä¸æ˜¯å¿…é¡»çš„å¯¹è±¡ï¼Œåœ¨ä¸‹ä¸€æ¬¡GCæ—¶ä¼šè¢«å›æ”¶ã€‚</p>
<p>Â·    è™šå¼•ç”¨ï¼ˆå¹½çµå¼•ç”¨/å¹»å½±å¼•ç”¨ï¼‰ï¼šæ— æ³•é€šè¿‡è™šå¼•ç”¨è·å¾—å¯¹è±¡ï¼Œç”¨ PhantomReference å®ç°è™šå¼•ç”¨ï¼Œè™šå¼•ç”¨çš„ç”¨é€”æ˜¯åœ¨ gc æ—¶è¿”å›ä¸€ä¸ªé€šçŸ¥ã€‚</p>
<h4 id="9-è¯´ä¸€ä¸‹-JVM-æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ"><a href="#9-è¯´ä¸€ä¸‹-JVM-æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ" class="headerlink" title="9. è¯´ä¸€ä¸‹ JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ"></a><strong>9.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>JVM</strong> <strong>æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ</strong></h4><p>Â·    æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼šæ ‡è®°æ— ç”¨å¯¹è±¡ï¼Œç„¶åè¿›è¡Œæ¸…é™¤å›æ”¶ã€‚ç¼ºç‚¹ï¼šæ•ˆç‡ä¸é«˜ï¼Œæ— æ³•æ¸…é™¤åƒåœ¾ç¢ç‰‡ã€‚</p>
<p>Â·    æ ‡è®°-æ•´ç†ç®—æ³•ï¼šæ ‡è®°æ— ç”¨å¯¹è±¡ï¼Œè®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…é™¤æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p>
<p>Â·    å¤åˆ¶ç®—æ³•ï¼šæŒ‰ç…§å®¹é‡åˆ’åˆ†äºŒä¸ªå¤§å°ç›¸ç­‰çš„å†…å­˜åŒºåŸŸï¼Œå½“ä¸€å—ç”¨å®Œçš„æ—¶å€™å°†æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚ç¼ºç‚¹ï¼šå†…å­˜ä½¿ç”¨ç‡ä¸é«˜ï¼Œåªæœ‰åŸæ¥çš„ä¸€åŠã€‚</p>
<p>Â·    åˆ†ä»£ç®—æ³•ï¼šæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬æ˜¯æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£åŸºæœ¬é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•ã€‚</p>
<h4 id="10-è¯´ä¸€ä¸‹-JVM-æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ"><a href="#10-è¯´ä¸€ä¸‹-JVM-æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ" class="headerlink" title="10. è¯´ä¸€ä¸‹ JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ"></a><strong>10.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>JVM</strong> <strong>æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ</strong></h4><p>Â·    Serialï¼šæœ€æ—©çš„å•çº¿ç¨‹ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ã€‚</p>
<p>Â·    Serial Oldï¼šSerial åƒåœ¾å›æ”¶å™¨çš„è€å¹´ç‰ˆæœ¬ï¼ŒåŒæ ·ä¹Ÿæ˜¯å•çº¿ç¨‹çš„ï¼Œå¯ä»¥ä½œä¸º CMS åƒåœ¾å›æ”¶å™¨çš„å¤‡é€‰é¢„æ¡ˆã€‚</p>
<p>Â·    ParNewï¼šæ˜¯ Serial çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚</p>
<p>Â·    Parallel å’Œ ParNew æ”¶é›†å™¨ç±»ä¼¼æ˜¯å¤šçº¿ç¨‹çš„ï¼Œä½† Parallel æ˜¯ååé‡ä¼˜å…ˆçš„æ”¶é›†å™¨ï¼Œå¯ä»¥ç‰ºç‰²ç­‰å¾…æ—¶é—´æ¢å–ç³»ç»Ÿçš„ååé‡ã€‚</p>
<p>Â·    Parallel Old æ˜¯ Parallel è€ç”Ÿä»£ç‰ˆæœ¬ï¼ŒParallel ä½¿ç”¨çš„æ˜¯å¤åˆ¶çš„å†…å­˜å›æ”¶ç®—æ³•ï¼ŒParallel Old ä½¿ç”¨çš„æ˜¯æ ‡è®°-æ•´ç†çš„å†…å­˜å›æ”¶ç®—æ³•ã€‚</p>
<p>Â·    CMSï¼šä¸€ç§ä»¥è·å¾—æœ€çŸ­åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œéå¸¸é€‚ç”¨ B/S ç³»ç»Ÿã€‚</p>
<p>Â·    G1ï¼šä¸€ç§å…¼é¡¾ååé‡å’Œåœé¡¿æ—¶é—´çš„ GC å®ç°ï¼Œæ˜¯ JDK 9 ä»¥åçš„é»˜è®¤ GC é€‰é¡¹ã€‚</p>
<h4 id="11-è¯¦ç»†ä»‹ç»ä¸€ä¸‹-CMS-åƒåœ¾å›æ”¶å™¨ï¼Ÿ"><a href="#11-è¯¦ç»†ä»‹ç»ä¸€ä¸‹-CMS-åƒåœ¾å›æ”¶å™¨ï¼Ÿ" class="headerlink" title="11. è¯¦ç»†ä»‹ç»ä¸€ä¸‹ CMS åƒåœ¾å›æ”¶å™¨ï¼Ÿ"></a><strong>11.</strong> <strong>è¯¦ç»†ä»‹ç»ä¸€ä¸‹</strong> <strong>CMS</strong> <strong>åƒåœ¾å›æ”¶å™¨ï¼Ÿ</strong></h4><p>CMS æ˜¯è‹±æ–‡ Concurrent Mark-Sweep çš„ç®€ç§°ï¼Œæ˜¯ä»¥ç‰ºç‰²ååé‡ä¸ºä»£ä»·æ¥è·å¾—æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´çš„åƒåœ¾å›æ”¶å™¨ã€‚å¯¹äºè¦æ±‚æœåŠ¡å™¨å“åº”é€Ÿåº¦çš„åº”ç”¨ä¸Šï¼Œè¿™ç§åƒåœ¾å›æ”¶å™¨éå¸¸é€‚åˆã€‚åœ¨å¯åŠ¨ JVM çš„å‚æ•°åŠ ä¸Šâ€œ-XX:+UseConcMarkSweepGCâ€æ¥æŒ‡å®šä½¿ç”¨ CMS åƒåœ¾å›æ”¶å™¨ã€‚</p>
<p>CMS ä½¿ç”¨çš„æ˜¯æ ‡è®°-æ¸…é™¤çš„ç®—æ³•å®ç°çš„ï¼Œæ‰€ä»¥åœ¨ gc çš„æ—¶å€™å›äº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå½“å‰©ä½™å†…å­˜ä¸èƒ½æ»¡è¶³ç¨‹åºè¿è¡Œè¦æ±‚æ—¶ï¼Œç³»ç»Ÿå°†ä¼šå‡ºç° Concurrent Mode Failureï¼Œä¸´æ—¶ CMS ä¼šé‡‡ç”¨ Serial Old å›æ”¶å™¨è¿›è¡Œåƒåœ¾æ¸…é™¤ï¼Œæ­¤æ—¶çš„æ€§èƒ½å°†ä¼šè¢«é™ä½ã€‚</p>
<h4 id="12-æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨å’Œè€ç”Ÿä»£åƒåœ¾å›æ”¶å™¨éƒ½æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#12-æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨å’Œè€ç”Ÿä»£åƒåœ¾å›æ”¶å™¨éƒ½æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="12. æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨å’Œè€ç”Ÿä»£åƒåœ¾å›æ”¶å™¨éƒ½æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>12.</strong> <strong>æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨å’Œè€ç”Ÿä»£åƒåœ¾å›æ”¶å™¨éƒ½æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    æ–°ç”Ÿä»£å›æ”¶å™¨ï¼šSerialã€ParNewã€Parallel Scavenge</p>
<p>Â·    è€å¹´ä»£å›æ”¶å™¨ï¼šSerial Oldã€Parallel Oldã€CMS</p>
<p>Â·    æ•´å †å›æ”¶å™¨ï¼šG1</p>
<p>æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•ï¼Œå¤åˆ¶ç®—æ³•çš„ä¼˜ç‚¹æ˜¯æ•ˆç‡é«˜ï¼Œç¼ºç‚¹æ˜¯å†…å­˜åˆ©ç”¨ç‡ä½ï¼›è€å¹´ä»£å›æ”¶å™¨ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯æ ‡è®°-æ•´ç†çš„ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p>
<h4 id="13-ç®€è¿°åˆ†ä»£åƒåœ¾å›æ”¶å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"><a href="#13-ç®€è¿°åˆ†ä»£åƒåœ¾å›æ”¶å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ" class="headerlink" title="13. ç®€è¿°åˆ†ä»£åƒåœ¾å›æ”¶å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"></a><strong>13.</strong> <strong>ç®€è¿°åˆ†ä»£åƒåœ¾å›æ”¶å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</strong></h4><p>åˆ†ä»£å›æ”¶å™¨æœ‰ä¸¤ä¸ªåˆ†åŒºï¼šè€ç”Ÿä»£å’Œæ–°ç”Ÿä»£ï¼Œæ–°ç”Ÿä»£é»˜è®¤çš„ç©ºé—´å æ¯”æ€»ç©ºé—´çš„ 1/3ï¼Œè€ç”Ÿä»£çš„é»˜è®¤å æ¯”æ˜¯ 2/3ã€‚</p>
<p>æ–°ç”Ÿä»£ä½¿ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£é‡Œæœ‰ 3 ä¸ªåˆ†åŒºï¼šEdenã€To Survivorã€From Survivorï¼Œå®ƒä»¬çš„é»˜è®¤å æ¯”æ˜¯ 8:1:1ï¼Œå®ƒçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p>Â·    æŠŠ Eden + From Survivor å­˜æ´»çš„å¯¹è±¡æ”¾å…¥ To Survivor åŒºï¼›</p>
<p>Â·    æ¸…ç©º Eden å’Œ From Survivor åˆ†åŒºï¼›</p>
<p>Â·    From Survivor å’Œ To Survivor åˆ†åŒºäº¤æ¢ï¼ŒFrom Survivor å˜ To Survivorï¼ŒTo Survivor å˜ From Survivorã€‚</p>
<p>æ¯æ¬¡åœ¨ From Survivor åˆ° To Survivor ç§»åŠ¨æ—¶éƒ½å­˜æ´»çš„å¯¹è±¡ï¼Œå¹´é¾„å°± +1ï¼Œå½“å¹´é¾„åˆ°è¾¾ 15ï¼ˆé»˜è®¤é…ç½®æ˜¯ 15ï¼‰æ—¶ï¼Œå‡çº§ä¸ºè€ç”Ÿä»£ã€‚å¤§å¯¹è±¡ä¹Ÿä¼šç›´æ¥è¿›å…¥è€ç”Ÿä»£ã€‚</p>
<p>è€ç”Ÿä»£å½“ç©ºé—´å ç”¨åˆ°è¾¾æŸä¸ªå€¼ä¹‹åå°±ä¼šè§¦å‘å…¨å±€åƒåœ¾æ”¶å›ï¼Œä¸€èˆ¬ä½¿ç”¨æ ‡è®°æ•´ç†çš„æ‰§è¡Œç®—æ³•ã€‚ä»¥ä¸Šè¿™äº›å¾ªç¯å¾€å¤å°±æ„æˆäº†æ•´ä¸ªåˆ†ä»£åƒåœ¾å›æ”¶çš„æ•´ä½“æ‰§è¡Œæµç¨‹ã€‚</p>
<h4 id="14-è¯´ä¸€ä¸‹-JVM-è°ƒä¼˜çš„å·¥å…·ï¼Ÿ"><a href="#14-è¯´ä¸€ä¸‹-JVM-è°ƒä¼˜çš„å·¥å…·ï¼Ÿ" class="headerlink" title="14. è¯´ä¸€ä¸‹ JVM è°ƒä¼˜çš„å·¥å…·ï¼Ÿ"></a><strong>14.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>JVM</strong> <strong>è°ƒä¼˜çš„å·¥å…·ï¼Ÿ</strong></h4><p>JDK è‡ªå¸¦äº†å¾ˆå¤šç›‘æ§å·¥å…·ï¼Œéƒ½ä½äº JDK çš„ bin ç›®å½•ä¸‹ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯ jconsole å’Œ jvisualvm è¿™ä¸¤æ¬¾è§†å›¾ç›‘æ§å·¥å…·ã€‚</p>
<p>Â·    jconsoleï¼šç”¨äºå¯¹ JVM ä¸­çš„å†…å­˜ã€çº¿ç¨‹å’Œç±»ç­‰è¿›è¡Œç›‘æ§ï¼›</p>
<p>Â·    jvisualvmï¼šJDK è‡ªå¸¦çš„å…¨èƒ½åˆ†æå·¥å…·ï¼Œå¯ä»¥åˆ†æï¼šå†…å­˜å¿«ç…§ã€çº¿ç¨‹å¿«ç…§ã€ç¨‹åºæ­»é”ã€ç›‘æ§å†…å­˜çš„å˜åŒ–ã€gc å˜åŒ–ç­‰ã€‚</p>
<h4 id="15-å¸¸ç”¨çš„-JVM-è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ"><a href="#15-å¸¸ç”¨çš„-JVM-è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="15. å¸¸ç”¨çš„ JVM è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ"></a><strong>15.</strong> <strong>å¸¸ç”¨çš„</strong> <strong>JVM</strong> <strong>è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Â·    -Xms2gï¼šåˆå§‹åŒ–æ¨å¤§å°ä¸º 2gï¼›</p>
<p>Â·    -Xmx2gï¼šå †æœ€å¤§å†…å­˜ä¸º 2gï¼›</p>
<p>Â·    -XX:NewRatio=4ï¼šè®¾ç½®å¹´è½»çš„å’Œè€å¹´ä»£çš„å†…å­˜æ¯”ä¾‹ä¸º 1:4ï¼›</p>
<p>Â·    -XX:SurvivorRatio=8ï¼šè®¾ç½®æ–°ç”Ÿä»£ Eden å’Œ Survivor æ¯”ä¾‹ä¸º 8:2ï¼›</p>
<p>Â·    â€“XX:+UseParNewGCï¼šæŒ‡å®šä½¿ç”¨ ParNew + Serial Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›</p>
<p>Â·    -XX:+UseParallelOldGCï¼šæŒ‡å®šä½¿ç”¨ ParNew + ParNew Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›</p>
<p>Â·    -XX:+UseConcMarkSweepGCï¼šæŒ‡å®šä½¿ç”¨ CMS + Serial Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›</p>
<p>Â·    -XX:+PrintGCï¼šå¼€å¯æ‰“å° gc ä¿¡æ¯ï¼›</p>
<p>Â·    -XX:+PrintGCDetailsï¼šæ‰“å° gc è¯¦ç»†ä¿¡æ¯ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>java Redis çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java-Redis-%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-Redis-æ˜¯ä»€ä¹ˆï¼Ÿéƒ½æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ"><a href="#1-Redis-æ˜¯ä»€ä¹ˆï¼Ÿéƒ½æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="1. Redis æ˜¯ä»€ä¹ˆï¼Ÿéƒ½æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ"></a><strong>1. Redis</strong> <strong>æ˜¯ä»€ä¹ˆï¼Ÿéƒ½æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</strong></h4><p>Redis æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€å¼€å‘çš„é«˜é€Ÿç¼“å­˜æ•°æ®åº“ã€‚</p>
<p>Redis ä½¿ç”¨åœºæ™¯ï¼š</p>
<p>Â·    è®°å½•å¸–å­ç‚¹èµæ•°ã€ç‚¹å‡»æ•°ã€è¯„è®ºæ•°ï¼›</p>
<p>Â·    ç¼“å­˜è¿‘æœŸçƒ­å¸–ï¼›</p>
<p>Â·    ç¼“å­˜æ–‡ç« è¯¦æƒ…ä¿¡æ¯ï¼›</p>
<p>Â·    è®°å½•ç”¨æˆ·ä¼šè¯ä¿¡æ¯ã€‚</p>
<h4 id="2-Redis-æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ"><a href="#2-Redis-æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ" class="headerlink" title="2. Redis æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ"></a><strong>2. Redis</strong> <strong>æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ</strong></h4><p>Â·    æ•°æ®ç¼“å­˜åŠŸèƒ½</p>
<p>Â·    åˆ†å¸ƒå¼é”çš„åŠŸèƒ½</p>
<p>Â·    æ”¯æŒæ•°æ®æŒä¹…åŒ–</p>
<p>Â·    æ”¯æŒäº‹åŠ¡</p>
<p>Â·    æ”¯æŒæ¶ˆæ¯é˜Ÿåˆ—</p>
<h4 id="3-Redis-å’Œ-memcache-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#3-Redis-å’Œ-memcache-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="3. Redis å’Œ memcache æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>3. Redis</strong> <strong>å’Œ</strong> <strong>memcache</strong> <strong>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    å­˜å‚¨æ–¹å¼ä¸åŒï¼šmemcache æŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ï¼Œæ–­ç”µåä¼šæŒ‚æ‰ï¼Œæ•°æ®ä¸èƒ½è¶…è¿‡å†…å­˜å¤§å°ï¼›Redis æœ‰éƒ¨ä»½å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œè¿™æ ·èƒ½ä¿è¯æ•°æ®çš„æŒä¹…æ€§ã€‚</p>
<p>Â·    æ•°æ®æ”¯æŒç±»å‹ï¼šmemcache å¯¹æ•°æ®ç±»å‹æ”¯æŒç›¸å¯¹ç®€å•ï¼›Redis æœ‰å¤æ‚çš„æ•°æ®ç±»å‹ã€‚</p>
<p>Â·    ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼šå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ï¼Œä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼ŒRedis è‡ªå·±æ„å»ºäº† vm æœºåˆ¶ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ã€‚</p>
<p>Â·    value å€¼å¤§å°ä¸åŒï¼šRedis æœ€å¤§å¯ä»¥è¾¾åˆ° 512mbï¼›memcache åªæœ‰ 1mbã€‚</p>
<h4 id="4-Redis-ä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„ï¼Ÿ"><a href="#4-Redis-ä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„ï¼Ÿ" class="headerlink" title="4. Redis ä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„ï¼Ÿ"></a><strong>4. Redis</strong> <strong>ä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„ï¼Ÿ</strong></h4><p>å› ä¸º cpu ä¸æ˜¯ Redis çš„ç“¶é¢ˆï¼ŒRedis çš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®ç°ï¼Œè€Œä¸” cpu åˆä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆäº†ã€‚</p>
<p>å…³äº Redis çš„æ€§èƒ½ï¼Œå®˜æ–¹ç½‘ç«™ä¹Ÿæœ‰ï¼Œæ™®é€šç¬”è®°æœ¬è½»æ¾å¤„ç†æ¯ç§’å‡ åä¸‡çš„è¯·æ±‚ã€‚</p>
<p>è€Œä¸”å•çº¿ç¨‹å¹¶ä¸ä»£è¡¨å°±æ…¢ nginx å’Œ nodejs ä¹Ÿéƒ½æ˜¯é«˜æ€§èƒ½å•çº¿ç¨‹çš„ä»£è¡¨ã€‚</p>
<h4 id="5-ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#5-ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="5. ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"></a><strong>5.</strong> <strong>ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</strong></h4><p>ç¼“å­˜ç©¿é€ï¼šæŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶éœ€è¦ä»æ•°æ®åº“æŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æ•°æ®åº“å»æŸ¥è¯¢ï¼Œé€ æˆç¼“å­˜ç©¿é€ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šæœ€ç®€å•ç²—æš´çš„æ–¹æ³•å¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•°æ®ä¸å­˜åœ¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿæ•…éšœï¼‰ï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼Œä½†å®ƒçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿã€‚</p>
<h4 id="6-Redis-æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ"><a href="#6-Redis-æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="6. Redis æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ"></a><strong>6. Redis</strong> <strong>æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Redis æ”¯æŒçš„æ•°æ®ç±»å‹ï¼šstringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€listï¼ˆåˆ—è¡¨ï¼‰ã€hashï¼ˆå­—å…¸ï¼‰ã€setï¼ˆé›†åˆï¼‰ã€zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€‚</p>
<h4 id="7-Redis-æ”¯æŒçš„-Java-å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿ"><a href="#7-Redis-æ”¯æŒçš„-Java-å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="7. Redis æ”¯æŒçš„ Java å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿ"></a><strong>7. Redis</strong> <strong>æ”¯æŒçš„</strong> <strong>Java</strong> <strong>å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>æ”¯æŒçš„ Java å®¢æˆ·ç«¯æœ‰ Redissonã€jedisã€lettuce ç­‰ã€‚</p>
<h4 id="8-jedis-å’Œ-Redisson-æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"><a href="#8-jedis-å’Œ-Redisson-æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ" class="headerlink" title="8. jedis å’Œ Redisson æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"></a><strong>8. jedis</strong> <strong>å’Œ</strong> <strong>Redisson</strong> <strong>æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    jedisï¼šæä¾›äº†æ¯”è¾ƒå…¨é¢çš„ Redis å‘½ä»¤çš„æ”¯æŒã€‚</p>
<p>Â·    Redissonï¼šå®ç°äº†åˆ†å¸ƒå¼å’Œå¯æ‰©å±•çš„ Java æ•°æ®ç»“æ„ï¼Œä¸ jedis ç›¸æ¯” Redisson çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸æ”¯æŒæ’åºã€äº‹åŠ¡ã€ç®¡é“ã€åˆ†åŒºç­‰ Redis ç‰¹æ€§ã€‚</p>
<h4 id="9-æ€ä¹ˆä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ"><a href="#9-æ€ä¹ˆä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="9. æ€ä¹ˆä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ"></a><strong>9.</strong> <strong>æ€ä¹ˆä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ</strong></h4><p>Â·    åˆç†è®¾ç½®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ã€‚</p>
<p>Â·    æ–°å¢ã€æ›´æ”¹ã€åˆ é™¤æ•°æ®åº“æ“ä½œæ—¶åŒæ­¥æ›´æ–° Redisï¼Œå¯ä»¥ä½¿ç”¨äº‹ç‰©æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<h4 id="10-Redis-æŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼ï¼Ÿ"><a href="#10-Redis-æŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="10. Redis æŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼ï¼Ÿ"></a><strong>10. Redis</strong> <strong>æŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼ï¼Ÿ</strong></h4><p>Redis çš„æŒä¹…åŒ–æœ‰ä¸¤ç§æ–¹å¼ï¼Œæˆ–è€…è¯´æœ‰ä¸¤ç§ç­–ç•¥ï¼š</p>
<p>Â·    RDBï¼ˆRedis Databaseï¼‰ï¼šæŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨ã€‚</p>
<p>Â·    AOFï¼ˆAppend Only Fileï¼‰ï¼šæ¯ä¸€ä¸ªæ”¶åˆ°çš„å†™å‘½ä»¤éƒ½é€šè¿‡writeå‡½æ•°è¿½åŠ åˆ°æ–‡ä»¶ä¸­ã€‚</p>
<h4 id="11-Redis-æ€ä¹ˆå®ç°åˆ†å¸ƒå¼é”ï¼Ÿ"><a href="#11-Redis-æ€ä¹ˆå®ç°åˆ†å¸ƒå¼é”ï¼Ÿ" class="headerlink" title="11. Redis æ€ä¹ˆå®ç°åˆ†å¸ƒå¼é”ï¼Ÿ"></a><strong>11. Redis</strong> <strong>æ€ä¹ˆå®ç°åˆ†å¸ƒå¼é”ï¼Ÿ</strong></h4><p>Redis åˆ†å¸ƒå¼é”å…¶å®å°±æ˜¯åœ¨ç³»ç»Ÿé‡Œé¢å ä¸€ä¸ªâ€œå‘â€ï¼Œå…¶ä»–ç¨‹åºä¹Ÿè¦å â€œå‘â€çš„æ—¶å€™ï¼Œå ç”¨æˆåŠŸäº†å°±å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œå¤±è´¥äº†å°±åªèƒ½æ”¾å¼ƒæˆ–ç¨åé‡è¯•ã€‚</p>
<p>å å‘ä¸€èˆ¬ä½¿ç”¨ setnx(set if not exists)æŒ‡ä»¤ï¼Œåªå…è®¸è¢«ä¸€ä¸ªç¨‹åºå æœ‰ï¼Œä½¿ç”¨å®Œè°ƒç”¨ del é‡Šæ”¾é”ã€‚</p>
<h4 id="12-Redis-åˆ†å¸ƒå¼é”æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ"><a href="#12-Redis-åˆ†å¸ƒå¼é”æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ" class="headerlink" title="12. Redis åˆ†å¸ƒå¼é”æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ"></a><strong>12. Redis</strong> <strong>åˆ†å¸ƒå¼é”æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ</strong></h4><p>Redis åˆ†å¸ƒå¼é”ä¸èƒ½è§£å†³è¶…æ—¶çš„é—®é¢˜ï¼Œåˆ†å¸ƒå¼é”æœ‰ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œç¨‹åºçš„æ‰§è¡Œå¦‚æœè¶…å‡ºäº†é”çš„è¶…æ—¶æ—¶é—´å°±ä¼šå‡ºç°é—®é¢˜ã€‚</p>
<h4 id="13-Redis-å¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ"><a href="#13-Redis-å¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="13. Redis å¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ"></a><strong>13. Redis</strong> <strong>å¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ</strong></h4><p>å°½é‡ä½¿ç”¨ Redis çš„æ•£åˆ—è¡¨ï¼ŒæŠŠç›¸å…³çš„ä¿¡æ¯æ”¾åˆ°æ•£åˆ—è¡¨é‡Œé¢å­˜å‚¨ï¼Œè€Œä¸æ˜¯æŠŠæ¯ä¸ªå­—æ®µå•ç‹¬å­˜å‚¨ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„å‡å°‘å†…å­˜ä½¿ç”¨ã€‚æ¯”å¦‚å°† Web ç³»ç»Ÿçš„ç”¨æˆ·å¯¹è±¡ï¼Œåº”è¯¥æ”¾åˆ°æ•£åˆ—è¡¨é‡Œé¢å†æ•´ä½“å­˜å‚¨åˆ° Redisï¼Œè€Œä¸æ˜¯æŠŠç”¨æˆ·çš„å§“åã€å¹´é¾„ã€å¯†ç ã€é‚®ç®±ç­‰å­—æ®µåˆ†åˆ«è®¾ç½® key è¿›è¡Œå­˜å‚¨ã€‚</p>
<h4 id="14-Redis-æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"><a href="#14-Redis-æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="14. Redis æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"></a><strong>14. Redis</strong> <strong>æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Â·   volatile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver. db[i]. expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚</p>
<p>Â·   volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver. db[i]. expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°ã€‚</p>
<p>Â·   volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver. db[i]. expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚</p>
<p>Â·   allkeys-lruï¼šä»æ•°æ®é›†ï¼ˆserver. db[i]. dictï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚</p>
<p>Â·   allkeys-randomï¼šä»æ•°æ®é›†ï¼ˆserver. db[i]. dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚</p>
<p>Â·   no-envictionï¼ˆé©±é€ï¼‰ï¼šç¦æ­¢é©±é€æ•°æ®ã€‚</p>
<p><strong>15. Redis</strong> <strong>å¸¸è§çš„æ€§èƒ½é—®é¢˜æœ‰å“ªäº›ï¼Ÿè¯¥å¦‚ä½•è§£å†³ï¼Ÿ</strong></p>
<p>Â·    ä¸»æœåŠ¡å™¨å†™å†…å­˜å¿«ç…§ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œå½“å¿«ç…§æ¯”è¾ƒå¤§æ—¶å¯¹æ€§èƒ½å½±å“æ˜¯éå¸¸å¤§çš„ï¼Œä¼šé—´æ–­æ€§æš‚åœæœåŠ¡ï¼Œæ‰€ä»¥ä¸»æœåŠ¡å™¨æœ€å¥½ä¸è¦å†™å†…å­˜å¿«ç…§ã€‚</p>
<p>Â·    Redis ä¸»ä»å¤åˆ¶çš„æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼Œä¸»ä»åº“æœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>Redis</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>java Mysql çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java-Mysql-%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-æ•°æ®åº“çš„ä¸‰èŒƒå¼æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-æ•°æ®åº“çš„ä¸‰èŒƒå¼æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. æ•°æ®åº“çš„ä¸‰èŒƒå¼æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1.</strong> <strong>æ•°æ®åº“çš„ä¸‰èŒƒå¼æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Â·    ç¬¬ä¸€èŒƒå¼ï¼šå¼ºè°ƒçš„æ˜¯åˆ—çš„åŸå­æ€§ï¼Œå³æ•°æ®åº“è¡¨çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ã€‚</p>
<p>Â·    ç¬¬äºŒèŒƒå¼ï¼šè¦æ±‚å®ä½“çš„å±æ€§å®Œå…¨ä¾èµ–äºä¸»å…³é”®å­—ã€‚æ‰€è°“å®Œå…¨ä¾èµ–æ˜¯æŒ‡ä¸èƒ½å­˜åœ¨ä»…ä¾èµ–ä¸»å…³é”®å­—ä¸€éƒ¨åˆ†çš„å±æ€§ã€‚</p>
<p>Â·    ç¬¬ä¸‰èŒƒå¼ï¼šä»»ä½•éä¸»å±æ€§ä¸ä¾èµ–äºå…¶å®ƒéä¸»å±æ€§ã€‚</p>
<h4 id="2-ä¸€å¼ è‡ªå¢è¡¨é‡Œé¢æ€»å…±æœ‰-7-æ¡æ•°æ®ï¼Œåˆ é™¤äº†æœ€å-2-æ¡æ•°æ®ï¼Œé‡å¯-MySQL-æ•°æ®åº“ï¼Œåˆæ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œæ­¤æ—¶-id-æ˜¯å‡ ï¼Ÿ"><a href="#2-ä¸€å¼ è‡ªå¢è¡¨é‡Œé¢æ€»å…±æœ‰-7-æ¡æ•°æ®ï¼Œåˆ é™¤äº†æœ€å-2-æ¡æ•°æ®ï¼Œé‡å¯-MySQL-æ•°æ®åº“ï¼Œåˆæ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œæ­¤æ—¶-id-æ˜¯å‡ ï¼Ÿ" class="headerlink" title="2. ä¸€å¼ è‡ªå¢è¡¨é‡Œé¢æ€»å…±æœ‰ 7 æ¡æ•°æ®ï¼Œåˆ é™¤äº†æœ€å 2 æ¡æ•°æ®ï¼Œé‡å¯ MySQL æ•°æ®åº“ï¼Œåˆæ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œæ­¤æ—¶ id æ˜¯å‡ ï¼Ÿ"></a><strong>2.</strong> <strong>ä¸€å¼ è‡ªå¢è¡¨é‡Œé¢æ€»å…±æœ‰</strong> <strong>7</strong> <strong>æ¡æ•°æ®ï¼Œåˆ é™¤äº†æœ€å</strong> <strong>2</strong> <strong>æ¡æ•°æ®ï¼Œé‡å¯</strong> <strong>MySQL</strong> <strong>æ•°æ®åº“ï¼Œåˆæ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œæ­¤æ—¶</strong> <strong>id</strong> <strong>æ˜¯å‡ ï¼Ÿ</strong></h4><p>Â·    è¡¨ç±»å‹å¦‚æœæ˜¯ MyISAM ï¼Œé‚£ id å°±æ˜¯ 8ã€‚</p>
<p>Â·    è¡¨ç±»å‹å¦‚æœæ˜¯ InnoDBï¼Œé‚£ id å°±æ˜¯ 6ã€‚</p>
<p>InnoDB è¡¨åªä¼šæŠŠè‡ªå¢ä¸»é”®çš„æœ€å¤§ id è®°å½•åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥é‡å¯ä¹‹åä¼šå¯¼è‡´æœ€å¤§ id ä¸¢å¤±ã€‚</p>
<h4 id="3-å¦‚ä½•è·å–å½“å‰æ•°æ®åº“ç‰ˆæœ¬ï¼Ÿ"><a href="#3-å¦‚ä½•è·å–å½“å‰æ•°æ®åº“ç‰ˆæœ¬ï¼Ÿ" class="headerlink" title="3. å¦‚ä½•è·å–å½“å‰æ•°æ®åº“ç‰ˆæœ¬ï¼Ÿ"></a><strong>3.</strong> <strong>å¦‚ä½•è·å–å½“å‰æ•°æ®åº“ç‰ˆæœ¬ï¼Ÿ</strong></h4><p>ä½¿ç”¨ select version() è·å–å½“å‰ MySQL æ•°æ®åº“ç‰ˆæœ¬ã€‚</p>
<h4 id="4-è¯´ä¸€ä¸‹-ACID-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#4-è¯´ä¸€ä¸‹-ACID-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="4. è¯´ä¸€ä¸‹ ACID æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>4.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>ACID</strong> <strong>æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Â·    Atomicityï¼ˆåŸå­æ€§ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…å…¨éƒ¨å®Œæˆï¼Œæˆ–è€…å…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«æ¢å¤ï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚å³ï¼Œäº‹åŠ¡ä¸å¯åˆ†å‰²ã€ä¸å¯çº¦ç®€ã€‚</p>
<p>Â·    Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾çº¦æŸã€è§¦å‘å™¨ã€çº§è”å›æ»šç­‰ã€‚</p>
<p>Â·    Isolationï¼ˆéš”ç¦»æ€§ï¼‰ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚</p>
<p>Â·    Durabilityï¼ˆæŒä¹…æ€§ï¼‰ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p>
<h4 id="5-char-å’Œ-varchar-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5-char-å’Œ-varchar-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5. char å’Œ varchar çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>5. char</strong> <strong>å’Œ</strong> <strong>varchar</strong> <strong>çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Â·    char(n) ï¼šå›ºå®šé•¿åº¦ç±»å‹ï¼Œæ¯”å¦‚è®¢é˜… char(10)ï¼Œå½“ä½ è¾“å…¥â€abcâ€ä¸‰ä¸ªå­—ç¬¦çš„æ—¶å€™ï¼Œå®ƒä»¬å çš„ç©ºé—´è¿˜æ˜¯ 10 ä¸ªå­—èŠ‚ï¼Œå…¶ä»– 7 ä¸ªæ˜¯ç©ºå­—èŠ‚ã€‚</p>
<p>chat ä¼˜ç‚¹ï¼šæ•ˆç‡é«˜ï¼›ç¼ºç‚¹ï¼šå ç”¨ç©ºé—´ï¼›é€‚ç”¨åœºæ™¯ï¼šå­˜å‚¨å¯†ç çš„ md5 å€¼ï¼Œå›ºå®šé•¿åº¦çš„ï¼Œä½¿ç”¨ char éå¸¸åˆé€‚ã€‚</p>
<p>Â·    varchar(n) ï¼šå¯å˜é•¿åº¦ï¼Œå­˜å‚¨çš„å€¼æ˜¯æ¯ä¸ªå€¼å ç”¨çš„å­—èŠ‚å†åŠ ä¸Šä¸€ä¸ªç”¨æ¥è®°å½•å…¶é•¿åº¦çš„å­—èŠ‚çš„é•¿åº¦ã€‚</p>
<p>æ‰€ä»¥ï¼Œä»ç©ºé—´ä¸Šè€ƒè™‘ varcahr æ¯”è¾ƒåˆé€‚ï¼›ä»æ•ˆç‡ä¸Šè€ƒè™‘ char æ¯”è¾ƒåˆé€‚ï¼ŒäºŒè€…ä½¿ç”¨éœ€è¦æƒè¡¡ã€‚</p>
<h4 id="6-float-å’Œ-double-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#6-float-å’Œ-double-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="6. float å’Œ double çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>6. float</strong> <strong>å’Œ</strong> <strong>double</strong> <strong>çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Â·    float æœ€å¤šå¯ä»¥å­˜å‚¨ 8 ä½çš„åè¿›åˆ¶æ•°ï¼Œå¹¶åœ¨å†…å­˜ä¸­å  4 å­—èŠ‚ã€‚</p>
<p>Â·    double æœ€å¯å¯ä»¥å­˜å‚¨ 16 ä½çš„åè¿›åˆ¶æ•°ï¼Œå¹¶åœ¨å†…å­˜ä¸­å  8 å­—èŠ‚ã€‚</p>
<h4 id="7-MySQL-çš„å†…è¿æ¥ã€å·¦è¿æ¥ã€å³è¿æ¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#7-MySQL-çš„å†…è¿æ¥ã€å·¦è¿æ¥ã€å³è¿æ¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="7. MySQL çš„å†…è¿æ¥ã€å·¦è¿æ¥ã€å³è¿æ¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>7. MySQL</strong> <strong>çš„å†…è¿æ¥ã€å·¦è¿æ¥ã€å³è¿æ¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>å†…è¿æ¥å…³é”®å­—ï¼šinner joinï¼›å·¦è¿æ¥ï¼šleft joinï¼›å³è¿æ¥ï¼šright joinã€‚</p>
<p>å†…è¿æ¥æ˜¯æŠŠåŒ¹é…çš„å…³è”æ•°æ®æ˜¾ç¤ºå‡ºæ¥ï¼›å·¦è¿æ¥æ˜¯å·¦è¾¹çš„è¡¨å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥ï¼Œå³è¾¹çš„è¡¨æ˜¾ç¤ºå‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼›å³è¿æ¥æ­£å¥½ç›¸åã€‚</p>
<h4 id="8-MySQL-ç´¢å¼•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#8-MySQL-ç´¢å¼•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="8. MySQL ç´¢å¼•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a><strong>8. MySQL</strong> <strong>ç´¢å¼•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</strong></h4><p>ç´¢å¼•æ˜¯æ»¡è¶³æŸç§ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè€Œè¿™äº›æ•°æ®ç»“æ„ä¼šä»¥æŸç§æ–¹å¼æŒ‡å‘æ•°æ®ï¼Œä»è€Œå®ç°é«˜æ•ˆæŸ¥æ‰¾æ•°æ®ã€‚</p>
<p>å…·ä½“æ¥è¯´ MySQL ä¸­çš„ç´¢å¼•ï¼Œä¸åŒçš„æ•°æ®å¼•æ“å®ç°æœ‰æ‰€ä¸åŒï¼Œä½†ç›®å‰ä¸»æµçš„æ•°æ®åº“å¼•æ“çš„ç´¢å¼•éƒ½æ˜¯ B+ æ ‘å®ç°çš„ï¼ŒB+ æ ‘çš„æœç´¢æ•ˆç‡ï¼Œå¯ä»¥åˆ°è¾¾äºŒåˆ†æ³•çš„æ€§èƒ½ï¼Œæ‰¾åˆ°æ•°æ®åŒºåŸŸä¹‹åå°±æ‰¾åˆ°äº†å®Œæ•´çš„æ•°æ®ç»“æ„äº†ï¼Œæ‰€æœ‰ç´¢å¼•çš„æ€§èƒ½ä¹Ÿæ˜¯æ›´å¥½çš„ã€‚</p>
<h4 id="9-æ€ä¹ˆéªŒè¯-MySQL-çš„ç´¢å¼•æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Ÿ"><a href="#9-æ€ä¹ˆéªŒè¯-MySQL-çš„ç´¢å¼•æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Ÿ" class="headerlink" title="9. æ€ä¹ˆéªŒè¯ MySQL çš„ç´¢å¼•æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Ÿ"></a><strong>9.</strong> <strong>æ€ä¹ˆéªŒè¯</strong> <strong>MySQL</strong> <strong>çš„ç´¢å¼•æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Ÿ</strong></h4><p>ä½¿ç”¨ explain æŸ¥çœ‹ SQL æ˜¯å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„ï¼Œä»è€Œåˆ†æä½ çš„ç´¢å¼•æ˜¯å¦æ»¡è¶³éœ€æ±‚ã€‚</p>
<p>explain è¯­æ³•ï¼šexplain select * from table where type=1ã€‚</p>
<h4 id="10-è¯´ä¸€ä¸‹æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ"><a href="#10-è¯´ä¸€ä¸‹æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ" class="headerlink" title="10. è¯´ä¸€ä¸‹æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ"></a><strong>10.</strong> <strong>è¯´ä¸€ä¸‹æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ</strong></h4><p>MySQL çš„äº‹åŠ¡éš”ç¦»æ˜¯åœ¨ MySQL. ini é…ç½®æ–‡ä»¶é‡Œæ·»åŠ çš„ï¼Œåœ¨æ–‡ä»¶çš„æœ€åæ·»åŠ ï¼š</p>
<p>transaction-isolation = REPEATABLE-READ</p>
<p>å¯ç”¨çš„é…ç½®å€¼ï¼šREAD-UNCOMMITTEDã€READ-COMMITTEDã€REPEATABLE-READã€SERIALIZABLEã€‚</p>
<p>Â·    READ-UNCOMMITTEDï¼šæœªæäº¤è¯»ï¼Œæœ€ä½éš”ç¦»çº§åˆ«ã€äº‹åŠ¡æœªæäº¤å‰ï¼Œå°±å¯è¢«å…¶ä»–äº‹åŠ¡è¯»å–ï¼ˆä¼šå‡ºç°å¹»è¯»ã€è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ã€‚</p>
<p>Â·    READ-COMMITTEDï¼šæäº¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡è¯»å–åˆ°ï¼ˆä¼šé€ æˆå¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ã€‚</p>
<p>Â·    REPEATABLE-READï¼šå¯é‡å¤è¯»ï¼Œé»˜è®¤çº§åˆ«ï¼Œä¿è¯å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œå…¶å€¼éƒ½å’Œäº‹åŠ¡å¼€å§‹æ—¶å€™çš„å†…å®¹æ˜¯ä¸€è‡´ï¼Œç¦æ­¢è¯»å–åˆ°åˆ«çš„äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼ˆä¼šé€ æˆå¹»è¯»ï¼‰ã€‚</p>
<p>Â·    SERIALIZABLEï¼šåºåˆ—åŒ–ï¼Œä»£ä»·æœ€é«˜æœ€å¯é çš„éš”ç¦»çº§åˆ«ï¼Œè¯¥éš”ç¦»çº§åˆ«èƒ½é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚</p>
<p>è„è¯» ï¼šè¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡èƒ½å¤Ÿè¯»å–å¦ä¸€ä¸ªäº‹åŠ¡ä¸­è¿˜æœªæäº¤çš„æ•°æ®ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªäº‹åŠ¡å°è¯•æ’å…¥è®°å½• Aï¼Œæ­¤æ—¶è¯¥äº‹åŠ¡è¿˜æœªæäº¤ï¼Œç„¶åå¦ä¸€ä¸ªäº‹åŠ¡å°è¯•è¯»å–åˆ°äº†è®°å½• Aã€‚</p>
<p>ä¸å¯é‡å¤è¯» ï¼šæ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚</p>
<p>å¹»è¯» ï¼šæŒ‡åŒä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢è¿”å›çš„ç»“æœé›†ä¸ä¸€æ ·ã€‚æ¯”å¦‚åŒä¸€ä¸ªäº‹åŠ¡ A ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶å€™æœ‰ n æ¡è®°å½•ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡åŒç­‰æ¡ä»¶ä¸‹æŸ¥è¯¢å´æœ‰ n+1 æ¡è®°å½•ï¼Œè¿™å°±å¥½åƒäº§ç”Ÿäº†å¹»è§‰ã€‚å‘ç”Ÿå¹»è¯»çš„åŸå› ä¹Ÿæ˜¯å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ–°å¢æˆ–è€…åˆ é™¤æˆ–è€…ä¿®æ”¹äº†ç¬¬ä¸€ä¸ªäº‹åŠ¡ç»“æœé›†é‡Œé¢çš„æ•°æ®ï¼ŒåŒä¸€ä¸ªè®°å½•çš„æ•°æ®å†…å®¹è¢«ä¿®æ”¹äº†ï¼Œæ‰€æœ‰æ•°æ®è¡Œçš„è®°å½•å°±å˜å¤šæˆ–è€…å˜å°‘äº†ã€‚</p>
<h4 id="11-è¯´ä¸€ä¸‹-MySQL-å¸¸ç”¨çš„å¼•æ“ï¼Ÿ"><a href="#11-è¯´ä¸€ä¸‹-MySQL-å¸¸ç”¨çš„å¼•æ“ï¼Ÿ" class="headerlink" title="11. è¯´ä¸€ä¸‹ MySQL å¸¸ç”¨çš„å¼•æ“ï¼Ÿ"></a><strong>11.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>MySQL</strong> <strong>å¸¸ç”¨çš„å¼•æ“ï¼Ÿ</strong></h4><p>Â·   InnoDB å¼•æ“ï¼šmysql 5.1 åé»˜è®¤çš„æ•°æ®åº“å¼•æ“ï¼Œæä¾›äº†å¯¹æ•°æ®åº“ acid äº‹åŠ¡çš„æ”¯æŒï¼Œå¹¶ä¸”è¿˜æä¾›äº†è¡Œçº§é”å’Œå¤–é”®çš„çº¦æŸï¼Œå®ƒçš„è®¾è®¡çš„ç›®æ ‡å°±æ˜¯å¤„ç†å¤§æ•°æ®å®¹é‡çš„æ•°æ®åº“ç³»ç»Ÿã€‚MySQL è¿è¡Œçš„æ—¶å€™ï¼ŒInnoDB ä¼šåœ¨å†…å­˜ä¸­å»ºç«‹ç¼“å†²æ± ï¼Œç”¨äºç¼“å†²æ•°æ®å’Œç´¢å¼•ã€‚ä½†æ˜¯è¯¥å¼•æ“æ˜¯ä¸æ”¯æŒå…¨æ–‡æœç´¢ï¼ŒåŒæ—¶å¯åŠ¨ä¹Ÿæ¯”è¾ƒçš„æ…¢ï¼Œå®ƒæ˜¯ä¸ä¼šä¿å­˜è¡¨çš„è¡Œæ•°çš„ï¼Œæ‰€ä»¥å½“è¿›è¡Œ select count(*) from table æŒ‡ä»¤çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œæ‰«æå…¨è¡¨ã€‚ç”±äºé”çš„ç²’åº¦å°ï¼Œå†™æ“ä½œæ˜¯ä¸ä¼šé”å®šå…¨è¡¨çš„,æ‰€ä»¥åœ¨å¹¶å‘åº¦è¾ƒé«˜çš„åœºæ™¯ä¸‹ä½¿ç”¨ä¼šæå‡æ•ˆç‡çš„ã€‚</p>
<p>Â·   MyIASM å¼•æ“ï¼šä¸æä¾›äº‹åŠ¡çš„æ”¯æŒï¼Œä¹Ÿä¸æ”¯æŒè¡Œçº§é”å’Œå¤–é”®ã€‚å› æ­¤å½“æ‰§è¡Œæ’å…¥å’Œæ›´æ–°è¯­å¥æ—¶ï¼Œå³æ‰§è¡Œå†™æ“ä½œçš„æ—¶å€™éœ€è¦é”å®šè¿™ä¸ªè¡¨ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ•ˆç‡ä¼šé™ä½ã€‚ä¸è¿‡å’Œ InnoDB ä¸åŒçš„æ˜¯ï¼ŒMyIASM å¼•æ“æ˜¯ä¿å­˜äº†è¡¨çš„è¡Œæ•°ï¼Œäºæ˜¯å½“è¿›è¡Œ select count(*) from table è¯­å¥æ—¶ï¼Œå¯ä»¥ç›´æ¥çš„è¯»å–å·²ç»ä¿å­˜çš„å€¼è€Œä¸éœ€è¦è¿›è¡Œæ‰«æå…¨è¡¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¡¨çš„è¯»æ“ä½œè¿œè¿œå¤šäºå†™æ“ä½œæ—¶ï¼Œå¹¶ä¸”ä¸éœ€è¦äº‹åŠ¡çš„æ”¯æŒçš„ï¼Œå¯ä»¥å°† MyIASM ä½œä¸ºæ•°æ®åº“å¼•æ“çš„é¦–é€‰ã€‚</p>
<h4 id="12-è¯´ä¸€ä¸‹-MySQL-çš„è¡Œé”å’Œè¡¨é”ï¼Ÿ"><a href="#12-è¯´ä¸€ä¸‹-MySQL-çš„è¡Œé”å’Œè¡¨é”ï¼Ÿ" class="headerlink" title="12. è¯´ä¸€ä¸‹ MySQL çš„è¡Œé”å’Œè¡¨é”ï¼Ÿ"></a><strong>12.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>MySQL</strong> <strong>çš„è¡Œé”å’Œè¡¨é”ï¼Ÿ</strong></h4><p>MyISAM åªæ”¯æŒè¡¨é”ï¼ŒInnoDB æ”¯æŒè¡¨é”å’Œè¡Œé”ï¼Œé»˜è®¤ä¸ºè¡Œé”ã€‚</p>
<p>Â·    è¡¨çº§é”ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘é‡æœ€ä½ã€‚</p>
<p>Â·    è¡Œçº§é”ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”ã€‚é”åŠ›åº¦å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡å°ï¼Œå¹¶å‘åº¦æœ€é«˜ã€‚</p>
<h4 id="13-è¯´ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ"><a href="#13-è¯´ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ" class="headerlink" title="13. è¯´ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ"></a><strong>13.</strong> <strong>è¯´ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ</strong></h4><p>Â·    ä¹è§‚é”ï¼šæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æäº¤æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ã€‚</p>
<p>Â·    æ‚²è§‚é”ï¼šæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»æ­¢ï¼Œç›´åˆ°è¿™ä¸ªé”è¢«é‡Šæ”¾ã€‚</p>
<p>æ•°æ®åº“çš„ä¹è§‚é”éœ€è¦è‡ªå·±å®ç°ï¼Œåœ¨è¡¨é‡Œé¢æ·»åŠ ä¸€ä¸ª version å­—æ®µï¼Œæ¯æ¬¡ä¿®æ”¹æˆåŠŸå€¼åŠ  1ï¼Œè¿™æ ·æ¯æ¬¡ä¿®æ”¹çš„æ—¶å€™å…ˆå¯¹æ¯”ä¸€ä¸‹ï¼Œè‡ªå·±æ‹¥æœ‰çš„ version å’Œæ•°æ®åº“ç°åœ¨çš„ version æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±ä¸ä¿®æ”¹ï¼Œè¿™æ ·å°±å®ç°äº†ä¹è§‚é”ã€‚</p>
<h4 id="14-MySQL-é—®é¢˜æ’æŸ¥éƒ½æœ‰å“ªäº›æ‰‹æ®µï¼Ÿ"><a href="#14-MySQL-é—®é¢˜æ’æŸ¥éƒ½æœ‰å“ªäº›æ‰‹æ®µï¼Ÿ" class="headerlink" title="14. MySQL é—®é¢˜æ’æŸ¥éƒ½æœ‰å“ªäº›æ‰‹æ®µï¼Ÿ"></a><strong>14. MySQL</strong> <strong>é—®é¢˜æ’æŸ¥éƒ½æœ‰å“ªäº›æ‰‹æ®µï¼Ÿ</strong></h4><p>Â·    ä½¿ç”¨ show processlist å‘½ä»¤æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿æ¥ä¿¡æ¯ã€‚</p>
<p>Â·    ä½¿ç”¨ explain å‘½ä»¤æŸ¥è¯¢ SQL è¯­å¥æ‰§è¡Œè®¡åˆ’ã€‚</p>
<p>Â·    å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ŒæŸ¥çœ‹æ…¢æŸ¥è¯¢çš„ SQLã€‚</p>
<h4 id="15-å¦‚ä½•åš-MySQL-çš„æ€§èƒ½ä¼˜åŒ–ï¼Ÿ"><a href="#15-å¦‚ä½•åš-MySQL-çš„æ€§èƒ½ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="15. å¦‚ä½•åš MySQL çš„æ€§èƒ½ä¼˜åŒ–ï¼Ÿ"></a><strong>15.</strong> <strong>å¦‚ä½•åš</strong> <strong>MySQL</strong> <strong>çš„æ€§èƒ½ä¼˜åŒ–ï¼Ÿ</strong></h4><p>Â·    ä¸ºæœç´¢å­—æ®µåˆ›å»ºç´¢å¼•ã€‚</p>
<p>Â·    é¿å…ä½¿ç”¨ select *ï¼Œåˆ—å‡ºéœ€è¦æŸ¥è¯¢çš„å­—æ®µã€‚</p>
<p>Â·    å‚ç›´åˆ†å‰²åˆ†è¡¨ã€‚</p>
<p>Â·    é€‰æ‹©æ­£ç¡®çš„å­˜å‚¨å¼•æ“ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>Mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>java Zookeeper çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java-Zookeeper-%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-zookeeper-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-zookeeper-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. zookeeper æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1. zookeeper</strong> <strong>æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œæ˜¯ google chubby çš„å¼€æºå®ç°ï¼Œæ˜¯ hadoop å’Œ hbase çš„é‡è¦ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚</p>
<h4 id="2-zookeeper-éƒ½æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ"><a href="#2-zookeeper-éƒ½æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ" class="headerlink" title="2. zookeeper éƒ½æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ"></a><strong>2. zookeeper</strong> <strong>éƒ½æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ</strong></h4><p>Â·    é›†ç¾¤ç®¡ç†ï¼šç›‘æ§èŠ‚ç‚¹å­˜æ´»çŠ¶æ€ã€è¿è¡Œè¯·æ±‚ç­‰ã€‚</p>
<p>Â·    ä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼šä¸»èŠ‚ç‚¹æŒ‚æ‰äº†ä¹‹åå¯ä»¥ä»å¤‡ç”¨çš„èŠ‚ç‚¹å¼€å§‹æ–°ä¸€è½®é€‰ä¸»ï¼Œä¸»èŠ‚ç‚¹é€‰ä¸¾è¯´çš„å°±æ˜¯è¿™ä¸ªé€‰ä¸¾çš„è¿‡ç¨‹ï¼Œä½¿ç”¨ zookeeper å¯ä»¥ååŠ©å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<p>Â·    åˆ†å¸ƒå¼é”ï¼šzookeeper æä¾›ä¸¤ç§é”ï¼šç‹¬å é”ã€å…±äº«é”ã€‚ç‹¬å é”å³ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨èµ„æºï¼Œå…±äº«é”æ˜¯è¯»é”å…±äº«ï¼Œè¯»å†™äº’æ–¥ï¼Œå³å¯ä»¥æœ‰å¤šçº¿çº¿ç¨‹åŒæ—¶è¯»åŒä¸€ä¸ªèµ„æºï¼Œå¦‚æœè¦ä½¿ç”¨å†™é”ä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚zookeeperå¯ä»¥å¯¹åˆ†å¸ƒå¼é”è¿›è¡Œæ§åˆ¶ã€‚</p>
<p>Â·    å‘½åæœåŠ¡ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé€šè¿‡ä½¿ç”¨å‘½åæœåŠ¡ï¼Œå®¢æˆ·ç«¯åº”ç”¨èƒ½å¤Ÿæ ¹æ®æŒ‡å®šåå­—æ¥è·å–èµ„æºæˆ–æœåŠ¡çš„åœ°å€ï¼Œæä¾›è€…ç­‰ä¿¡æ¯ã€‚</p>
<h4 id="3-zookeeper-æœ‰å‡ ç§éƒ¨ç½²æ¨¡å¼ï¼Ÿ"><a href="#3-zookeeper-æœ‰å‡ ç§éƒ¨ç½²æ¨¡å¼ï¼Ÿ" class="headerlink" title="3. zookeeper æœ‰å‡ ç§éƒ¨ç½²æ¨¡å¼ï¼Ÿ"></a><strong>3. zookeeper</strong> <strong>æœ‰å‡ ç§éƒ¨ç½²æ¨¡å¼ï¼Ÿ</strong></h4><p>zookeeper æœ‰ä¸‰ç§éƒ¨ç½²æ¨¡å¼ï¼š</p>
<p>Â·    å•æœºéƒ¨ç½²ï¼šä¸€å°é›†ç¾¤ä¸Šè¿è¡Œï¼›</p>
<p>Â·    é›†ç¾¤éƒ¨ç½²ï¼šå¤šå°é›†ç¾¤è¿è¡Œï¼›</p>
<p>Â·    ä¼ªé›†ç¾¤éƒ¨ç½²ï¼šä¸€å°é›†ç¾¤å¯åŠ¨å¤šä¸ª zookeeper å®ä¾‹è¿è¡Œã€‚</p>
<h4 id="4-zookeeper-æ€ä¹ˆä¿è¯ä¸»ä»èŠ‚ç‚¹çš„çŠ¶æ€åŒæ­¥ï¼Ÿ"><a href="#4-zookeeper-æ€ä¹ˆä¿è¯ä¸»ä»èŠ‚ç‚¹çš„çŠ¶æ€åŒæ­¥ï¼Ÿ" class="headerlink" title="4. zookeeper æ€ä¹ˆä¿è¯ä¸»ä»èŠ‚ç‚¹çš„çŠ¶æ€åŒæ­¥ï¼Ÿ"></a><strong>4. zookeeper</strong> <strong>æ€ä¹ˆä¿è¯ä¸»ä»èŠ‚ç‚¹çš„çŠ¶æ€åŒæ­¥ï¼Ÿ</strong></h4><p>zookeeper çš„æ ¸å¿ƒæ˜¯åŸå­å¹¿æ’­ï¼Œè¿™ä¸ªæœºåˆ¶ä¿è¯äº†å„ä¸ª server ä¹‹é—´çš„åŒæ­¥ã€‚å®ç°è¿™ä¸ªæœºåˆ¶çš„åè®®å«åš zab åè®®ã€‚ zab åè®®æœ‰ä¸¤ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯æ¢å¤æ¨¡å¼ï¼ˆé€‰ä¸»ï¼‰å’Œå¹¿æ’­æ¨¡å¼ï¼ˆåŒæ­¥ï¼‰ã€‚å½“æœåŠ¡å¯åŠ¨æˆ–è€…åœ¨é¢†å¯¼è€…å´©æºƒåï¼Œzab å°±è¿›å…¥äº†æ¢å¤æ¨¡å¼ï¼Œå½“é¢†å¯¼è€…è¢«é€‰ä¸¾å‡ºæ¥ï¼Œä¸”å¤§å¤šæ•° server å®Œæˆäº†å’Œ leader çš„çŠ¶æ€åŒæ­¥ä»¥åï¼Œæ¢å¤æ¨¡å¼å°±ç»“æŸäº†ã€‚çŠ¶æ€åŒæ­¥ä¿è¯äº† leader å’Œ server å…·æœ‰ç›¸åŒçš„ç³»ç»ŸçŠ¶æ€ã€‚</p>
<h4 id="5-é›†ç¾¤ä¸­ä¸ºä»€ä¹ˆè¦æœ‰ä¸»èŠ‚ç‚¹ï¼Ÿ"><a href="#5-é›†ç¾¤ä¸­ä¸ºä»€ä¹ˆè¦æœ‰ä¸»èŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="5. é›†ç¾¤ä¸­ä¸ºä»€ä¹ˆè¦æœ‰ä¸»èŠ‚ç‚¹ï¼Ÿ"></a><strong>5.</strong> <strong>é›†ç¾¤ä¸­ä¸ºä»€ä¹ˆè¦æœ‰ä¸»èŠ‚ç‚¹ï¼Ÿ</strong></h4><p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæœ‰äº›ä¸šåŠ¡é€»è¾‘åªéœ€è¦é›†ç¾¤ä¸­çš„æŸä¸€å°æœºå™¨è¿›è¡Œæ‰§è¡Œï¼Œå…¶ä»–çš„æœºå™¨å¯ä»¥å…±äº«è¿™ä¸ªç»“æœï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘é‡å¤è®¡ç®—ï¼Œæé«˜æ€§èƒ½ï¼Œæ‰€ä»¥å°±éœ€è¦ä¸»èŠ‚ç‚¹ã€‚</p>
<h4 id="6-é›†ç¾¤ä¸­æœ‰-3-å°æœåŠ¡å™¨ï¼Œå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œè¿™ä¸ªæ—¶å€™-zookeeper-è¿˜å¯ä»¥ä½¿ç”¨å—ï¼Ÿ"><a href="#6-é›†ç¾¤ä¸­æœ‰-3-å°æœåŠ¡å™¨ï¼Œå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œè¿™ä¸ªæ—¶å€™-zookeeper-è¿˜å¯ä»¥ä½¿ç”¨å—ï¼Ÿ" class="headerlink" title="6. é›†ç¾¤ä¸­æœ‰ 3 å°æœåŠ¡å™¨ï¼Œå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œè¿™ä¸ªæ—¶å€™ zookeeper è¿˜å¯ä»¥ä½¿ç”¨å—ï¼Ÿ"></a><strong>6.</strong> <strong>é›†ç¾¤ä¸­æœ‰</strong> <strong>3</strong> <strong>å°æœåŠ¡å™¨ï¼Œå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œè¿™ä¸ªæ—¶å€™</strong> <strong>zookeeper</strong> <strong>è¿˜å¯ä»¥ä½¿ç”¨å—ï¼Ÿ</strong></h4><p>å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œå•æ•°æœåŠ¡å™¨åªè¦æ²¡è¶…è¿‡ä¸€åŠçš„æœåŠ¡å™¨å®•æœºå°±å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</p>
<h4 id="7-è¯´ä¸€ä¸‹-zookeeper-çš„é€šçŸ¥æœºåˆ¶ï¼Ÿ"><a href="#7-è¯´ä¸€ä¸‹-zookeeper-çš„é€šçŸ¥æœºåˆ¶ï¼Ÿ" class="headerlink" title="7. è¯´ä¸€ä¸‹ zookeeper çš„é€šçŸ¥æœºåˆ¶ï¼Ÿ"></a><strong>7.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>zookeeper</strong> <strong>çš„é€šçŸ¥æœºåˆ¶ï¼Ÿ</strong></h4><p>å®¢æˆ·ç«¯ç«¯ä¼šå¯¹æŸä¸ª znode å»ºç«‹ä¸€ä¸ª watcher äº‹ä»¶ï¼Œå½“è¯¥ znode å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™äº›å®¢æˆ·ç«¯ä¼šæ”¶åˆ° zookeeper çš„é€šçŸ¥ï¼Œç„¶åå®¢æˆ·ç«¯å¯ä»¥æ ¹æ® znode å˜åŒ–æ¥åšå‡ºä¸šåŠ¡ä¸Šçš„æ”¹å˜ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>Zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title>java Kafka çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java-Kafka-%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-kafka-å¯ä»¥è„±ç¦»-zookeeper-å•ç‹¬ä½¿ç”¨å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#1-kafka-å¯ä»¥è„±ç¦»-zookeeper-å•ç‹¬ä½¿ç”¨å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. kafka å¯ä»¥è„±ç¦» zookeeper å•ç‹¬ä½¿ç”¨å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a><strong>1. kafka</strong> <strong>å¯ä»¥è„±ç¦»</strong> <strong>zookeeper</strong> <strong>å•ç‹¬ä½¿ç”¨å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></h4><p>kafka ä¸èƒ½è„±ç¦» zookeeper å•ç‹¬ä½¿ç”¨ï¼Œå› ä¸º kafka ä½¿ç”¨ zookeeper ç®¡ç†å’Œåè°ƒ kafka çš„èŠ‚ç‚¹æœåŠ¡å™¨ã€‚</p>
<h4 id="2-kafka-æœ‰å‡ ç§æ•°æ®ä¿ç•™çš„ç­–ç•¥ï¼Ÿ"><a href="#2-kafka-æœ‰å‡ ç§æ•°æ®ä¿ç•™çš„ç­–ç•¥ï¼Ÿ" class="headerlink" title="2. kafka æœ‰å‡ ç§æ•°æ®ä¿ç•™çš„ç­–ç•¥ï¼Ÿ"></a><strong>2. kafka</strong> <strong>æœ‰å‡ ç§æ•°æ®ä¿ç•™çš„ç­–ç•¥ï¼Ÿ</strong></h4><p>kafka æœ‰ä¸¤ç§æ•°æ®ä¿å­˜ç­–ç•¥ï¼šæŒ‰ç…§è¿‡æœŸæ—¶é—´ä¿ç•™å’ŒæŒ‰ç…§å­˜å‚¨çš„æ¶ˆæ¯å¤§å°ä¿ç•™ã€‚</p>
<h4 id="3-kafka-åŒæ—¶è®¾ç½®äº†-7-å¤©å’Œ-10G-æ¸…é™¤æ•°æ®ï¼Œåˆ°ç¬¬äº”å¤©çš„æ—¶å€™æ¶ˆæ¯è¾¾åˆ°äº†-10G-ï¼Œè¿™ä¸ªæ—¶å€™-kafka-å°†å¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#3-kafka-åŒæ—¶è®¾ç½®äº†-7-å¤©å’Œ-10G-æ¸…é™¤æ•°æ®ï¼Œåˆ°ç¬¬äº”å¤©çš„æ—¶å€™æ¶ˆæ¯è¾¾åˆ°äº†-10G-ï¼Œè¿™ä¸ªæ—¶å€™-kafka-å°†å¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="3. kafka åŒæ—¶è®¾ç½®äº† 7 å¤©å’Œ 10G æ¸…é™¤æ•°æ®ï¼Œåˆ°ç¬¬äº”å¤©çš„æ—¶å€™æ¶ˆæ¯è¾¾åˆ°äº† 10G**ï¼Œè¿™ä¸ªæ—¶å€™** kafka å°†å¦‚ä½•å¤„ç†ï¼Ÿ"></a><strong>3. kafka</strong> <strong>åŒæ—¶è®¾ç½®äº†</strong> <strong>7</strong> <strong>å¤©å’Œ</strong> <strong>10G</strong> <strong>æ¸…é™¤æ•°æ®ï¼Œåˆ°ç¬¬äº”å¤©çš„æ—¶å€™æ¶ˆæ¯è¾¾åˆ°äº†</strong> <strong>10G**</strong>ï¼Œè¿™ä¸ªæ—¶å€™** <strong>kafka</strong> <strong>å°†å¦‚ä½•å¤„ç†ï¼Ÿ</strong></h4><p>è¿™ä¸ªæ—¶å€™ kafka ä¼šæ‰§è¡Œæ•°æ®æ¸…é™¤å·¥ä½œï¼Œæ—¶é—´å’Œå¤§å°ä¸è®ºé‚£ä¸ªæ»¡è¶³æ¡ä»¶ï¼Œéƒ½ä¼šæ¸…ç©ºæ•°æ®ã€‚</p>
<h4 id="4-ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´-kafka-è¿è¡Œå˜æ…¢ï¼Ÿ"><a href="#4-ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´-kafka-è¿è¡Œå˜æ…¢ï¼Ÿ" class="headerlink" title="4. ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´ kafka è¿è¡Œå˜æ…¢ï¼Ÿ"></a><strong>4.</strong> <strong>ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´</strong> <strong>kafka</strong> <strong>è¿è¡Œå˜æ…¢ï¼Ÿ</strong></h4><p>Â·    cpu æ€§èƒ½ç“¶é¢ˆ</p>
<p>Â·    ç£ç›˜è¯»å†™ç“¶é¢ˆ</p>
<p>Â·    ç½‘ç»œç“¶é¢ˆ</p>
<h4 id="5-ä½¿ç”¨-kafka-é›†ç¾¤éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#5-ä½¿ç”¨-kafka-é›†ç¾¤éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5. ä½¿ç”¨ kafka é›†ç¾¤éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a><strong>5.</strong> <strong>ä½¿ç”¨</strong> <strong>kafka</strong> <strong>é›†ç¾¤éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</strong></h4><p>Â·    é›†ç¾¤çš„æ•°é‡ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡ 7 ä¸ªï¼Œå› ä¸ºèŠ‚ç‚¹è¶Šå¤šï¼Œæ¶ˆæ¯å¤åˆ¶éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œæ•´ä¸ªç¾¤ç»„çš„ååé‡å°±è¶Šä½ã€‚</p>
<p>Â·    é›†ç¾¤æ•°é‡æœ€å¥½æ˜¯å•æ•°ï¼Œå› ä¸ºè¶…è¿‡ä¸€åŠæ•…éšœé›†ç¾¤å°±ä¸èƒ½ç”¨äº†ï¼Œè®¾ç½®ä¸ºå•æ•°å®¹é”™ç‡æ›´é«˜ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>Kafka</tag>
        <tag>æ¶ˆæ¯é˜Ÿåˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title>java RabbitMQ çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java-RabbitMQ-%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-RabbitMQ-çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#1-RabbitMQ-çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="1. RabbitMQ çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a><strong>1. RabbitMQ</strong> <strong>çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Â·    æŠ¢è´­æ´»åŠ¨ï¼Œå‰Šå³°å¡«è°·ï¼Œé˜²æ­¢ç³»ç»Ÿå´©å¡Œã€‚</p>
<p>Â·    å»¶è¿Ÿä¿¡æ¯å¤„ç†ï¼Œæ¯”å¦‚ 10 åˆ†é’Ÿä¹‹åç»™ä¸‹å•æœªä»˜æ¬¾çš„ç”¨æˆ·å‘é€é‚®ä»¶æé†’ã€‚</p>
<p>Â·    è§£è€¦ç³»ç»Ÿï¼Œå¯¹äºæ–°å¢çš„åŠŸèƒ½å¯ä»¥å•ç‹¬å†™æ¨¡å—æ‰©å±•ï¼Œæ¯”å¦‚ç”¨æˆ·ç¡®è®¤è¯„ä»·ä¹‹åï¼Œæ–°å¢äº†ç»™ç”¨æˆ·è¿”ç§¯åˆ†çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæ—¶å€™ä¸ç”¨åœ¨ä¸šåŠ¡ä»£ç é‡Œæ·»åŠ æ–°å¢ç§¯åˆ†çš„åŠŸèƒ½ï¼Œåªéœ€è¦æŠŠæ–°å¢ç§¯åˆ†çš„æ¥å£è®¢é˜…ç¡®è®¤è¯„ä»·çš„æ¶ˆæ¯é˜Ÿåˆ—å³å¯ï¼Œåé¢å†æ·»åŠ ä»»ä½•åŠŸèƒ½åªéœ€è¦è®¢é˜…å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—å³å¯ã€‚</p>
<h4 id="2-RabbitMQ-æœ‰å“ªäº›é‡è¦çš„è§’è‰²ï¼Ÿ"><a href="#2-RabbitMQ-æœ‰å“ªäº›é‡è¦çš„è§’è‰²ï¼Ÿ" class="headerlink" title="2. RabbitMQ æœ‰å“ªäº›é‡è¦çš„è§’è‰²ï¼Ÿ"></a><strong>2. RabbitMQ</strong> <strong>æœ‰å“ªäº›é‡è¦çš„è§’è‰²ï¼Ÿ</strong></h4><p>RabbitMQ ä¸­é‡è¦çš„è§’è‰²æœ‰ï¼šç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å’Œä»£ç†ï¼š</p>
<p>Â·    ç”Ÿäº§è€…ï¼šæ¶ˆæ¯çš„åˆ›å»ºè€…ï¼Œè´Ÿè´£åˆ›å»ºå’Œæ¨é€æ•°æ®åˆ°æ¶ˆæ¯æœåŠ¡å™¨ï¼›</p>
<p>Â·    æ¶ˆè´¹è€…ï¼šæ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œç”¨äºå¤„ç†æ•°æ®å’Œç¡®è®¤æ¶ˆæ¯ï¼›</p>
<p>Â·    ä»£ç†ï¼šå°±æ˜¯ RabbitMQ æœ¬èº«ï¼Œç”¨äºæ‰®æ¼”â€œå¿«é€’â€çš„è§’è‰²ï¼Œæœ¬èº«ä¸ç”Ÿäº§æ¶ˆæ¯ï¼Œåªæ˜¯æ‰®æ¼”â€œå¿«é€’â€çš„è§’è‰²ã€‚</p>
<h4 id="3-RabbitMQ-æœ‰å“ªäº›é‡è¦çš„ç»„ä»¶ï¼Ÿ"><a href="#3-RabbitMQ-æœ‰å“ªäº›é‡è¦çš„ç»„ä»¶ï¼Ÿ" class="headerlink" title="3. RabbitMQ æœ‰å“ªäº›é‡è¦çš„ç»„ä»¶ï¼Ÿ"></a><strong>3. RabbitMQ</strong> <strong>æœ‰å“ªäº›é‡è¦çš„ç»„ä»¶ï¼Ÿ</strong></h4><p>Â·    ConnectionFactoryï¼ˆè¿æ¥ç®¡ç†å™¨ï¼‰ï¼šåº”ç”¨ç¨‹åºä¸Rabbitä¹‹é—´å»ºç«‹è¿æ¥çš„ç®¡ç†å™¨ï¼Œç¨‹åºä»£ç ä¸­ä½¿ç”¨ã€‚</p>
<p>Â·    Channelï¼ˆä¿¡é“ï¼‰ï¼šæ¶ˆæ¯æ¨é€ä½¿ç”¨çš„é€šé“ã€‚</p>
<p>Â·    Exchangeï¼ˆäº¤æ¢å™¨ï¼‰ï¼šç”¨äºæ¥å—ã€åˆ†é…æ¶ˆæ¯ã€‚</p>
<p>Â·    Queueï¼ˆé˜Ÿåˆ—ï¼‰ï¼šç”¨äºå­˜å‚¨ç”Ÿäº§è€…çš„æ¶ˆæ¯ã€‚</p>
<p>Â·    RoutingKeyï¼ˆè·¯ç”±é”®ï¼‰ï¼šç”¨äºæŠŠç”Ÿæˆè€…çš„æ•°æ®åˆ†é…åˆ°äº¤æ¢å™¨ä¸Šã€‚</p>
<p>Â·    BindingKeyï¼ˆç»‘å®šé”®ï¼‰ï¼šç”¨äºæŠŠäº¤æ¢å™¨çš„æ¶ˆæ¯ç»‘å®šåˆ°é˜Ÿåˆ—ä¸Šã€‚</p>
<h4 id="4-RabbitMQ-ä¸­-vhost-çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#4-RabbitMQ-ä¸­-vhost-çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="4. RabbitMQ ä¸­ vhost çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>4. RabbitMQ</strong> <strong>ä¸­</strong> <strong>vhost</strong> <strong>çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>vhostï¼šæ¯ä¸ª RabbitMQ éƒ½èƒ½åˆ›å»ºå¾ˆå¤š vhostï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè™šæ‹Ÿä¸»æœºï¼Œæ¯ä¸ªè™šæ‹Ÿä¸»æœºå…¶å®éƒ½æ˜¯ mini ç‰ˆçš„RabbitMQï¼Œå®ƒæ‹¥æœ‰è‡ªå·±çš„é˜Ÿåˆ—ï¼Œäº¤æ¢å™¨å’Œç»‘å®šï¼Œæ‹¥æœ‰è‡ªå·±çš„æƒé™æœºåˆ¶ã€‚</p>
<h4 id="5-RabbitMQ-çš„æ¶ˆæ¯æ˜¯æ€ä¹ˆå‘é€çš„ï¼Ÿ"><a href="#5-RabbitMQ-çš„æ¶ˆæ¯æ˜¯æ€ä¹ˆå‘é€çš„ï¼Ÿ" class="headerlink" title="5. RabbitMQ çš„æ¶ˆæ¯æ˜¯æ€ä¹ˆå‘é€çš„ï¼Ÿ"></a><strong>5. RabbitMQ</strong> <strong>çš„æ¶ˆæ¯æ˜¯æ€ä¹ˆå‘é€çš„ï¼Ÿ</strong></h4><p>é¦–å…ˆå®¢æˆ·ç«¯å¿…é¡»è¿æ¥åˆ° RabbitMQ æœåŠ¡å™¨æ‰èƒ½å‘å¸ƒå’Œæ¶ˆè´¹æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å’Œ rabbit server ä¹‹é—´ä¼šåˆ›å»ºä¸€ä¸ª tcp è¿æ¥ï¼Œä¸€æ—¦ tcp æ‰“å¼€å¹¶é€šè¿‡äº†è®¤è¯ï¼ˆè®¤è¯å°±æ˜¯ä½ å‘é€ç»™ rabbit æœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç ï¼‰ï¼Œä½ çš„å®¢æˆ·ç«¯å’Œ RabbitMQ å°±åˆ›å»ºäº†ä¸€æ¡ amqp ä¿¡é“ï¼ˆchannelï¼‰ï¼Œä¿¡é“æ˜¯åˆ›å»ºåœ¨â€œçœŸå®â€ tcp ä¸Šçš„è™šæ‹Ÿè¿æ¥ï¼Œamqp å‘½ä»¤éƒ½æ˜¯é€šè¿‡ä¿¡é“å‘é€å‡ºå»çš„ï¼Œæ¯ä¸ªä¿¡é“éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„ idï¼Œä¸è®ºæ˜¯å‘å¸ƒæ¶ˆæ¯ï¼Œè®¢é˜…é˜Ÿåˆ—éƒ½æ˜¯é€šè¿‡è¿™ä¸ªä¿¡é“å®Œæˆçš„ã€‚</p>
<h4 id="6-RabbitMQ-æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„ç¨³å®šæ€§ï¼Ÿ"><a href="#6-RabbitMQ-æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„ç¨³å®šæ€§ï¼Ÿ" class="headerlink" title="6. RabbitMQ æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„ç¨³å®šæ€§ï¼Ÿ"></a><strong>6. RabbitMQ</strong> <strong>æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„ç¨³å®šæ€§ï¼Ÿ</strong></h4><p>Â·    æä¾›äº†äº‹åŠ¡çš„åŠŸèƒ½ã€‚</p>
<p>Â·    é€šè¿‡å°† channel è®¾ç½®ä¸º confirmï¼ˆç¡®è®¤ï¼‰æ¨¡å¼ã€‚</p>
<h4 id="7-RabbitMQ-æ€ä¹ˆé¿å…æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ"><a href="#7-RabbitMQ-æ€ä¹ˆé¿å…æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ" class="headerlink" title="7. RabbitMQ æ€ä¹ˆé¿å…æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ"></a><strong>7. RabbitMQ</strong> <strong>æ€ä¹ˆé¿å…æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ</strong></h4><p>Â·    æŠŠæ¶ˆæ¯æŒä¹…åŒ–ç£ç›˜ï¼Œä¿è¯æœåŠ¡å™¨é‡å¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚</p>
<p>Â·    æ¯ä¸ªé›†ç¾¤ä¸­è‡³å°‘æœ‰ä¸€ä¸ªç‰©ç†ç£ç›˜ï¼Œä¿è¯æ¶ˆæ¯è½å…¥ç£ç›˜ã€‚</p>
<h4 id="8-è¦ä¿è¯æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸçš„æ¡ä»¶æœ‰å“ªäº›ï¼Ÿ"><a href="#8-è¦ä¿è¯æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸçš„æ¡ä»¶æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="8. è¦ä¿è¯æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸçš„æ¡ä»¶æœ‰å“ªäº›ï¼Ÿ"></a><strong>8.</strong> <strong>è¦ä¿è¯æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸçš„æ¡ä»¶æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Â·    å£°æ˜é˜Ÿåˆ—å¿…é¡»è®¾ç½®æŒä¹…åŒ– durable è®¾ç½®ä¸º true.</p>
<p>Â·    æ¶ˆæ¯æ¨é€æŠ•é€’æ¨¡å¼å¿…é¡»è®¾ç½®æŒä¹…åŒ–ï¼ŒdeliveryMode è®¾ç½®ä¸º 2ï¼ˆæŒä¹…ï¼‰ã€‚</p>
<p>Â·    æ¶ˆæ¯å·²ç»åˆ°è¾¾æŒä¹…åŒ–äº¤æ¢å™¨ã€‚</p>
<p>Â·    æ¶ˆæ¯å·²ç»åˆ°è¾¾æŒä¹…åŒ–é˜Ÿåˆ—ã€‚</p>
<p>ä»¥ä¸Šå››ä¸ªæ¡ä»¶éƒ½æ»¡è¶³æ‰èƒ½ä¿è¯æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸã€‚</p>
<h4 id="9-RabbitMQ-æŒä¹…åŒ–æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ"><a href="#9-RabbitMQ-æŒä¹…åŒ–æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ" class="headerlink" title="9. RabbitMQ æŒä¹…åŒ–æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ"></a><strong>9. RabbitMQ</strong> <strong>æŒä¹…åŒ–æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</strong></h4><p>æŒä¹…åŒ–çš„ç¼ºåœ°å°±æ˜¯é™ä½äº†æœåŠ¡å™¨çš„ååé‡ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯ç£ç›˜è€Œéå†…å­˜å­˜å‚¨ï¼Œä»è€Œé™ä½äº†ååé‡ã€‚å¯å°½é‡ä½¿ç”¨ ssd ç¡¬ç›˜æ¥ç¼“è§£ååé‡çš„é—®é¢˜ã€‚</p>
<h4 id="10-RabbitMQ-æœ‰å‡ ç§å¹¿æ’­ç±»å‹ï¼Ÿ"><a href="#10-RabbitMQ-æœ‰å‡ ç§å¹¿æ’­ç±»å‹ï¼Ÿ" class="headerlink" title="10. RabbitMQ æœ‰å‡ ç§å¹¿æ’­ç±»å‹ï¼Ÿ"></a><strong>10. RabbitMQ</strong> <strong>æœ‰å‡ ç§å¹¿æ’­ç±»å‹ï¼Ÿ</strong></h4><p>Â·    directï¼ˆé»˜è®¤æ–¹å¼ï¼‰ï¼šæœ€åŸºç¡€æœ€ç®€å•çš„æ¨¡å¼ï¼Œå‘é€æ–¹æŠŠæ¶ˆæ¯å‘é€ç»™è®¢é˜…æ–¹ï¼Œå¦‚æœæœ‰å¤šä¸ªè®¢é˜…è€…ï¼Œé»˜è®¤é‡‡å–è½®è¯¢çš„æ–¹å¼è¿›è¡Œæ¶ˆæ¯å‘é€ã€‚</p>
<p>Â·    headersï¼šä¸ direct ç±»ä¼¼ï¼Œåªæ˜¯æ€§èƒ½å¾ˆå·®ï¼Œæ­¤ç±»å‹å‡ ä¹ç”¨ä¸åˆ°ã€‚</p>
<p>Â·    fanoutï¼šåˆ†å‘æ¨¡å¼ï¼ŒæŠŠæ¶ˆè´¹åˆ†å‘ç»™æ‰€æœ‰è®¢é˜…è€…ã€‚</p>
<p>Â·    topicï¼šåŒ¹é…è®¢é˜…æ¨¡å¼ï¼Œä½¿ç”¨æ­£åˆ™åŒ¹é…åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œèƒ½åŒ¹é…åˆ°çš„éƒ½èƒ½æ¥æ”¶åˆ°ã€‚</p>
<h4 id="11-RabbitMQ-æ€ä¹ˆå®ç°å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"><a href="#11-RabbitMQ-æ€ä¹ˆå®ç°å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="11. RabbitMQ æ€ä¹ˆå®ç°å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"></a><strong>11. RabbitMQ</strong> <strong>æ€ä¹ˆå®ç°å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</strong></h4><p>å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<p>Â·    é€šè¿‡æ¶ˆæ¯è¿‡æœŸåè¿›å…¥æ­»ä¿¡äº¤æ¢å™¨ï¼Œå†ç”±äº¤æ¢å™¨è½¬å‘åˆ°å»¶è¿Ÿæ¶ˆè´¹é˜Ÿåˆ—ï¼Œå®ç°å»¶è¿ŸåŠŸèƒ½ï¼›</p>
<p>Â·    ä½¿ç”¨ RabbitMQ-delayed-message-exchange æ’ä»¶å®ç°å»¶è¿ŸåŠŸèƒ½ã€‚</p>
<h4 id="12-RabbitMQ-é›†ç¾¤æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#12-RabbitMQ-é›†ç¾¤æœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="12. RabbitMQ é›†ç¾¤æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a><strong>12. RabbitMQ</strong> <strong>é›†ç¾¤æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</strong></h4><p>é›†ç¾¤ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªç”¨é€”ï¼š</p>
<p>Â·    é«˜å¯ç”¨ï¼šæŸä¸ªæœåŠ¡å™¨å‡ºç°é—®é¢˜ï¼Œæ•´ä¸ª RabbitMQ è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼›</p>
<p>Â·    é«˜å®¹é‡ï¼šé›†ç¾¤å¯ä»¥æ‰¿è½½æ›´å¤šçš„æ¶ˆæ¯é‡ã€‚</p>
<h4 id="13-RabbitMQ-èŠ‚ç‚¹çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ"><a href="#13-RabbitMQ-èŠ‚ç‚¹çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="13. RabbitMQ èŠ‚ç‚¹çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ"></a><strong>13. RabbitMQ</strong> <strong>èŠ‚ç‚¹çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Â·    ç£ç›˜èŠ‚ç‚¹ï¼šæ¶ˆæ¯ä¼šå­˜å‚¨åˆ°ç£ç›˜ã€‚</p>
<p>Â·    å†…å­˜èŠ‚ç‚¹ï¼šæ¶ˆæ¯éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé‡å¯æœåŠ¡å™¨æ¶ˆæ¯ä¸¢å¤±ï¼Œæ€§èƒ½é«˜äºç£ç›˜ç±»å‹ã€‚</p>
<h4 id="14-RabbitMQ-é›†ç¾¤æ­å»ºéœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ"><a href="#14-RabbitMQ-é›†ç¾¤æ­å»ºéœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ" class="headerlink" title="14. RabbitMQ é›†ç¾¤æ­å»ºéœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ"></a><strong>14. RabbitMQ</strong> <strong>é›†ç¾¤æ­å»ºéœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ</strong></h4><p>Â·    å„èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨â€œâ€“linkâ€è¿æ¥ï¼Œæ­¤å±æ€§ä¸èƒ½å¿½ç•¥ã€‚</p>
<p>Â·    å„èŠ‚ç‚¹ä½¿ç”¨çš„ erlang cookie å€¼å¿…é¡»ç›¸åŒï¼Œæ­¤å€¼ç›¸å½“äºâ€œç§˜é’¥â€çš„åŠŸèƒ½ï¼Œç”¨äºå„èŠ‚ç‚¹çš„è®¤è¯ã€‚</p>
<p>Â·    æ•´ä¸ªé›†ç¾¤ä¸­å¿…é¡»åŒ…å«ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹ã€‚</p>
<h4 id="15-RabbitMQ-æ¯ä¸ªèŠ‚ç‚¹æ˜¯å…¶ä»–èŠ‚ç‚¹çš„å®Œæ•´æ‹·è´å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#15-RabbitMQ-æ¯ä¸ªèŠ‚ç‚¹æ˜¯å…¶ä»–èŠ‚ç‚¹çš„å®Œæ•´æ‹·è´å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="15. RabbitMQ æ¯ä¸ªèŠ‚ç‚¹æ˜¯å…¶ä»–èŠ‚ç‚¹çš„å®Œæ•´æ‹·è´å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a><strong>15. RabbitMQ</strong> <strong>æ¯ä¸ªèŠ‚ç‚¹æ˜¯å…¶ä»–èŠ‚ç‚¹çš„å®Œæ•´æ‹·è´å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></h4><p>ä¸æ˜¯ï¼ŒåŸå› æœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š</p>
<p>Â·    å­˜å‚¨ç©ºé—´çš„è€ƒè™‘ï¼šå¦‚æœæ¯ä¸ªèŠ‚ç‚¹éƒ½æ‹¥æœ‰æ‰€æœ‰é˜Ÿåˆ—çš„å®Œå…¨æ‹·è´ï¼Œè¿™æ ·æ–°å¢èŠ‚ç‚¹ä¸ä½†æ²¡æœ‰æ–°å¢å­˜å‚¨ç©ºé—´ï¼Œåè€Œå¢åŠ äº†æ›´å¤šçš„å†—ä½™æ•°æ®ï¼›</p>
<p>Â·    æ€§èƒ½çš„è€ƒè™‘ï¼šå¦‚æœæ¯æ¡æ¶ˆæ¯éƒ½éœ€è¦å®Œæ•´æ‹·è´åˆ°æ¯ä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹ï¼Œé‚£æ–°å¢èŠ‚ç‚¹å¹¶æ²¡æœ‰æå‡å¤„ç†æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œæœ€å¤šæ˜¯ä¿æŒå’Œå•èŠ‚ç‚¹ç›¸åŒçš„æ€§èƒ½ç”šè‡³æ˜¯æ›´ç³Ÿã€‚</p>
<h4 id="16-RabbitMQ-é›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹å´©æºƒäº†ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ"><a href="#16-RabbitMQ-é›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹å´©æºƒäº†ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ" class="headerlink" title="16. RabbitMQ é›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹å´©æºƒäº†ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ"></a><strong>16. RabbitMQ</strong> <strong>é›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹å´©æºƒäº†ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ</strong></h4><p>å¦‚æœå”¯ä¸€ç£ç›˜çš„ç£ç›˜èŠ‚ç‚¹å´©æºƒäº†ï¼Œä¸èƒ½è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<p>Â·    ä¸èƒ½åˆ›å»ºé˜Ÿåˆ—</p>
<p>Â·    ä¸èƒ½åˆ›å»ºäº¤æ¢å™¨</p>
<p>Â·    ä¸èƒ½åˆ›å»ºç»‘å®š</p>
<p>Â·    ä¸èƒ½æ·»åŠ ç”¨æˆ·</p>
<p>Â·    ä¸èƒ½æ›´æ”¹æƒé™</p>
<p>Â·    ä¸èƒ½æ·»åŠ å’Œåˆ é™¤é›†ç¾¤èŠ‚ç‚¹</p>
<p>å”¯ä¸€ç£ç›˜èŠ‚ç‚¹å´©æºƒäº†ï¼Œé›†ç¾¤æ˜¯å¯ä»¥ä¿æŒè¿è¡Œçš„ï¼Œä½†ä½ ä¸èƒ½æ›´æ”¹ä»»ä½•ä¸œè¥¿ã€‚</p>
<h4 id="17-RabbitMQ-å¯¹é›†ç¾¤èŠ‚ç‚¹åœæ­¢é¡ºåºæœ‰è¦æ±‚å—ï¼Ÿ"><a href="#17-RabbitMQ-å¯¹é›†ç¾¤èŠ‚ç‚¹åœæ­¢é¡ºåºæœ‰è¦æ±‚å—ï¼Ÿ" class="headerlink" title="17. RabbitMQ å¯¹é›†ç¾¤èŠ‚ç‚¹åœæ­¢é¡ºåºæœ‰è¦æ±‚å—ï¼Ÿ"></a><strong>17. RabbitMQ</strong> <strong>å¯¹é›†ç¾¤èŠ‚ç‚¹åœæ­¢é¡ºåºæœ‰è¦æ±‚å—ï¼Ÿ</strong></h4><p>RabbitMQ å¯¹é›†ç¾¤çš„åœæ­¢çš„é¡ºåºæ˜¯æœ‰è¦æ±‚çš„ï¼Œåº”è¯¥å…ˆå…³é—­å†…å­˜èŠ‚ç‚¹ï¼Œæœ€åå†å…³é—­ç£ç›˜èŠ‚ç‚¹ã€‚å¦‚æœé¡ºåºæ°å¥½ç›¸åçš„è¯ï¼Œå¯èƒ½ä¼šé€ æˆæ¶ˆæ¯çš„ä¸¢å¤±ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>æ¶ˆæ¯é˜Ÿåˆ—</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>java Mybatis çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java-Mybatis-%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-MyBatis-ä¸­-å’Œ-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-MyBatis-ä¸­-å’Œ-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. MyBatis ä¸­ #{}å’Œ** ${}**çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>1. MyBatis</strong> <strong>ä¸­</strong> <strong>#{}</strong>å’Œ** ${}**çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>#{}æ˜¯é¢„ç¼–è¯‘å¤„ç†ï¼Œ${}æ˜¯å­—ç¬¦æ›¿æ¢ã€‚ åœ¨ä½¿ç”¨ #{}æ—¶ï¼ŒMyBatis ä¼šå°† SQL ä¸­çš„ #{}æ›¿æ¢æˆâ€œ?â€ï¼Œé…åˆ PreparedStatement çš„ set æ–¹æ³•èµ‹å€¼ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢ SQL æ³¨å…¥ï¼Œä¿è¯ç¨‹åºçš„è¿è¡Œå®‰å…¨ã€‚</p>
<h4 id="2-MyBatis-æœ‰å‡ ç§åˆ†é¡µæ–¹å¼ï¼Ÿ"><a href="#2-MyBatis-æœ‰å‡ ç§åˆ†é¡µæ–¹å¼ï¼Ÿ" class="headerlink" title="2. MyBatis æœ‰å‡ ç§åˆ†é¡µæ–¹å¼ï¼Ÿ"></a><strong>2. MyBatis</strong> <strong>æœ‰å‡ ç§åˆ†é¡µæ–¹å¼ï¼Ÿ</strong></h4><p>åˆ†é¡µæ–¹å¼ï¼šé€»è¾‘åˆ†é¡µå’Œç‰©ç†åˆ†é¡µã€‚</p>
<p>é€»è¾‘åˆ†é¡µï¼š ä½¿ç”¨ MyBatis è‡ªå¸¦çš„ RowBounds è¿›è¡Œåˆ†é¡µï¼Œå®ƒæ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å¾ˆå¤šæ•°æ®ï¼Œç„¶ååœ¨æ•°æ®ä¸­å†è¿›è¡Œæ£€ç´¢ã€‚</p>
<p>ç‰©ç†åˆ†é¡µï¼š è‡ªå·±æ‰‹å†™ SQL åˆ†é¡µæˆ–ä½¿ç”¨åˆ†é¡µæ’ä»¶ PageHelperï¼Œå»æ•°æ®åº“æŸ¥è¯¢æŒ‡å®šæ¡æ•°çš„åˆ†é¡µæ•°æ®çš„å½¢å¼ã€‚</p>
<h4 id="3-RowBounds-æ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å…¨éƒ¨ç»“æœå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#3-RowBounds-æ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å…¨éƒ¨ç»“æœå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="3. RowBounds æ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å…¨éƒ¨ç»“æœå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a><strong>3. RowBounds</strong> <strong>æ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å…¨éƒ¨ç»“æœå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></h4><p>RowBounds è¡¨é¢æ˜¯åœ¨â€œæ‰€æœ‰â€æ•°æ®ä¸­æ£€ç´¢æ•°æ®ï¼Œå…¶å®å¹¶éæ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ï¼Œå› ä¸º MyBatis æ˜¯å¯¹ jdbc çš„å°è£…ï¼Œåœ¨ jdbc é©±åŠ¨ä¸­æœ‰ä¸€ä¸ª Fetch Size çš„é…ç½®ï¼Œå®ƒè§„å®šäº†æ¯æ¬¡æœ€å¤šä»æ•°æ®åº“æŸ¥è¯¢å¤šå°‘æ¡æ•°æ®ï¼Œå‡å¦‚ä½ è¦æŸ¥è¯¢æ›´å¤šæ•°æ®ï¼Œå®ƒä¼šåœ¨ä½ æ‰§è¡Œ next()çš„æ—¶å€™ï¼Œå»æŸ¥è¯¢æ›´å¤šçš„æ•°æ®ã€‚å°±å¥½æ¯”ä½ å»è‡ªåŠ¨å–æ¬¾æœºå– 10000 å…ƒï¼Œä½†å–æ¬¾æœºæ¯æ¬¡æœ€å¤šèƒ½å– 2500 å…ƒï¼Œæ‰€ä»¥ä½ è¦å– 4 æ¬¡æ‰èƒ½æŠŠé’±å–å®Œã€‚åªæ˜¯å¯¹äº jdbc æ¥è¯´ï¼Œå½“ä½ è°ƒç”¨ next()çš„æ—¶å€™ä¼šè‡ªåŠ¨å¸®ä½ å®ŒæˆæŸ¥è¯¢å·¥ä½œã€‚è¿™æ ·åšçš„å¥½å¤„å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢å†…å­˜æº¢å‡ºã€‚</p>
<p>Fetch Size å®˜æ–¹ç›¸å…³æ–‡æ¡£ï¼š<a href="http://t" target="_blank" rel="noopener">http://t</a>. cn/EfSE2g3</p>
<h4 id="4-MyBatis-é€»è¾‘åˆ†é¡µå’Œç‰©ç†åˆ†é¡µçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#4-MyBatis-é€»è¾‘åˆ†é¡µå’Œç‰©ç†åˆ†é¡µçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="4. MyBatis é€»è¾‘åˆ†é¡µå’Œç‰©ç†åˆ†é¡µçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>4. MyBatis</strong> <strong>é€»è¾‘åˆ†é¡µå’Œç‰©ç†åˆ†é¡µçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Â·    é€»è¾‘åˆ†é¡µæ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢å¾ˆå¤šæ•°æ®ï¼Œç„¶åå†åœ¨ç»“æœä¸­æ£€ç´¢åˆ†é¡µçš„æ•°æ®ã€‚è¿™æ ·åšå¼Šç«¯æ˜¯éœ€è¦æ¶ˆè€—å¤§é‡çš„å†…å­˜ã€æœ‰å†…å­˜æº¢å‡ºçš„é£é™©ã€å¯¹æ•°æ®åº“å‹åŠ›è¾ƒå¤§ã€‚</p>
<p>Â·    ç‰©ç†åˆ†é¡µæ˜¯ä»æ•°æ®åº“æŸ¥è¯¢æŒ‡å®šæ¡æ•°çš„æ•°æ®ï¼Œå¼¥è¡¥äº†ä¸€æ¬¡æ€§å…¨éƒ¨æŸ¥å‡ºçš„æ‰€æœ‰æ•°æ®çš„ç§ç§ç¼ºç‚¹ï¼Œæ¯”å¦‚éœ€è¦å¤§é‡çš„å†…å­˜ï¼Œå¯¹æ•°æ®åº“æŸ¥è¯¢å‹åŠ›è¾ƒå¤§ç­‰é—®é¢˜ã€‚</p>
<h4 id="5-MyBatis-æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå»¶è¿ŸåŠ è½½çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5-MyBatis-æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå»¶è¿ŸåŠ è½½çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5. MyBatis æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå»¶è¿ŸåŠ è½½çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>5. MyBatis</strong> <strong>æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå»¶è¿ŸåŠ è½½çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>MyBatis æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œè®¾ç½® lazyLoadingEnabled=true å³å¯ã€‚</p>
<p>å»¶è¿ŸåŠ è½½çš„åŸç†çš„æ˜¯è°ƒç”¨çš„æ—¶å€™è§¦å‘åŠ è½½ï¼Œè€Œä¸æ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±åŠ è½½ä¿¡æ¯ã€‚æ¯”å¦‚è°ƒç”¨ a. getB(). getName()ï¼Œè¿™ä¸ªæ—¶å€™å‘ç° a. getB() çš„å€¼ä¸º nullï¼Œæ­¤æ—¶ä¼šå•ç‹¬è§¦å‘äº‹å…ˆä¿å­˜å¥½çš„å…³è” B å¯¹è±¡çš„ SQLï¼Œå…ˆæŸ¥è¯¢å‡ºæ¥ Bï¼Œç„¶åå†è°ƒç”¨ a. setB(b)ï¼Œè€Œè¿™æ—¶å€™å†è°ƒç”¨ a. getB(). getName() å°±æœ‰å€¼äº†ï¼Œè¿™å°±æ˜¯å»¶è¿ŸåŠ è½½çš„åŸºæœ¬åŸç†ã€‚</p>
<h4 id="6-è¯´ä¸€ä¸‹-MyBatis-çš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Ÿ"><a href="#6-è¯´ä¸€ä¸‹-MyBatis-çš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Ÿ" class="headerlink" title="6. è¯´ä¸€ä¸‹ MyBatis çš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Ÿ"></a><strong>6.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>MyBatis</strong> <strong>çš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Ÿ</strong></h4><p>Â·    ä¸€çº§ç¼“å­˜ï¼šåŸºäº PerpetualCache çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œå®ƒçš„å£°æ˜å‘¨æœŸæ˜¯å’Œ SQLSession ä¸€è‡´çš„ï¼Œæœ‰å¤šä¸ª SQLSession æˆ–è€…åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸­æ•°æ®åº“æ“ä½œï¼Œå¯èƒ½ä¼šå‡ºç°è„æ•°æ®ã€‚å½“ Session flush æˆ– close ä¹‹åï¼Œè¯¥ Session ä¸­çš„æ‰€æœ‰ Cache å°±å°†æ¸…ç©ºï¼Œé»˜è®¤ä¸€çº§ç¼“å­˜æ˜¯å¼€å¯çš„ã€‚</p>
<p>Â·    äºŒçº§ç¼“å­˜ï¼šä¹Ÿæ˜¯åŸºäº PerpetualCache çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œä¸åŒåœ¨äºå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Mapper çº§åˆ«çš„ï¼Œå¦‚æœå¤šä¸ªSQLSessionä¹‹é—´éœ€è¦å…±äº«ç¼“å­˜ï¼Œåˆ™éœ€è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜ï¼Œå¹¶ä¸”äºŒçº§ç¼“å­˜å¯è‡ªå®šä¹‰å­˜å‚¨æºï¼Œå¦‚ Ehcacheã€‚é»˜è®¤ä¸æ‰“å¼€äºŒçº§ç¼“å­˜ï¼Œè¦å¼€å¯äºŒçº§ç¼“å­˜ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜å±æ€§ç±»éœ€è¦å®ç° Serializable åºåˆ—åŒ–æ¥å£(å¯ç”¨æ¥ä¿å­˜å¯¹è±¡çš„çŠ¶æ€)ã€‚</p>
<p>å¼€å¯äºŒçº§ç¼“å­˜æ•°æ®æŸ¥è¯¢æµç¨‹ï¼šäºŒçº§ç¼“å­˜ -&gt; ä¸€çº§ç¼“å­˜ -&gt; æ•°æ®åº“ã€‚</p>
<p>ç¼“å­˜æ›´æ–°æœºåˆ¶ï¼šå½“æŸä¸€ä¸ªä½œç”¨åŸŸ(ä¸€çº§ç¼“å­˜ Session/äºŒçº§ç¼“å­˜ Mapper)è¿›è¡Œäº†C/U/D æ“ä½œåï¼Œé»˜è®¤è¯¥ä½œç”¨åŸŸä¸‹æ‰€æœ‰ select ä¸­çš„ç¼“å­˜å°†è¢« clearã€‚</p>
<h4 id="7-MyBatis-å’Œ-hibernate-çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ"><a href="#7-MyBatis-å’Œ-hibernate-çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="7. MyBatis å’Œ hibernate çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ"></a><strong>7. MyBatis</strong> <strong>å’Œ</strong> <strong>hibernate</strong> <strong>çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Â·    çµæ´»æ€§ï¼šMyBatis æ›´åŠ çµæ´»ï¼Œè‡ªå·±å¯ä»¥å†™ SQL è¯­å¥ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
<p>Â·    å¯ç§»æ¤æ€§ï¼šMyBatis æœ‰å¾ˆå¤šè‡ªå·±å†™çš„ SQLï¼Œå› ä¸ºæ¯ä¸ªæ•°æ®åº“çš„ SQL å¯ä»¥ä¸ç›¸åŒï¼Œæ‰€ä»¥å¯ç§»æ¤æ€§æ¯”è¾ƒå·®ã€‚</p>
<p>Â·    å­¦ä¹ å’Œä½¿ç”¨é—¨æ§›ï¼šMyBatis å…¥é—¨æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨é—¨æ§›ä¹Ÿæ›´ä½ã€‚</p>
<p>Â·    äºŒçº§ç¼“å­˜ï¼šhibernate æ‹¥æœ‰æ›´å¥½çš„äºŒçº§ç¼“å­˜ï¼Œå®ƒçš„äºŒçº§ç¼“å­˜å¯ä»¥è‡ªè¡Œæ›´æ¢ä¸ºç¬¬ä¸‰æ–¹çš„äºŒçº§ç¼“å­˜ã€‚</p>
<h4 id="8-MyBatis-æœ‰å“ªäº›æ‰§è¡Œå™¨ï¼ˆ-Executor-ï¼‰ï¼Ÿ"><a href="#8-MyBatis-æœ‰å“ªäº›æ‰§è¡Œå™¨ï¼ˆ-Executor-ï¼‰ï¼Ÿ" class="headerlink" title="8. MyBatis æœ‰å“ªäº›æ‰§è¡Œå™¨ï¼ˆ**Executor**ï¼‰ï¼Ÿ"></a><strong>8. MyBatis</strong> <strong>æœ‰å“ªäº›æ‰§è¡Œå™¨ï¼ˆ**</strong>Executor<strong>**ï¼‰ï¼Ÿ</strong></h4><p>MyBatis æœ‰ä¸‰ç§åŸºæœ¬çš„Executoræ‰§è¡Œå™¨ï¼š</p>
<p>Â·    SimpleExecutorï¼šæ¯æ‰§è¡Œä¸€æ¬¡ update æˆ– select å°±å¼€å¯ä¸€ä¸ª Statement å¯¹è±¡ï¼Œç”¨å®Œç«‹åˆ»å…³é—­ Statement å¯¹è±¡ï¼›</p>
<p>Â·    ReuseExecutorï¼šæ‰§è¡Œ update æˆ– selectï¼Œä»¥ SQL ä½œä¸º key æŸ¥æ‰¾ Statement å¯¹è±¡ï¼Œå­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼Œç”¨å®Œåä¸å…³é—­ Statement å¯¹è±¡ï¼Œè€Œæ˜¯æ”¾ç½®äº Map å†…ä¾›ä¸‹ä¸€æ¬¡ä½¿ç”¨ã€‚ç®€è¨€ä¹‹ï¼Œå°±æ˜¯é‡å¤ä½¿ç”¨ Statement å¯¹è±¡ï¼›</p>
<p>Â·    BatchExecutorï¼šæ‰§è¡Œ updateï¼ˆæ²¡æœ‰ selectï¼Œjdbc æ‰¹å¤„ç†ä¸æ”¯æŒ selectï¼‰ï¼Œå°†æ‰€æœ‰ SQL éƒ½æ·»åŠ åˆ°æ‰¹å¤„ç†ä¸­ï¼ˆaddBatch()ï¼‰ï¼Œç­‰å¾…ç»Ÿä¸€æ‰§è¡Œï¼ˆexecuteBatch()ï¼‰ï¼Œå®ƒç¼“å­˜äº†å¤šä¸ª Statement å¯¹è±¡ï¼Œæ¯ä¸ª Statement å¯¹è±¡éƒ½æ˜¯ addBatch()å®Œæ¯•åï¼Œç­‰å¾…é€ä¸€æ‰§è¡Œ executeBatch()æ‰¹å¤„ç†ï¼Œä¸ jdbc æ‰¹å¤„ç†ç›¸åŒã€‚</p>
<h4 id="9-MyBatis-åˆ†é¡µæ’ä»¶çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#9-MyBatis-åˆ†é¡µæ’ä»¶çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="9. MyBatis åˆ†é¡µæ’ä»¶çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>9. MyBatis</strong> <strong>åˆ†é¡µæ’ä»¶çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>åˆ†é¡µæ’ä»¶çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨ MyBatis æä¾›çš„æ’ä»¶æ¥å£ï¼Œå®ç°è‡ªå®šä¹‰æ’ä»¶ï¼Œåœ¨æ’ä»¶çš„æ‹¦æˆªæ–¹æ³•å†…æ‹¦æˆªå¾…æ‰§è¡Œçš„ SQLï¼Œç„¶åé‡å†™ SQLï¼Œæ ¹æ® dialect æ–¹è¨€ï¼Œæ·»åŠ å¯¹åº”çš„ç‰©ç†åˆ†é¡µè¯­å¥å’Œç‰©ç†åˆ†é¡µå‚æ•°ã€‚</p>
<h4 id="10-MyBatis-å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ’ä»¶ï¼Ÿ"><a href="#10-MyBatis-å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ’ä»¶ï¼Ÿ" class="headerlink" title="10. MyBatis å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ’ä»¶ï¼Ÿ"></a><strong>10. MyBatis</strong> <strong>å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ’ä»¶ï¼Ÿ</strong></h4><p>è‡ªå®šä¹‰æ’ä»¶å®ç°åŸç†</p>
<p>MyBatis è‡ªå®šä¹‰æ’ä»¶é’ˆå¯¹ MyBatis å››å¤§å¯¹è±¡ï¼ˆExecutorã€StatementHandlerã€ParameterHandlerã€ResultSetHandlerï¼‰è¿›è¡Œæ‹¦æˆªï¼š</p>
<p>Â·    Executorï¼šæ‹¦æˆªå†…éƒ¨æ‰§è¡Œå™¨ï¼Œå®ƒè´Ÿè´£è°ƒç”¨ StatementHandler æ“ä½œæ•°æ®åº“ï¼Œå¹¶æŠŠç»“æœé›†é€šè¿‡ ResultSetHandler è¿›è¡Œè‡ªåŠ¨æ˜ å°„ï¼Œå¦å¤–å®ƒè¿˜å¤„ç†äº†äºŒçº§ç¼“å­˜çš„æ“ä½œï¼›</p>
<p>Â·    StatementHandlerï¼šæ‹¦æˆª SQL è¯­æ³•æ„å»ºçš„å¤„ç†ï¼Œå®ƒæ˜¯ MyBatis ç›´æ¥å’Œæ•°æ®åº“æ‰§è¡Œ SQL è„šæœ¬çš„å¯¹è±¡ï¼Œå¦å¤–å®ƒä¹Ÿå®ç°äº† MyBatis çš„ä¸€çº§ç¼“å­˜ï¼›</p>
<p>Â·    ParameterHandlerï¼šæ‹¦æˆªå‚æ•°çš„å¤„ç†ï¼›</p>
<p>Â·    ResultSetHandlerï¼šæ‹¦æˆªç»“æœé›†çš„å¤„ç†ã€‚</p>
<p>è‡ªå®šä¹‰æ’ä»¶å®ç°å…³é”®</p>
<p>MyBatis æ’ä»¶è¦å®ç° Interceptor æ¥å£ï¼Œæ¥å£åŒ…å«çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Interceptor</span> </span>&#123;  </span><br><span class="line"></span><br><span class="line">  <span class="function">Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable</span>;    </span><br><span class="line"></span><br><span class="line">  <span class="function">Object <span class="title">plugin</span><span class="params">(Object target)</span></span>;  </span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â·    setProperties æ–¹æ³•æ˜¯åœ¨ MyBatis è¿›è¡Œé…ç½®æ’ä»¶çš„æ—¶å€™å¯ä»¥é…ç½®è‡ªå®šä¹‰ç›¸å…³å±æ€§ï¼Œå³ï¼šæ¥å£å®ç°å¯¹è±¡çš„å‚æ•°é…ç½®ï¼›</p>
<p>Â·    plugin æ–¹æ³•æ˜¯æ’ä»¶ç”¨äºå°è£…ç›®æ ‡å¯¹è±¡çš„ï¼Œé€šè¿‡è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥è¿”å›ç›®æ ‡å¯¹è±¡æœ¬èº«ï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå®ƒçš„ä»£ç†ï¼Œå¯ä»¥å†³å®šæ˜¯å¦è¦è¿›è¡Œæ‹¦æˆªè¿›è€Œå†³å®šè¦è¿”å›ä¸€ä¸ªä»€ä¹ˆæ ·çš„ç›®æ ‡å¯¹è±¡ï¼Œå®˜æ–¹æä¾›äº†ç¤ºä¾‹ï¼šreturn Plugin. wrap(target, this)ï¼›</p>
<p>Â·    intercept æ–¹æ³•å°±æ˜¯è¦è¿›è¡Œæ‹¦æˆªçš„æ—¶å€™è¦æ‰§è¡Œçš„æ–¹æ³•ã€‚</p>
<p>è‡ªå®šä¹‰æ’ä»¶å®ç°ç¤ºä¾‹</p>
<p>å®˜æ–¹æ’ä»¶å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Intercepts</span>(&#123;<span class="meta">@Signature</span>(type = Executor. <span class="class"><span class="keyword">class</span>, <span class="title">method</span> </span>= <span class="string">"query"</span>,</span><br><span class="line"></span><br><span class="line">â€‹    args = &#123;MappedStatement. <span class="class"><span class="keyword">class</span>, <span class="title">Object</span>. <span class="title">class</span>, <span class="title">RowBounds</span>. <span class="title">class</span>, <span class="title">ResultHandler</span>. <span class="title">class</span>&#125;)&#125;)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">TestInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">   Object target = invocation. getTarget(); <span class="comment">//è¢«ä»£ç†å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">   Method method = invocation. getMethod(); <span class="comment">//ä»£ç†æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">   Object[] args = invocation. getArgs(); <span class="comment">//æ–¹æ³•å‚æ•°</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// do something . . . . . . æ–¹æ³•æ‹¦æˆªå‰æ‰§è¡Œä»£ç å—</span></span><br><span class="line"></span><br><span class="line">   Object result = invocation. proceed();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// do something . . . . . . . æ–¹æ³•æ‹¦æˆªåæ‰§è¡Œä»£ç å—</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> Plugin. wrap(target, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>Mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>java Hibernate çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java-Hibernate-%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-hibernateï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-hibernateï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ hibernateï¼Ÿ"></a><strong>1.</strong> <strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨</strong> <strong>hibernate</strong>ï¼Ÿ</h4><p>Â·    hibernate æ˜¯å¯¹ jdbc çš„å°è£…ï¼Œå¤§å¤§ç®€åŒ–äº†æ•°æ®è®¿é—®å±‚çš„ç¹ççš„é‡å¤æ€§ä»£ç ã€‚</p>
<p>Â·    hibernate æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ ORM å®ç°ï¼Œå¾ˆå¤šç¨‹åº¦ä¸Šç®€åŒ–äº† DAO å±‚çš„ç¼–ç åŠŸèƒ½ã€‚</p>
<p>Â·    å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œæ•°æ®åº“çš„ç§»æ¤å·¥ä½œã€‚</p>
<p>Â·    æä¾›äº†ç¼“å­˜æœºåˆ¶ï¼Œæ˜¯ç¨‹åºæ‰§è¡Œæ›´æ”¹çš„é«˜æ•ˆã€‚</p>
<h4 id="2-ä»€ä¹ˆæ˜¯-ORM-æ¡†æ¶ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯-ORM-æ¡†æ¶ï¼Ÿ" class="headerlink" title="2. ä»€ä¹ˆæ˜¯ ORM æ¡†æ¶ï¼Ÿ"></a><strong>2.</strong> <strong>ä»€ä¹ˆæ˜¯</strong> <strong>ORM</strong> <strong>æ¡†æ¶ï¼Ÿ</strong></h4><p>ORMï¼ˆObject Relation Mappingï¼‰å¯¹è±¡å…³ç³»æ˜ å°„ï¼Œæ˜¯æŠŠæ•°æ®åº“ä¸­çš„å…³ç³»æ•°æ®æ˜ å°„æˆä¸ºç¨‹åºä¸­çš„å¯¹è±¡ã€‚</p>
<p>ä½¿ç”¨ ORM çš„ä¼˜ç‚¹ï¼šæé«˜äº†å¼€å‘æ•ˆç‡é™ä½äº†å¼€å‘æˆæœ¬ã€å¼€å‘æ›´ç®€å•æ›´å¯¹è±¡åŒ–ã€å¯ç§»æ¤æ›´å¼ºã€‚</p>
<h4 id="3-hibernate-ä¸­å¦‚ä½•åœ¨æ§åˆ¶å°æŸ¥çœ‹æ‰“å°çš„-SQL-è¯­å¥ï¼Ÿ"><a href="#3-hibernate-ä¸­å¦‚ä½•åœ¨æ§åˆ¶å°æŸ¥çœ‹æ‰“å°çš„-SQL-è¯­å¥ï¼Ÿ" class="headerlink" title="3. hibernate ä¸­å¦‚ä½•åœ¨æ§åˆ¶å°æŸ¥çœ‹æ‰“å°çš„ SQL è¯­å¥ï¼Ÿ"></a><strong>3. hibernate</strong> <strong>ä¸­å¦‚ä½•åœ¨æ§åˆ¶å°æŸ¥çœ‹æ‰“å°çš„</strong> <strong>SQL</strong> <strong>è¯­å¥ï¼Ÿ</strong></h4><p>åœ¨ Config é‡Œé¢æŠŠ hibernate. show_SQL è®¾ç½®ä¸º true å°±å¯ä»¥ã€‚ä½†ä¸å»ºè®®å¼€å¯ï¼Œå¼€å¯ä¹‹åä¼šé™ä½ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p>
<h4 id="4-hibernate-æœ‰å‡ ç§æŸ¥è¯¢æ–¹å¼ï¼Ÿ"><a href="#4-hibernate-æœ‰å‡ ç§æŸ¥è¯¢æ–¹å¼ï¼Ÿ" class="headerlink" title="4. hibernate æœ‰å‡ ç§æŸ¥è¯¢æ–¹å¼ï¼Ÿ"></a><strong>4. hibernate</strong> <strong>æœ‰å‡ ç§æŸ¥è¯¢æ–¹å¼ï¼Ÿ</strong></h4><p>ä¸‰ç§ï¼šhqlã€åŸç”Ÿ SQLã€æ¡ä»¶æŸ¥è¯¢ Criteriaã€‚</p>
<h4 id="5-hibernate-å®ä½“ç±»å¯ä»¥è¢«å®šä¹‰ä¸º-final-å—ï¼Ÿ"><a href="#5-hibernate-å®ä½“ç±»å¯ä»¥è¢«å®šä¹‰ä¸º-final-å—ï¼Ÿ" class="headerlink" title="5. hibernate å®ä½“ç±»å¯ä»¥è¢«å®šä¹‰ä¸º final å—ï¼Ÿ"></a><strong>5. hibernate</strong> <strong>å®ä½“ç±»å¯ä»¥è¢«å®šä¹‰ä¸º</strong> <strong>final</strong> <strong>å—ï¼Ÿ</strong></h4><p>å®ä½“ç±»å¯ä»¥å®šä¹‰ä¸º final ç±»ï¼Œä½†è¿™æ ·çš„è¯å°±ä¸èƒ½ä½¿ç”¨ hibernate ä»£ç†æ¨¡å¼ä¸‹çš„å»¶è¿Ÿå…³è”æä¾›æ€§èƒ½äº†ï¼Œæ‰€ä»¥ä¸å»ºè®®å®šä¹‰å®ä½“ç±»ä¸º finalã€‚</p>
<h4 id="6-åœ¨-hibernate-ä¸­ä½¿ç”¨-Integer-å’Œ-int-åšæ˜ å°„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#6-åœ¨-hibernate-ä¸­ä½¿ç”¨-Integer-å’Œ-int-åšæ˜ å°„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="6. åœ¨ hibernate ä¸­ä½¿ç”¨ Integer å’Œ int åšæ˜ å°„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>6.</strong> <strong>åœ¨</strong> <strong>hibernate</strong> <strong>ä¸­ä½¿ç”¨</strong> <strong>Integer</strong> <strong>å’Œ</strong> <strong>int</strong> <strong>åšæ˜ å°„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Integer ç±»å‹ä¸ºå¯¹è±¡ï¼Œå®ƒçš„å€¼å…è®¸ä¸º nullï¼Œè€Œ int å±äºåŸºç¡€æ•°æ®ç±»å‹ï¼Œå€¼ä¸èƒ½ä¸º nullã€‚</p>
<h4 id="7-hibernate-æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"><a href="#7-hibernate-æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ" class="headerlink" title="7. hibernate æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"></a><strong>7. hibernate</strong> <strong>æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</strong></h4><p>Â·    è¯»å–å¹¶è§£æé…ç½®æ–‡ä»¶ã€‚</p>
<p>Â·    è¯»å–å¹¶è§£ææ˜ å°„æ–‡ä»¶ï¼Œåˆ›å»º SessionFactoryã€‚</p>
<p>Â·    æ‰“å¼€ Sessionã€‚</p>
<p>Â·    åˆ›å»ºäº‹åŠ¡ã€‚</p>
<p>Â·    è¿›è¡ŒæŒä¹…åŒ–æ“ä½œã€‚</p>
<p>Â·    æäº¤äº‹åŠ¡ã€‚</p>
<p>Â·    å…³é—­ Sessionã€‚</p>
<p>Â·    å…³é—­ SessionFactoryã€‚</p>
<h4 id="8-get-å’Œ-load-çš„åŒºåˆ«ï¼Ÿ"><a href="#8-get-å’Œ-load-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="8. get()**å’Œ** load()**çš„åŒºåˆ«ï¼Ÿ"></a><strong>8. get()**</strong>å’Œ** <strong>load()**</strong>çš„åŒºåˆ«ï¼Ÿ</h4><p>Â·    æ•°æ®æŸ¥è¯¢æ—¶ï¼Œæ²¡æœ‰ OID æŒ‡å®šçš„å¯¹è±¡ï¼Œget() è¿”å› nullï¼›load() è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</p>
<p>Â·    load()æ”¯æŒå»¶è¿ŸåŠ è½½ï¼›get() ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚</p>
<h4 id="9-è¯´ä¸€ä¸‹-hibernate-çš„ç¼“å­˜æœºåˆ¶ï¼Ÿ"><a href="#9-è¯´ä¸€ä¸‹-hibernate-çš„ç¼“å­˜æœºåˆ¶ï¼Ÿ" class="headerlink" title="9. è¯´ä¸€ä¸‹ hibernate çš„ç¼“å­˜æœºåˆ¶ï¼Ÿ"></a><strong>9.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>hibernate</strong> <strong>çš„ç¼“å­˜æœºåˆ¶ï¼Ÿ</strong></h4><p>hibernate å¸¸ç”¨çš„ç¼“å­˜æœ‰ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼š</p>
<p>ä¸€çº§ç¼“å­˜ï¼šä¹Ÿå« Session ç¼“å­˜ï¼Œåªåœ¨ Session ä½œç”¨èŒƒå›´å†…æœ‰æ•ˆï¼Œä¸éœ€è¦ç”¨æˆ·å¹²æ¶‰ï¼Œç”± hibernate è‡ªèº«ç»´æŠ¤ï¼Œå¯ä»¥é€šè¿‡ï¼ševict(object)æ¸…é™¤ object çš„ç¼“å­˜ï¼›clear()æ¸…é™¤ä¸€çº§ç¼“å­˜ä¸­çš„æ‰€æœ‰ç¼“å­˜ï¼›flush()åˆ·å‡ºç¼“å­˜ï¼›</p>
<p>äºŒçº§ç¼“å­˜ï¼šåº”ç”¨çº§åˆ«çš„ç¼“å­˜ï¼Œåœ¨æ‰€æœ‰ Session ä¸­éƒ½æœ‰æ•ˆï¼Œæ”¯æŒé…ç½®ç¬¬ä¸‰æ–¹çš„ç¼“å­˜ï¼Œå¦‚ï¼šEhCacheã€‚</p>
<h4 id="10-hibernate-å¯¹è±¡æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ"><a href="#10-hibernate-å¯¹è±¡æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ" class="headerlink" title="10. hibernate å¯¹è±¡æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ"></a><strong>10. hibernate</strong> <strong>å¯¹è±¡æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ</strong></h4><p>Â·    ä¸´æ—¶/ç¬æ—¶çŠ¶æ€ï¼šç›´æ¥ new å‡ºæ¥çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¿˜æ²¡è¢«æŒä¹…åŒ–ï¼ˆæ²¡ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼‰ï¼Œä¸å— Session ç®¡ç†ã€‚</p>
<p>Â·    æŒä¹…åŒ–çŠ¶æ€ï¼šå½“è°ƒç”¨ Session çš„ save/saveOrupdate/get/load/list ç­‰æ–¹æ³•çš„æ—¶å€™ï¼Œå¯¹è±¡å°±æ˜¯æŒä¹…åŒ–çŠ¶æ€ã€‚</p>
<p>Â·    æ¸¸ç¦»çŠ¶æ€ï¼šSession å…³é—­ä¹‹åå¯¹è±¡å°±æ˜¯æ¸¸ç¦»çŠ¶æ€ã€‚</p>
<h4 id="11-åœ¨-hibernate-ä¸­-getCurrentSession-å’Œ-openSession-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#11-åœ¨-hibernate-ä¸­-getCurrentSession-å’Œ-openSession-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="11. åœ¨ hibernate ä¸­ getCurrentSession å’Œ openSession çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>11.</strong> <strong>åœ¨</strong> <strong>hibernate</strong> <strong>ä¸­</strong> <strong>getCurrentSession</strong> <strong>å’Œ</strong> <strong>openSession</strong> <strong>çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Â·    getCurrentSession ä¼šç»‘å®šå½“å‰çº¿ç¨‹ï¼Œè€Œ openSession åˆ™ä¸ä¼šã€‚</p>
<p>Â·    getCurrentSession äº‹åŠ¡æ˜¯ Spring æ§åˆ¶çš„ï¼Œå¹¶ä¸”ä¸éœ€è¦æ‰‹åŠ¨å…³é—­ï¼Œè€Œ openSession éœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å¼€å¯å’Œæäº¤äº‹åŠ¡ã€‚</p>
<h4 id="12-hibernate-å®ä½“ç±»å¿…é¡»è¦æœ‰æ— å‚æ„é€ å‡½æ•°å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#12-hibernate-å®ä½“ç±»å¿…é¡»è¦æœ‰æ— å‚æ„é€ å‡½æ•°å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="12. hibernate å®ä½“ç±»å¿…é¡»è¦æœ‰æ— å‚æ„é€ å‡½æ•°å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a><strong>12. hibernate</strong> <strong>å®ä½“ç±»å¿…é¡»è¦æœ‰æ— å‚æ„é€ å‡½æ•°å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></h4><p>hibernate ä¸­æ¯ä¸ªå®ä½“ç±»å¿…é¡»æä¾›ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ï¼Œå› ä¸ºæ¡†æ¶è¦ä½¿ç”¨ï¼Œé€šè¿‡è°ƒç”¨æ¥åˆ›å»ºå®ä½“ç±»çš„å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰æ— å‚çš„æ„é€ å‡½æ•°å°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>Hibernate</tag>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>java[springBoot/springCloud]çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java-springBoot-springCloud-%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-ä»€ä¹ˆæ˜¯-spring-bootï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯-spring-bootï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯ spring bootï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯ spring bootï¼Ÿ</h4><p>spring boot æ˜¯ä¸º spring æœåŠ¡çš„ï¼Œæ˜¯ç”¨æ¥ç®€åŒ–æ–° spring åº”ç”¨çš„åˆå§‹æ­å»ºä»¥åŠå¼€å‘è¿‡ç¨‹çš„ã€‚</p>
<h4 id="2-ä¸ºä»€ä¹ˆè¦ç”¨-spring-bootï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆè¦ç”¨-spring-bootï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆè¦ç”¨ spring bootï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆè¦ç”¨ spring bootï¼Ÿ</h4><p>â€¢    é…ç½®ç®€å•<br>â€¢    ç‹¬ç«‹è¿è¡Œ<br>â€¢    è‡ªåŠ¨è£…é…<br>â€¢    æ— ä»£ç ç”Ÿæˆå’Œ xml é…ç½®<br>â€¢    æä¾›åº”ç”¨ç›‘æ§<br>â€¢    æ˜“ä¸Šæ‰‹<br>â€¢    æå‡å¼€å‘æ•ˆç‡</p>
<h4 id="3-spring-boot-é…ç½®æ–‡ä»¶æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#3-spring-boot-é…ç½®æ–‡ä»¶æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="3. spring boot é…ç½®æ–‡ä»¶æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>3. spring boot é…ç½®æ–‡ä»¶æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>é…ç½®æ–‡ä»¶æœ‰ . properties æ ¼å¼å’Œ . yml æ ¼å¼ï¼Œå®ƒä»¬ä¸»è¦çš„åŒºåˆ«æ˜¯ä¹¦æ³•é£æ ¼ä¸åŒã€‚<br>. properties é…ç½®å¦‚ä¸‹ï¼š<br>spring. RabbitMQ. port=5672<br>. yml é…ç½®å¦‚ä¸‹ï¼š<br>spring:</p>
<pre><code>RabbitMQ:
    port: 5672</code></pre><p>â€‹    . yml æ ¼å¼ä¸æ”¯æŒ @PropertySource æ³¨è§£å¯¼å…¥ã€‚</p>
<h4 id="4-spring-boot-æœ‰å“ªäº›æ–¹å¼å¯ä»¥å®ç°çƒ­éƒ¨ç½²ï¼Ÿ"><a href="#4-spring-boot-æœ‰å“ªäº›æ–¹å¼å¯ä»¥å®ç°çƒ­éƒ¨ç½²ï¼Ÿ" class="headerlink" title="4. spring boot æœ‰å“ªäº›æ–¹å¼å¯ä»¥å®ç°çƒ­éƒ¨ç½²ï¼Ÿ"></a>4. spring boot æœ‰å“ªäº›æ–¹å¼å¯ä»¥å®ç°çƒ­éƒ¨ç½²ï¼Ÿ</h4><p>â€¢    ä½¿ç”¨ devtools å¯åŠ¨çƒ­éƒ¨ç½²ï¼Œæ·»åŠ  devtools åº“ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æŠŠ spring. devtools. restart. enabled è®¾ç½®ä¸º trueï¼›</p>
<p>â€¢    å¯¼å…¥springloadedä¾èµ–</p>
<p>â€¢    ä½¿ç”¨ Intellij Idea ç¼–è¾‘å™¨ï¼Œå‹¾ä¸Šè‡ªåŠ¨ç¼–è¯‘æˆ–æ‰‹åŠ¨é‡æ–°ç¼–è¯‘ã€‚</p>
<h4 id="5-jpa-å’Œ-hibernate-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#5-jpa-å’Œ-hibernate-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="5. jpa å’Œ hibernate æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>5. jpa å’Œ hibernate æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><p>jpa å…¨ç§° Java Persistence APIï¼Œæ˜¯ Java æŒä¹…åŒ–æ¥å£è§„èŒƒï¼Œhibernate å±äº jpa çš„å…·ä½“å®ç°ã€‚</p>
<h4 id="6-ä»€ä¹ˆæ˜¯-spring-cloudï¼Ÿ"><a href="#6-ä»€ä¹ˆæ˜¯-spring-cloudï¼Ÿ" class="headerlink" title="6. ä»€ä¹ˆæ˜¯ spring cloudï¼Ÿ"></a>6. ä»€ä¹ˆæ˜¯ spring cloudï¼Ÿ</h4><p>spring cloud æ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„æœ‰åºé›†åˆã€‚å®ƒåˆ©ç”¨ spring boot çš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘ç°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æ§ç­‰ï¼Œéƒ½å¯ä»¥ç”¨ spring boot çš„å¼€å‘é£æ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚</p>
<h4 id="7-spring-cloud-æ–­è·¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#7-spring-cloud-æ–­è·¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="7. spring cloud æ–­è·¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>7. spring cloud æ–­è·¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼Œæ–­è·¯å™¨æ¨¡å¼çš„ä½œç”¨ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœï¼ˆç±»ä¼¼ç”¨ç”µå™¨å‘ç”ŸçŸ­è·¯ï¼‰ä¹‹åï¼Œé€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ï¼ˆç±»ä¼¼ç†”æ–­ä¿é™©ä¸ï¼‰ï¼Œå‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªé”™è¯¯å“åº”ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…ã€‚è¿™æ ·å°±ä¸ä¼šä½¿å¾—çº¿ç¨‹å› è°ƒç”¨æ•…éšœæœåŠ¡è¢«é•¿æ—¶é—´å ç”¨ä¸é‡Šæ”¾ï¼Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶ã€‚</p>
<h4 id="8-spring-cloud-çš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ"><a href="#8-spring-cloud-çš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="8. spring cloud çš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ"></a>8. spring cloud çš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ</h4><p>â€¢    Eurekaï¼šæœåŠ¡æ³¨å†Œäºå‘ç°ã€‚<br>â€¢    Feignï¼šåŸºäºåŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œæ ¹æ®æ³¨è§£å’Œé€‰æ‹©çš„æœºå™¨ï¼Œæ‹¼æ¥è¯·æ±‚ url åœ°å€ï¼Œå‘èµ·è¯·æ±‚ã€‚<br>â€¢    Ribbonï¼šå®ç°è´Ÿè½½å‡è¡¡ï¼Œä»ä¸€ä¸ªæœåŠ¡çš„å¤šå°æœºå™¨ä¸­é€‰æ‹©ä¸€å°ã€‚<br>â€¢    Hystrixï¼šæä¾›çº¿ç¨‹æ± ï¼Œä¸åŒçš„æœåŠ¡èµ°ä¸åŒçš„çº¿ç¨‹æ± ï¼Œå®ç°äº†ä¸åŒæœåŠ¡è°ƒç”¨çš„éš”ç¦»ï¼Œé¿å…äº†æœåŠ¡é›ªå´©çš„é—®é¢˜ã€‚<br>â€¢    Zuulï¼šç½‘å…³ç®¡ç†ï¼Œç”± Zuul ç½‘å…³è½¬å‘è¯·æ±‚ç»™å¯¹åº”çš„æœåŠ¡ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>springBoot</tag>
        <tag>springCloud</tag>
      </tags>
  </entry>
  <entry>
    <title>java[spring/springMVC]çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java-spring-springMVC-%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-springï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-springï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ springï¼Ÿ"></a><strong>1.</strong> <strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨</strong> <strong>spring</strong>ï¼Ÿ</h4><p>Â·    spring æä¾› ioc æŠ€æœ¯ï¼Œå®¹å™¨ä¼šå¸®ä½ ç®¡ç†ä¾èµ–çš„å¯¹è±¡ï¼Œä»è€Œä¸éœ€è¦è‡ªå·±åˆ›å»ºå’Œç®¡ç†ä¾èµ–å¯¹è±¡äº†ï¼Œæ›´è½»æ¾çš„å®ç°äº†ç¨‹åºçš„è§£è€¦ã€‚</p>
<p>Â·    spring æä¾›äº†äº‹åŠ¡æ”¯æŒï¼Œä½¿å¾—äº‹åŠ¡æ“ä½œå˜çš„æ›´åŠ æ–¹ä¾¿ã€‚</p>
<p>Â·    spring æä¾›äº†é¢å‘åˆ‡ç‰‡ç¼–ç¨‹ï¼Œè¿™æ ·å¯ä»¥æ›´æ–¹ä¾¿çš„å¤„ç†æŸä¸€ç±»çš„é—®é¢˜ã€‚</p>
<p>Â·    æ›´æ–¹ä¾¿çš„æ¡†æ¶é›†æˆï¼Œspring å¯ä»¥å¾ˆæ–¹ä¾¿çš„é›†æˆå…¶ä»–æ¡†æ¶ï¼Œæ¯”å¦‚ MyBatisã€hibernate ç­‰ã€‚</p>
<h4 id="2-è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯-aopï¼Ÿ"><a href="#2-è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯-aopï¼Ÿ" class="headerlink" title="2. è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ aopï¼Ÿ"></a><strong>2.</strong> <strong>è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯</strong> <em>aop</em>ï¼Ÿ</h4><p>aop æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ã€‚</p>
<p>ç®€å•æ¥è¯´å°±æ˜¯ç»Ÿä¸€å¤„ç†æŸä¸€â€œåˆ‡é¢â€ï¼ˆç±»ï¼‰çš„é—®é¢˜çš„ç¼–ç¨‹æ€æƒ³ï¼Œæ¯”å¦‚ç»Ÿä¸€å¤„ç†æ—¥å¿—ã€å¼‚å¸¸ç­‰ã€‚</p>
<h4 id="3-è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯-iocï¼Ÿ"><a href="#3-è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯-iocï¼Ÿ" class="headerlink" title="3. è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ iocï¼Ÿ"></a><strong>3.</strong> <strong>è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯</strong> <strong>ioc</strong>ï¼Ÿ</h4><p>iocï¼šInversionof Controlï¼ˆä¸­æ–‡ï¼šæ§åˆ¶åè½¬ï¼‰æ˜¯ spring çš„æ ¸å¿ƒï¼Œå¯¹äº spring æ¡†æ¶æ¥è¯´ï¼Œå°±æ˜¯ç”± spring æ¥è´Ÿè´£æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡é—´çš„å…³ç³»ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œæ§åˆ¶æŒ‡çš„æ˜¯å½“å‰å¯¹è±¡å¯¹å†…éƒ¨æˆå‘˜çš„æ§åˆ¶æƒï¼›æ§åˆ¶åè½¬æŒ‡çš„æ˜¯ï¼Œè¿™ç§æ§åˆ¶æƒä¸ç”±å½“å‰å¯¹è±¡ç®¡ç†äº†ï¼Œç”±å…¶ä»–ï¼ˆç±»,ç¬¬ä¸‰æ–¹å®¹å™¨ï¼‰æ¥ç®¡ç†ã€‚</p>
<h4 id="4-spring-æœ‰å“ªäº›ä¸»è¦æ¨¡å—ï¼Ÿ"><a href="#4-spring-æœ‰å“ªäº›ä¸»è¦æ¨¡å—ï¼Ÿ" class="headerlink" title="4. spring æœ‰å“ªäº›ä¸»è¦æ¨¡å—ï¼Ÿ"></a><strong>4. spring</strong> <strong>æœ‰å“ªäº›ä¸»è¦æ¨¡å—ï¼Ÿ</strong></h4><p>Â·    spring coreï¼šæ¡†æ¶çš„æœ€åŸºç¡€éƒ¨åˆ†ï¼Œæä¾› ioc å’Œä¾èµ–æ³¨å…¥ç‰¹æ€§ã€‚</p>
<p>Â·    spring contextï¼šæ„å»ºäº core å°è£…åŒ…åŸºç¡€ä¸Šçš„ context å°è£…åŒ…ï¼Œæä¾›äº†ä¸€ç§æ¡†æ¶å¼çš„å¯¹è±¡è®¿é—®æ–¹æ³•ã€‚</p>
<p>Â·    spring daoï¼šData Access Object æä¾›äº†JDBCçš„æŠ½è±¡å±‚ã€‚</p>
<p>Â·    spring aopï¼šæä¾›äº†é¢å‘åˆ‡é¢çš„ç¼–ç¨‹å®ç°ï¼Œè®©ä½ å¯ä»¥è‡ªå®šä¹‰æ‹¦æˆªå™¨ã€åˆ‡ç‚¹ç­‰ã€‚</p>
<p>Â·    spring Webï¼šæä¾›äº†é’ˆå¯¹ Web å¼€å‘çš„é›†æˆç‰¹æ€§ï¼Œä¾‹å¦‚æ–‡ä»¶ä¸Šä¼ ï¼Œåˆ©ç”¨ servlet listeners è¿›è¡Œ ioc å®¹å™¨åˆå§‹åŒ–å’Œé’ˆå¯¹ Web çš„ ApplicationContextã€‚</p>
<p>Â·    spring Web mvcï¼šspring ä¸­çš„ mvc å°è£…åŒ…æä¾›äº† Web åº”ç”¨çš„ Model-View-Controllerï¼ˆMVCï¼‰çš„å®ç°ã€‚</p>
<h4 id="5-spring-å¸¸ç”¨çš„æ³¨å…¥æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#5-spring-å¸¸ç”¨çš„æ³¨å…¥æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="5. spring å¸¸ç”¨çš„æ³¨å…¥æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a><strong>5. spring</strong> <strong>å¸¸ç”¨çš„æ³¨å…¥æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Â·    setter å±æ€§æ³¨å…¥</p>
<p>Â·    æ„é€ æ–¹æ³•æ³¨å…¥</p>
<p>Â·    æ³¨è§£æ–¹å¼æ³¨å…¥</p>
<h4 id="6-spring-ä¸­çš„-bean-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ"><a href="#6-spring-ä¸­çš„-bean-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ" class="headerlink" title="6. spring ä¸­çš„ bean æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ"></a><strong>6. spring</strong> <strong>ä¸­çš„</strong> <strong>bean</strong> <strong>æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</strong></h4><p>spring ä¸­çš„ bean é»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼ï¼Œspring æ¡†æ¶å¹¶æ²¡æœ‰å¯¹å•ä¾‹ bean è¿›è¡Œå¤šçº¿ç¨‹çš„å°è£…å¤„ç†ã€‚</p>
<p>å®é™…ä¸Šå¤§éƒ¨åˆ†æ—¶å€™ spring bean æ— çŠ¶æ€çš„ï¼ˆæ¯”å¦‚ dao ç±»ï¼‰ï¼Œæ‰€æœ‰æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ bean ä¹Ÿæ˜¯å®‰å…¨çš„ï¼Œä½†å¦‚æœ bean æœ‰çŠ¶æ€çš„è¯ï¼ˆæ¯”å¦‚ view model å¯¹è±¡ï¼‰ï¼Œé‚£å°±è¦å¼€å‘è€…è‡ªå·±å»ä¿è¯çº¿ç¨‹å®‰å…¨äº†ï¼Œæœ€ç®€å•çš„å°±æ˜¯æ”¹å˜ bean çš„ä½œç”¨åŸŸï¼ŒæŠŠâ€œsingletonâ€å˜æ›´ä¸ºâ€œprototypeâ€ï¼Œè¿™æ ·è¯·æ±‚ bean ç›¸å½“äº new Bean()äº†ï¼Œæ‰€ä»¥å°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚</p>
<p>Â·    æœ‰çŠ¶æ€å°±æ˜¯æœ‰æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚</p>
<p>Â·    æ— çŠ¶æ€å°±æ˜¯ä¸ä¼šä¿å­˜æ•°æ®ã€‚</p>
<h4 id="7-spring-æ”¯æŒå‡ ç§-bean-çš„ä½œç”¨åŸŸï¼Ÿ"><a href="#7-spring-æ”¯æŒå‡ ç§-bean-çš„ä½œç”¨åŸŸï¼Ÿ" class="headerlink" title="7. spring æ”¯æŒå‡ ç§ bean çš„ä½œç”¨åŸŸï¼Ÿ"></a><strong>7. spring</strong> <strong>æ”¯æŒå‡ ç§</strong> <strong>bean</strong> <strong>çš„ä½œç”¨åŸŸï¼Ÿ</strong></h4><p>spring æ”¯æŒ 5 ç§ä½œç”¨åŸŸï¼Œå¦‚ä¸‹ï¼š</p>
<p>Â·    singletonï¼šspring ioc å®¹å™¨ä¸­åªå­˜åœ¨ä¸€ä¸ª bean å®ä¾‹ï¼Œbean ä»¥å•ä¾‹æ¨¡å¼å­˜åœ¨ï¼Œæ˜¯ç³»ç»Ÿé»˜è®¤å€¼ï¼›</p>
<p>Â·    prototypeï¼šæ¯æ¬¡ä»å®¹å™¨è°ƒç”¨ bean æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¤ºä¾‹ï¼Œæ—¢æ¯æ¬¡ getBean()ç›¸å½“äºæ‰§è¡Œ new Bean()æ“ä½œï¼›</p>
<p>Â·    Web ç¯å¢ƒä¸‹çš„ä½œç”¨åŸŸï¼š</p>
<p>Â·    requestï¼šæ¯æ¬¡ http è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ª beanï¼›</p>
<p>Â·    sessionï¼šåŒä¸€ä¸ª http session å…±äº«ä¸€ä¸ª bean å®ä¾‹ï¼›</p>
<p>Â·    global-sessionï¼šç”¨äº portlet å®¹å™¨ï¼Œå› ä¸ºæ¯ä¸ª portlet æœ‰å•ç‹¬çš„ sessionï¼Œglobalsession æä¾›ä¸€ä¸ªå…¨å±€æ€§çš„ http sessionã€‚</p>
<p>æ³¨æ„ï¼š ä½¿ç”¨ prototype ä½œç”¨åŸŸéœ€è¦æ…é‡çš„æ€è€ƒï¼Œå› ä¸ºé¢‘ç¹åˆ›å»ºå’Œé”€æ¯ bean ä¼šå¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½å¼€é”€ã€‚</p>
<h4 id="8-spring-è‡ªåŠ¨è£…é…-bean-æœ‰å“ªäº›æ–¹å¼ï¼Ÿ"><a href="#8-spring-è‡ªåŠ¨è£…é…-bean-æœ‰å“ªäº›æ–¹å¼ï¼Ÿ" class="headerlink" title="8. spring è‡ªåŠ¨è£…é… bean æœ‰å“ªäº›æ–¹å¼ï¼Ÿ"></a><strong>8. spring</strong> <strong>è‡ªåŠ¨è£…é…</strong> <strong>bean</strong> <strong>æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</strong></h4><p>Â·    noï¼šé»˜è®¤å€¼ï¼Œè¡¨ç¤ºæ²¡æœ‰è‡ªåŠ¨è£…é…ï¼Œåº”ä½¿ç”¨æ˜¾å¼ bean å¼•ç”¨è¿›è¡Œè£…é…ã€‚</p>
<p>Â·    byNameï¼šå®ƒæ ¹æ® bean çš„åç§°æ³¨å…¥å¯¹è±¡ä¾èµ–é¡¹ã€‚</p>
<p>Â·    byTypeï¼šå®ƒæ ¹æ®ç±»å‹æ³¨å…¥å¯¹è±¡ä¾èµ–é¡¹ã€‚</p>
<p>Â·    æ„é€ å‡½æ•°ï¼šé€šè¿‡æ„é€ å‡½æ•°æ¥æ³¨å…¥ä¾èµ–é¡¹ï¼Œéœ€è¦è®¾ç½®å¤§é‡çš„å‚æ•°ã€‚</p>
<p>Â·    autodetectï¼šå®¹å™¨é¦–å…ˆé€šè¿‡æ„é€ å‡½æ•°ä½¿ç”¨ autowire è£…é…ï¼Œå¦‚æœä¸èƒ½ï¼Œåˆ™é€šè¿‡ byType è‡ªåŠ¨è£…é…ã€‚</p>
<h4 id="9-spring-äº‹åŠ¡å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#9-spring-äº‹åŠ¡å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="9. spring äº‹åŠ¡å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a><strong>9. spring</strong> <strong>äº‹åŠ¡å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Â·    å£°æ˜å¼äº‹åŠ¡ï¼šå£°æ˜å¼äº‹åŠ¡ä¹Ÿæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼ŒåŸºäº xml é…ç½®æ–‡ä»¶çš„æ–¹å¼å’Œæ³¨è§£æ–¹å¼ï¼ˆåœ¨ç±»ä¸Šæ·»åŠ  @Transaction æ³¨è§£ï¼‰ã€‚</p>
<p>Â·    ç¼–ç æ–¹å¼ï¼šæä¾›ç¼–ç çš„å½¢å¼ç®¡ç†å’Œç»´æŠ¤äº‹åŠ¡ã€‚</p>
<h4 id="10-è¯´ä¸€ä¸‹-spring-çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ"><a href="#10-è¯´ä¸€ä¸‹-spring-çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ" class="headerlink" title="10.è¯´ä¸€ä¸‹ spring çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ"></a>10.<strong>è¯´ä¸€ä¸‹</strong> <strong>spring</strong> <strong>çš„äº‹åŠ¡éš”ç¦»ï¼Ÿ</strong></h4><p>spring æœ‰äº”å¤§éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤å€¼ä¸º ISOLATION_DEFAULTï¼ˆä½¿ç”¨æ•°æ®åº“çš„è®¾ç½®ï¼‰ï¼Œå…¶ä»–å››ä¸ªéš”ç¦»çº§åˆ«å’Œæ•°æ®åº“çš„éš”ç¦»çº§åˆ«ä¸€è‡´ï¼š</p>
<p>ISOLATION_DEFAULTï¼šç”¨åº•å±‚æ•°æ®åº“çš„è®¾ç½®éš”ç¦»çº§åˆ«ï¼Œæ•°æ®åº“è®¾ç½®çš„æ˜¯ä»€ä¹ˆæˆ‘å°±ç”¨ä»€ä¹ˆï¼›</p>
<p>ISOLATION<em>READ</em>UNCOMMITTEDï¼šæœªæäº¤è¯»ï¼Œæœ€ä½éš”ç¦»çº§åˆ«ã€äº‹åŠ¡æœªæäº¤å‰ï¼Œå°±å¯è¢«å…¶ä»–äº‹åŠ¡è¯»å–ï¼ˆä¼šå‡ºç°å¹»è¯»ã€è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ï¼›</p>
<p>ISOLATION<em>READ</em>COMMITTEDï¼šæäº¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡è¯»å–åˆ°ï¼ˆä¼šé€ æˆå¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ï¼ŒSQL server çš„é»˜è®¤çº§åˆ«ï¼›</p>
<p>ISOLATION<em>REPEATABLE</em>READï¼šå¯é‡å¤è¯»ï¼Œä¿è¯å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œå…¶å€¼éƒ½å’Œäº‹åŠ¡å¼€å§‹æ—¶å€™çš„å†…å®¹æ˜¯ä¸€è‡´ï¼Œç¦æ­¢è¯»å–åˆ°åˆ«çš„äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼ˆä¼šé€ æˆå¹»è¯»ï¼‰ï¼ŒMySQL çš„é»˜è®¤çº§åˆ«ï¼›</p>
<p>ISOLATION_SERIALIZABLEï¼šåºåˆ—åŒ–ï¼Œä»£ä»·æœ€é«˜æœ€å¯é çš„éš”ç¦»çº§åˆ«ï¼Œè¯¥éš”ç¦»çº§åˆ«èƒ½é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚</p>
<p>è„è¯» ï¼šè¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡èƒ½å¤Ÿè¯»å–å¦ä¸€ä¸ªäº‹åŠ¡ä¸­è¿˜æœªæäº¤çš„æ•°æ®ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªäº‹åŠ¡å°è¯•æ’å…¥è®°å½• Aï¼Œæ­¤æ—¶è¯¥äº‹åŠ¡è¿˜æœªæäº¤ï¼Œç„¶åå¦ä¸€ä¸ªäº‹åŠ¡å°è¯•è¯»å–åˆ°äº†è®°å½• Aã€‚</p>
<p>ä¸å¯é‡å¤è¯» ï¼šæ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚</p>
<p>å¹»è¯» ï¼šæŒ‡åŒä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢è¿”å›çš„ç»“æœé›†ä¸ä¸€æ ·ã€‚æ¯”å¦‚åŒä¸€ä¸ªäº‹åŠ¡ A ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶å€™æœ‰ n æ¡è®°å½•ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡åŒç­‰æ¡ä»¶ä¸‹æŸ¥è¯¢å´æœ‰ n+1 æ¡è®°å½•ï¼Œè¿™å°±å¥½åƒäº§ç”Ÿäº†å¹»è§‰ã€‚å‘ç”Ÿå¹»è¯»çš„åŸå› ä¹Ÿæ˜¯å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ–°å¢æˆ–è€…åˆ é™¤æˆ–è€…ä¿®æ”¹äº†ç¬¬ä¸€ä¸ªäº‹åŠ¡ç»“æœé›†é‡Œé¢çš„æ•°æ®ï¼ŒåŒä¸€ä¸ªè®°å½•çš„æ•°æ®å†…å®¹è¢«ä¿®æ”¹äº†ï¼Œæ‰€æœ‰æ•°æ®è¡Œçš„è®°å½•å°±å˜å¤šæˆ–è€…å˜å°‘äº†ã€‚</p>
<h4 id="11-è¯´ä¸€ä¸‹-spring-mvc-è¿è¡Œæµç¨‹ï¼Ÿ"><a href="#11-è¯´ä¸€ä¸‹-spring-mvc-è¿è¡Œæµç¨‹ï¼Ÿ" class="headerlink" title="11. è¯´ä¸€ä¸‹ spring mvc è¿è¡Œæµç¨‹ï¼Ÿ"></a><strong>11.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>spring mvc</strong> <strong>è¿è¡Œæµç¨‹ï¼Ÿ</strong></h4><p>Â·    spring mvc å…ˆå°†è¯·æ±‚å‘é€ç»™ DispatcherServletã€‚</p>
<p>Â·    DispatcherServlet æŸ¥è¯¢ä¸€ä¸ªæˆ–å¤šä¸ª HandlerMappingï¼Œæ‰¾åˆ°å¤„ç†è¯·æ±‚çš„ Controllerã€‚</p>
<p>Â·    DispatcherServlet å†æŠŠè¯·æ±‚æäº¤åˆ°å¯¹åº”çš„ Controllerã€‚</p>
<p>Â·    Controller è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†åï¼Œä¼šè¿”å›ä¸€ä¸ªModelAndViewã€‚</p>
<p>Â·    Dispathcher æŸ¥è¯¢ä¸€ä¸ªæˆ–å¤šä¸ª ViewResolver è§†å›¾è§£æå™¨ï¼Œæ‰¾åˆ° ModelAndView å¯¹è±¡æŒ‡å®šçš„è§†å›¾å¯¹è±¡ã€‚</p>
<p>Â·    è§†å›¾å¯¹è±¡è´Ÿè´£æ¸²æŸ“è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<h4 id="12-spring-mvc-æœ‰å“ªäº›ç»„ä»¶ï¼Ÿ"><a href="#12-spring-mvc-æœ‰å“ªäº›ç»„ä»¶ï¼Ÿ" class="headerlink" title="12. spring mvc æœ‰å“ªäº›ç»„ä»¶ï¼Ÿ"></a><strong>12. spring mvc</strong> <strong>æœ‰å“ªäº›ç»„ä»¶ï¼Ÿ</strong></h4><p>Â·    å‰ç½®æ§åˆ¶å™¨ DispatcherServletã€‚</p>
<p>Â·    æ˜ å°„æ§åˆ¶å™¨ HandlerMappingã€‚</p>
<p>Â·    å¤„ç†å™¨ Controllerã€‚</p>
<p>Â·    æ¨¡å‹å’Œè§†å›¾ ModelAndViewã€‚</p>
<p>Â·    è§†å›¾è§£æå™¨ ViewResolverã€‚</p>
<h4 id="13-RequestMapping-çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#13-RequestMapping-çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="13. @RequestMapping çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>13. @RequestMapping</strong> <strong>çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>å°† http è¯·æ±‚æ˜ å°„åˆ°ç›¸åº”çš„ç±»/æ–¹æ³•ä¸Šã€‚</p>
<h5 id="14-Autowired-çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#14-Autowired-çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="14. @Autowired çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>14. @Autowired</strong> <strong>çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h5><p>@Autowired å®ƒå¯ä»¥å¯¹ç±»æˆå‘˜å˜é‡ã€æ–¹æ³•åŠæ„é€ å‡½æ•°è¿›è¡Œæ ‡æ³¨ï¼Œå®Œæˆè‡ªåŠ¨è£…é…çš„å·¥ä½œï¼Œé€šè¿‡@Autowired çš„ä½¿ç”¨æ¥æ¶ˆé™¤ set/get æ–¹æ³•ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>spring</tag>
        <tag>springmMVC</tag>
      </tags>
  </entry>
  <entry>
    <title>javaç½‘ç»œçŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-http-å“åº”ç -301-å’Œ-302-ä»£è¡¨çš„æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#1-http-å“åº”ç -301-å’Œ-302-ä»£è¡¨çš„æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="1. http å“åº”ç  301 å’Œ 302 ä»£è¡¨çš„æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>1. http</strong> <strong>å“åº”ç </strong> <strong>301</strong> <strong>å’Œ</strong> <strong>302</strong> <strong>ä»£è¡¨çš„æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>301ï¼šæ°¸ä¹…é‡å®šå‘ã€‚</p>
<p>302ï¼šæš‚æ—¶é‡å®šå‘ã€‚</p>
<p>å®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼Œ301 å¯¹æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰æ›´åŠ æœ‰åˆ©ï¼›302 æœ‰è¢«æç¤ºä¸ºç½‘ç»œæ‹¦æˆªçš„é£é™©ã€‚</p>
<h4 id="2-forward-å’Œ-redirect-çš„åŒºåˆ«ï¼Ÿ"><a href="#2-forward-å’Œ-redirect-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2. forward å’Œ redirect çš„åŒºåˆ«ï¼Ÿ"></a><strong>2. forward</strong> <strong>å’Œ</strong> <strong>redirect</strong> <strong>çš„åŒºåˆ«ï¼Ÿ</strong></h4><p>forward æ˜¯è½¬å‘ å’Œ redirect æ˜¯é‡å®šå‘ï¼š</p>
<p>Â·    åœ°å€æ  url æ˜¾ç¤ºï¼šfoward url ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œredirect url ä¼šå‘ç”Ÿæ”¹å˜ï¼›</p>
<p>Â·    æ•°æ®å…±äº«ï¼šforward å¯ä»¥å…±äº« request é‡Œçš„æ•°æ®ï¼Œredirect ä¸èƒ½å…±äº«ï¼›</p>
<p>Â·    æ•ˆç‡ï¼šforward æ¯” redirect æ•ˆç‡é«˜ã€‚</p>
<h4 id="3-ç®€è¿°-tcp-å’Œ-udpçš„åŒºåˆ«ï¼Ÿ"><a href="#3-ç®€è¿°-tcp-å’Œ-udpçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3. ç®€è¿° tcp å’Œ udpçš„åŒºåˆ«ï¼Ÿ"></a><strong>3.</strong> <strong>ç®€è¿°</strong> <strong>tcp</strong> <strong>å’Œ</strong> <strong>udp</strong>çš„åŒºåˆ«ï¼Ÿ</h4><p>tcp å’Œ udp æ˜¯ OSI æ¨¡å‹ä¸­çš„è¿è¾“å±‚ä¸­çš„åè®®ã€‚tcp æä¾›å¯é çš„é€šä¿¡ä¼ è¾“ï¼Œè€Œ udp åˆ™å¸¸è¢«ç”¨äºè®©å¹¿æ’­å’Œç»†èŠ‚æ§åˆ¶äº¤ç»™åº”ç”¨çš„é€šä¿¡ä¼ è¾“ã€‚</p>
<p>ä¸¤è€…çš„åŒºåˆ«å¤§è‡´å¦‚ä¸‹ï¼š</p>
<p>Â·    tcp é¢å‘è¿æ¥ï¼Œudp é¢å‘éè¿æ¥å³å‘é€æ•°æ®å‰ä¸éœ€è¦å»ºç«‹é“¾æ¥ï¼›</p>
<p>Â·    tcp æä¾›å¯é çš„æœåŠ¡ï¼ˆæ•°æ®ä¼ è¾“ï¼‰ï¼Œudp æ— æ³•ä¿è¯ï¼›</p>
<p>Â·    tcp é¢å‘å­—èŠ‚æµï¼Œudp é¢å‘æŠ¥æ–‡ï¼›</p>
<p>Â·    tcp æ•°æ®ä¼ è¾“æ…¢ï¼Œudp æ•°æ®ä¼ è¾“å¿«ï¼›</p>
<h4 id="4-tcp-ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#4-tcp-ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="4. tcp ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a><strong>4. tcp</strong> <strong>ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></h4><p>å¦‚æœé‡‡ç”¨ä¸¤æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆåªè¦æœåŠ¡å™¨å‘å‡ºç¡®è®¤æ•°æ®åŒ…å°±ä¼šå»ºç«‹è¿æ¥ï¼Œä½†ç”±äºå®¢æˆ·ç«¯æ­¤æ—¶å¹¶æœªå“åº”æœåŠ¡å™¨ç«¯çš„è¯·æ±‚ï¼Œé‚£æ­¤æ—¶æœåŠ¡å™¨ç«¯å°±ä¼šä¸€ç›´åœ¨ç­‰å¾…å®¢æˆ·ç«¯ï¼Œè¿™æ ·æœåŠ¡å™¨ç«¯å°±ç™½ç™½æµªè´¹äº†ä¸€å®šçš„èµ„æºã€‚è‹¥é‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡å™¨ç«¯æ²¡æœ‰æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„å†æ­¤ç¡®è®¤ï¼Œåˆ™å°±ä¼šçŸ¥é“å®¢æˆ·ç«¯å¹¶æ²¡æœ‰è¦æ±‚å»ºç«‹è¯·æ±‚ï¼Œå°±ä¸ä¼šæµªè´¹æœåŠ¡å™¨çš„èµ„æºã€‚</p>
<h4 id="5-è¯´ä¸€ä¸‹-tcp-ç²˜åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ"><a href="#5-è¯´ä¸€ä¸‹-tcp-ç²˜åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ" class="headerlink" title="5. è¯´ä¸€ä¸‹ tcp ç²˜åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ"></a><strong>5.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>tcp</strong> <strong>ç²˜åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ</strong></h4><p>tcp ç²˜åŒ…å¯èƒ½å‘ç”Ÿåœ¨å‘é€ç«¯æˆ–è€…æ¥æ”¶ç«¯ï¼Œåˆ†åˆ«æ¥çœ‹ä¸¤ç«¯å„ç§äº§ç”Ÿç²˜åŒ…çš„åŸå› ï¼š</p>
<p>Â·    å‘é€ç«¯ç²˜åŒ…ï¼šå‘é€ç«¯éœ€è¦ç­‰ç¼“å†²åŒºæ»¡æ‰å‘é€å‡ºå»ï¼Œé€ æˆç²˜åŒ…ï¼›</p>
<p>Â·    æ¥æ”¶æ–¹ç²˜åŒ…ï¼šæ¥æ”¶æ–¹ä¸åŠæ—¶æ¥æ”¶ç¼“å†²åŒºçš„åŒ…ï¼Œé€ æˆå¤šä¸ªåŒ…æ¥æ”¶ã€‚</p>
<h4 id="6-OSI-çš„ä¸ƒå±‚æ¨¡å‹éƒ½æœ‰å“ªäº›ï¼Ÿ"><a href="#6-OSI-çš„ä¸ƒå±‚æ¨¡å‹éƒ½æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="6. OSI çš„ä¸ƒå±‚æ¨¡å‹éƒ½æœ‰å“ªäº›ï¼Ÿ"></a><strong>6. OSI</strong> <strong>çš„ä¸ƒå±‚æ¨¡å‹éƒ½æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Â·    ç‰©ç†å±‚ï¼šåˆ©ç”¨ä¼ è¾“ä»‹è´¨ä¸ºæ•°æ®é“¾è·¯å±‚æä¾›ç‰©ç†è¿æ¥ï¼Œå®ç°æ¯”ç‰¹æµçš„é€æ˜ä¼ è¾“ã€‚</p>
<p>Â·    æ•°æ®é“¾è·¯å±‚ï¼šè´Ÿè´£å»ºç«‹å’Œç®¡ç†èŠ‚ç‚¹é—´çš„é“¾è·¯ã€‚</p>
<p>Â·    ç½‘ç»œå±‚ï¼šé€šè¿‡è·¯ç”±é€‰æ‹©ç®—æ³•ï¼Œä¸ºæŠ¥æ–‡æˆ–åˆ†ç»„é€šè¿‡é€šä¿¡å­ç½‘é€‰æ‹©æœ€é€‚å½“çš„è·¯å¾„ã€‚</p>
<p>Â·    ä¼ è¾“å±‚ï¼šå‘ç”¨æˆ·æä¾›å¯é çš„ç«¯åˆ°ç«¯çš„å·®é”™å’Œæµé‡æ§åˆ¶ï¼Œä¿è¯æŠ¥æ–‡çš„æ­£ç¡®ä¼ è¾“ã€‚</p>
<p>Â·    ä¼šè¯å±‚ï¼šå‘ä¸¤ä¸ªå®ä½“çš„è¡¨ç¤ºå±‚æä¾›å»ºç«‹å’Œä½¿ç”¨è¿æ¥çš„æ–¹æ³•ã€‚</p>
<p>Â·    è¡¨ç¤ºå±‚ï¼šå¤„ç†ç”¨æˆ·ä¿¡æ¯çš„è¡¨ç¤ºé—®é¢˜ï¼Œå¦‚ç¼–ç ã€æ•°æ®æ ¼å¼è½¬æ¢å’ŒåŠ å¯†è§£å¯†ç­‰ã€‚</p>
<p>Â·    åº”ç”¨å±‚ï¼šç›´æ¥å‘ç”¨æˆ·æä¾›æœåŠ¡ï¼Œå®Œæˆç”¨æˆ·å¸Œæœ›åœ¨ç½‘ç»œä¸Šå®Œæˆçš„å„ç§å·¥ä½œã€‚</p>
<h4 id="7-get-å’Œ-post-è¯·æ±‚æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"><a href="#7-get-å’Œ-post-è¯·æ±‚æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ" class="headerlink" title="7. get å’Œ post è¯·æ±‚æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"></a><strong>7. get</strong> <strong>å’Œ</strong> <strong>post</strong> <strong>è¯·æ±‚æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    get è¯·æ±‚ä¼šè¢«æµè§ˆå™¨ä¸»åŠ¨ç¼“å­˜ï¼Œè€Œ post ä¸ä¼šã€‚</p>
<p>Â·    get ä¼ é€’å‚æ•°æœ‰å¤§å°é™åˆ¶ï¼Œè€Œ post æ²¡æœ‰ã€‚</p>
<p>Â·    post å‚æ•°ä¼ è¾“æ›´å®‰å…¨ï¼Œget çš„å‚æ•°ä¼šæ˜æ–‡é™åˆ¶åœ¨ url ä¸Šï¼Œpost ä¸ä¼šã€‚</p>
<h4 id="8-å¦‚ä½•å®ç°è·¨åŸŸï¼Ÿ"><a href="#8-å¦‚ä½•å®ç°è·¨åŸŸï¼Ÿ" class="headerlink" title="8. å¦‚ä½•å®ç°è·¨åŸŸï¼Ÿ"></a><strong>8.</strong> <strong>å¦‚ä½•å®ç°è·¨åŸŸï¼Ÿ</strong></h4><p>å®ç°è·¨åŸŸæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š</p>
<p>Â·    æœåŠ¡å™¨ç«¯è¿è¡Œè·¨åŸŸ è®¾ç½® CORS ç­‰äº *ï¼›</p>
<p>Â·    åœ¨å•ä¸ªæ¥å£ä½¿ç”¨æ³¨è§£ @CrossOrigin è¿è¡Œè·¨åŸŸï¼›</p>
<p>Â·    ä½¿ç”¨ jsonp è·¨åŸŸï¼›</p>
<h4 id="9-è¯´ä¸€ä¸‹-JSONP-å®ç°åŸç†ï¼Ÿ"><a href="#9-è¯´ä¸€ä¸‹-JSONP-å®ç°åŸç†ï¼Ÿ" class="headerlink" title="9. è¯´ä¸€ä¸‹ JSONP å®ç°åŸç†ï¼Ÿ"></a><strong>9.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>JSONP</strong> <strong>å®ç°åŸç†ï¼Ÿ</strong></h4><p>jsonpï¼šJSON with Paddingï¼Œå®ƒæ˜¯åˆ©ç”¨scriptæ ‡ç­¾çš„ src è¿æ¥å¯ä»¥è®¿é—®ä¸åŒæºçš„ç‰¹æ€§ï¼ŒåŠ è½½è¿œç¨‹è¿”å›çš„â€œJS å‡½æ•°â€æ¥æ‰§è¡Œçš„ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>ç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>javaå¤šçº¿ç¨‹çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/19/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#1-å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="1. å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>1. <strong>å¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨æˆ–å¤šæ ¸å¤„ç†å™¨åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚</p>
<p>Â·    å¹¶å‘ï¼šå¤šä¸ªä»»åŠ¡åœ¨åŒä¸€ä¸ª CPU æ ¸ä¸Šï¼ŒæŒ‰ç»†åˆ†çš„æ—¶é—´ç‰‡è½®æµ(äº¤æ›¿)æ‰§è¡Œï¼Œä»é€»è¾‘ä¸Šæ¥çœ‹é‚£äº›ä»»åŠ¡æ˜¯åŒæ—¶æ‰§è¡Œã€‚</p>
<p>å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2020/07/19/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/clip_image001.png"  alt="å¹¶å‘å’Œå¹¶è¡Œ"></p>
<p>å¹¶å‘ = ä¸¤ä¸ªé˜Ÿåˆ—å’Œä¸€å°å’–å•¡æœºã€‚</p>
<p>å¹¶è¡Œ = ä¸¤ä¸ªé˜Ÿåˆ—å’Œä¸¤å°å’–å•¡æœºã€‚</p>
<h4 id="2-çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ"><a href="#2-çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2. çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ"></a><strong>2.</strong> <strong>çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ</strong></h4><p>ä¸€ä¸ªç¨‹åºä¸‹è‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸‹ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹æ¥å¢åŠ ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€‚</p>
<h4 id="3-å®ˆæŠ¤çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3-å®ˆæŠ¤çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3. å®ˆæŠ¤çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>3.</strong> <strong>å®ˆæŠ¤çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>å®ˆæŠ¤çº¿ç¨‹æ˜¯è¿è¡Œåœ¨åå°çš„ä¸€ç§ç‰¹æ®Šè¿›ç¨‹ã€‚å®ƒç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯å¹¶ä¸”å‘¨æœŸæ€§åœ°æ‰§è¡ŒæŸç§ä»»åŠ¡æˆ–ç­‰å¾…å¤„ç†æŸäº›å‘ç”Ÿçš„äº‹ä»¶ã€‚åœ¨ Java ä¸­åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ç‰¹æ®Šçš„å®ˆæŠ¤çº¿ç¨‹ã€‚</p>
<h4 id="4-åˆ›å»ºçº¿ç¨‹æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"><a href="#4-åˆ›å»ºçº¿ç¨‹æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="4. åˆ›å»ºçº¿ç¨‹æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"></a><strong>4.</strong> <strong>åˆ›å»ºçº¿ç¨‹æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</strong></h4><p>åˆ›å»ºçº¿ç¨‹æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>
<p>Â·    ç»§æ‰¿ Thread é‡å†™ run æ–¹æ³•ï¼›</p>
<p>Â·    å®ç° Runnable æ¥å£ï¼›</p>
<p>Â·    å®ç° Callable æ¥å£ã€‚</p>
<h4 id="5-è¯´ä¸€ä¸‹-runnable-å’Œ-callable-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#5-è¯´ä¸€ä¸‹-runnable-å’Œ-callable-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="5. è¯´ä¸€ä¸‹ runnable å’Œ callable æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>5.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>runnable</strong> <strong>å’Œ</strong> <strong>callable</strong> <strong>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>runnable æ²¡æœ‰è¿”å›å€¼ï¼Œcallable å¯ä»¥æ‹¿åˆ°æœ‰è¿”å›å€¼ï¼Œcallable å¯ä»¥çœ‹ä½œæ˜¯ runnable çš„è¡¥å……ã€‚</p>
<h4 id="6-çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ"><a href="#6-çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ" class="headerlink" title="6. çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ"></a><strong>6.</strong> <strong>çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ</strong></h4><p>çº¿ç¨‹çš„çŠ¶æ€ï¼š</p>
<p>Â·    NEW å°šæœªå¯åŠ¨</p>
<p>Â·    RUNNABLE æ­£åœ¨æ‰§è¡Œä¸­</p>
<p>Â·    BLOCKED é˜»å¡çš„ï¼ˆè¢«åŒæ­¥é”æˆ–è€…IOé”é˜»å¡ï¼‰</p>
<p>Â·    WAITING æ°¸ä¹…ç­‰å¾…çŠ¶æ€</p>
<p>Â·    TIMED_WAITING ç­‰å¾…æŒ‡å®šçš„æ—¶é—´é‡æ–°è¢«å”¤é†’çš„çŠ¶æ€</p>
<p>Â·    TERMINATED æ‰§è¡Œå®Œæˆ</p>
<h4 id="7-sleep-å’Œ-wait-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#7-sleep-å’Œ-wait-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="7. sleep() å’Œ wait() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>7. sleep()</strong> <strong>å’Œ</strong> <strong>wait()</strong> <strong>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    ç±»çš„ä¸åŒï¼šsleep() æ¥è‡ª Threadï¼Œwait() æ¥è‡ª Objectã€‚</p>
<p>Â·    é‡Šæ”¾é”ï¼šsleep() ä¸é‡Šæ”¾é”ï¼›wait() é‡Šæ”¾é”ã€‚</p>
<p>Â·    ç”¨æ³•ä¸åŒï¼šsleep() æ—¶é—´åˆ°ä¼šè‡ªåŠ¨æ¢å¤ï¼›wait() å¯ä»¥ä½¿ç”¨ notify()/notifyAll()ç›´æ¥å”¤é†’ã€‚</p>
<h4 id="8-notify-å’Œ-notifyAll-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#8-notify-å’Œ-notifyAll-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="8. notify()**å’Œ** notifyAll()**æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**"></a><strong>8. notify()**</strong>å’Œ** <strong>notifyAll()**</strong>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**</h4><p>notifyAll()ä¼šå”¤é†’æ‰€æœ‰çš„çº¿ç¨‹ï¼Œnotify()ä¹‹åå”¤é†’ä¸€ä¸ªçº¿ç¨‹ã€‚notifyAll() è°ƒç”¨åï¼Œä¼šå°†å…¨éƒ¨çº¿ç¨‹ç”±ç­‰å¾…æ± ç§»åˆ°é”æ± ï¼Œç„¶åå‚ä¸é”çš„ç«äº‰ï¼Œç«äº‰æˆåŠŸåˆ™ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœä¸æˆåŠŸåˆ™ç•™åœ¨é”æ± ç­‰å¾…é”è¢«é‡Šæ”¾åå†æ¬¡å‚ä¸ç«äº‰ã€‚è€Œ notify()åªä¼šå”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œå…·ä½“å”¤é†’å“ªä¸€ä¸ªçº¿ç¨‹ç”±è™šæ‹Ÿæœºæ§åˆ¶ã€‚</p>
<h4 id="9-çº¿ç¨‹çš„-run-å’Œ-start-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#9-çº¿ç¨‹çš„-run-å’Œ-start-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="9. çº¿ç¨‹çš„ run() å’Œ start() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>9.</strong> <strong>çº¿ç¨‹çš„</strong> <strong>run()</strong> <strong>å’Œ</strong> <strong>start()</strong> <strong>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>start() æ–¹æ³•ç”¨äºå¯åŠ¨çº¿ç¨‹ï¼Œrun() æ–¹æ³•ç”¨äºæ‰§è¡Œçº¿ç¨‹çš„è¿è¡Œæ—¶ä»£ç ã€‚run() å¯ä»¥é‡å¤è°ƒç”¨ï¼Œè€Œ start() åªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚</p>
<h4 id="10-åˆ›å»ºçº¿ç¨‹æ± æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"><a href="#10-åˆ›å»ºçº¿ç¨‹æ± æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="10. åˆ›å»ºçº¿ç¨‹æ± æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"></a><strong>10.</strong> <strong>åˆ›å»ºçº¿ç¨‹æ± æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</strong></h4><p>çº¿ç¨‹æ± åˆ›å»ºæœ‰ä¸ƒç§æ–¹å¼ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯æœ€åä¸€ç§ï¼š</p>
<p>Â·   newSingleThreadExecutor()ï¼šå®ƒçš„ç‰¹ç‚¹åœ¨äºå·¥ä½œçº¿ç¨‹æ•°ç›®è¢«é™åˆ¶ä¸º 1ï¼Œæ“ä½œä¸€ä¸ªæ— ç•Œçš„å·¥ä½œé˜Ÿåˆ—ï¼Œæ‰€ä»¥å®ƒä¿è¯äº†æ‰€æœ‰ä»»åŠ¡çš„éƒ½æ˜¯è¢«é¡ºåºæ‰§è¡Œï¼Œæœ€å¤šä¼šæœ‰ä¸€ä¸ªä»»åŠ¡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”ä¸å…è®¸ä½¿ç”¨è€…æ”¹åŠ¨çº¿ç¨‹æ± å®ä¾‹ï¼Œå› æ­¤å¯ä»¥é¿å…å…¶æ”¹å˜çº¿ç¨‹æ•°ç›®ï¼›</p>
<p>Â·   newCachedThreadPool()ï¼šå®ƒæ˜¯ä¸€ç§ç”¨æ¥å¤„ç†å¤§é‡çŸ­æ—¶é—´å·¥ä½œä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œå…·æœ‰å‡ ä¸ªé²œæ˜ç‰¹ç‚¹ï¼šå®ƒä¼šè¯•å›¾ç¼“å­˜çº¿ç¨‹å¹¶é‡ç”¨ï¼Œå½“æ— ç¼“å­˜çº¿ç¨‹å¯ç”¨æ—¶ï¼Œå°±ä¼šåˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼›å¦‚æœçº¿ç¨‹é—²ç½®çš„æ—¶é—´è¶…è¿‡ 60 ç§’ï¼Œåˆ™è¢«ç»ˆæ­¢å¹¶ç§»å‡ºç¼“å­˜ï¼›é•¿æ—¶é—´é—²ç½®æ—¶ï¼Œè¿™ç§çº¿ç¨‹æ± ï¼Œä¸ä¼šæ¶ˆè€—ä»€ä¹ˆèµ„æºã€‚å…¶å†…éƒ¨ä½¿ç”¨ SynchronousQueue ä½œä¸ºå·¥ä½œé˜Ÿåˆ—ï¼›</p>
<p>Â·   newFixedThreadPool(int nThreads)ï¼šé‡ç”¨æŒ‡å®šæ•°ç›®ï¼ˆnThreadsï¼‰çš„çº¿ç¨‹ï¼Œå…¶èƒŒåä½¿ç”¨çš„æ˜¯æ— ç•Œçš„å·¥ä½œé˜Ÿåˆ—ï¼Œä»»ä½•æ—¶å€™æœ€å¤šæœ‰ nThreads ä¸ªå·¥ä½œçº¿ç¨‹æ˜¯æ´»åŠ¨çš„ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä»»åŠ¡æ•°é‡è¶…è¿‡äº†æ´»åŠ¨é˜Ÿåˆ—æ•°ç›®ï¼Œå°†åœ¨å·¥ä½œé˜Ÿåˆ—ä¸­ç­‰å¾…ç©ºé—²çº¿ç¨‹å‡ºç°ï¼›å¦‚æœæœ‰å·¥ä½œçº¿ç¨‹é€€å‡ºï¼Œå°†ä¼šæœ‰æ–°çš„å·¥ä½œçº¿ç¨‹è¢«åˆ›å»ºï¼Œä»¥è¡¥è¶³æŒ‡å®šçš„æ•°ç›® nThreadsï¼›</p>
<p>Â·   newSingleThreadScheduledExecutor()ï¼šåˆ›å»ºå•çº¿ç¨‹æ± ï¼Œè¿”å› ScheduledExecutorServiceï¼Œå¯ä»¥è¿›è¡Œå®šæ—¶æˆ–å‘¨æœŸæ€§çš„å·¥ä½œè°ƒåº¦ï¼›</p>
<p>Â·   newScheduledThreadPool(int corePoolSize)ï¼šå’ŒnewSingleThreadScheduledExecutor()ç±»ä¼¼ï¼Œåˆ›å»ºçš„æ˜¯ä¸ª ScheduledExecutorServiceï¼Œå¯ä»¥è¿›è¡Œå®šæ—¶æˆ–å‘¨æœŸæ€§çš„å·¥ä½œè°ƒåº¦ï¼ŒåŒºåˆ«åœ¨äºå•ä¸€å·¥ä½œçº¿ç¨‹è¿˜æ˜¯å¤šä¸ªå·¥ä½œçº¿ç¨‹ï¼›</p>
<p>Â·   newWorkStealingPool(int parallelism)ï¼šè¿™æ˜¯ä¸€ä¸ªç»å¸¸è¢«äººå¿½ç•¥çš„çº¿ç¨‹æ± ï¼ŒJava 8 æ‰åŠ å…¥è¿™ä¸ªåˆ›å»ºæ–¹æ³•ï¼Œå…¶å†…éƒ¨ä¼šæ„å»ºForkJoinPoolï¼Œåˆ©ç”¨Work-Stealingç®—æ³•ï¼Œå¹¶è¡Œåœ°å¤„ç†ä»»åŠ¡ï¼Œä¸ä¿è¯å¤„ç†é¡ºåºï¼›</p>
<p>Â·   ThreadPoolExecutor()ï¼šæ˜¯æœ€åŸå§‹çš„çº¿ç¨‹æ± åˆ›å»ºï¼Œä¸Šé¢1-3åˆ›å»ºæ–¹å¼éƒ½æ˜¯å¯¹ThreadPoolExecutorçš„å°è£…ã€‚</p>
<h4 id="11-çº¿ç¨‹æ± éƒ½æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ"><a href="#11-çº¿ç¨‹æ± éƒ½æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ" class="headerlink" title="11. çº¿ç¨‹æ± éƒ½æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ"></a><strong>11.</strong> <strong>çº¿ç¨‹æ± éƒ½æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ</strong></h4><p>Â·    RUNNINGï¼šè¿™æ˜¯æœ€æ­£å¸¸çš„çŠ¶æ€ï¼Œæ¥å—æ–°çš„ä»»åŠ¡ï¼Œå¤„ç†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</p>
<p>Â·    SHUTDOWNï¼šä¸æ¥å—æ–°çš„ä»»åŠ¡æäº¤ï¼Œä½†æ˜¯ä¼šç»§ç»­å¤„ç†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</p>
<p>Â·    STOPï¼šä¸æ¥å—æ–°çš„ä»»åŠ¡æäº¤ï¼Œä¸å†å¤„ç†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¸­æ–­æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ã€‚</p>
<p>Â·    TIDYINGï¼šæ‰€æœ‰çš„ä»»åŠ¡éƒ½é”€æ¯äº†ï¼ŒworkCount ä¸º 0ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€åœ¨è½¬æ¢ä¸º TIDYING çŠ¶æ€æ—¶ï¼Œä¼šæ‰§è¡Œé’©å­æ–¹æ³• terminated()ã€‚</p>
<p>Â·    TERMINATEDï¼šterminated()æ–¹æ³•ç»“æŸåï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€å°±ä¼šå˜æˆè¿™ä¸ªã€‚</p>
<h4 id="12-çº¿ç¨‹æ± ä¸­-submit-å’Œ-execute-æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#12-çº¿ç¨‹æ± ä¸­-submit-å’Œ-execute-æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="12. çº¿ç¨‹æ± ä¸­ submit() å’Œ execute() æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>12.</strong> <strong>çº¿ç¨‹æ± ä¸­</strong> <strong>submit()</strong> <strong>å’Œ</strong> <strong>execute()</strong> <strong>æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    execute()ï¼šåªèƒ½æ‰§è¡Œ Runnable ç±»å‹çš„ä»»åŠ¡ã€‚</p>
<p>Â·    submit()ï¼šå¯ä»¥æ‰§è¡Œ Runnable å’Œ Callable ç±»å‹çš„ä»»åŠ¡ã€‚</p>
<p>Callable ç±»å‹çš„ä»»åŠ¡å¯ä»¥è·å–æ‰§è¡Œçš„è¿”å›å€¼ï¼Œè€Œ Runnable æ‰§è¡Œæ— è¿”å›å€¼ã€‚</p>
<h4 id="13-åœ¨-Java-ç¨‹åºä¸­æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹çš„è¿è¡Œå®‰å…¨ï¼Ÿ"><a href="#13-åœ¨-Java-ç¨‹åºä¸­æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹çš„è¿è¡Œå®‰å…¨ï¼Ÿ" class="headerlink" title="13. åœ¨ Java ç¨‹åºä¸­æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹çš„è¿è¡Œå®‰å…¨ï¼Ÿ"></a><strong>13.</strong> <strong>åœ¨</strong> <strong>Java</strong> <strong>ç¨‹åºä¸­æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹çš„è¿è¡Œå®‰å…¨ï¼Ÿ</strong></h4><p>Â·    æ–¹æ³•ä¸€ï¼šä½¿ç”¨å®‰å…¨ç±»ï¼Œæ¯”å¦‚ Java. util. concurrent ä¸‹çš„ç±»ã€‚</p>
<p>Â·    æ–¹æ³•äºŒï¼šä½¿ç”¨è‡ªåŠ¨é” synchronizedã€‚</p>
<p>Â·    æ–¹æ³•ä¸‰ï¼šä½¿ç”¨æ‰‹åŠ¨é” Lockã€‚</p>
<p>æ‰‹åŠ¨é” Java ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<p>Lock lock = new ReentrantLock();</p>
<p>lock. lock();</p>
<p>try {</p>
<p>  System. out. println(â€œè·å¾—é”â€);</p>
<p>} catch (Exception e) {</p>
<p>  // TODO: handle exception</p>
<p>} finally {</p>
<p>  System. out. println(â€œé‡Šæ”¾é”â€);</p>
<p>  lock. unlock();</p>
<p>}</p>
<h4 id="14-å¤šçº¿ç¨‹ä¸­-synchronized-é”å‡çº§çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#14-å¤šçº¿ç¨‹ä¸­-synchronized-é”å‡çº§çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="14. å¤šçº¿ç¨‹ä¸­ synchronized é”å‡çº§çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>14.</strong> <strong>å¤šçº¿ç¨‹ä¸­</strong> <strong>synchronized</strong> <strong>é”å‡çº§çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>synchronized é”å‡çº§åŸç†ï¼šåœ¨é”å¯¹è±¡çš„å¯¹è±¡å¤´é‡Œé¢æœ‰ä¸€ä¸ª threadid å­—æ®µï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ threadid ä¸ºç©ºï¼Œjvm è®©å…¶æŒæœ‰åå‘é”ï¼Œå¹¶å°† threadid è®¾ç½®ä¸ºå…¶çº¿ç¨‹ idï¼Œå†æ¬¡è¿›å…¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­ threadid æ˜¯å¦ä¸å…¶çº¿ç¨‹ id ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨æ­¤å¯¹è±¡ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™å‡çº§åå‘é”ä¸ºè½»é‡çº§é”ï¼Œé€šè¿‡è‡ªæ—‹å¾ªç¯ä¸€å®šæ¬¡æ•°æ¥è·å–é”ï¼Œæ‰§è¡Œä¸€å®šæ¬¡æ•°ä¹‹åï¼Œå¦‚æœè¿˜æ²¡æœ‰æ­£å¸¸è·å–åˆ°è¦ä½¿ç”¨çš„å¯¹è±¡ï¼Œæ­¤æ—¶å°±ä¼šæŠŠé”ä»è½»é‡çº§å‡çº§ä¸ºé‡é‡çº§é”ï¼Œæ­¤è¿‡ç¨‹å°±æ„æˆäº† synchronized é”çš„å‡çº§ã€‚</p>
<p>é”çš„å‡çº§çš„ç›®çš„ï¼šé”å‡çº§æ˜¯ä¸ºäº†å‡ä½äº†é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚åœ¨ Java 6 ä¹‹åä¼˜åŒ– synchronized çš„å®ç°æ–¹å¼ï¼Œä½¿ç”¨äº†åå‘é”å‡çº§ä¸ºè½»é‡çº§é”å†å‡çº§åˆ°é‡é‡çº§é”çš„æ–¹å¼ï¼Œä»è€Œå‡ä½äº†é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚</p>
<h4 id="15-ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ"><a href="#15-ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ" class="headerlink" title="15. ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ"></a><strong>15.</strong> <strong>ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ</strong></h4><p>å½“çº¿ç¨‹ A æŒæœ‰ç‹¬å é”aï¼Œå¹¶å°è¯•å»è·å–ç‹¬å é” b çš„åŒæ—¶ï¼Œçº¿ç¨‹ B æŒæœ‰ç‹¬å é” bï¼Œå¹¶å°è¯•è·å–ç‹¬å é” a çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šå‘ç”Ÿ AB ä¸¤ä¸ªçº¿ç¨‹ç”±äºäº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œè€Œå‘ç”Ÿçš„é˜»å¡ç°è±¡ï¼Œæˆ‘ä»¬ç§°ä¸ºæ­»é”ã€‚</p>
<h4 id="16-æ€ä¹ˆé˜²æ­¢æ­»é”ï¼Ÿ"><a href="#16-æ€ä¹ˆé˜²æ­¢æ­»é”ï¼Ÿ" class="headerlink" title="16. æ€ä¹ˆé˜²æ­¢æ­»é”ï¼Ÿ"></a><strong>16.</strong> <strong>æ€ä¹ˆé˜²æ­¢æ­»é”ï¼Ÿ</strong></h4><p>Â·    å°½é‡ä½¿ç”¨ tryLock(long timeout, TimeUnit unit)çš„æ–¹æ³•(ReentrantLockã€ReentrantReadWriteLock)ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶å¯ä»¥é€€å‡ºé˜²æ­¢æ­»é”ã€‚</p>
<p>Â·    å°½é‡ä½¿ç”¨ Java. util. concurrent å¹¶å‘ç±»ä»£æ›¿è‡ªå·±æ‰‹å†™é”ã€‚</p>
<p>Â·    å°½é‡é™ä½é”çš„ä½¿ç”¨ç²’åº¦ï¼Œå°½é‡ä¸è¦å‡ ä¸ªåŠŸèƒ½ç”¨åŒä¸€æŠŠé”ã€‚</p>
<p>Â·    å°½é‡å‡å°‘åŒæ­¥çš„ä»£ç å—ã€‚</p>
<h4 id="17-ThreadLocal-æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ"><a href="#17-ThreadLocal-æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="17. ThreadLocal æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ"></a><strong>17. ThreadLocal</strong> <strong>æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</strong></h4><p>ThreadLocal ä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶å®ƒçº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚</p>
<p>ThreadLocal çš„ç»å…¸ä½¿ç”¨åœºæ™¯æ˜¯æ•°æ®åº“è¿æ¥å’Œ session ç®¡ç†ç­‰ã€‚</p>
<h4 id="18-è¯´ä¸€ä¸‹-synchronized-åº•å±‚å®ç°åŸç†ï¼Ÿ"><a href="#18-è¯´ä¸€ä¸‹-synchronized-åº•å±‚å®ç°åŸç†ï¼Ÿ" class="headerlink" title="18. è¯´ä¸€ä¸‹ synchronized åº•å±‚å®ç°åŸç†ï¼Ÿ"></a><strong>18.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>synchronized</strong> <strong>åº•å±‚å®ç°åŸç†ï¼Ÿ</strong></h4><p>synchronized æ˜¯ç”±ä¸€å¯¹ monitorenter/monitorexit æŒ‡ä»¤å®ç°çš„ï¼Œmonitor å¯¹è±¡æ˜¯åŒæ­¥çš„åŸºæœ¬å®ç°å•å…ƒã€‚åœ¨ Java 6 ä¹‹å‰ï¼Œmonitor çš„å®ç°å®Œå…¨æ˜¯ä¾é æ“ä½œç³»ç»Ÿå†…éƒ¨çš„äº’æ–¥é”ï¼Œå› ä¸ºéœ€è¦è¿›è¡Œç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ‰€ä»¥åŒæ­¥æ“ä½œæ˜¯ä¸€ä¸ªæ— å·®åˆ«çš„é‡é‡çº§æ“ä½œï¼Œæ€§èƒ½ä¹Ÿå¾ˆä½ã€‚ä½†åœ¨ Java 6 çš„æ—¶å€™ï¼ŒJava è™šæ‹Ÿæœº å¯¹æ­¤è¿›è¡Œäº†å¤§åˆ€é˜”æ–§åœ°æ”¹è¿›ï¼Œæä¾›äº†ä¸‰ç§ä¸åŒçš„ monitor å®ç°ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ä¸‰ç§ä¸åŒçš„é”ï¼šåå‘é”ï¼ˆBiased Lockingï¼‰ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ï¼Œå¤§å¤§æ”¹è¿›äº†å…¶æ€§èƒ½ã€‚</p>
<h4 id="19-synchronized-å’Œ-volatile-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#19-synchronized-å’Œ-volatile-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="19. synchronized å’Œ volatile çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>19. synchronized</strong> <strong>å’Œ</strong> <strong>volatile</strong> <strong>çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Â·    volatile æ˜¯å˜é‡ä¿®é¥°ç¬¦ï¼›synchronized æ˜¯ä¿®é¥°ç±»ã€æ–¹æ³•ã€ä»£ç æ®µã€‚</p>
<p>Â·    volatile ä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼›è€Œ synchronized åˆ™å¯ä»¥ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§å’ŒåŸå­æ€§ã€‚</p>
<p>Â·    volatile ä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼›synchronized å¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ã€‚</p>
<h4 id="20-synchronized-å’Œ-Lock-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#20-synchronized-å’Œ-Lock-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="20. synchronized å’Œ Lock æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>20. synchronized</strong> <strong>å’Œ</strong> <strong>Lock</strong> <strong>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    synchronized å¯ä»¥ç»™ç±»ã€æ–¹æ³•ã€ä»£ç å—åŠ é”ï¼›è€Œ lock åªèƒ½ç»™ä»£ç å—åŠ é”ã€‚</p>
<p>Â·    synchronized ä¸éœ€è¦æ‰‹åŠ¨è·å–é”å’Œé‡Šæ”¾é”ï¼Œä½¿ç”¨ç®€å•ï¼Œå‘ç”Ÿå¼‚å¸¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œä¸ä¼šé€ æˆæ­»é”ï¼›è€Œ lock éœ€è¦è‡ªå·±åŠ é”å’Œé‡Šæ”¾é”ï¼Œå¦‚æœä½¿ç”¨ä¸å½“æ²¡æœ‰ unLock()å»é‡Šæ”¾é”å°±ä¼šé€ æˆæ­»é”ã€‚</p>
<p>Â·    é€šè¿‡ Lock å¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸè·å–é”ï¼Œè€Œ synchronized å´æ— æ³•åŠåˆ°ã€‚</p>
<h4 id="21-synchronized-å’Œ-ReentrantLock-åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#21-synchronized-å’Œ-ReentrantLock-åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="21. synchronized å’Œ ReentrantLock åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>21. synchronized</strong> <strong>å’Œ</strong> <strong>ReentrantLock</strong> <strong>åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>synchronized æ—©æœŸçš„å®ç°æ¯”è¾ƒä½æ•ˆï¼Œå¯¹æ¯” ReentrantLockï¼Œå¤§å¤šæ•°åœºæ™¯æ€§èƒ½éƒ½ç›¸å·®è¾ƒå¤§ï¼Œä½†æ˜¯åœ¨ Java 6 ä¸­å¯¹ synchronized è¿›è¡Œäº†éå¸¸å¤šçš„æ”¹è¿›ã€‚</p>
<p>ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<p>Â·    ReentrantLock ä½¿ç”¨èµ·æ¥æ¯”è¾ƒçµæ´»ï¼Œä½†æ˜¯å¿…é¡»æœ‰é‡Šæ”¾é”çš„é…åˆåŠ¨ä½œï¼›</p>
<p>Â·    ReentrantLock å¿…é¡»æ‰‹åŠ¨è·å–ä¸é‡Šæ”¾é”ï¼Œè€Œ synchronized ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾å’Œå¼€å¯é”ï¼›</p>
<p>Â·    ReentrantLock åªé€‚ç”¨äºä»£ç å—é”ï¼Œè€Œ synchronized å¯ç”¨äºä¿®é¥°æ–¹æ³•ã€ä»£ç å—ç­‰ã€‚</p>
<p>Â·    volatile æ ‡è®°çš„å˜é‡ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›synchronized æ ‡è®°çš„å˜é‡å¯ä»¥è¢«ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</p>
<h4 id="22-è¯´ä¸€ä¸‹-atomic-çš„åŸç†ï¼Ÿ"><a href="#22-è¯´ä¸€ä¸‹-atomic-çš„åŸç†ï¼Ÿ" class="headerlink" title="22. è¯´ä¸€ä¸‹ atomic çš„åŸç†ï¼Ÿ"></a><strong>22.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>atomic</strong> <strong>çš„åŸç†ï¼Ÿ</strong></h4><p>atomic ä¸»è¦åˆ©ç”¨ CAS (Compare And Wwap) å’Œ volatile å’Œ native æ–¹æ³•æ¥ä¿è¯åŸå­æ“ä½œï¼Œä»è€Œé¿å… synchronized çš„é«˜å¼€é”€ï¼Œæ‰§è¡Œæ•ˆç‡å¤§ä¸ºæå‡ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é”</tag>
        <tag>é¢è¯•</tag>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>javaå®¹å™¨çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/16/java%E5%AE%B9%E5%99%A8%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="18-Java-å®¹å™¨éƒ½æœ‰å“ªäº›ï¼Ÿ"><a href="#18-Java-å®¹å™¨éƒ½æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="18. Java å®¹å™¨éƒ½æœ‰å“ªäº›ï¼Ÿ"></a><strong>18. Java</strong> <strong>å®¹å™¨éƒ½æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>Java å®¹å™¨åˆ†ä¸º Collection å’Œ Map ä¸¤å¤§ç±»ï¼Œå…¶ä¸‹åˆæœ‰å¾ˆå¤šå­ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>Â·    Collection</p>
<p>Â·    List</p>
<p>o  ArrayList</p>
<p>o  LinkedList</p>
<p>o  Vector</p>
<p>o  Stack</p>
<p>Â·    Set</p>
<p>o  HashSet</p>
<p>o  LinkedHashSet</p>
<p>o  TreeSet</p>
<p>Â·    Map</p>
<p>Â·    HashMap</p>
<p>o  LinkedHashMap</p>
<p>Â·    TreeMap</p>
<p>Â·    ConcurrentHashMap</p>
<p>Â·    Hashtable</p>
<h4 id="19-Collection-å’Œ-Collections-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#19-Collection-å’Œ-Collections-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="19. Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>19. Collection</strong> <strong>å’Œ</strong> <strong>Collections</strong> <strong>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    Collection æ˜¯ä¸€ä¸ªé›†åˆæ¥å£ï¼Œå®ƒæä¾›äº†å¯¹é›†åˆå¯¹è±¡è¿›è¡ŒåŸºæœ¬æ“ä½œçš„é€šç”¨æ¥å£æ–¹æ³•ï¼Œæ‰€æœ‰é›†åˆéƒ½æ˜¯å®ƒçš„å­ç±»ï¼Œæ¯”å¦‚ Listã€Set ç­‰ã€‚</p>
<p>Â·    Collections æ˜¯ä¸€ä¸ªåŒ…è£…ç±»ï¼ŒåŒ…å«äº†å¾ˆå¤šé™æ€æ–¹æ³•ï¼Œä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œå°±åƒä¸€ä¸ªå·¥å…·ç±»ï¼Œæ¯”å¦‚æä¾›çš„æ’åºæ–¹æ³•ï¼š Collections. sort(list)ã€‚</p>
<h4 id="20-Listã€Setã€-Map-ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#20-Listã€Setã€-Map-ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="20. Listã€Setã€*Map *ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>20. List</strong>ã€<strong><strong>Set</strong></strong>ã€<strong>*<em>Map *</em>ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Listã€Setã€Map çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼šå…ƒç´ æ˜¯å¦æœ‰åºã€æ˜¯å¦å…è®¸å…ƒç´ é‡å¤ã€‚</p>
<p>ä¸‰è€…ä¹‹é—´çš„åŒºåˆ«ï¼Œå¦‚ä¸‹è¡¨ï¼š</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2020/07/16/java%E5%AE%B9%E5%99%A8%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/%E5%9B%BE1.png"  alt="åŒºåˆ«å›¾"></p>
<h4 id="21-HashMap-å’Œ-Hashtable-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#21-HashMap-å’Œ-Hashtable-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="21. HashMap å’Œ Hashtable æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>21. HashMap</strong> <strong>å’Œ</strong> <strong>Hashtable</strong> <strong>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    å­˜å‚¨ï¼šHashMap è¿è¡Œ key å’Œ value ä¸º nullï¼Œè€Œ Hashtable ä¸å…è®¸ã€‚</p>
<p>Â·    çº¿ç¨‹å®‰å…¨ï¼šHashtable æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>Â·    æ¨èä½¿ç”¨ï¼šåœ¨ Hashtable çš„ç±»æ³¨é‡Šå¯ä»¥çœ‹åˆ°ï¼ŒHashtable æ˜¯ä¿ç•™ç±»ä¸å»ºè®®ä½¿ç”¨ï¼Œæ¨èåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ HashMap æ›¿ä»£ï¼Œå¦‚æœéœ€è¦å¤šçº¿ç¨‹ä½¿ç”¨åˆ™ç”¨ ConcurrentHashMap æ›¿ä»£ã€‚</p>
<h4 id="22-å¦‚ä½•å†³å®šä½¿ç”¨-HashMap-è¿˜æ˜¯-TreeMap-ï¼Ÿ"><a href="#22-å¦‚ä½•å†³å®šä½¿ç”¨-HashMap-è¿˜æ˜¯-TreeMap-ï¼Ÿ" class="headerlink" title="22. å¦‚ä½•å†³å®šä½¿ç”¨ HashMap è¿˜æ˜¯ TreeMap**ï¼Ÿ**"></a><strong>22.</strong> <strong>å¦‚ä½•å†³å®šä½¿ç”¨</strong> <strong>HashMap</strong> <strong>è¿˜æ˜¯</strong> <strong>TreeMap**</strong>ï¼Ÿ**</h4><p>å¯¹äºåœ¨ Map ä¸­æ’å…¥ã€åˆ é™¤ã€å®šä½ä¸€ä¸ªå…ƒç´ è¿™ç±»æ“ä½œï¼ŒHashMap æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºç›¸å¯¹è€Œè¨€ HashMap çš„æ’å…¥ä¼šæ›´å¿«ï¼Œä½†å¦‚æœä½ è¦å¯¹ä¸€ä¸ª key é›†åˆè¿›è¡Œæœ‰åºçš„éå†ï¼Œé‚£ TreeMap æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<h4 id="23-è¯´ä¸€ä¸‹-HashMap-çš„å®ç°åŸç†ï¼Ÿ"><a href="#23-è¯´ä¸€ä¸‹-HashMap-çš„å®ç°åŸç†ï¼Ÿ" class="headerlink" title="23. è¯´ä¸€ä¸‹ HashMap çš„å®ç°åŸç†ï¼Ÿ"></a><strong>23.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>HashMap</strong> <strong>çš„å®ç°åŸç†ï¼Ÿ</strong></h4><p>HashMap åŸºäº Hash ç®—æ³•å®ç°çš„ï¼Œæˆ‘ä»¬é€šè¿‡ put(key,value)å­˜å‚¨ï¼Œget(key)æ¥è·å–ã€‚å½“ä¼ å…¥ key æ—¶ï¼ŒHashMap ä¼šæ ¹æ® key. hashCode() è®¡ç®—å‡º hash å€¼ï¼Œæ ¹æ® hash å€¼å°† value ä¿å­˜åœ¨ bucket é‡Œã€‚å½“è®¡ç®—å‡ºçš„ hash å€¼ç›¸åŒæ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º hash å†²çªï¼ŒHashMap çš„åšæ³•æ˜¯ç”¨é“¾è¡¨å’Œçº¢é»‘æ ‘å­˜å‚¨ç›¸åŒ hash å€¼çš„ valueã€‚å½“ hash å†²çªçš„ä¸ªæ•°æ¯”è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨é“¾è¡¨å¦åˆ™ä½¿ç”¨çº¢é»‘æ ‘ã€‚</p>
<h4 id="24-è¯´ä¸€ä¸‹-HashSet-çš„å®ç°åŸç†ï¼Ÿ"><a href="#24-è¯´ä¸€ä¸‹-HashSet-çš„å®ç°åŸç†ï¼Ÿ" class="headerlink" title="24. è¯´ä¸€ä¸‹ HashSet çš„å®ç°åŸç†ï¼Ÿ"></a><strong>24.</strong> <strong>è¯´ä¸€ä¸‹</strong> <strong>HashSet</strong> <strong>çš„å®ç°åŸç†ï¼Ÿ</strong></h4><p>HashSet æ˜¯åŸºäº HashMap å®ç°çš„ï¼ŒHashSet åº•å±‚ä½¿ç”¨ HashMap æ¥ä¿å­˜æ‰€æœ‰å…ƒç´ ï¼Œå› æ­¤ HashSet çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œç›¸å…³ HashSet çš„æ“ä½œï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç›´æ¥è°ƒç”¨åº•å±‚ HashMap çš„ç›¸å…³æ–¹æ³•æ¥å®Œæˆï¼ŒHashSet ä¸å…è®¸é‡å¤çš„å€¼ã€‚</p>
<h4 id="25-ArrayList-å’Œ-LinkedList-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#25-ArrayList-å’Œ-LinkedList-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="25. ArrayList å’Œ LinkedList çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>25. ArrayList</strong> <strong>å’Œ</strong> <strong>LinkedList</strong> <strong>çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Â·    æ•°æ®ç»“æ„å®ç°ï¼šArrayList æ˜¯åŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„å®ç°ï¼Œè€Œ LinkedList æ˜¯åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„å®ç°ã€‚</p>
<p>Â·    éšæœºè®¿é—®æ•ˆç‡ï¼šArrayList æ¯” LinkedList åœ¨éšæœºè®¿é—®çš„æ—¶å€™æ•ˆç‡è¦é«˜ï¼Œå› ä¸º LinkedList æ˜¯çº¿æ€§çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦ç§»åŠ¨æŒ‡é’ˆä»å‰å¾€åä¾æ¬¡æŸ¥æ‰¾ã€‚</p>
<p>Â·    å¢åŠ å’Œåˆ é™¤æ•ˆç‡ï¼šåœ¨éé¦–å°¾çš„å¢åŠ å’Œåˆ é™¤æ“ä½œï¼ŒLinkedList è¦æ¯” ArrayList æ•ˆç‡è¦é«˜ï¼Œå› ä¸º ArrayList å¢åˆ æ“ä½œè¦å½±å“æ•°ç»„å†…çš„å…¶ä»–æ•°æ®çš„ä¸‹æ ‡ã€‚</p>
<p>ç»¼åˆæ¥è¯´ï¼Œåœ¨éœ€è¦é¢‘ç¹è¯»å–é›†åˆä¸­çš„å…ƒç´ æ—¶ï¼Œæ›´æ¨èä½¿ç”¨ ArrayListï¼Œè€Œåœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œè¾ƒå¤šæ—¶ï¼Œæ›´æ¨èä½¿ç”¨ LinkedListã€‚</p>
<h4 id="26-å¦‚ä½•å®ç°æ•°ç»„å’Œ-List-ä¹‹é—´çš„è½¬æ¢ï¼Ÿ"><a href="#26-å¦‚ä½•å®ç°æ•°ç»„å’Œ-List-ä¹‹é—´çš„è½¬æ¢ï¼Ÿ" class="headerlink" title="26. å¦‚ä½•å®ç°æ•°ç»„å’Œ List ä¹‹é—´çš„è½¬æ¢ï¼Ÿ"></a><strong>26.</strong> <strong>å¦‚ä½•å®ç°æ•°ç»„å’Œ</strong> <strong>List</strong> <strong>ä¹‹é—´çš„è½¬æ¢ï¼Ÿ</strong></h4><p>Â·    æ•°ç»„è½¬ Listï¼šä½¿ç”¨ Arrays. asList(array) è¿›è¡Œè½¬æ¢ã€‚</p>
<p>Â·    List è½¬æ•°ç»„ï¼šä½¿ç”¨ List è‡ªå¸¦çš„ toArray() æ–¹æ³•ã€‚</p>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// list to array</span></span><br><span class="line"></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">list. add(<span class="string">"ç‹ç£Š"</span>);</span><br><span class="line"></span><br><span class="line">list. add(<span class="string">"çš„åšå®¢"</span>);</span><br><span class="line"></span><br><span class="line">list. toArray();</span><br><span class="line"></span><br><span class="line"><span class="comment">// array to list</span></span><br><span class="line"></span><br><span class="line">String[] array = <span class="keyword">new</span> String[]&#123;<span class="string">"ç‹ç£Š"</span>,<span class="string">"çš„åšå®¢"</span>&#125;;</span><br><span class="line"></span><br><span class="line">Arrays. asList(array);</span><br></pre></td></tr></table></figure>

<h4 id="27-ArrayList-å’Œ-Vector-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#27-ArrayList-å’Œ-Vector-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="27. ArrayList å’Œ Vector çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>27. ArrayList</strong> <strong>å’Œ</strong> <strong>Vector</strong> <strong>çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Â·    çº¿ç¨‹å®‰å…¨ï¼šVector ä½¿ç”¨äº† Synchronized æ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ ArrayList æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>Â·    æ€§èƒ½ï¼šArrayList åœ¨æ€§èƒ½æ–¹é¢è¦ä¼˜äº Vectorã€‚</p>
<p>Â·    æ‰©å®¹ï¼šArrayList å’Œ Vector éƒ½ä¼šæ ¹æ®å®é™…çš„éœ€è¦åŠ¨æ€çš„è°ƒæ•´å®¹é‡ï¼Œåªä¸è¿‡åœ¨ Vector æ‰©å®¹æ¯æ¬¡ä¼šå¢åŠ  1 å€ï¼Œè€Œ ArrayList åªä¼šå¢åŠ  50%ã€‚</p>
<h4 id="28-Array-å’Œ-ArrayList-æœ‰ä½•åŒºåˆ«ï¼Ÿ"><a href="#28-Array-å’Œ-ArrayList-æœ‰ä½•åŒºåˆ«ï¼Ÿ" class="headerlink" title="28. Array å’Œ ArrayList æœ‰ä½•åŒºåˆ«ï¼Ÿ"></a><strong>28. Array</strong> <strong>å’Œ</strong> <strong>ArrayList</strong> <strong>æœ‰ä½•åŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    Array å¯ä»¥å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡ï¼ŒArrayList åªèƒ½å­˜å‚¨å¯¹è±¡ã€‚</p>
<p>Â·    Array æ˜¯æŒ‡å®šå›ºå®šå¤§å°çš„ï¼Œè€Œ ArrayList å¤§å°æ˜¯è‡ªåŠ¨æ‰©å±•çš„ã€‚</p>
<p>Â·    Array å†…ç½®æ–¹æ³•æ²¡æœ‰ ArrayList å¤šï¼Œæ¯”å¦‚ addAllã€removeAllã€iteration ç­‰æ–¹æ³•åªæœ‰ ArrayList æœ‰ã€‚</p>
<h4 id="29-åœ¨-Queue-ä¸­-poll-å’Œ-remove-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#29-åœ¨-Queue-ä¸­-poll-å’Œ-remove-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="29. åœ¨ Queue ä¸­ poll()å’Œ remove()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>29.</strong> <strong>åœ¨</strong> <strong>Queue</strong> <strong>ä¸­</strong> <strong>poll()</strong>å’Œ <strong>remove()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    ç›¸åŒç‚¹ï¼šéƒ½æ˜¯è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨é˜Ÿåˆ—ä¸­åˆ é™¤è¿”å›çš„å¯¹è±¡ã€‚</p>
<p>Â·    ä¸åŒç‚¹ï¼šå¦‚æœæ²¡æœ‰å…ƒç´  poll()ä¼šè¿”å› nullï¼Œè€Œ remove()ä¼šç›´æ¥æŠ›å‡º NoSuchElementException å¼‚å¸¸ã€‚</p>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Queue&lt;String&gt; queue = <span class="keyword">new</span> LinkedList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">queue. offer(<span class="string">"string"</span>); <span class="comment">// add</span></span><br><span class="line"></span><br><span class="line">System. out. println(queue. poll());</span><br><span class="line"></span><br><span class="line">System. out. println(queue. remove());</span><br><span class="line"></span><br><span class="line">System. out. println(queue. size());</span><br></pre></td></tr></table></figure>



<h4 id="30-å“ªäº›é›†åˆç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ"><a href="#30-å“ªäº›é›†åˆç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ" class="headerlink" title="30. å“ªäº›é›†åˆç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ"></a><strong>30.</strong> <strong>å“ªäº›é›†åˆç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</strong></h4><p>Vectorã€Hashtableã€Stack éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œåƒ HashMap åˆ™æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸è¿‡åœ¨ JDK 1.5 ä¹‹åéšç€ Java. util. concurrent å¹¶å‘åŒ…çš„å‡ºç°ï¼Œå®ƒä»¬ä¹Ÿæœ‰äº†è‡ªå·±å¯¹åº”çš„çº¿ç¨‹å®‰å…¨ç±»ï¼Œæ¯”å¦‚ HashMap å¯¹åº”çš„çº¿ç¨‹å®‰å…¨ç±»å°±æ˜¯ ConcurrentHashMapã€‚</p>
<h4 id="31-è¿­ä»£å™¨-Iterator-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#31-è¿­ä»£å™¨-Iterator-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="31. è¿­ä»£å™¨ Iterator æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>31.</strong> <strong>è¿­ä»£å™¨</strong> <strong>Iterator</strong> <strong>æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>Iterator æ¥å£æä¾›éå†ä»»ä½• Collection çš„æ¥å£ã€‚æˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ª Collection ä¸­ä½¿ç”¨è¿­ä»£å™¨æ–¹æ³•æ¥è·å–è¿­ä»£å™¨å®ä¾‹ã€‚è¿­ä»£å™¨å–ä»£äº† Java é›†åˆæ¡†æ¶ä¸­çš„ Enumerationï¼Œè¿­ä»£å™¨å…è®¸è°ƒç”¨è€…åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ç§»é™¤å…ƒç´ ã€‚</p>
<h4 id="32-Iterator-æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"><a href="#32-Iterator-æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="32. Iterator æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"></a><strong>32. Iterator</strong> <strong>æ€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</strong></h4><p>Iterator ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">Iterator&lt;String&gt; it = list. iterator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(it. hasNext())&#123;</span><br><span class="line"></span><br><span class="line"> String obj = it. next();</span><br><span class="line"></span><br><span class="line"> System. out. println(obj);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Iterator çš„ç‰¹ç‚¹æ˜¯æ›´åŠ å®‰å…¨ï¼Œå› ä¸ºå®ƒå¯ä»¥ç¡®ä¿ï¼Œåœ¨å½“å‰éå†çš„é›†åˆå…ƒç´ è¢«æ›´æ”¹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚</p>
<h4 id="33-Iterator-å’Œ-ListIterator-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#33-Iterator-å’Œ-ListIterator-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="33. Iterator å’Œ ListIterator æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>33. Iterator</strong> <strong>å’Œ</strong> <strong>ListIterator</strong> <strong>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    Iterator å¯ä»¥éå† Set å’Œ List é›†åˆï¼Œè€Œ ListIterator åªèƒ½éå† Listã€‚</p>
<p>Â·    Iterator åªèƒ½å•å‘éå†ï¼Œè€Œ ListIterator å¯ä»¥åŒå‘éå†ï¼ˆå‘å‰/åéå†ï¼‰ã€‚</p>
<p>Â·    ListIterator ä» Iterator æ¥å£ç»§æ‰¿ï¼Œç„¶åæ·»åŠ äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€æ›¿æ¢ä¸€ä¸ªå…ƒç´ ã€è·å–å‰é¢æˆ–åé¢å…ƒç´ çš„ç´¢å¼•ä½ç½®ã€‚</p>
<h4 id="34-æ€ä¹ˆç¡®ä¿ä¸€ä¸ªé›†åˆä¸èƒ½è¢«ä¿®æ”¹ï¼Ÿ"><a href="#34-æ€ä¹ˆç¡®ä¿ä¸€ä¸ªé›†åˆä¸èƒ½è¢«ä¿®æ”¹ï¼Ÿ" class="headerlink" title="34. æ€ä¹ˆç¡®ä¿ä¸€ä¸ªé›†åˆä¸èƒ½è¢«ä¿®æ”¹ï¼Ÿ"></a><strong>34.</strong> <strong>æ€ä¹ˆç¡®ä¿ä¸€ä¸ªé›†åˆä¸èƒ½è¢«ä¿®æ”¹ï¼Ÿ</strong></h4><p>å¯ä»¥ä½¿ç”¨ Collections. unmodifiableCollection(Collection c) æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªåªè¯»é›†åˆï¼Œè¿™æ ·æ”¹å˜é›†åˆçš„ä»»ä½•æ“ä½œéƒ½ä¼šæŠ›å‡º Java. lang. UnsupportedOperationException å¼‚å¸¸ã€‚</p>
<p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">list. add(<span class="string">"x"</span>);</span><br><span class="line"></span><br><span class="line">Collection&lt;String&gt; clist = Collections. unmodifiableCollection(list);</span><br><span class="line"></span><br><span class="line">clist. add(<span class="string">"y"</span>); <span class="comment">// è¿è¡Œæ—¶æ­¤è¡ŒæŠ¥é”™</span></span><br><span class="line"></span><br><span class="line">System. out. println(list. size());</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•</tag>
        <tag>å®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>javaåŸºç¡€çŸ¥è¯†æ£€éªŒ</title>
    <url>/2020/07/16/java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h4 id="1-JDK-å’Œ-JRE-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#1-JDK-å’Œ-JRE-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="1. JDK å’Œ JRE æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>1. JDK</strong> <strong>å’Œ</strong> <strong>JRE</strong> <strong>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    JDKï¼šJava Development Kit çš„ç®€ç§°ï¼ŒJava å¼€å‘å·¥å…·åŒ…ï¼Œæä¾›äº† Java çš„å¼€å‘ç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒã€‚</p>
<p>Â·    JREï¼šJava Runtime Environment çš„ç®€ç§°ï¼ŒJava è¿è¡Œç¯å¢ƒï¼Œä¸º Java çš„è¿è¡Œæä¾›äº†æ‰€éœ€ç¯å¢ƒã€‚</p>
<p>å…·ä½“æ¥è¯´ JDK å…¶å®åŒ…å«äº† JREï¼ŒåŒæ—¶è¿˜åŒ…å«äº†ç¼–è¯‘ Java æºç çš„ç¼–è¯‘å™¨ Javacï¼Œè¿˜åŒ…å«äº†å¾ˆå¤š Java ç¨‹åºè°ƒè¯•å’Œåˆ†æçš„å·¥å…·ã€‚ç®€å•æ¥è¯´ï¼šå¦‚æœä½ éœ€è¦è¿è¡Œ Java ç¨‹åºï¼Œåªéœ€å®‰è£… JRE å°±å¯ä»¥äº†ï¼Œå¦‚æœä½ éœ€è¦ç¼–å†™ Java ç¨‹åºï¼Œéœ€è¦å®‰è£… JDKã€‚</p>
<h4 id="2-å’Œ-equals-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-å’Œ-equals-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. == å’Œ equals çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>2. ==</strong> <strong>å’Œ</strong> <strong>equals</strong> <strong>çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4><p>== è§£è¯»</p>
<p>å¯¹äºåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ == çš„ä½œç”¨æ•ˆæœæ˜¯ä¸åŒçš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>Â·    åŸºæœ¬ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸åŒï¼›</p>
<p>Â·    å¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å¼•ç”¨æ˜¯å¦ç›¸åŒï¼›</p>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String x = <span class="string">"string"</span>;</span><br><span class="line"></span><br><span class="line">String y = <span class="string">"string"</span>;</span><br><span class="line"></span><br><span class="line">String z = <span class="keyword">new</span> String(<span class="string">"string"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(x==y); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">System.out.println(x==z); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">System.out.println(x.equals(y)); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">System.out.println(x.equals(z)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>ä»£ç è§£è¯»ï¼šå› ä¸º x å’Œ y æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥ == ä¹Ÿæ˜¯ trueï¼Œè€Œ new String()æ–¹æ³•åˆ™é‡å†™å¼€è¾Ÿäº†å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ == ç»“æœä¸º falseï¼Œè€Œ equals æ¯”è¾ƒçš„ä¸€ç›´æ˜¯å€¼ï¼Œæ‰€ä»¥ç»“æœéƒ½ä¸º trueã€‚</p>
<p>equals è§£è¯»</p>
<p>equals æœ¬è´¨ä¸Šå°±æ˜¯ ==ï¼Œåªä¸è¿‡ String å’Œ Integer ç­‰é‡å†™äº† equals æ–¹æ³•ï¼ŒæŠŠå®ƒå˜æˆäº†å€¼æ¯”è¾ƒã€‚çœ‹ä¸‹é¢çš„ä»£ç å°±æ˜ç™½äº†ã€‚</p>
<p>é¦–å…ˆæ¥çœ‹é»˜è®¤æƒ…å†µä¸‹ equals æ¯”è¾ƒä¸€ä¸ªæœ‰ç›¸åŒå€¼çš„å¯¹è±¡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Cat</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="keyword">this</span>.name = name;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="keyword">return</span> name;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="keyword">this</span>.name = name;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Cat c1 = <span class="keyword">new</span> Cat(<span class="string">"ç‹ç£Š"</span>);</span><br><span class="line"></span><br><span class="line">Cat c2 = <span class="keyword">new</span> Cat(<span class="string">"ç‹ç£Š"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(c1.equals(c2)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå‡ºä¹æˆ‘ä»¬çš„æ„æ–™ï¼Œç«Ÿç„¶æ˜¯ falseï¼Ÿè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Œçœ‹äº† equals æºç å°±çŸ¥é“äº†ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="keyword">return</span> (<span class="keyword">this</span> == obj);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸæ¥ equals æœ¬è´¨ä¸Šå°±æ˜¯ ==ã€‚</p>
<p>é‚£é—®é¢˜æ¥äº†ï¼Œä¸¤ä¸ªç›¸åŒå€¼çš„ String å¯¹è±¡ï¼Œä¸ºä»€ä¹ˆè¿”å›çš„æ˜¯ trueï¼Ÿä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s1 = <span class="keyword">new</span> String(<span class="string">"è€ç‹"</span>);</span><br><span class="line"></span><br><span class="line">String s2 = <span class="keyword">new</span> String(<span class="string">"è€ç‹"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(s1.equals(s2)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œå½“æˆ‘ä»¬è¿›å…¥ String çš„ equals æ–¹æ³•ï¼Œæ‰¾åˆ°äº†ç­”æ¡ˆï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line"></span><br><span class="line">â€‹    String anotherString = (String)anObject;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="keyword">int</span> n = value.length;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="keyword">if</span> (n == anotherString.value.length) &#123;</span><br><span class="line"></span><br><span class="line">â€‹      <span class="keyword">char</span> v1[] = value;</span><br><span class="line"></span><br><span class="line">â€‹      <span class="keyword">char</span> v2[] = anotherString.value;</span><br><span class="line"></span><br><span class="line">â€‹      <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">â€‹      <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">â€‹        <span class="keyword">if</span> (v1[i] != v2[i])</span><br><span class="line"></span><br><span class="line">â€‹          <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">â€‹        i++;</span><br><span class="line"></span><br><span class="line">â€‹      &#125;</span><br><span class="line"></span><br><span class="line">â€‹      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">â€‹    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸæ¥æ˜¯ String é‡å†™äº† Object çš„ equals æ–¹æ³•ï¼ŒæŠŠå¼•ç”¨æ¯”è¾ƒæ”¹æˆäº†å€¼æ¯”è¾ƒã€‚</p>
<p>æ€»ç»“ ï¼š== å¯¹äºåŸºæœ¬ç±»å‹æ¥è¯´æ˜¯å€¼æ¯”è¾ƒï¼Œå¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´æ˜¯æ¯”è¾ƒçš„æ˜¯å¼•ç”¨ï¼›è€Œ equals é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼•ç”¨æ¯”è¾ƒï¼Œåªæ˜¯å¾ˆå¤šç±»é‡æ–°äº† equals æ–¹æ³•ï¼Œæ¯”å¦‚ Stringã€Integer ç­‰æŠŠå®ƒå˜æˆäº†å€¼æ¯”è¾ƒï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ equals æ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸ç­‰ã€‚</p>
<h4 id="3-ä¸¤ä¸ªå¯¹è±¡çš„-hashCode-ç›¸åŒï¼Œåˆ™-equals-ä¹Ÿä¸€å®šä¸º-trueï¼Œå¯¹å—ï¼Ÿ"><a href="#3-ä¸¤ä¸ªå¯¹è±¡çš„-hashCode-ç›¸åŒï¼Œåˆ™-equals-ä¹Ÿä¸€å®šä¸º-trueï¼Œå¯¹å—ï¼Ÿ" class="headerlink" title="3. ä¸¤ä¸ªå¯¹è±¡çš„ hashCode() ç›¸åŒï¼Œåˆ™ equals() ä¹Ÿä¸€å®šä¸º trueï¼Œå¯¹å—ï¼Ÿ"></a><strong>3.</strong> <strong>ä¸¤ä¸ªå¯¹è±¡çš„</strong> <strong>hashCode()</strong> <strong>ç›¸åŒï¼Œåˆ™</strong> <strong>equals()</strong> <strong>ä¹Ÿä¸€å®šä¸º</strong> <strong>true</strong>ï¼Œå¯¹å—ï¼Ÿ</h4><p>ä¸å¯¹ï¼Œä¸¤ä¸ªå¯¹è±¡çš„ hashCode() ç›¸åŒï¼Œequals() ä¸ä¸€å®š trueã€‚</p>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String str1 = <span class="string">"é€šè¯"</span>;</span><br><span class="line"></span><br><span class="line">String str2 = <span class="string">"é‡åœ°"</span>;</span><br><span class="line"></span><br><span class="line">System. out. println(String. format(<span class="string">"str1ï¼š%d | str2ï¼š%d"</span>, str1. hashCode(),str2. hashCode()));</span><br><span class="line"></span><br><span class="line">System. out. println(str1. equals(str2));</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œçš„ç»“æœï¼š</p>
<p>str1ï¼š1179395 | str2ï¼š1179395</p>
<p> false</p>
<p>ä»£ç è§£è¯»ï¼šå¾ˆæ˜¾ç„¶â€œé€šè¯â€å’Œâ€œé‡åœ°â€çš„ hashCode() ç›¸åŒï¼Œç„¶è€Œ equals() åˆ™ä¸º falseï¼Œå› ä¸ºåœ¨æ•£åˆ—è¡¨ä¸­ï¼ŒhashCode() ç›¸ç­‰å³ä¸¤ä¸ªé”®å€¼å¯¹çš„å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œç„¶è€Œå“ˆå¸Œå€¼ç›¸ç­‰ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¾—å‡ºé”®å€¼å¯¹ç›¸ç­‰ã€‚</p>
<h4 id="4-final-åœ¨-Java-ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#4-final-åœ¨-Java-ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="4. final åœ¨ Java ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a><strong>4. final</strong> <strong>åœ¨</strong> <strong>Java</strong> <strong>ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></h4><p>Â·    final ä¿®é¥°çš„ç±»å«æœ€ç»ˆç±»ï¼Œè¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚</p>
<p>Â·    final ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€‚</p>
<p>Â·    final ä¿®é¥°çš„å˜é‡å«å¸¸é‡ï¼Œå¸¸é‡å¿…é¡»åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–ä¹‹åå€¼å°±ä¸èƒ½è¢«ä¿®æ”¹ã€‚</p>
<h4 id="5-Java-ä¸­çš„-Math-round-1-5-ç­‰äºå¤šå°‘ï¼Ÿ"><a href="#5-Java-ä¸­çš„-Math-round-1-5-ç­‰äºå¤šå°‘ï¼Ÿ" class="headerlink" title="5. Java ä¸­çš„ Math. round(-1. 5) ç­‰äºå¤šå°‘ï¼Ÿ"></a><strong>5. Java</strong> <strong>ä¸­çš„</strong> <strong>Math. round(-1. 5)</strong> <strong>ç­‰äºå¤šå°‘ï¼Ÿ</strong></h4><p>ç­‰äº -1ï¼Œå› ä¸ºåœ¨æ•°è½´ä¸Šå–å€¼æ—¶ï¼Œä¸­é—´å€¼ï¼ˆ0.5ï¼‰å‘å³å–æ•´ï¼Œæ‰€ä»¥æ­£ 0.5 æ˜¯å¾€ä¸Šå–æ•´ï¼Œè´Ÿ 0.5 æ˜¯ç›´æ¥èˆå¼ƒã€‚</p>
<h4 id="6-String-å±äºåŸºç¡€çš„æ•°æ®ç±»å‹å—ï¼Ÿ"><a href="#6-String-å±äºåŸºç¡€çš„æ•°æ®ç±»å‹å—ï¼Ÿ" class="headerlink" title="6. String å±äºåŸºç¡€çš„æ•°æ®ç±»å‹å—ï¼Ÿ"></a><strong>6. String</strong> <strong>å±äºåŸºç¡€çš„æ•°æ®ç±»å‹å—ï¼Ÿ</strong></h4><p>String ä¸å±äºåŸºç¡€ç±»å‹ï¼ŒåŸºç¡€ç±»å‹æœ‰ 8 ç§ï¼šbyteã€booleanã€charã€shortã€intã€floatã€longã€doubleï¼Œè€Œ String å±äºå¯¹è±¡ã€‚</p>
<h4 id="7-Java-ä¸­æ“ä½œå­—ç¬¦ä¸²éƒ½æœ‰å“ªäº›ç±»ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#7-Java-ä¸­æ“ä½œå­—ç¬¦ä¸²éƒ½æœ‰å“ªäº›ç±»ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="7. Java ä¸­æ“ä½œå­—ç¬¦ä¸²éƒ½æœ‰å“ªäº›ç±»ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>7. Java</strong> <strong>ä¸­æ“ä½œå­—ç¬¦ä¸²éƒ½æœ‰å“ªäº›ç±»ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>æ“ä½œå­—ç¬¦ä¸²çš„ç±»æœ‰ï¼šStringã€StringBufferã€StringBuilderã€‚</p>
<p>String å’Œ StringBufferã€StringBuilder çš„åŒºåˆ«åœ¨äº String å£°æ˜çš„æ˜¯ä¸å¯å˜çš„å¯¹è±¡ï¼Œæ¯æ¬¡æ“ä½œéƒ½ä¼šç”Ÿæˆæ–°çš„ String å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ String å¯¹è±¡ï¼Œè€Œ StringBufferã€StringBuilder å¯ä»¥åœ¨åŸæœ‰å¯¹è±¡çš„åŸºç¡€ä¸Šè¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥åœ¨ç»å¸¸æ”¹å˜å­—ç¬¦ä¸²å†…å®¹çš„æƒ…å†µä¸‹æœ€å¥½ä¸è¦ä½¿ç”¨ Stringã€‚</p>
<p>StringBuffer å’Œ StringBuilder æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼ŒStringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ StringBuilder æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä½† StringBuilder çš„æ€§èƒ½å´é«˜äº StringBufferï¼Œæ‰€ä»¥åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹æ¨èä½¿ç”¨ StringBuilderï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ¨èä½¿ç”¨ StringBufferã€‚</p>
<h4 id="8-String-str-â€iâ€-ä¸-String-str-new-String-â€œiâ€-ä¸€æ ·å—ï¼Ÿ"><a href="#8-String-str-â€iâ€-ä¸-String-str-new-String-â€œiâ€-ä¸€æ ·å—ï¼Ÿ" class="headerlink" title="8. String str=â€iâ€**ä¸** String str=new String(â€œiâ€)**ä¸€æ ·å—ï¼Ÿ**"></a><strong>8. String str=â€iâ€**</strong>ä¸** <strong>String str=new String(â€œiâ€)**</strong>ä¸€æ ·å—ï¼Ÿ**</h4><p>ä¸ä¸€æ ·ï¼Œå› ä¸ºå†…å­˜çš„åˆ†é…æ–¹å¼ä¸ä¸€æ ·ã€‚String str=â€iâ€çš„æ–¹å¼ï¼ŒJava è™šæ‹Ÿæœºä¼šå°†å…¶åˆ†é…åˆ°å¸¸é‡æ± ä¸­ï¼›è€Œ String str=new String(â€œiâ€) åˆ™ä¼šè¢«åˆ†åˆ°å †å†…å­˜ä¸­ã€‚</p>
<h4 id="9-å¦‚ä½•å°†å­—ç¬¦ä¸²åè½¬ï¼Ÿ"><a href="#9-å¦‚ä½•å°†å­—ç¬¦ä¸²åè½¬ï¼Ÿ" class="headerlink" title="9. å¦‚ä½•å°†å­—ç¬¦ä¸²åè½¬ï¼Ÿ"></a><strong>9.</strong> <strong>å¦‚ä½•å°†å­—ç¬¦ä¸²åè½¬ï¼Ÿ</strong></h4><p>ä½¿ç”¨ StringBuilder æˆ–è€… stringBuffer çš„ reverse() æ–¹æ³•ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// StringBuffer reverse</span></span><br><span class="line"></span><br><span class="line">StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">stringBuffer. append(<span class="string">"abcdefg"</span>);</span><br><span class="line"></span><br><span class="line">System. out. println(stringBuffer. reverse()); <span class="comment">// gfedcba</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// StringBuilder reverse</span></span><br><span class="line"></span><br><span class="line">StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">stringBuilder. append(<span class="string">"abcdefg"</span>);</span><br><span class="line"></span><br><span class="line">System. out. println(stringBuilder. reverse()); <span class="comment">// gfedcba</span></span><br></pre></td></tr></table></figure>

<h4 id="10-String-ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ"><a href="#10-String-ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ" class="headerlink" title="10. String ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ"></a><strong>10. String</strong> <strong>ç±»çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰é‚£äº›ï¼Ÿ</strong></h4><p>Â·    indexOf()ï¼šè¿”å›æŒ‡å®šå­—ç¬¦çš„ç´¢å¼•ã€‚</p>
<p>Â·    charAt()ï¼šè¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å­—ç¬¦ã€‚</p>
<p>Â·    replace()ï¼šå­—ç¬¦ä¸²æ›¿æ¢ã€‚</p>
<p>Â·    trim()ï¼šå»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯ç©ºç™½ã€‚</p>
<p>Â·    split()ï¼šåˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªåˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„ã€‚</p>
<p>Â·    getBytes()ï¼šè¿”å›å­—ç¬¦ä¸²çš„ byte ç±»å‹æ•°ç»„ã€‚</p>
<p>Â·    length()ï¼šè¿”å›å­—ç¬¦ä¸²é•¿åº¦ã€‚</p>
<p>Â·    toLowerCase()ï¼šå°†å­—ç¬¦ä¸²è½¬æˆå°å†™å­—æ¯ã€‚</p>
<p>Â·    toUpperCase()ï¼šå°†å­—ç¬¦ä¸²è½¬æˆå¤§å†™å­—ç¬¦ã€‚</p>
<p>Â·    substring()ï¼šæˆªå–å­—ç¬¦ä¸²ã€‚</p>
<p>Â·    equals()ï¼šå­—ç¬¦ä¸²æ¯”è¾ƒã€‚</p>
<h4 id="11-æŠ½è±¡ç±»å¿…é¡»è¦æœ‰æŠ½è±¡æ–¹æ³•å—ï¼Ÿ"><a href="#11-æŠ½è±¡ç±»å¿…é¡»è¦æœ‰æŠ½è±¡æ–¹æ³•å—ï¼Ÿ" class="headerlink" title="11. æŠ½è±¡ç±»å¿…é¡»è¦æœ‰æŠ½è±¡æ–¹æ³•å—ï¼Ÿ"></a><strong>11.</strong> <strong>æŠ½è±¡ç±»å¿…é¡»è¦æœ‰æŠ½è±¡æ–¹æ³•å—ï¼Ÿ</strong></h4><p>ä¸éœ€è¦ï¼ŒæŠ½è±¡ç±»ä¸ä¸€å®šéè¦æœ‰æŠ½è±¡æ–¹æ³•ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<p>abstract class Cat {</p>
<p>  public static void sayHi() {</p>
<p>â€‹    System. out. println(â€œhi~â€);</p>
<p>  }</p>
<p>}</p>
<p>ä¸Šé¢ä»£ç ï¼ŒæŠ½è±¡ç±»å¹¶æ²¡æœ‰æŠ½è±¡æ–¹æ³•ä½†å®Œå…¨å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p>
<h4 id="12-æ™®é€šç±»å’ŒæŠ½è±¡ç±»æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"><a href="#12-æ™®é€šç±»å’ŒæŠ½è±¡ç±»æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ" class="headerlink" title="12. æ™®é€šç±»å’ŒæŠ½è±¡ç±»æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"></a><strong>12.</strong> <strong>æ™®é€šç±»å’ŒæŠ½è±¡ç±»æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    æ™®é€šç±»ä¸èƒ½åŒ…å«æŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡ç±»å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚</p>
<p>Â·    æŠ½è±¡ç±»ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œæ™®é€šç±»å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ã€‚</p>
<h4 id="13-æŠ½è±¡ç±»èƒ½ä½¿ç”¨-final-ä¿®é¥°å—ï¼Ÿ"><a href="#13-æŠ½è±¡ç±»èƒ½ä½¿ç”¨-final-ä¿®é¥°å—ï¼Ÿ" class="headerlink" title="13. æŠ½è±¡ç±»èƒ½ä½¿ç”¨ final ä¿®é¥°å—ï¼Ÿ"></a><strong>13.</strong> <strong>æŠ½è±¡ç±»èƒ½ä½¿ç”¨</strong> <strong>final</strong> <strong>ä¿®é¥°å—ï¼Ÿ</strong></h4><p>ä¸èƒ½ï¼Œå®šä¹‰æŠ½è±¡ç±»å°±æ˜¯è®©å…¶ä»–ç±»ç»§æ‰¿çš„ï¼Œå¦‚æœå®šä¹‰ä¸º final è¯¥ç±»å°±ä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¿™æ ·å½¼æ­¤å°±ä¼šäº§ç”ŸçŸ›ç›¾ï¼Œæ‰€ä»¥ final ä¸èƒ½ä¿®é¥°æŠ½è±¡ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç¼–è¾‘å™¨ä¹Ÿä¼šæç¤ºé”™è¯¯ä¿¡æ¯ï¼š</p>
<p><img src="/img/loading.gif" class="lazyload" data-src="/2020/07/16/java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%A3%80%E9%AA%8C/img.png"  alt="å›¾1"></p>
<h4 id="14-æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#14-æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="14. æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>14.</strong> <strong>æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    å®ç°ï¼šæŠ½è±¡ç±»çš„å­ç±»ä½¿ç”¨ extends æ¥ç»§æ‰¿ï¼›æ¥å£å¿…é¡»ä½¿ç”¨ implements æ¥å®ç°æ¥å£ã€‚</p>
<p>Â·    æ„é€ å‡½æ•°ï¼šæŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ å‡½æ•°ï¼›æ¥å£ä¸èƒ½æœ‰ã€‚</p>
<p>Â·    å®ç°æ•°é‡ï¼šç±»å¯ä»¥å®ç°å¾ˆå¤šä¸ªæ¥å£ï¼›ä½†æ˜¯åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ã€‚</p>
<p>Â·    è®¿é—®ä¿®é¥°ç¬¦ï¼šæ¥å£ä¸­çš„æ–¹æ³•é»˜è®¤ä½¿ç”¨ public ä¿®é¥°ï¼›æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å¯ä»¥æ˜¯ä»»æ„è®¿é—®ä¿®é¥°ç¬¦ã€‚</p>
<h4 id="15-Java-ä¸­-IO-æµåˆ†ä¸ºå‡ ç§ï¼Ÿ"><a href="#15-Java-ä¸­-IO-æµåˆ†ä¸ºå‡ ç§ï¼Ÿ" class="headerlink" title="15. Java ä¸­ IO æµåˆ†ä¸ºå‡ ç§ï¼Ÿ"></a><strong>15. Java</strong> <strong>ä¸­</strong> <strong>IO</strong> <strong>æµåˆ†ä¸ºå‡ ç§ï¼Ÿ</strong></h4><p>æŒ‰åŠŸèƒ½æ¥åˆ†ï¼šè¾“å…¥æµï¼ˆinputï¼‰ã€è¾“å‡ºæµï¼ˆoutputï¼‰ã€‚</p>
<p>æŒ‰ç±»å‹æ¥åˆ†ï¼šå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚</p>
<p>å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«æ˜¯ï¼šå­—èŠ‚æµæŒ‰ 8 ä½ä¼ è¾“ä»¥å­—èŠ‚ä¸ºå•ä½è¾“å…¥è¾“å‡ºæ•°æ®ï¼Œå­—ç¬¦æµæŒ‰ 16 ä½ä¼ è¾“ä»¥å­—ç¬¦ä¸ºå•ä½è¾“å…¥è¾“å‡ºæ•°æ®ã€‚</p>
<h4 id="16-BIOã€NIOã€AIOæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#16-BIOã€NIOã€AIOæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="16. BIOã€NIOã€AIOæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>16. BIOã€NIOã€AIOæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>Â·    BIOï¼šBlock IO åŒæ­¥é˜»å¡å¼ IOï¼Œå°±æ˜¯æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„ä¼ ç»Ÿ IOï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æ¨¡å¼ç®€å•ä½¿ç”¨æ–¹ä¾¿ï¼Œå¹¶å‘å¤„ç†èƒ½åŠ›ä½ã€‚</p>
<p>Â·    NIOï¼šNon IO åŒæ­¥éé˜»å¡ IOï¼Œæ˜¯ä¼ ç»Ÿ IO çš„å‡çº§ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯é€šè¿‡ Channelï¼ˆé€šé“ï¼‰é€šè®¯ï¼Œå®ç°äº†å¤šè·¯å¤ç”¨ã€‚</p>
<p>Â·    AIOï¼šAsynchronous IO æ˜¯ NIO çš„å‡çº§ï¼Œä¹Ÿå« NIO2ï¼Œå®ç°äº†å¼‚æ­¥éå µå¡ IO ï¼Œå¼‚æ­¥ IO çš„æ“ä½œåŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶ã€‚</p>
<h4 id="17-Files-çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ"><a href="#17-Files-çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="17. Files**çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ**"></a><strong>17. Files**</strong>çš„å¸¸ç”¨æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼Ÿ**</h4><p>Â·    Files. exists()ï¼šæ£€æµ‹æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨ã€‚</p>
<p>Â·    Files. createFile()ï¼šåˆ›å»ºæ–‡ä»¶ã€‚</p>
<p>Â·    Files. createDirectory()ï¼šåˆ›å»ºæ–‡ä»¶å¤¹ã€‚</p>
<p>Â·    Files. delete()ï¼šåˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚</p>
<p>Â·    Files. copy()ï¼šå¤åˆ¶æ–‡ä»¶ã€‚</p>
<p>Â·    Files. move()ï¼šç§»åŠ¨æ–‡ä»¶ã€‚</p>
<p>Â·    Files. size()ï¼šæŸ¥çœ‹æ–‡ä»¶ä¸ªæ•°ã€‚</p>
<p>Â·    Files. read()ï¼šè¯»å–æ–‡ä»¶ã€‚</p>
<p>Â·    Files. write()ï¼šå†™å…¥æ–‡ä»¶ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é¢è¯•é¢˜</tag>
        <tag>åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaè™šæ‹Ÿæœº</title>
    <url>/2020/07/06/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/</url>
    <content><![CDATA[<p><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E8%99%9A%E6%8B%9F%E6%9C%BA.md#%E4%B8%80%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F" target="_blank" rel="noopener">å‚è€ƒè¿æ¥</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/29881777" target="_blank" rel="noopener">JVMæ€»ç»“</a></p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>CASå’ŒSynchronizedçš„åŒºåˆ«</title>
    <url>/2020/07/05/CAS%E5%92%8CSynchronized%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<p><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%B9%B6%E5%8F%91.md" target="_blank" rel="noopener">æ›´å¤šèµ„æº</a>ï¼š<a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%B9%B6%E5%8F%91.md" target="_blank" rel="noopener">https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%B9%B6%E5%8F%91.md</a></p>
<h2 id="ä¸€ã€CAS"><a href="#ä¸€ã€CAS" class="headerlink" title="ä¸€ã€CAS"></a>ä¸€ã€CAS</h2><h3 id="æ¦‚å¿µï¼š"><a href="#æ¦‚å¿µï¼š" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h3><p> CASï¼ˆCompare And Swap ) æˆ–ï¼ˆ Compare-and-Set ï¼‰æ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œæ˜¯ä¸€ç§è½»é‡çº§é”ã€‚JAVA1.5å¼€å§‹å¼•å…¥äº†CASï¼ŒJUCä¸‹å¾ˆå¤šå·¥å…·ç±»éƒ½æ˜¯åŸºäºCASã€‚ </p>
<h3 id="CASçš„å®ç°æ–¹å¼"><a href="#CASçš„å®ç°æ–¹å¼" class="headerlink" title="CASçš„å®ç°æ–¹å¼:"></a><strong>CASçš„å®ç°æ–¹å¼:</strong></h3><p> CASæœ‰3ä¸ªæ“ä½œæ•°ï¼Œå†…å­˜å€¼Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚å½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸ºBï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶å°è¯•ä½¿ç”¨CASæ›´æ–°ä¸€ä¸ªå˜é‡æ—¶ï¼Œä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ›´æ–°æˆåŠŸï¼Œè‹¥æ›´æ–°å¤±è´¥ï¼Œçº¿ç¨‹ä¼šé‡æ–°è¿›å…¥å¾ªç¯å†æ¬¡è¿›è¡Œå°è¯•ã€‚ </p>
<h3 id="CASå¸¦æ¥çš„é—®é¢˜"><a href="#CASå¸¦æ¥çš„é—®é¢˜" class="headerlink" title="CASå¸¦æ¥çš„é—®é¢˜"></a>CASå¸¦æ¥çš„é—®é¢˜</h3><h4 id="ABAé—®é¢˜-ï¼š"><a href="#ABAé—®é¢˜-ï¼š" class="headerlink" title="ABAé—®é¢˜ ï¼š"></a><strong>ABAé—®é¢˜</strong> ï¼š</h4><p>ABAé—®é¢˜æ˜¯æŒ‡åœ¨CASæ“ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°†å˜é‡å€¼Aæ”¹ä¸ºäº†Bï¼Œä½†æ˜¯åˆè¢«æ”¹å›äº†Aï¼Œç­‰åˆ°æœ¬çº¿ç¨‹ä½¿ç”¨æœŸæœ›å€¼Aä¸å½“å‰å˜é‡è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œå‘ç°å˜é‡Aæ²¡æœ‰å˜ï¼Œäºæ˜¯CASå°±å°†Aå€¼è¿›è¡Œäº†äº¤æ¢æ“ä½œï¼Œä½†æ˜¯å®é™…ä¸Šè¯¥å€¼å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ”¹å˜è¿‡ï¼Œè¿™ä¸ä¹è§‚é”çš„è®¾è®¡æ€æƒ³ä¸ç¬¦åˆã€‚ABAé—®é¢˜çš„è§£å†³æ€è·¯æ˜¯ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™æŠŠå˜é‡çš„ç‰ˆæœ¬å·åŠ 1ï¼Œé‚£ä¹ˆA-B-Aå°±ä¼šå˜æˆA1-B2-A3ï¼Œåªè¦å˜é‡è¢«æŸä¸€çº¿ç¨‹ä¿®æ”¹è¿‡ï¼Œæ”¹å˜é‡å¯¹åº”çš„ç‰ˆæœ¬å·å°±ä¼šå‘ç”Ÿé€’å¢å˜åŒ–ï¼Œä»è€Œè§£å†³äº†ABAé—®é¢˜ã€‚åœ¨JDKçš„java.util.concurrent.atomicåŒ…ä¸­æä¾›äº†AtomicStampedReferenceæ¥è§£å†³ABAé—®é¢˜ï¼Œè¯¥ç±»çš„compareAndSetæ˜¯è¯¥ç±»çš„æ ¸å¿ƒæ–¹æ³•ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(V   expectedReference,</span></span></span><br><span class="line"><span class="function"><span class="params">                            V   newReference,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="keyword">int</span> expectedStamp,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="keyword">int</span> newStamp)</span> </span>&#123;</span><br><span class="line">   Pair&lt;V&gt; current = pair;</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">       expectedReference == current.reference &amp;&amp;</span><br><span class="line">       expectedStamp == current.stamp &amp;&amp;</span><br><span class="line">       ((newReference == current.reference &amp;&amp;</span><br><span class="line">         newStamp == current.stamp) ||</span><br><span class="line">        casPair(current, Pair.of(newReference, newStamp)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¯¥ç±»æ£€æŸ¥äº†å½“å‰å¼•ç”¨ä¸å½“å‰æ ‡å¿—æ˜¯å¦ä¸é¢„æœŸç›¸åŒï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œæ‰ä¼šä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ä¸ºæ–°çš„æ›´æ–°å€¼ï¼Œè¿™æ ·CASæ“ä½œä¸­çš„æ¯”è¾ƒå°±ä¸ä¾èµ–äºå˜é‡çš„å€¼äº†ã€‚</p>
<h2 id="äºŒã€synchronized"><a href="#äºŒã€synchronized" class="headerlink" title="äºŒã€synchronized"></a>äºŒã€synchronized</h2><p>ç›¸æ¯”äºCASåŸºäºä¹è§‚é”å®ç°ï¼Œsynchronizedæ˜¯åŸºäºæ‚²è§‚é”çš„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è®¿é—®åŒæ­¥ä»£ç å—æ—¶ï¼Œå®ƒé¦–å…ˆå¿…é¡»å¾—åˆ°é”ï¼Œé€€å‡ºæˆ–æŠ›å‡ºå¼‚å¸¸æ—¶å¿…é¡»é‡Šæ”¾é”ã€‚</p>
<ul>
<li>å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•åŠ é”æ—¶ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡</li>
<li>å¯¹äºé™æ€åŒæ­¥æ–¹æ³•åŠ é”æ—¶ï¼Œé”æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡</li>
<li>å¯¹äºåŒæ­¥æ–¹æ³•å—åŠ é”æ—¶ï¼Œé”æ˜¯Synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡</li>
</ul>
<h3 id="Synchronizedçš„å®ç°æ–¹å¼ï¼š"><a href="#Synchronizedçš„å®ç°æ–¹å¼ï¼š" class="headerlink" title="Synchronizedçš„å®ç°æ–¹å¼ï¼š"></a><strong>Synchronizedçš„å®ç°æ–¹å¼ï¼š</strong></h3><p>Synchonizedæ˜¯åŸºäºè¿›å…¥å’Œé€€å‡ºMonitorå¯¹è±¡æ¥å®ç°æ–¹æ³•åŒæ­¥å’Œä»£ç å—åŒæ­¥ï¼Œä½†ä¸¤è€…çš„å®ç°ç»†èŠ‚ä¸ä¸€æ ·ã€‚Synchronized ç”¨åœ¨æ–¹æ³•ä¸Šæ—¶ï¼Œåœ¨å­—èŠ‚ç ä¸­æ˜¯é€šè¿‡æ–¹æ³•çš„ ACC_SYNCHRONIZED æ ‡å¿—æ¥å®ç°çš„ã€‚è€Œä»£ç å—åŒæ­¥åˆ™æ˜¯ä½¿ç”¨monitorenterå’ŒmonitorexitæŒ‡ä»¤å®ç°çš„ã€‚</p>
<p>monitorenteræŒ‡ä»¤æ˜¯åœ¨ç¼–è¯‘åæ’å…¥åˆ°åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œè€Œmonitorexitæ˜¯æ’å…¥åˆ°æ–¹æ³•ç»“æŸå¤„å’Œå¼‚å¸¸å¤„ï¼ŒJVMè¦ä¿è¯æ¯ä¸ªmonitorenterå¿…é¡»æœ‰å¯¹åº”çš„monitorexitä¸ä¹‹é…å¯¹ã€‚ä»»ä½•å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªmonitorä¸ä¹‹å…³è”ï¼Œå½“ä¸”ä¸€ä¸ªmonitorè¢«æŒæœ‰åï¼Œå®ƒå°†å¤„äºé”å®šçŠ¶æ€ã€‚çº¿ç¨‹æ‰§è¡Œåˆ°monitorenteræŒ‡ä»¤æ—¶ï¼Œå°†ä¼šå°è¯•è·å–å¯¹è±¡æ‰€å¯¹åº”çš„monitorçš„æ‰€æœ‰æƒï¼Œå³å°è¯•è·å¾—å¯¹è±¡çš„é”ï¼Œå½“è·å¾—å¯¹è±¡çš„monitorä»¥åï¼Œmonitorå†…éƒ¨çš„è®¡æ•°å™¨å°±ä¼šè‡ªå¢ï¼ˆåˆå§‹ä¸º0ï¼‰ï¼Œå½“åŒä¸€ä¸ªçº¿ç¨‹å†æ¬¡è·å¾—monitorçš„æ—¶å€™ï¼Œè®¡æ•°å™¨ä¼šå†æ¬¡è‡ªå¢ã€‚å½“åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒmonitorexitæŒ‡ä»¤çš„æ—¶å€™ï¼Œè®¡æ•°å™¨ä¼šè¿›è¡Œè‡ªå‡ï¼Œå½“è®¡æ•°å™¨ä¸º0çš„æ—¶å€™ï¼Œmonitorå°±ä¼šè¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹ä¾¿å¯ä»¥è·å¾—monitorã€‚</p>
<h3 id="Synchronizedçš„ä¼˜åŒ–ï¼š"><a href="#Synchronizedçš„ä¼˜åŒ–ï¼š" class="headerlink" title="Synchronizedçš„ä¼˜åŒ–ï¼š"></a><strong>Synchronizedçš„ä¼˜åŒ–ï¼š</strong></h3><p>Java SE 1.6ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ï¼Œåœ¨Java SE 1.6ä¸­ï¼Œé”ä¸€å…±æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€å’Œé‡é‡çº§é”çŠ¶æ€ã€‚</p>
<h4 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a><strong>åå‘é”</strong></h4><p>HotSpotçš„ä½œè€…ç»è¿‡ç ”ç©¶å‘ç°ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ã€‚åå‘é”æ˜¯ä¸ºäº†åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥å—æ—¶æé«˜æ€§èƒ½ã€‚</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡ŒCASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€ç®€å•åœ°æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤ï¼ˆç”±äºä¸€æ—¦å‡ºç°å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µå°±å¿…é¡»æ’¤é”€åå‘é”ï¼Œæ‰€ä»¥åå‘é”çš„æ’¤é”€æ“ä½œçš„æ€§èƒ½æŸè€—å¿…é¡»å°äºèŠ‚çœä¸‹æ¥çš„CASåŸå­æŒ‡ä»¤çš„æ€§èƒ½æ¶ˆè€—ï¼‰ã€‚</p>
<p><strong>åå‘é”è·å–è¿‡ç¨‹ï¼š</strong></p>
<ul>
<li>ï¼ˆ1ï¼‰è®¿é—®Mark Wordä¸­åå‘é”çš„æ ‡è¯†æ˜¯å¦è®¾ç½®æˆ1ï¼Œé”æ ‡å¿—ä½æ˜¯å¦ä¸º01â€”â€”ç¡®è®¤ä¸ºå¯åå‘çŠ¶æ€ã€‚</li>
<li>ï¼ˆ2ï¼‰å¦‚æœä¸ºå¯åå‘çŠ¶æ€ï¼Œåˆ™æµ‹è¯•çº¿ç¨‹IDæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œè¿›å…¥æ­¥éª¤ï¼ˆ5ï¼‰ï¼Œå¦åˆ™è¿›å…¥æ­¥éª¤ï¼ˆ3ï¼‰ã€‚</li>
<li>ï¼ˆ3ï¼‰å¦‚æœçº¿ç¨‹IDå¹¶æœªæŒ‡å‘å½“å‰çº¿ç¨‹ï¼Œåˆ™é€šè¿‡CASæ“ä½œç«äº‰é”ã€‚å¦‚æœç«äº‰æˆåŠŸï¼Œåˆ™å°†Mark Wordä¸­çº¿ç¨‹IDè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹IDï¼Œç„¶åæ‰§è¡Œï¼ˆ5ï¼‰ï¼›å¦‚æœç«äº‰å¤±è´¥ï¼Œæ‰§è¡Œï¼ˆ4ï¼‰ã€‚</li>
<li>ï¼ˆ4ï¼‰å¦‚æœCASè·å–åå‘é”å¤±è´¥ï¼Œåˆ™è¡¨ç¤ºæœ‰ç«äº‰ï¼ˆCASè·å–åå‘é”å¤±è´¥è¯´æ˜è‡³å°‘æœ‰è¿‡å…¶ä»–çº¿ç¨‹æ›¾ç»è·å¾—è¿‡åå‘é”ï¼Œå› ä¸ºçº¿ç¨‹ä¸ä¼šä¸»åŠ¨å»é‡Šæ”¾åå‘é”ï¼‰ã€‚å½“åˆ°è¾¾å…¨å±€å®‰å…¨ç‚¹ï¼ˆsafepointï¼‰æ—¶ï¼Œä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œç„¶åæ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦æ´»ç€ï¼ˆå› ä¸ºå¯èƒ½æŒæœ‰åå‘é”çš„çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œä½†æ˜¯è¯¥çº¿ç¨‹å¹¶ä¸ä¼šä¸»åŠ¨å»é‡Šæ”¾åå‘é”ï¼‰ï¼Œå¦‚æœçº¿ç¨‹ä¸å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™å°†å¯¹è±¡å¤´è®¾ç½®æˆæ— é”çŠ¶æ€ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰ï¼Œç„¶åé‡æ–°åå‘æ–°çš„çº¿ç¨‹ï¼›å¦‚æœçº¿ç¨‹ä»ç„¶æ´»ç€ï¼Œæ’¤é”€åå‘é”åå‡çº§åˆ°è½»é‡çº§é”çŠ¶æ€ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰ï¼Œæ­¤æ—¶è½»é‡çº§é”ç”±åŸæŒæœ‰åå‘é”çš„çº¿ç¨‹æŒæœ‰ï¼Œç»§ç»­æ‰§è¡Œå…¶åŒæ­¥ä»£ç ï¼Œè€Œæ­£åœ¨ç«äº‰çš„çº¿ç¨‹ä¼šè¿›å…¥è‡ªæ—‹ç­‰å¾…è·å¾—è¯¥è½»é‡çº§é”ã€‚</li>
<li>ï¼ˆ5ï¼‰æ‰§è¡ŒåŒæ­¥ä»£ç ã€‚</li>
</ul>
<p><strong>åå‘é”çš„é‡Šæ”¾è¿‡ç¨‹ï¼š</strong></p>
<p>å¦‚ä¸Šæ­¥éª¤ï¼ˆ4ï¼‰ã€‚åå‘é”ä½¿ç”¨äº†ä¸€ç§ç­‰åˆ°ç«äº‰å‡ºç°æ‰é‡Šæ”¾åå‘é”çš„æœºåˆ¶ï¼šåå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨å»é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ï¼Œæ’¤é”€åå‘é”åæ¢å¤åˆ°æœªé”å®šï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚</p>
<p><strong>å…³é—­åå‘é”ï¼š</strong></p>
<p>åå‘é”åœ¨Java 6å’ŒJava 7é‡Œæ˜¯é»˜è®¤å¯ç”¨çš„ã€‚ç”±äºåå‘é”æ˜¯ä¸ºäº†åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥å—æ—¶æé«˜æ€§èƒ½ï¼Œå¦‚æœä½ ç¡®å®šåº”ç”¨ç¨‹åºé‡Œæ‰€æœ‰çš„é”é€šå¸¸æƒ…å†µä¸‹å¤„äºç«äº‰çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š-XX:-UseBiasedLocking=falseï¼Œé‚£ä¹ˆç¨‹åºé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚</p>
<h4 id="è½»é‡çº§é”ï¼š"><a href="#è½»é‡çº§é”ï¼š" class="headerlink" title="è½»é‡çº§é”ï¼š"></a><strong>è½»é‡çº§é”ï¼š</strong></h4><p>çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVMä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆæ¡¢ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ç„¶åçº¿ç¨‹å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´ä¸­çš„Mark Wordæ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚</p>
<h4 id="é‡é‡çº§é”ï¼š"><a href="#é‡é‡çº§é”ï¼š" class="headerlink" title="é‡é‡çº§é”ï¼š"></a><strong>é‡é‡çº§é”ï¼š</strong></h4><p>é‡é‡çº§é”æ˜¯ä¾èµ–å¯¹è±¡å†…éƒ¨çš„monitoré”æ¥å®ç°ã€‚å½“ç³»ç»Ÿæ£€æŸ¥åˆ°é”æ˜¯é‡é‡çº§é”ä¹‹åï¼Œä¼šæŠŠç­‰å¾…æƒ³è¦è·å¾—é”çš„çº¿ç¨‹è¿›è¡Œé˜»å¡ï¼Œè¢«é˜»å¡çš„çº¿ç¨‹ä¸ä¼šæ¶ˆè€—cupã€‚ä½†æ˜¯é˜»å¡æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿæ¥å¸®å¿™ï¼Œéœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè€Œè½¬æ¢çŠ¶æ€æ˜¯éœ€è¦æ¶ˆè€—å¾ˆå¤šæ—¶é—´ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>é”</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¹å™¨å°è®°</title>
    <url>/2020/07/04/%E5%AE%B9%E5%99%A8%E5%B0%8F%E8%AE%B0/</url>
    <content><![CDATA[<h5 id="å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼ï¼š"><a href="#å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼ï¼š" class="headerlink" title="å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼ï¼š"></a>å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼ï¼š</h5><ol>
<li>è¿­ä»£å™¨æ¨¡å¼ï¼›[ä¾‹å­ï¼šå®¹å™¨å¾ªç¯æ‰€ä½¿ç”¨çš„ Iterator è¿­ä»£å™¨]</li>
<li>è®¾é…å™¨æ¨¡å¼ï¼šç®€å•çš„è¯´å°±æ˜¯å°†åŸæœ¬ä¸¤ä¸ªä¸ç›¸å¹²çš„ç±»è”ç³»èµ·æ¥ï¼ˆç±»ä¼¼äºå……ç”µå™¨ï¼Œè¿æ¥æ’åº§å’Œç”¨ç”µå™¨ï¼Œå°†ç”µå‹å˜æˆç”µå™¨åŒ¹é…çš„é‡çº§ï¼‰ï¼›[ä¾‹å­ï¼šArrays.asList() å°†æ•°ç»„è½¬æ¢æˆList]</li>
</ol>
<h5 id="é»˜è®¤é•¿åº¦-amp-æ‰©å®¹å¤§å°ï¼š"><a href="#é»˜è®¤é•¿åº¦-amp-æ‰©å®¹å¤§å°ï¼š" class="headerlink" title="é»˜è®¤é•¿åº¦ &amp; æ‰©å®¹å¤§å°ï¼š"></a>é»˜è®¤é•¿åº¦ &amp; æ‰©å®¹å¤§å°ï¼š</h5><ol>
<li>List</li>
</ol>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">é»˜è®¤å¤§å°</th>
<th>é»˜è®¤æ‰©å®¹</th>
<th align="center">å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ArrayList</td>
<td align="center">10</td>
<td>åŸæ¥çš„1.5å€</td>
<td align="center">ç”±æ•°ç»„å®ç°ï¼Œå› æ­¤æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼›æ‰©å®¹æ“ä½œéœ€è¦å°†åŸæ•°ç»„æ•´ä¸ªå¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ï¼Œä»£ä»·å¾ˆé«˜ï¼›åˆ é™¤å…ƒç´ æ˜¯å°†åˆ é™¤indexåçš„å…ƒç´ å¤åˆ¶åˆ°indexçš„ä½ç½®ï¼Œä»£ä»·å¾ˆé«˜ï¼›</td>
</tr>
<tr>
<td align="center">Vector</td>
<td align="center"></td>
<td>åŸæ¥çš„2å€</td>
<td align="center">ä¸ArrayListç›¸ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨äº†synchronizedè¿›è¡ŒåŒæ­¥ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„</td>
</tr>
</tbody></table>
<h5 id="å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹-å®‰å…¨çš„ArrayListæ›¿ä»£æ–¹æ¡ˆï¼š"><a href="#å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹-å®‰å…¨çš„ArrayListæ›¿ä»£æ–¹æ¡ˆï¼š" class="headerlink" title="å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹ å®‰å…¨çš„ArrayListæ›¿ä»£æ–¹æ¡ˆï¼š"></a>å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹ å®‰å…¨çš„ArrayListæ›¿ä»£æ–¹æ¡ˆï¼š</h5><p>  â‘    Collections.synchronizedList() </p>
<p>  â‘¡   concurrent å¹¶å‘åŒ…ä¸‹çš„ CopyOnWriteArrayList ç±»</p>
<h4 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList :"></a>CopyOnWriteArrayList :</h4><ol>
<li><p>å†™æ“ä½œåœ¨ä¸€ä¸ªå¤åˆ¶çš„æ•°ç»„ä¸Šè¿›è¡Œï¼Œè¯»æ“ä½œè¿˜æ˜¯åœ¨åŸå§‹æ•°ç»„ä¸­è¿›è¡Œï¼Œè¯»å†™åˆ†ç¦»ï¼Œäº’ä¸å½±å“ã€‚  å†™æ“ä½œéœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘å†™å…¥æ—¶å¯¼è‡´å†™å…¥æ•°æ®ä¸¢å¤±ã€‚  å†™æ“ä½œç»“æŸä¹‹åéœ€è¦æŠŠåŸå§‹æ•°ç»„æŒ‡å‘æ–°çš„å¤åˆ¶æ•°ç»„ã€‚ </p>
</li>
<li><p>é€‚ç”¨åœºæ™¯ï¼šCopyOnWriteArrayList åœ¨å†™æ“ä½œçš„åŒæ—¶å…è®¸è¯»æ“ä½œï¼Œå¤§å¤§æé«˜äº†è¯»æ“ä½œçš„æ€§èƒ½ï¼Œå› æ­¤å¾ˆé€‚åˆè¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ã€‚</p>
<p>ä½†æ˜¯ CopyOnWriteArrayList æœ‰å…¶ç¼ºé™·ï¼š</p>
<ul>
<li>å†…å­˜å ç”¨ï¼šåœ¨å†™æ“ä½œæ—¶éœ€è¦å¤åˆ¶ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œä½¿å¾—å†…å­˜å ç”¨ä¸ºåŸæ¥çš„ä¸¤å€å·¦å³ï¼›</li>
<li>æ•°æ®ä¸ä¸€è‡´ï¼šè¯»æ“ä½œä¸èƒ½è¯»å–å®æ—¶æ€§çš„æ•°æ®ï¼Œå› ä¸ºéƒ¨åˆ†å†™æ“ä½œçš„æ•°æ®è¿˜æœªåŒæ­¥åˆ°è¯»æ•°ç»„ä¸­ã€‚</li>
</ul>
<p>æ‰€ä»¥ CopyOnWriteArrayList ä¸é€‚åˆå†…å­˜æ•æ„Ÿä»¥åŠå¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ã€‚</p>
</li>
</ol>
<h4 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList:"></a>LinkedList:</h4><p> åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œä½¿ç”¨ Node å­˜å‚¨é“¾è¡¨èŠ‚ç‚¹ä¿¡æ¯ã€‚ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line">    Node&lt;E&gt; prev;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é“¾è¡¨ä¸æ”¯æŒéšæœºè®¿é—®ï¼Œä½†æ’å…¥åˆ é™¤åªéœ€è¦æ”¹å˜æŒ‡é’ˆã€‚</p>
<h4 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap:"></a>HashMap:</h4><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>capacity</td>
<td>table çš„å®¹é‡å¤§å°ï¼Œé»˜è®¤ä¸º 16ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ capacity å¿…é¡»ä¿è¯ä¸º 2 çš„ n æ¬¡æ–¹ã€‚</td>
</tr>
<tr>
<td>size</td>
<td>é”®å€¼å¯¹æ•°é‡ã€‚</td>
</tr>
<tr>
<td>threshold</td>
<td>size çš„ä¸´ç•Œå€¼ï¼Œå½“ size å¤§äºç­‰äº threshold å°±å¿…é¡»è¿›è¡Œæ‰©å®¹æ“ä½œã€‚</td>
</tr>
<tr>
<td>loadFactor</td>
<td>è£…è½½å› å­ï¼Œtable èƒ½å¤Ÿä½¿ç”¨çš„æ¯”ä¾‹ï¼Œthreshold = (int)(capacity* loadFactor)ã€‚</td>
</tr>
</tbody></table>
<p><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%AE%B9%E5%99%A8.md" target="_blank" rel="noopener">https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%AE%B9%E5%99%A8.md</a> (æºç åˆ†æï¼š1.7ä¸ºä¸»)</p>
<p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/collection/HashMap.md" target="_blank" rel="noopener">https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/collection/HashMap.md</a> ï¼ˆè¯¦ç»†è®²è§£ï¼‰</p>
<p> ä» JDK 1.8 å¼€å§‹ï¼Œä¸€ä¸ªæ¡¶å­˜å‚¨çš„é“¾è¡¨é•¿åº¦å¤§äºç­‰äº 8 æ—¶ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ </p>
<p><strong>è¿™é‡Œéœ€è¦æ³¨æ„ï¼š1.7  putæ–¹æ³•åœ¨é“¾è¡¨ä¸­é‡‡ç”¨å¤´æ’æ³•ï¼Œå³å½“æ•°ç»„ä½ç½®ç›¸åŒï¼Œè€Œkeyä¸åŒï¼Œå°±åœ¨è¿™ä¸ªé“¾è¡¨çš„å¤´éƒ¨æ’å…¥è¯¥å…ƒç´ ï¼›1.8ä¸­åˆ™æ˜¯åœ¨é“¾è¡¨å°¾éƒ¨æ’å…¥</strong></p>
<blockquote>
<p> ä¸ºä»€ä¹ˆè¦ä»å¤´æ’æ³•æ”¹æˆå°¾æ’æ³•ï¼Ÿ </p>
<p>A.å› ä¸ºå¤´æ’æ³•ä¼šé€ æˆæ­»é“¾ï¼Œå‚è€ƒé“¾æ¥<a href="https://blog.csdn.net/chenyiminnanjing/article/details/82706942" target="_blank" rel="noopener">https://blog.csdn.net/chenyiminnanjing/article/details/82706942</a><br>B.JDK7ç”¨å¤´æ’æ˜¯è€ƒè™‘åˆ°äº†ä¸€ä¸ªæ‰€è°“çš„çƒ­ç‚¹æ•°æ®çš„ç‚¹(æ–°æ’å…¥çš„æ•°æ®å¯èƒ½ä¼šæ›´æ—©ç”¨åˆ°)ï¼Œä½†è¿™å…¶å®æ˜¯ä¸ªä¼ªå‘½é¢˜,å› ä¸ºJDK7ä¸­rehashçš„æ—¶å€™ï¼Œæ—§é“¾è¡¨è¿ç§»æ–°é“¾è¡¨çš„æ—¶å€™ï¼Œå¦‚æœåœ¨æ–°è¡¨çš„æ•°ç»„ç´¢å¼•ä½ç½®ç›¸åŒï¼Œåˆ™é“¾è¡¨å…ƒç´ ä¼šå€’ç½®(å°±æ˜¯å› ä¸ºå¤´æ’) æ‰€ä»¥æœ€åçš„ç»“æœ è¿˜æ˜¯æ‰“ä¹±äº†æ’å…¥çš„é¡ºåº æ‰€ä»¥æ€»çš„æ¥çœ‹æ”¯æ’‘JDK7ä½¿ç”¨å¤´æ’çš„è¿™ç‚¹åŸå› ä¹Ÿä¸è¶³ä»¥æ”¯æ’‘ä¸‹å»äº† æ‰€ä»¥å°±å¹²è„†æ¢æˆå°¾æ’ ä¸€ä¸¾å¤šå¾—</p>
</blockquote>
<h6 id="ä¸-Hashtable-çš„æ¯”è¾ƒ"><a href="#ä¸-Hashtable-çš„æ¯”è¾ƒ" class="headerlink" title="ä¸ Hashtable çš„æ¯”è¾ƒ"></a>ä¸ Hashtable çš„æ¯”è¾ƒ</h6><ul>
<li>Hashtable ä½¿ç”¨ synchronized æ¥è¿›è¡ŒåŒæ­¥ã€‚</li>
<li>HashMap å¯ä»¥æ’å…¥é”®ä¸º null çš„ Entryã€‚</li>
<li>HashMap çš„è¿­ä»£å™¨æ˜¯ fail-fast è¿­ä»£å™¨ã€‚</li>
<li>HashMap ä¸èƒ½ä¿è¯éšç€æ—¶é—´çš„æ¨ç§» Map ä¸­çš„å…ƒç´ æ¬¡åºæ˜¯ä¸å˜çš„ã€‚</li>
</ul>
<h4 id="ConcurrentHashMapï¼š"><a href="#ConcurrentHashMapï¼š" class="headerlink" title="ConcurrentHashMapï¼š"></a>ConcurrentHashMapï¼š</h4><h6 id="å­˜å‚¨ç»“æ„"><a href="#å­˜å‚¨ç»“æ„" class="headerlink" title="å­˜å‚¨ç»“æ„"></a>å­˜å‚¨ç»“æ„</h6><p><a href="https://mp.weixin.qq.com/s/AHWzboztt53ZfFZmsSnMSw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/AHWzboztt53ZfFZmsSnMSw</a> ï¼ˆè¯¦ç»†è®²è§£ï¼‰</p>
<p>Java7 ä¸­ ConcruuentHashMap ä½¿ç”¨çš„åˆ†æ®µé”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ª Segment ä¸ŠåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ“ä½œï¼Œæ¯ä¸€ä¸ª Segment éƒ½æ˜¯ä¸€ä¸ªç±»ä¼¼ HashMap æ•°ç»„çš„ç»“æ„ï¼Œå®ƒå¯ä»¥æ‰©å®¹ï¼Œå®ƒçš„å†²çªä¼šè½¬åŒ–ä¸ºé“¾è¡¨ã€‚ä½†æ˜¯ Segment çš„ä¸ªæ•°ä¸€ä½†åˆå§‹åŒ–å°±ä¸èƒ½æ”¹å˜ã€‚</p>
<p> Segment ç»§æ‰¿è‡ª ReentrantLockã€‚ </p>
<p>Java8 ä¸­çš„ ConcruuentHashMap ä½¿ç”¨çš„ Synchronized é”åŠ  CAS çš„æœºåˆ¶ã€‚ç»“æ„ä¹Ÿç”± Java7 ä¸­çš„ <strong>Segment æ•°ç»„ + HashEntry æ•°ç»„ + é“¾è¡¨</strong> è¿›åŒ–æˆäº† <strong>Node æ•°ç»„ + é“¾è¡¨ / çº¢é»‘æ ‘</strong>ï¼ŒNode æ˜¯ç±»ä¼¼äºä¸€ä¸ª HashEntry çš„ç»“æ„ã€‚å®ƒçš„å†²çªå†è¾¾åˆ°ä¸€å®šå¤§å°æ—¶ä¼šè½¬åŒ–æˆçº¢é»‘æ ‘ï¼Œåœ¨å†²çªå°äºä¸€å®šæ•°é‡æ—¶åˆé€€å›é“¾è¡¨ã€‚</p>
<p>JDK8ä¹‹åï¼ŒConcurrentHashMapèˆå¼ƒäº†ReentrantLockï¼Œè€Œé‡æ–°ä½¿ç”¨äº†synchronizedã€‚å…¶åŸå› å¤§è‡´æœ‰ä¸€ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>åŠ å…¥å¤šä¸ªåˆ†æ®µé”æµªè´¹å†…å­˜ç©ºé—´ã€‚</li>
<li>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œ map åœ¨æ”¾å…¥æ—¶ç«äº‰åŒä¸€ä¸ªé”çš„æ¦‚ç‡éå¸¸å°ï¼Œåˆ†æ®µé”åè€Œä¼šé€ æˆæ›´æ–°ç­‰æ“ä½œçš„é•¿æ—¶é—´ç­‰å¾…ã€‚</li>
<li>ä¸ºäº†æé«˜ GC çš„æ•ˆç‡</li>
</ol>
<p>æ–°çš„ConcurrentHashMapä¸­ä½¿ç”¨synchronizedå…³é”®å­—+CASæ“ä½œä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼›è¯¦ç»†ä¿¡æ¯ <a href="https://my.oschina.net/pingpangkuangmo/blog/817973#h2_12" target="_blank" rel="noopener">https://my.oschina.net/pingpangkuangmo/blog/817973#h2_12</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Segment</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">ReentrantLock</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">2249069246763182397L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SCAN_RETRIES =</span><br><span class="line">        Runtime.getRuntime().availableProcessors() &gt; <span class="number">1</span> ? <span class="number">64</span> : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> HashEntry&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> é»˜è®¤çš„å¹¶å‘çº§åˆ«ä¸º 16ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤åˆ›å»º 16 ä¸ª Segmentã€‚ </p>
<h6 id="size-æ“ä½œ"><a href="#size-æ“ä½œ" class="headerlink" title="size æ“ä½œ"></a>size æ“ä½œ</h6><p>æ¯ä¸ª Segment ç»´æŠ¤äº†ä¸€ä¸ª count å˜é‡æ¥ç»Ÿè®¡è¯¥ Segment ä¸­çš„é”®å€¼å¯¹ä¸ªæ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The number of elements. Accessed only either within locks</span></span><br><span class="line"><span class="comment"> * or among other volatile reads that maintain visibility.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> count;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ‰§è¡Œ size æ“ä½œæ—¶ï¼Œéœ€è¦éå†æ‰€æœ‰ Segment ç„¶åæŠŠ count ç´¯è®¡èµ·æ¥ã€‚</p>
<p>ConcurrentHashMap åœ¨æ‰§è¡Œ size æ“ä½œæ—¶å…ˆå°è¯•ä¸åŠ é”ï¼Œå¦‚æœè¿ç»­ä¸¤æ¬¡ä¸åŠ é”æ“ä½œå¾—åˆ°çš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¿™ä¸ªç»“æœæ˜¯æ­£ç¡®çš„ã€‚</p>
<p>å°è¯•æ¬¡æ•°ä½¿ç”¨ RETRIES_BEFORE_LOCK å®šä¹‰ï¼Œè¯¥å€¼ä¸º 2ï¼Œretries åˆå§‹å€¼ä¸º -1ï¼Œå› æ­¤å°è¯•æ¬¡æ•°ä¸º 3ã€‚</p>
<p>å¦‚æœå°è¯•çš„æ¬¡æ•°è¶…è¿‡ 3 æ¬¡ï¼Œå°±éœ€è¦å¯¹æ¯ä¸ª Segment åŠ é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Number of unsynchronized retries in size and containsValue</span></span><br><span class="line"><span class="comment"> * methods before resorting to locking. This is used to avoid</span></span><br><span class="line"><span class="comment"> * unbounded retries if tables undergo continuous modification</span></span><br><span class="line"><span class="comment"> * which would make it impossible to obtain an accurate result.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RETRIES_BEFORE_LOCK = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Try a few times to get accurate count. On failure due to</span></span><br><span class="line">    <span class="comment">// continuous async changes in table, resort to locking.</span></span><br><span class="line">    <span class="keyword">final</span> Segment&lt;K,V&gt;[] segments = <span class="keyword">this</span>.segments;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">boolean</span> overflow; <span class="comment">// true if size overflows 32 bits</span></span><br><span class="line">    <span class="keyword">long</span> sum;         <span class="comment">// sum of modCounts</span></span><br><span class="line">    <span class="keyword">long</span> last = <span class="number">0L</span>;   <span class="comment">// previous sum</span></span><br><span class="line">    <span class="keyword">int</span> retries = -<span class="number">1</span>; <span class="comment">// first iteration isn't retry</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="comment">// è¶…è¿‡å°è¯•æ¬¡æ•°ï¼Œåˆ™å¯¹æ¯ä¸ª Segment åŠ é”</span></span><br><span class="line">            <span class="keyword">if</span> (retries++ == RETRIES_BEFORE_LOCK) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; segments.length; ++j)</span><br><span class="line">                    ensureSegment(j).lock(); <span class="comment">// force creation</span></span><br><span class="line">            &#125;</span><br><span class="line">            sum = <span class="number">0L</span>;</span><br><span class="line">            size = <span class="number">0</span>;</span><br><span class="line">            overflow = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; segments.length; ++j) &#123;</span><br><span class="line">                Segment&lt;K,V&gt; seg = segmentAt(segments, j);</span><br><span class="line">                <span class="keyword">if</span> (seg != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    sum += seg.modCount;</span><br><span class="line">                    <span class="keyword">int</span> c = seg.count;</span><br><span class="line">                    <span class="keyword">if</span> (c &lt; <span class="number">0</span> || (size += c) &lt; <span class="number">0</span>)</span><br><span class="line">                        overflow = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è¿ç»­ä¸¤æ¬¡å¾—åˆ°çš„ç»“æœä¸€è‡´ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªç»“æœæ˜¯æ­£ç¡®çš„</span></span><br><span class="line">            <span class="keyword">if</span> (sum == last)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            last = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (retries &gt; RETRIES_BEFORE_LOCK) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; segments.length; ++j)</span><br><span class="line">                segmentAt(segments, j).unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> overflow ? Integer.MAX_VALUE : size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="JDK-1-8-çš„æ”¹åŠ¨"><a href="#JDK-1-8-çš„æ”¹åŠ¨" class="headerlink" title="JDK 1.8 çš„æ”¹åŠ¨"></a>JDK 1.8 çš„æ”¹åŠ¨</h6><p>JDK 1.7 ä½¿ç”¨åˆ†æ®µé”æœºåˆ¶æ¥å®ç°å¹¶å‘æ›´æ–°æ“ä½œï¼Œæ ¸å¿ƒç±»ä¸º Segmentï¼Œå®ƒç»§æ‰¿è‡ªé‡å…¥é” ReentrantLockï¼Œå¹¶å‘åº¦ä¸ Segment æ•°é‡ç›¸ç­‰ã€‚</p>
<p>JDK 1.8 ä½¿ç”¨äº† CAS æ“ä½œæ¥æ”¯æŒæ›´é«˜çš„å¹¶å‘åº¦ï¼Œåœ¨ CAS æ“ä½œå¤±è´¥æ—¶ä½¿ç”¨å†…ç½®é” synchronizedã€‚</p>
<p>å¹¶ä¸” JDK 1.8 çš„å®ç°ä¹Ÿåœ¨é“¾è¡¨è¿‡é•¿æ—¶ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</p>
<h4 id="LinkedHashMapï¼š"><a href="#LinkedHashMapï¼š" class="headerlink" title="LinkedHashMapï¼š"></a>LinkedHashMapï¼š</h4><p> ç»§æ‰¿è‡ª HashMapï¼Œå› æ­¤å…·æœ‰å’Œ HashMap ä¸€æ ·çš„å¿«é€ŸæŸ¥æ‰¾ç‰¹æ€§ã€‚ </p>
<p> å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨æ¥ç»´æŠ¤æ’å…¥é¡ºåºæˆ–è€… LRU é¡ºåºã€‚ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * The head (eldest) of the doubly linked list.</span><br><span class="line"> *&#x2F;</span><br><span class="line">transient LinkedHashMap.Entry&lt;K,V&gt; head;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * The tail (youngest) of the doubly linked list.</span><br><span class="line"> *&#x2F;</span><br><span class="line">transient LinkedHashMap.Entry&lt;K,V&gt; tail;</span><br></pre></td></tr></table></figure>

<p>accessOrder å†³å®šäº†é¡ºåºï¼Œé»˜è®¤ä¸º falseï¼Œæ­¤æ—¶ç»´æŠ¤çš„æ˜¯æ’å…¥é¡ºåºã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">final boolean accessOrder;</span><br></pre></td></tr></table></figure>

<p>LinkedHashMap æœ€é‡è¦çš„æ˜¯ä»¥ä¸‹ç”¨äºç»´æŠ¤é¡ºåºçš„å‡½æ•°ï¼Œå®ƒä»¬ä¼šåœ¨ putã€get ç­‰æ–¹æ³•ä¸­è°ƒç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void afterNodeAccess(Node&lt;K,V&gt; p) &#123; &#125;</span><br><span class="line">void afterNodeInsertion(boolean evict) &#123; &#125;</span><br></pre></td></tr></table></figure>

<h6 id="afterNodeAccess"><a href="#afterNodeAccess" class="headerlink" title="afterNodeAccess()"></a>afterNodeAccess()</h6><p>å½“ä¸€ä¸ªèŠ‚ç‚¹è¢«è®¿é—®æ—¶ï¼Œå¦‚æœ accessOrder ä¸º trueï¼Œåˆ™ä¼šå°†è¯¥èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å°¾éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´æŒ‡å®šä¸º LRU é¡ºåºä¹‹åï¼Œåœ¨æ¯æ¬¡è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¼šå°†è¿™ä¸ªèŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œä¿è¯é“¾è¡¨å°¾éƒ¨æ˜¯æœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆé“¾è¡¨é¦–éƒ¨å°±æ˜¯æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void afterNodeAccess(Node&lt;K,V&gt; e) &#123; &#x2F;&#x2F; move node to last</span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; last;</span><br><span class="line">    if (accessOrder &amp;&amp; (last &#x3D; tail) !&#x3D; e) &#123;</span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; p &#x3D;</span><br><span class="line">            (LinkedHashMap.Entry&lt;K,V&gt;)e, b &#x3D; p.before, a &#x3D; p.after;</span><br><span class="line">        p.after &#x3D; null;</span><br><span class="line">        if (b &#x3D;&#x3D; null)</span><br><span class="line">            head &#x3D; a;</span><br><span class="line">        else</span><br><span class="line">            b.after &#x3D; a;</span><br><span class="line">        if (a !&#x3D; null)</span><br><span class="line">            a.before &#x3D; b;</span><br><span class="line">        else</span><br><span class="line">            last &#x3D; b;</span><br><span class="line">        if (last &#x3D;&#x3D; null)</span><br><span class="line">            head &#x3D; p;</span><br><span class="line">        else &#123;</span><br><span class="line">            p.before &#x3D; last;</span><br><span class="line">            last.after &#x3D; p;</span><br><span class="line">        &#125;</span><br><span class="line">        tail &#x3D; p;</span><br><span class="line">        ++modCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="afterNodeInsertion"><a href="#afterNodeInsertion" class="headerlink" title="afterNodeInsertion()"></a>afterNodeInsertion()</h6><p>åœ¨ put ç­‰æ“ä½œä¹‹åæ‰§è¡Œï¼Œå½“ removeEldestEntry() æ–¹æ³•è¿”å› true æ—¶ä¼šç§»é™¤æœ€æ™šçš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨é¦–éƒ¨èŠ‚ç‚¹ firstã€‚</p>
<p>evict åªæœ‰åœ¨æ„å»º Map çš„æ—¶å€™æ‰ä¸º falseï¼Œåœ¨è¿™é‡Œä¸º trueã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterNodeInsertion</span><span class="params">(<span class="keyword">boolean</span> evict)</span> </span>&#123; <span class="comment">// possibly remove eldest</span></span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; first;</span><br><span class="line">    <span class="keyword">if</span> (evict &amp;&amp; (first = head) != <span class="keyword">null</span> &amp;&amp; removeEldestEntry(first)) &#123;</span><br><span class="line">        K key = first.key;</span><br><span class="line">        removeNode(hash(key), key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>removeEldestEntry() é»˜è®¤ä¸º falseï¼Œå¦‚æœéœ€è¦è®©å®ƒä¸º trueï¼Œéœ€è¦ç»§æ‰¿ LinkedHashMap å¹¶ä¸”è¦†ç›–è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼Œè¿™åœ¨å®ç° LRU çš„ç¼“å­˜ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œé€šè¿‡ç§»é™¤æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹ï¼Œä»è€Œä¿è¯ç¼“å­˜ç©ºé—´è¶³å¤Ÿï¼Œå¹¶ä¸”ç¼“å­˜çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">removeEldestEntry</span><span class="params">(Map.Entry&lt;K,V&gt; eldest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="LRU-ç¼“å­˜"><a href="#LRU-ç¼“å­˜" class="headerlink" title="LRU ç¼“å­˜"></a>LRU ç¼“å­˜</h4><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ LinkedHashMap å®ç°çš„ä¸€ä¸ª LRU ç¼“å­˜ï¼š</p>
<ul>
<li>è®¾å®šæœ€å¤§ç¼“å­˜ç©ºé—´ MAX_ENTRIES ä¸º 3ï¼›</li>
<li>ä½¿ç”¨ LinkedHashMap çš„æ„é€ å‡½æ•°å°† accessOrder è®¾ç½®ä¸º trueï¼Œå¼€å¯ LRU é¡ºåºï¼›</li>
<li>è¦†ç›– removeEldestEntry() æ–¹æ³•å®ç°ï¼Œåœ¨èŠ‚ç‚¹å¤šäº MAX_ENTRIES å°±ä¼šå°†æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ç§»é™¤ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">LinkedHashMap</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ENTRIES = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">removeEldestEntry</span><span class="params">(Map.Entry eldest)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size() &gt; MAX_ENTRIES;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LRUCache() &#123;</span><br><span class="line">        <span class="keyword">super</span>(MAX_ENTRIES, <span class="number">0.75f</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LRUCache&lt;Integer, String&gt; cache = <span class="keyword">new</span> LRUCache&lt;&gt;();</span><br><span class="line">    cache.put(<span class="number">1</span>, <span class="string">"a"</span>);</span><br><span class="line">    cache.put(<span class="number">2</span>, <span class="string">"b"</span>);</span><br><span class="line">    cache.put(<span class="number">3</span>, <span class="string">"c"</span>);</span><br><span class="line">    cache.get(<span class="number">1</span>);</span><br><span class="line">    cache.put(<span class="number">4</span>, <span class="string">"d"</span>);</span><br><span class="line">    System.out.println(cache.keySet());</span><br><span class="line">&#125;</span><br><span class="line">[<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>å®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºä¸äº‹åŠ¡éš”ç¦»çº§åˆ«</title>
    <url>/2020/06/04/%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA%E4%B8%8E%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/</url>
    <content><![CDATA[<h1 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h1><h4 id="äº‹åŠ¡è¯»ä¼ æ’­è¡Œä¸º"><a href="#äº‹åŠ¡è¯»ä¼ æ’­è¡Œä¸º" class="headerlink" title="äº‹åŠ¡è¯»ä¼ æ’­è¡Œä¸º"></a>äº‹åŠ¡è¯»ä¼ æ’­è¡Œä¸º</h4><h6 id="Â·-ä¿è¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­"><a href="#Â·-ä¿è¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­" class="headerlink" title="Â· ä¿è¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­"></a>Â· ä¿è¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­</h6><p>PROPAGATION_REQUIREDæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±æ–°å»ºä¸€ä¸ªï¼ˆé»˜è®¤ï¼‰<br>PROPAGATION_SUPPORTSæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¸é€‚ç”¨äº‹åŠ¡<br>PROPAGATION_MANDATORY æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼ŒæŠ›å‡ºå¼‚å¸¸</p>
<h6 id="Â·-ä¿è¯æ²¡æœ‰åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­"><a href="#Â·-ä¿è¯æ²¡æœ‰åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­" class="headerlink" title="Â· ä¿è¯æ²¡æœ‰åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­"></a>Â· ä¿è¯æ²¡æœ‰åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­</h6><p>PROPAGATION_REQUIRES_NEWå¦‚æœæœ‰äº‹åŠ¡å­˜åœ¨ï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡<br>PROPAGATION_NOT_SUPPORTED ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœæœ‰äº‹åŠ¡å­˜åœ¨ï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡<br>PROPAGATION_NEVER ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœæœ‰äº‹åŠ¡å­˜åœ¨ï¼ŒæŠ›å‡ºå¼‚å¸¸<br>PROPAGATION_NESTED å¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™åµŒå¥—äº‹åŠ¡æ‰§è¡Œ</p>
<h4 id="äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h4><p>DEFAULTè¿™æ˜¯ä¸€ä¸ªPlatfromTransactionManageré»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼›</p>
<h6 id="æœªæäº¤è¯»ï¼ˆread-uncommittedï¼‰ï¼š"><a href="#æœªæäº¤è¯»ï¼ˆread-uncommittedï¼‰ï¼š" class="headerlink" title="æœªæäº¤è¯»ï¼ˆread uncommittedï¼‰ï¼š"></a>æœªæäº¤è¯»ï¼ˆread uncommittedï¼‰ï¼š</h6><p>â€‹    äº‹åŠ¡çš„ä¿®æ”¹ï¼Œå³ä½¿å½“å‰äº‹åŠ¡æ²¡æœ‰è¢«æäº¤ï¼Œå¯¹å…¶ä»–äº‹åŠ¡è€Œè¨€ä¹Ÿæ˜¯å¯è§çš„ã€‚äº‹åŠ¡å¯ä»¥è¯»å–æœªæäº¤çš„æ•°æ®ï¼Œä¹Ÿç§°ä¸ºè„è¯»ã€‚è¿™ä¸ªçº§åˆ«ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ï¼Œæ€§èƒ½ä¸Šä¹Ÿä¸æ¯”å…¶ä»–çº§åˆ«å¥½å¤šå°‘ï¼Œä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼›</p>
<h6 id="å·²æäº¤è¯»ï¼ˆread-committedï¼‰ï¼š"><a href="#å·²æäº¤è¯»ï¼ˆread-committedï¼‰ï¼š" class="headerlink" title="å·²æäº¤è¯»ï¼ˆread committedï¼‰ï¼š"></a>å·²æäº¤è¯»ï¼ˆread committedï¼‰ï¼š</h6><p>â€‹    å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»Ÿçš„é»˜è®¤éš”ç¦»çº§åˆ«éƒ½æ˜¯read committedï¼ˆMysql ä¸æ˜¯ï¼‰ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹åˆ°å·²ç»æäº¤çš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹ã€‚æ¢ä¸ªè§’åº¦æ¥è®²ï¼Œå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ä»å¼€å§‹åˆ°æäº¤ä¹‹å‰ï¼Œæ‰€åšçš„æ“ä½œå¯¹åˆ«çš„æ“ä½œéƒ½æ˜¯ä¸å¯è§çš„ã€‚æ­¤éš”ç¦»çº§åˆ«ä¹Ÿè¢«ç§°ä¸ºï¼ˆ<strong>ä¸å¯é‡å¤è¯»</strong>ï¼‰ï¼Œå› ä¸ºå¤šæ¬¡æ‰§è¡ŒåŒæ ·çš„æŸ¥è¯¢è¯­å¥ï¼Œå¯èƒ½ä¼šå¾—å‡ºä¸ä¸€æ ·çš„ç»“æœï¼Œå› ä¸ºå¯èƒ½æœ‰åˆ«çš„äº‹åŠ¡æäº¤äº†ã€‚</p>
<h6 id="å¯é‡å¤è¯»ï¼ˆrepeatable-readï¼‰ï¼š"><a href="#å¯é‡å¤è¯»ï¼ˆrepeatable-readï¼‰ï¼š" class="headerlink" title="å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰ï¼š"></a>å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰ï¼š</h6><p>â€‹    repeatable readè§£å†³äº†è„è¯»çš„é—®é¢˜ï¼Œè¯¥éš”ç¦»çº§åˆ«ä¿è¯äº†åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æ¯æ¬¡è¯»å–éƒ½æ˜¯åŒæ ·çš„ç»“æœï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•è§£å†³å¹»è¯»çš„é—®é¢˜ã€‚ï¼ˆ<strong>å¹»è¯»ï¼š</strong>æŒ‡çš„æ˜¯å½“æŸä¸ªäº‹åŠ¡åœ¨è¯»å–æŸä¸ªèŒƒå›´å†…çš„è®°å½•æ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åˆåœ¨è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°çš„è®°å½•ï¼Œå½“ä¹‹å‰çš„äº‹åŠ¡å†è¯»å–è¯¥èŒƒå›´å†…çš„è®°å½•æ—¶ï¼Œä¼šäº§ç”Ÿå¹»è¡Œï¼›ï¼‰ã€è¿™æ˜¯é«˜æ€§èƒ½Mysqlä¸­çš„è§£é‡Šï¼Œæˆ‘çš„ä¸ªäººç†è§£ä¸ºï¼šå…ˆè¯»å–çš„äº‹åŠ¡è¯»ä¸åˆ°åæ¥æ–°æ·»åŠ çš„è®°å½•ï¼Œå¯¼è‡´è¯»å–ä¸å‡†ç¡®ã€‘ã€‚ä½†InnoDBå’ŒXtraDBå­˜å‚¨å¼•æ“é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰è§£å†³äº†å¹»è¯»çš„é—®é¢˜ï¼Œåé¢æˆ‘ä¼šè¯¦ç»†å†™åˆ°ã€‚</p>
<h6 id="å¯ä¸²è¡ŒåŒ–çš„ï¼ˆserializableï¼‰ï¼š"><a href="#å¯ä¸²è¡ŒåŒ–çš„ï¼ˆserializableï¼‰ï¼š" class="headerlink" title="å¯ä¸²è¡ŒåŒ–çš„ï¼ˆserializableï¼‰ï¼š"></a>å¯ä¸²è¡ŒåŒ–çš„ï¼ˆserializableï¼‰ï¼š</h6><p>å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œç”±äºå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„è¶…æ—¶å’Œé”äº‰ç”¨ï¼Œé€šå¸¸ä¸è€ƒè™‘ã€‚<br>MySQLé»˜è®¤ï¼šå¯é‡å¤è¯»<br>Oracleé»˜è®¤ï¼šå·²æäº¤è¯»</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>äº‹åŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>servletå­¦ä¹ ç¬”è®°</title>
    <url>/2020/05/04/servlet%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h3 id="1-Tomcatä¸»è¦åœ¨ç¨‹åºä¸­åšäº†äº›ä»€ä¹ˆï¼Ÿ"><a href="#1-Tomcatä¸»è¦åœ¨ç¨‹åºä¸­åšäº†äº›ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.Tomcatä¸»è¦åœ¨ç¨‹åºä¸­åšäº†äº›ä»€ä¹ˆï¼Ÿ"></a>1.Tomcatä¸»è¦åœ¨ç¨‹åºä¸­åšäº†äº›ä»€ä¹ˆï¼Ÿ</h3><p>1.1  åˆ›å»ºsocketç›‘å¬åœ¨å¯¹åº”çš„ç«¯å£</p>
<p>1.2  ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± </p>
<p>1.3  å½“æœ‰TCPè¿æ¥æ—¶åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†</p>
<p>1.4  ä»TCPè¿æ¥ä¸­è¯»å–æ•°æ®</p>
<p>1.5  æŒ‰ç…§HTTPåè®®è§£ææ•°æ®</p>
<p>1.6  å°†è§£æåçš„æ•°æ®åŒ…å°è£…åˆ°requestå¯¹è±¡ä¸­</p>
<p>1.7  æŒ‰ç…§web.xmlçš„æ˜ å°„å…³ç³»æ‰¾åˆ°å¯¹åº”çš„Servletç±»</p>
<p>1.8  å°†æœ€åçš„æ‰§è¡Œç»“æœresponseç»„è£…æˆHTTPåè®®æ ¼å¼çš„æ•°æ®åŒ…</p>
<p>1.9  é‡æ–°é€šè¿‡TCPè¿”å›ç»™å®¢æˆ·ç«¯</p>
<h3 id="2-è®¿é—®servlet-çš„è¿‡ç¨‹"><a href="#2-è®¿é—®servlet-çš„è¿‡ç¨‹" class="headerlink" title="2.è®¿é—®servlet çš„è¿‡ç¨‹"></a>2.è®¿é—®servlet çš„è¿‡ç¨‹</h3><p>2.1  connector è´Ÿè´£ç›‘å¬ç«¯â¼,å½“æœ‰é“¾æ¥è¿›æ¥æ—¶åˆ†é…çº¿ç¨‹å¹¶å®ä¾‹åŒ–HttpllProcessorå¯¹æ•°æ®è¿›â¾ HTTPåè®®è§£æ,ç„¶åå°†è¯·æ±‚äº¤ç»™å…¶æ‰€åœ¨çš„engineå³Catalinaæ¥å¤„ç†,å¤„ç†çš„æ˜¯åŸŸåå¯¹åº”çš„ipå’Œ ç«¯â¼8080 ,æ³¨æ„localhostä»»ç„¶æ²¡è¢«ä½¿â½¤ </p>
<p>2.2  engineå°†ä»HTTPè¯·æ±‚å¤´ä¸­è·å–hostå‚æ•°â½¤äºé€‰æ‹©â¼€ä¸ªåŒ¹é…çš„Host   å¤„ç†çš„æ˜¯ä¸»æœºå localhost(Hostå¯ä»¥é…ç½®å¤šä¸ª,å³ä½ å¯ä»¥åœ¨â¼€å°ç”µè„‘ä¸Šéƒ¨ç½²ä¸¤ä¸ªå®Œå…¨ä¸ç›¸å…³çš„webé¡¹â½¬ä¾‹å¦‚jd å’Œç™¾åº¦),æ­¤æ—¶å¤„ç†çš„æ˜¯åŸŸåå³localhost</p>
<p>2.3  Hostå°†åœ¨Contextä¸­æŸ¥æ‰¾åŒ¹é…ç¬¬â¼€çº§è·¯å¾„çš„Context(webé¡¹â½¬)   å¤„ç†çš„æ˜¯ç¬¬â¼€çº§è·¯å¾„(ServletLesson)</p>
<p>2.4  è¯»å–ServletLessoné¡¹â½¬çš„web.xmlé…ç½®,æŸ¥æ‰¾åŒ¹é…TestServletçš„Servlet</p>
<p>2.5  å®ä¾‹åŒ–Servlet,è°ƒâ½¤Serviceæ ¹æ®è¯·æ±‚ç±»å‹æ‰§â¾å¯¹åº”çš„Getæˆ–Post ,å¤„ç†çš„çœŸæ­£çš„å®¢æˆ·ç«¯è¯·æ±‚</p>
<p>2.6  Servletå“åº”â½…æ³•æ‰§â¾å®Œæ¯•å,å“åº”æ•°æ®ä¾æ¬¡è¿”å›-&gt;Context-&gt;Host-&gt;engine-&gt;connector</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>Servlet</tag>
        <tag>Tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>éƒ¨ç½²webåˆ°Tomcatçš„ä¸‰ç§æ–¹å¼</title>
    <url>/2020/05/04/%E9%83%A8%E7%BD%B2web%E5%88%B0Tomcat%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<p>è¿™é‡Œç®€å•çš„è®°å½•tomcatçš„éƒ¨ç½²æ–¹å¼ï¼š</p>
<p>ä¸€ã€ ç›´æ¥å°† web é¡¹ç›®æ–‡ä»¶ï¼ˆä¸€èˆ¬æ˜¯å¤åˆ¶ç”Ÿæˆçš„waråŒ…ï¼‰å¤åˆ¶åˆ°tomcatçš„webappsç›®å½•ä¸­ ï¼›</p>
<p>äºŒã€åœ¨tomcatä¸­çš„confç›®å½•ä¸‹çš„server.xmlæ–‡ä»¶ä¸­ï¼Œåœ¨<Host>èŠ‚ç‚¹ä¸­æ·»åŠ ä¸€ä¸ªcontextï¼Œå…·ä½“ä¸ºï¼š</Host></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">Path</span>=<span class="string">""</span> <span class="attr">Docbase</span>=<span class="string">"ç›®æ ‡ç›®å½•ä½ç½®"</span> <span class="attr">Debug</span>=<span class="string">"0"</span> <span class="attr">Privileged</span>=<span class="string">"True"</span> <span class="attr">Reloadable</span>=<span class="string">"True"</span>&gt;</span><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ Reloadable= â€œtrueâ€ è¿™ä¸ªå±æ€§æ˜¯æŒ‡tomcatåœ¨è¿è¡ŒçŠ¶æ€ä¸‹ä¼šè‡ªåŠ¨æ£€æµ‹åº”ç”¨ç¨‹åºçš„WEB-INF/classeså’ŒWEB-INF/libç›®å½•ä¸‹çš„classæ–‡ä»¶ï¼Œå¦‚æœç›‘æµ‹åˆ°æœ‰classæ–‡ä»¶æœ‰æ”¹åŠ¨ï¼ŒæœåŠ¡å™¨è‡ªåŠ¨åŠ è½½æ–°çš„webåº”ç”¨ç¨‹åºï¼Œå¯ä»¥åœ¨ä¸é‡èµ·tomcatçš„æƒ…å†µä¸‹æ”¹å˜åº”ç”¨ç¨‹åºï¼Œä¹Ÿå°±æ˜¯çƒ­éƒ¨ç½²ï¼›</p>
<p>ä¸€èˆ¬æˆ‘ä»¬ä¼šåœ¨å¼€å‘é˜¶æ®µå°†Reloadableå±æ€§è®¾ä¸ºtrueï¼Œæœ‰åŠ©äºè°ƒè¯•servletå’Œå…¶å®ƒçš„classæ–‡ä»¶ï¼Œä½†æ˜¯ç”±äºè¿™æ ·ä¼šå¢åŠ æœåŠ¡å™¨çš„è¿è¡Œè´Ÿè·ï¼ŒæŸè€—ç³»ç»Ÿæ€§èƒ½ï¼Œåœ¨é¡¹ç›®è¿è¡Œé˜¶æ®µå»ºè®®å°†å®ƒè®¾ä¸ºfalseã€‚</p>
<p>ä¸‰ã€ç›´æ¥å°†ç¼–è¯‘åçš„é¡¹ç›®å¤åˆ¶åˆ°webappsä¸­ï¼Œç›´æ¥è®¿é—®</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>Tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>Lambdaè¡¨è¾¾å¼å¸¸è§åº”ç”¨åœºæ™¯</title>
    <url>/2020/04/19/Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%B8%B8%E8%A7%81%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/</url>
    <content><![CDATA[<h3 id="ä¸€ã€é›†åˆä¸­çš„ä½¿ç”¨"><a href="#ä¸€ã€é›†åˆä¸­çš„ä½¿ç”¨" class="headerlink" title="ä¸€ã€é›†åˆä¸­çš„ä½¿ç”¨"></a>ä¸€ã€é›†åˆä¸­çš„ä½¿ç”¨</h3><ul>
<li><h5 id="é›†åˆçš„éå†"><a href="#é›†åˆçš„éå†" class="headerlink" title="é›†åˆçš„éå†"></a>é›†åˆçš„éå†</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–é›†åˆ</span></span><br><span class="line">List&lt;User&gt; users = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">users.add(<span class="keyword">new</span> User(<span class="string">"è©¹å§†å£«"</span>,<span class="number">22</span>,<span class="string">"ç”·"</span>));</span><br><span class="line">users.add(<span class="keyword">new</span> User(<span class="string">"éœ²è¥¿"</span>,<span class="number">21</span>,<span class="string">"å¥³"</span>));</span><br><span class="line">users.add(<span class="keyword">new</span> User(<span class="string">"å¼—å…°å…‹"</span>,<span class="number">25</span>,<span class="string">"ç”·"</span>));</span><br><span class="line">users.add(<span class="keyword">new</span> User(<span class="string">"çˆ±ä¸½ä¸"</span>,<span class="number">27</span>,<span class="string">"å¥³"</span>));</span><br><span class="line">users.add(<span class="keyword">new</span> User(<span class="string">"è·¯æ˜“æ–¯"</span>,<span class="number">22</span>,<span class="string">"ç”·"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†é›†åˆ Lambda</span></span><br><span class="line">users.stream().forEach(user -&gt; System.out.println(user));</span><br><span class="line"><span class="comment">// éå†é›†åˆ æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">users.stream().forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ³•å¼•ç”¨ï¼ˆ::åŒå†’å·æ“ä½œç¬¦ï¼‰</strong></p>
<ol>
<li><p>å…¶å®å°±æ˜¯ä¸€ç§Lambdaè¡¨è¾¾å¼çš„ç®€å†™æ–¹å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§å¼•ç”¨è€Œä¸æ‰§è¡Œæ–¹æ³•çš„æ–¹å¼ï¼Œè¿è¡Œæ—¶ï¼Œæ–¹æ³•å¼•ç”¨ä¼šåˆ›å»ºä¸€ä¸ªå‡½æ•°å¼æ¥å£çš„å®ä¾‹ã€‚</p>
</li>
<li><p>æ–¹æ³•å¼•ç”¨çš„äº”ç§æ–¹å¼ï¼š</p>
<table>
<thead>
<tr>
<th align="center">â€”-</th>
<th align="center">â€”-</th>
</tr>
</thead>
<tbody><tr>
<td align="center">å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•</td>
<td align="center">å¯¹è±¡::å®ä¾‹æ–¹æ³•å</td>
</tr>
<tr>
<td align="center">å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•</td>
<td align="center">ç±»::é™æ€æ–¹æ³•å</td>
</tr>
<tr>
<td align="center">å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•</td>
<td align="center">ç±»::å®ä¾‹æ–¹æ³•å</td>
</tr>
<tr>
<td align="center">å¼•ç”¨æ„é€ æ–¹æ³•</td>
<td align="center">ç±»::new</td>
</tr>
<tr>
<td align="center">æ•°ç»„å¼•ç”¨</td>
<td align="center">ç±»å‹::new</td>
</tr>
</tbody></table>
</li>
</ol>
</li>
<li><h5 id="Listè½¬Map"><a href="#Listè½¬Map" class="headerlink" title="Listè½¬Map"></a>Listè½¬Map</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œçš„toMapæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå–çš„åç§°ä¸º key,ç¬¬äºŒä¸ªå‚æ•° è¡¨ç¤ºæ•´ä¸ªuserå¯¹è±¡ä¸ºä¸€ä¸ª value,æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥ä¸åŠ ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¦‚æœ key å€¼æœ‰é‡å¤çš„ï¼Œå¦‚ä½•å¤„ç†</span></span><br><span class="line">Map&lt;String, User&gt; userMap = users.stream().collect(Collectors.toMap(User::getName, a -&gt; a, (k1, k2) -&gt; k1));</span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="å°†Liståˆ†ç»„"><a href="#å°†Liståˆ†ç»„" class="headerlink" title="å°†Liståˆ†ç»„"></a>å°†Liståˆ†ç»„</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®æ€§åˆ«è¿›è¡Œåˆ†ç±»</span></span><br><span class="line">Map&lt;String, List&lt;User&gt;&gt; groupBy = users.stream().collect(Collectors.groupingBy(User::getSex));</span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="é›†åˆè¿‡æ»¤"><a href="#é›†åˆè¿‡æ»¤" class="headerlink" title="é›†åˆè¿‡æ»¤"></a>é›†åˆè¿‡æ»¤</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿‡æ»¤å‡ºç”·æ€§</span></span><br><span class="line">List&lt;User&gt; filterList = users.stream().filter(user -&gt; user.getSex().equals(<span class="string">"ç”·"</span>)).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="é›†åˆæ±‚å’Œ"><a href="#é›†åˆæ±‚å’Œ" class="headerlink" title="é›†åˆæ±‚å’Œ"></a>é›†åˆæ±‚å’Œ</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¹´é¾„å’Œ</span></span><br><span class="line"><span class="keyword">int</span> sum = users.stream().mapToInt(User::getAge).sum();</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="äºŒã€ä»£æ›¿Runnable"><a href="#äºŒã€ä»£æ›¿Runnable" class="headerlink" title="äºŒã€ä»£æ›¿Runnable"></a>äºŒã€ä»£æ›¿Runnable</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ©ç”¨Lambdaå®ç°Runnableé‡Œçš„runæ–¹æ³•</span></span><br><span class="line">Runnable r = () -&gt; &#123;</span><br><span class="line">   System.out.println(Thread.currentThread().getName());</span><br><span class="line"> &#125;  ;</span><br><span class="line">Thread thread = <span class="keyword">new</span> Thread(r);</span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure>

<h3 id="ä¸‰ã€Predicateæ¡ä»¶è¿‡æ»¤"><a href="#ä¸‰ã€Predicateæ¡ä»¶è¿‡æ»¤" class="headerlink" title="ä¸‰ã€Predicateæ¡ä»¶è¿‡æ»¤"></a>ä¸‰ã€Predicateæ¡ä»¶è¿‡æ»¤</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>);</span><br><span class="line">       filter(numbers,number -&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> (<span class="keyword">int</span>)number &gt; <span class="number">2</span>;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è¿‡æ»¤æ–¹æ³•</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> list</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> condition</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">filter</span><span class="params">(List list, Predicate condition)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       list.forEach(number -&gt; &#123;</span><br><span class="line">           <span class="keyword">if</span> (condition.test(number))&#123;</span><br><span class="line">               System.out.println(number);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="å››ã€Mapæ˜ å°„"><a href="#å››ã€Mapæ˜ å°„" class="headerlink" title="å››ã€Mapæ˜ å°„"></a>å››ã€Mapæ˜ å°„</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†è¿”å›ä¸€ä¸ªå°†æ¯ä¸ªæ•°å­—éƒ½Ã—2çš„æ–°List</span></span><br><span class="line">List&lt;Integer&gt; mapList = numbers.stream().map(number -&gt; number * <span class="number">2</span>).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<h3 id="äº”ã€Reduceèšåˆ"><a href="#äº”ã€Reduceèšåˆ" class="headerlink" title="äº”ã€Reduceèšåˆ"></a>äº”ã€Reduceèšåˆ</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿”å›æ‰€æœ‰æˆå‘˜çš„å’Œ</span></span><br><span class="line">Integer sum = numbers.stream().reduce((x, y) -&gt; x + y).get();</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>Lambda</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVAåå°„æœºåˆ¶</title>
    <url>/2020/04/13/JAVA%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h1 id="JAVAåå°„æœºåˆ¶"><a href="#JAVAåå°„æœºåˆ¶" class="headerlink" title="JAVAåå°„æœºåˆ¶"></a>JAVAåå°„æœºåˆ¶</h1><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>javaåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤Ÿå¾—åˆ°è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½è°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º<strong>åå°„æœºåˆ¶</strong></p>
<h3 id="è·å–Classå¯¹è±¡çš„ä¸¤ç§æ–¹å¼"><a href="#è·å–Classå¯¹è±¡çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="è·å–Classå¯¹è±¡çš„ä¸¤ç§æ–¹å¼"></a>è·å–Classå¯¹è±¡çš„ä¸¤ç§æ–¹å¼</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1.å¦‚æœæˆ‘ä»¬çŸ¥é“å…·ä½“çš„ç±»,å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼Œ[ç±»å.class];ä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯ä¸çŸ¥é“å…·ä½“çš„ç±»çš„ï¼Œå¹¶ä¸”è¿˜éœ€è¦å¯¼å…¥ç±»çš„åŒ…ï¼Œä¾èµ–å¤ªå¼ºã€‚</span></span><br><span class="line">Class targetClass = TargetObject<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.é€šè¿‡[Class.forName()]å°æ‹¬å·ä¸­ä¼ å…¥ç±»çš„å­—ç¬¦ä¸²è·¯å¾„è·å–ï¼Œå­—ç¬¦ä¸²å¯ä»¥å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚</span></span><br><span class="line">Class targetClass = Class.forName(<span class="string">"frosro.test.TargetObject"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.å…¶å®è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œç»§æ‰¿è‡ªObjectç±»çš„getClassæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼Œä½†è¿™æ ·å¯¹è±¡éƒ½å·²ç»å­˜åœ¨äº†ï¼Œæˆ‘ä»¬å†ç”¨åå°„å°±å¤šæ­¤ä¸€ä¸¾äº†ã€‚</span></span><br><span class="line">TargetObject targetObject = <span class="keyword">new</span> TargetObject();</span><br><span class="line">Class targetClass = targetObject.getClass();</span><br></pre></td></tr></table></figure>

<h3 id="ä»£ç æ¼”ç¤º"><a href="#ä»£ç æ¼”ç¤º" class="headerlink" title="ä»£ç æ¼”ç¤º"></a>ä»£ç æ¼”ç¤º</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæˆ‘ä»¬å°†è¦æ“ä½œçš„ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> fanshe;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> sy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 21:35</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TargetObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TargetObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        value = <span class="string">"initVal"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicMethod</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I love "</span> + s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">privateMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"value is "</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨åå°„æ¥æ“ä½œè¿™ä¸ªç±»çš„æ–¹æ³•å’Œå‚æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package fanshe;</span><br><span class="line"></span><br><span class="line">import java.lang.annotation.Annotation;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.InvocationTargetException;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author sy</span><br><span class="line"> * @data \ 21:36</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException, NoSuchFieldException &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è·å–TargetObjectç±»çš„Classå¯¹è±¡</span><br><span class="line">        Class&lt;?&gt; tagetClass  &#x3D; Class.forName(&quot;fanshe.TargetObject&quot;);</span><br><span class="line">        &#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªTargetObjectç±»çš„å®ä¾‹</span><br><span class="line">        TargetObject targetObject &#x3D; (TargetObject)tagetClass .newInstance();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è·å–ç±»ä¸­æ‰€æœ‰å®šä¹‰çš„æ–¹æ³•</span><br><span class="line">        Method[] methods &#x3D; tagetClass.getDeclaredMethods();</span><br><span class="line">        for (Method method : methods) &#123;</span><br><span class="line">            &#x2F;&#x2F; å¾ªç¯è¾“å‡ºæ–¹æ³•åç§°</span><br><span class="line">            System.out.println(method.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è·å–æŒ‡å®šæ–¹æ³•å¹¶è°ƒç”¨</span><br><span class="line">        Method publicMethod &#x3D; tagetClass.getDeclaredMethod(&quot;publicMethod&quot;, String.class);</span><br><span class="line">        publicMethod.invoke(targetObject,&quot;frosro&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è·å–æŒ‡å®šå‚æ•°</span><br><span class="line">        Field field &#x3D; tagetClass.getDeclaredField(&quot;value&quot;);</span><br><span class="line">        &#x2F;&#x2F; å–æ¶ˆå®‰å…¨æ£€æŸ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¿é—®åˆ°ç§æœ‰çš„å±æ€§å’Œæ–¹æ³•</span><br><span class="line">        field.setAccessible(true);</span><br><span class="line">        &#x2F;&#x2F; å¯¹å‚æ•°è¿›è¡Œä¿®æ”¹</span><br><span class="line">        field.set(targetObject,&quot;frosro&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è°ƒç”¨ç§æœ‰çš„æ–¹æ³•</span><br><span class="line">        Method privateMethod &#x3D; tagetClass.getDeclaredMethod(&quot;privateMethod&quot;);</span><br><span class="line">        privateMethod.setAccessible(true);</span><br><span class="line">        privateMethod.invoke(targetObject);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰å…¶ä»–å¾ˆå¤šæ–¹æ³•ï¼Œå¯ä»¥ç¿»çœ‹æ–‡æ¡£æŸ¥æ‰¾ï¼›</p>
<h3 id="åå°„æœºåˆ¶ä¼˜ç¼ºç‚¹"><a href="#åå°„æœºåˆ¶ä¼˜ç¼ºç‚¹" class="headerlink" title="åå°„æœºåˆ¶ä¼˜ç¼ºç‚¹"></a>åå°„æœºåˆ¶ä¼˜ç¼ºç‚¹</h3><ul>
<li><p>ä¼˜ç‚¹ï¼š è¿è¡ŒæœŸç±»å‹çš„åˆ¤æ–­ï¼ŒåŠ¨æ€åŠ è½½ç±»ï¼Œæé«˜ä»£ç çµæ´»åº¦ã€‚ </p>
</li>
<li><p>ç¼ºç‚¹ï¼š  </p>
<p>1.æ€§èƒ½ç“¶é¢ˆï¼šåå°„ç›¸å½“äºä¸€ç³»åˆ—è§£é‡Šæ“ä½œï¼Œé€šçŸ¥ JVM è¦åšçš„äº‹æƒ…ï¼Œæ€§èƒ½æ¯”ç›´æ¥çš„ java ä»£ç è¦æ…¢å¾ˆå¤šã€‚</p>
<p>2.å®‰å…¨é—®é¢˜ï¼šè®©æˆ‘ä»¬å¯ä»¥åŠ¨æ€æ“ä½œæ”¹å˜ç±»çš„å±æ€§åŒæ—¶ä¹Ÿå¢åŠ äº†ç±»çš„å®‰å…¨éšæ‚£ã€‚ </p>
</li>
</ul>
<h3 id="åå°„çš„åº”ç”¨åœºæ™¯"><a href="#åå°„çš„åº”ç”¨åœºæ™¯" class="headerlink" title="åå°„çš„åº”ç”¨åœºæ™¯"></a>åå°„çš„åº”ç”¨åœºæ™¯</h3><p>åœ¨æˆ‘ä»¬å¹³æ—¶çš„é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒåŸºæœ¬ä¸Šå¾ˆå°‘ä¼šç›´æ¥ä½¿ç”¨åˆ°åå°„æœºåˆ¶ï¼Œä½†è¿™ä¸èƒ½è¯´æ˜åå°„æœºåˆ¶æ²¡æœ‰ç”¨ï¼Œå®é™…ä¸Šæœ‰å¾ˆå¤šè®¾è®¡ã€å¼€å‘éƒ½ä¸åå°„æœºåˆ¶æœ‰å…³ï¼Œä¾‹å¦‚æ¨¡å—åŒ–çš„å¼€å‘ï¼Œé€šè¿‡åå°„å»è°ƒç”¨å¯¹åº”çš„å­—èŠ‚ç ï¼›åŠ¨æ€ä»£ç†è®¾è®¡æ¨¡å¼ä¹Ÿé‡‡ç”¨äº†åå°„æœºåˆ¶ï¼Œè¿˜æœ‰æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ Springï¼Hibernate ç­‰æ¡†æ¶ä¹Ÿå¤§é‡ä½¿ç”¨åˆ°äº†åå°„æœºåˆ¶ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<ol>
<li>æˆ‘ä»¬åœ¨ä½¿ç”¨ JDBC è¿æ¥æ•°æ®åº“æ—¶ä½¿ç”¨ <code>Class.forName()</code>é€šè¿‡åå°„åŠ è½½æ•°æ®åº“çš„é©±åŠ¨ç¨‹åºï¼›</li>
<li>Spring æ¡†æ¶çš„ IOCï¼ˆåŠ¨æ€åŠ è½½ç®¡ç† Beanï¼‰åˆ›å»ºå¯¹è±¡ä»¥åŠ AOPï¼ˆåŠ¨æ€ä»£ç†ï¼‰åŠŸèƒ½éƒ½å’Œåå°„æœ‰è”ç³»ï¼›</li>
<li>åŠ¨æ€é…ç½®å®ä¾‹çš„å±æ€§ï¼›</li>
</ol>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>åå°„</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVAé›†åˆçš„å¤šç§éå†æ–¹å¼æ€»ç»“</title>
    <url>/2020/03/29/JAVA%E9%9B%86%E5%90%88%E7%9A%84%E5%A4%9A%E7%A7%8D%E9%81%8D%E5%8E%86%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<ol>
<li>Collection é›†åˆ :  æ€»çš„æ¥è¯´åˆ†ä¸ºä»¥ä¸‹è¿™ä¸‰ç±»ï¼Œè¿™é‡Œæ›´å¤šçš„å­ç±»æˆ‘ä¾¿ä¸åœ¨é˜è¿°äº†ã€‚</li>
</ol>
<ul>
<li>Set ï¼š æ— åºé›†åˆï¼Œå…ƒç´ ä¸å¯é‡å¤ï¼›</li>
<li>Queue  ï¼š é˜Ÿåˆ—ï¼›</li>
<li>List ï¼š æœ‰åºé›†åˆï¼Œå…ƒç´ å¯ä»¥é‡å¤ï¼›</li>
</ul>
<ol start="2">
<li>Mapé›†åˆ ï¼šä¸€èˆ¬ç”¨äºä¿å­˜æ‹¥æœ‰æ˜ å°„å…³ç³»çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ key-value é”®å€¼å¯¹ï¼Œå®ƒä¹Ÿæœ‰å¾ˆå¤šå­ç±»ï¼Œè¿™é‡Œä¸ç»†è¯´ï¼›</li>
</ol>
<hr>
<p>æœ¬æ–‡ä»¥HashSet ä¸ºä¾‹ï¼Œæ€»ç»“éå†æ–¹å¼ã€‚å½“ç„¶åƒListè¿™ç§æœ‰åºé›†åˆè¿˜å¯ä»¥é€šè¿‡forå¾ªç¯çš„æ–¹å¼éå†ã€‚</p>
<p><strong>ä¸‹é¢æ˜¯ä¸»è¦å†…å®¹ï¼š</strong></p>
<h3 id="ä¸€ã€ä½¿ç”¨-Lambda-è¡¨è¾¾å¼éå†é›†åˆ"><a href="#ä¸€ã€ä½¿ç”¨-Lambda-è¡¨è¾¾å¼éå†é›†åˆ" class="headerlink" title="ä¸€ã€ä½¿ç”¨ Lambda è¡¨è¾¾å¼éå†é›†åˆ"></a>ä¸€ã€ä½¿ç”¨ Lambda è¡¨è¾¾å¼éå†é›†åˆ</h3><p>ä» JDK8 å¼€å§‹ï¼ŒIterable æ¥å£æ–°å¢äº† forEach(Consumer action)æ–¹æ³•ï¼Œä¸»è¦ æ˜¯ä½¿ç”¨ Lambda è¡¨è¾¾å¼æ›´åŠ ç®€æ´çš„æ“ä½œã€‚Consumer å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥ å£ï¼Œåªè¦æ˜¯å‡½æ•°å¼æ¥å£ï¼Œéƒ½èƒ½å¤Ÿä½¿ç”¨ Lambda è¡¨ç¤ºæ¥è¿›è¡Œæ›¿ä»£ã€‚åœ¨è°ƒç”¨è¿™ ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œå…¶å®ä¼šä¾æ¬¡å°†é›†åˆçš„å…ƒç´ ä¼ é€’ç»™ Consumer ä¸­çš„ accept(T t) æ–¹æ³•å»å¤„ç†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author frosro</span><br><span class="line"> * @data 21:34</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class CollectionEach &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        HashSet&lt;String&gt; books &#x3D; new HashSet&lt;&gt;();</span><br><span class="line">        books.add(&quot;ç¼–ç¨‹æ€æƒ³&quot;);</span><br><span class="line">        books.add(&quot;æ ¸å¿ƒæŠ€æœ¯&quot;);</span><br><span class="line">        books.add(&quot;ä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;);</span><br><span class="line">        books.forEach(str -&gt; System.out.println(&quot;ä¹¦åï¼š&quot;  + str));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="äºŒã€-ä½¿ç”¨-Iterator-éå†é›†åˆå…ƒç´ "><a href="#äºŒã€-ä½¿ç”¨-Iterator-éå†é›†åˆå…ƒç´ " class="headerlink" title="äºŒã€ ä½¿ç”¨ Iterator éå†é›†åˆå…ƒç´ "></a>äºŒã€ ä½¿ç”¨ Iterator éå†é›†åˆå…ƒç´ </h3><p>Iterator ä¸»è¦ç”¨æ¥éå† Conllection é›†åˆä¸­çš„å…ƒç´ ï¼Œä¹Ÿå«è¿­ä»£å™¨ã€‚å®ƒåªèƒ½ç”¨äºéå†é›†åˆã€‚</p>
<p>å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>hasNext()ï¼šåˆ¤æ–­é›†åˆä¸­è¿˜æœ‰æ²¡æœ‰å…ƒç´ ï¼Œå¦‚æœæœ‰åˆ™è¿”å› trueã€‚ </li>
<li>next()ï¼šå–å‡ºé›†åˆä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ </li>
<li>remove()ï¼šç§»é™¤ä¸Šé¢ next() æ–¹æ³•ä¸­è¯»å–çš„å…ƒç´ ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author frosro</span><br><span class="line"> * @data 21:48</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class IteratorTest &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        HashSet&lt;String&gt; books &#x3D; new HashSet&lt;&gt;();</span><br><span class="line">        books.add(&quot;ç¼–ç¨‹æ€æƒ³&quot;);</span><br><span class="line">        books.add(&quot;æ ¸å¿ƒæŠ€æœ¯&quot;);</span><br><span class="line">        books.add(&quot;ä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; é€šè¿‡ iterator() æ–¹æ³•ï¼Œè·å– books é›†åˆå¯¹åº”çš„è¿­ ä»£å™¨</span><br><span class="line">        Iterator&lt;String&gt; iterator &#x3D; books.iterator();</span><br><span class="line"></span><br><span class="line">        while (iterator.hasNext())&#123;</span><br><span class="line">            String next &#x3D; iterator.next();</span><br><span class="line">            System.out.println(next);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; å¯¹ next å˜é‡èµ‹å€¼ï¼Œä¸ä¼šæ”¹å˜é›†åˆå…ƒç´ æœ¬èº«</span><br><span class="line">            &#x2F;&#x2F; Iterator å¹¶ä¸ä¼šæŠŠé›†åˆå…ƒç´ æœ¬èº«äº¤ç»™è¿­ä»£å˜ é‡ï¼Œ</span><br><span class="line">            &#x2F;&#x2F; è€Œæ˜¯æŠŠé›†åˆå…ƒç´ çš„å€¼äº¤ç»™äº†è¿­ä»£å˜é‡</span><br><span class="line">            &#x2F;&#x2F; æ‰€ä»¥åœ¨ä¿®æ”¹è¿­ä»£å˜é‡çš„å€¼ä¹‹åå¯¹é›†åˆè¿œå¤ä¸‰æœ¬èº«å¹¶ æ²¡æœ‰ä»»ä½•è¦†ç›–ã€‚</span><br><span class="line">            next &#x3D; &quot;è®¾è®¡æ¨¡å¼&quot;;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; å¦‚æœæˆ‘ä»¬åœ¨ä½¿ç”¨è¿­ä»£å™¨çš„è¿‡ç¨‹ä¸­æ”¹å˜äº†é›†åˆå…ƒç´ çš„å€¼ï¼Œä¹Ÿå°±æ˜¯books,æ¯”å¦‚</span><br><span class="line">            &#x2F;&#x2F; books.remove(next);</span><br><span class="line">            &#x2F;&#x2F; ä¸Šé¢è¿™è¡Œä»£ç è¿è¡Œä¼šæŠ¥ ConcurrentModificationException å¼‚å¸¸</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(books);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ¬è´¨ä¸Šï¼Œæ˜¯å› ä¸º Iterator è¿­ä»£å™¨ä½¿ç”¨äº† fail-fast æœºåˆ¶ï¼ˆå¿«é€Ÿå¤±è´¥æœºåˆ¶ï¼‰ï¼Œ åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¸€æ—¦å‘ç°æœ‰å…¶ä»–çº¿ç¨‹æ¥ä¿®æ”¹è¯¥é›†åˆï¼Œåˆ™é©¬ä¸ŠæŠ¥ ConcurrentModicationException å¼‚å¸¸ï¼Œè¿™æ ·åšå¯ä»¥é¿å…å…±äº«èµ„æºè€ŒåŸ‹ä¸‹å…¶ä»–éšæ‚£é—®é¢˜ã€‚</p>
<h3 id="ä¸‰ã€-ä½¿ç”¨-Lambda-è¡¨è¾¾å¼éå†-Iterator"><a href="#ä¸‰ã€-ä½¿ç”¨-Lambda-è¡¨è¾¾å¼éå†-Iterator" class="headerlink" title="ä¸‰ã€ ä½¿ç”¨ Lambda è¡¨è¾¾å¼éå† Iterator"></a>ä¸‰ã€ ä½¿ç”¨ Lambda è¡¨è¾¾å¼éå† Iterator</h3><p>æ ¸å¿ƒæ–¹æ³•ï¼š</p>
<ul>
<li>forEachRemaining()ï¼šJDK8 æ–°å¢æ–¹æ³•ï¼Œä½¿ç”¨ Lambda è¡¨è¾¾å¼æ¥éå†é›†åˆå…ƒç´ ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author frosro</span><br><span class="line"> * @data 22:06</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class IteratorEach &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        HashSet&lt;String&gt; books &#x3D; new HashSet&lt;&gt;();</span><br><span class="line">        books.add(&quot;ç¼–ç¨‹æ€æƒ³&quot;);</span><br><span class="line">        books.add(&quot;æ ¸å¿ƒæŠ€æœ¯&quot;);</span><br><span class="line">        books.add(&quot;ä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;);</span><br><span class="line"></span><br><span class="line">        Iterator&lt;String&gt; iterator &#x3D; books.iterator();</span><br><span class="line"></span><br><span class="line">        iterator.forEachRemaining(str -&gt; System.out.println(&quot;è¿­ä»£é›†åˆå…ƒç´ ï¼š&quot; + str));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å››ã€-ä½¿ç”¨-foreach-å¾ªç¯éå†é›†åˆå…ƒç´ "><a href="#å››ã€-ä½¿ç”¨-foreach-å¾ªç¯éå†é›†åˆå…ƒç´ " class="headerlink" title="å››ã€  ä½¿ç”¨ foreach å¾ªç¯éå†é›†åˆå…ƒç´ "></a>å››ã€  ä½¿ç”¨ foreach å¾ªç¯éå†é›†åˆå…ƒç´ </h3><p>foreach å¾ªç¯ï¼Œæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ç§éå†æ–¹å¼ã€‚å¦å¤–ï¼Œforeach å¾ªç¯ä¸­è¿­ä»£å˜é‡ä¹Ÿä¸æ˜¯é›†åˆå…ƒç´ æœ¬èº«ï¼Œå…¶å®ä¹Ÿæ˜¯æŠŠæ¯ä¸ªé›†åˆå…ƒç´ çš„å€¼èµ‹ç»™äº†è¿­ä»£å˜é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author frosro</span><br><span class="line"> * @data 22:13</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class ForeachTest &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        HashSet&lt;String&gt; books &#x3D; new HashSet&lt;&gt;();</span><br><span class="line">        books.add(&quot;ç¼–ç¨‹æ€æƒ³&quot;);</span><br><span class="line">        books.add(&quot;æ ¸å¿ƒæŠ€æœ¯&quot;);</span><br><span class="line">        books.add(&quot;ä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;);</span><br><span class="line"></span><br><span class="line">        for (String book : books) &#123;</span><br><span class="line">            System.out.println(book);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; æ”¹å˜bookçš„å€¼ï¼Œå¹¶ä¸ä¼šæ”¹å˜booksé›†åˆçš„æ•°æ®</span><br><span class="line">            &#x2F;&#x2F; å› ä¸ºbookåªæ˜¯ä¿å­˜ç€bookså…¶ä¸­çš„ä¸€ä¸ªå€¼</span><br><span class="line">            book &#x3D; &quot;è®¾è®¡æ¨¡å¼&quot;;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½åœ¨éå†æ—¶æ”¹å˜åŸæœ‰çš„é›†åˆbooks</span><br><span class="line">            &#x2F;&#x2F; å¦‚æœåƒä¸‹é¢è¿™ç§æ–¹å¼ï¼Œä¼šæŠ¥ ConcurrentModificationException</span><br><span class="line">            &#x2F;&#x2F; books.remove(book);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(books);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="äº”ã€-ä½¿ç”¨-Streaméå†é›†åˆ"><a href="#äº”ã€-ä½¿ç”¨-Streaméå†é›†åˆ" class="headerlink" title="äº”ã€  ä½¿ç”¨ Streaméå†é›†åˆ"></a>äº”ã€  ä½¿ç”¨ Streaméå†é›†åˆ</h3><p>JDK8 æ–°å¢äº† Streamã€IntStreamã€LongStreamã€DoubleStream ç­‰å¼ºæ‚çš„ æµå¼ APIï¼Œä»£è¡¨å¤šä¸ªæ”¯æŒä¸²è¡Œ &amp; å¹¶è¡Œèšé›†æ“ä½œçš„å…ƒç´ ã€‚è¿˜å¯ä»¥é€šè¿‡ç‰¹åˆ«æ ä¾›çš„ Builder æ¥åˆ›å»ºå¯¹åº”çš„æµã€‚</p>
<p>ä½¿ç”¨æ­¥éª¤ï¼š</p>
<p> 1ï¼‰ä½¿ç”¨ Stream æˆ– XxxStream çš„ builder() æ–¹æ³•åˆå§‹åŒ–å¯¹åº” çš„ Builderã€‚<br>2ï¼‰å¤šæ¬¡è°ƒç”¨ Builder çš„ add() æ–¹æ³•ï¼Œæ·»åŠ å…ƒç´ <br>3ï¼‰è°ƒç”¨ Builder çš„ build() æ–¹æ³•è·å–å¯¹åº”çš„ Streamã€‚<br>4ï¼‰è°ƒç”¨ Stream çš„èšé›†æ–¹æ³•ã€‚ï¼ˆå…·ä½“å‚è€ƒ API æ–‡æ¡£ï¼‰</p>
<p>Stream æä¾›äº†å¾ˆå¤šæ–¹æ³•ï¼Œå¯ä»¥å½’ç±»ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>Intermediateï¼ˆä¸­é—´æ–¹æ³•ï¼‰<br>ä¸­é—´æ–¹æ³•ï¼ŒæŒ‡çš„æ˜¯ä¸­é—´æ“ä½œå…è®¸æµä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå¹¶å…è®¸ç›´æ¥è°ƒç”¨åç»­æ–¹ æ³•ï¼Œä¸­é—´æ–¹æ³•çš„è¿”å›å€¼æ˜¯å¦å¤–ä¸€ä¸ªæµã€‚</li>
<li>Terminalï¼ˆæœ«ç«¯æ–¹æ³•ï¼‰<br>æœ«ç«¯æ–¹æ³•ï¼ŒæŒ‡çš„æ˜¯å¯¹æµçš„ç»ˆæ“ä½œï¼Œæ‰§è¡Œè¿‡åï¼Œè¯¥æµå°±ä¼šè¢«â€œæ¶ˆè€—â€ä¸”ä¸å†å¯ç”¨ã€‚å› ä¸ºæˆ‘ä»¬åœ¨æ“ä½œçš„æ—¶å€™ï¼Œæ˜¯åœ¨å†…å­˜ä¸­çš„ç¼“å­˜ä¸­ï¼Œå¦‚æœæ“ä½œå®Œæ¯•ï¼Œå®ƒå°†ä¼šä»ç¼“å†²ä¸­åˆ·æ–°flush() å‡ºæ¥ï¼Œå°±ä¸èƒ½å†æ”¹äº†ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author frosro</span><br><span class="line"> * @data 22:29</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class IntStreamTest &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">       Stream stream &#x3D; Stream.builder()</span><br><span class="line">               .add(&quot;ç¼–ç¨‹æ€æƒ³&quot;)</span><br><span class="line">                .add(&quot;æ ¸å¿ƒæŠ€æœ¯&quot;)</span><br><span class="line">                .add(&quot;ä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;).build();</span><br><span class="line"></span><br><span class="line">       &#x2F;&#x2F; å½“ç„¶ï¼Œè¿™é‡Œä¸å¯é¿å…çš„ç”¨åˆ°äº†forEach</span><br><span class="line">       stream.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…æ˜¯è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author frosro</span><br><span class="line"> * @data 22:29</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class IntStreamTest &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        HashSet&lt;String&gt; books &#x3D; new HashSet&lt;&gt;();</span><br><span class="line">        books.add(&quot;ç¼–ç¨‹æ€æƒ³&quot;);</span><br><span class="line">        books.add(&quot;æ ¸å¿ƒæŠ€æœ¯&quot;);</span><br><span class="line">        books.add(&quot;ä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;);</span><br><span class="line"></span><br><span class="line">        books.stream().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯èƒ½ä½ ä¼šè§‰å¾—è¿™å’Œç¬¬ä¸€ç§æ–¹å¼å¾ˆåƒï¼Œæˆ‘æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè¿™ä¸¤è€…æ•ˆç‡ä¹Ÿç›¸å·®æ— å‡ ã€‚<br>ä½†æ˜¯streamæµå´æ˜¯ç›®å‰å¿…é¡»æŒæ¡çš„æ–¹å¼ã€‚å› ä¸ºå®ƒçš„ä¸€äº›å…¶ä»–ç”¨æ³•éƒ½é¢‡ä¸ºé‡è¦ã€‚</p>
]]></content>
      <categories>
        <category>ğŸºJAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>å¾ªç¯</tag>
        <tag>é›†åˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘çš„ç¬¬ä¸€ç¯‡åšæ–‡</title>
    <url>/2020/03/28/myfirstPage/</url>
    <content><![CDATA[<p>æˆ‘çš„ä¸ªäººåšå®¢ç®—æ˜¯å»ºç«‹äº†ï¼Œä¸­é—´é‡åˆ°æ¯”è¾ƒå‘çš„å°±æ˜¯ï¼Œæˆ‘æƒ³è¦ä½¿ç”¨javaåšåˆ†ç±»ï¼Œä½†æ€»æ˜¯æŠ¥404ï¼Œä½†æ˜¯JAVAå´å¯ä»¥ï¼Œæ²¡æ‰¾åˆ°åŸå› ï¼›è¿˜æœ‰å°±æ˜¯é˜¿é‡Œäº‘çš„åŸŸåçœŸçš„æ˜¯å‘ï¼Œæäº¤äº†åå‡ ä¸ªå®åè®¤è¯è¿˜æ˜¯æ²¡é€šè¿‡ï¼Œå¤ªè€ƒéªŒè€å¿ƒäº†ã€‚markdownè¿˜ä¸å¤ªä¼šç”¨ï¼Œæ¸æ¸ç†Ÿç»ƒå§ï¼Œä¹‹åæˆ‘ä¼šæŠŠé‡åˆ°çš„å¥½çš„ç»éªŒåˆ†äº«åˆ°è¿™ä¸ªåšå®¢ï¼Œå…¶ä»–æ•™ç¨‹ä»€ä¹ˆçš„ç½‘ä¸Šå¤ªå¤šäº†ï¼Œæˆ‘å°±ä¸åœ¨è¿™ä¸Šé¢æ·»åŠ äº†ï¼Œæˆ‘åªå†™æˆ‘è®¤ä¸ºæœ‰ä»·å€¼çš„åšæ–‡ï¼Œå¦‚æœå“ªä½åŒå­¦æœ‰é—®é¢˜æˆ–è€…æƒ³è¦å’Œæˆ‘åœ¨æŠ€æœ¯ä¸Šäº¤æµï¼Œå¯ä»¥è”ç³»æˆ‘ï¼Œæˆ‘ä¼šéå¸¸ä¹æ„åˆ†äº«æˆ‘æ‰€çŸ¥é“çš„ä¿¡æ¯ã€‚å¤§å®¶ä¸€èµ·å­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ä¸ºç¤¾ä¼šä¸»ä¹‰åšè´¡çŒ®ï¼</p>
]]></content>
      <categories>
        <category>ğŸŸå°å°è®°</category>
      </categories>
      <tags>
        <tag>å†å²</tag>
      </tags>
  </entry>
</search>
